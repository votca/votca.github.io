{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-16T07:09:12.215890Z",
     "iopub.status.busy": "2022-09-16T07:09:12.215349Z",
     "iopub.status.idle": "2022-09-16T07:09:24.057034Z",
     "shell.execute_reply": "2022-09-16T07:09:24.056298Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2023-dev gitid: 3134d80 (compiled Sep 16 2022, 06:58:11)\r\n",
      "votca_csg, version 2023-dev gitid: 3134d80 (compiled Sep 16 2022, 06:37:06)\r\n",
      "votca_tools, version 2023-dev gitid: 3134d80 (compiled Sep 16 2022, 06:33:22)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 BohrA\r\n",
      "    0.306708   6.1626e-14 -1.22458e-10 -3.90429e-10  -4.4143e-14   -0.0516336  2.61579e-13 -2.63119e-13  6.53033e-14 -2.30218e-06    0.0181563   3.8635e-14  1.59419e-05   -0.0389795  3.77499e-14    0.0421241  1.94744e-11 -2.61567e-11 -3.30273e-14 -3.59262e-14   4.2884e-07     0.108303  -1.6043e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 6.16751e-14     0.306708  2.68577e-13  2.70069e-13   -0.0516336 -4.41942e-14  1.74359e-09 -2.01157e-09  5.34415e-10   -0.0181563 -2.30218e-06  3.16684e-10    0.0389795  1.59419e-05    0.0421241  3.76378e-14  9.25971e-14 -8.97071e-14  -3.2947e-10 -3.36152e-10     0.108303  -4.2884e-07  5.40562e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.22458e-10  2.68577e-13     0.319156   -0.0100481   1.7076e-13 -4.19801e-11  2.92357e-05 -2.92357e-05   1.0926e-05 -9.88616e-14 -4.28643e-11  4.67574e-06 -6.23219e-14 -2.56197e-11 -6.17731e-14  1.63904e-11    0.0495092  -0.00204416 -3.85285e-06  1.55595e-05   9.2976e-13 -1.58329e-11    0.0252874          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.90429e-10  2.70069e-13   -0.0100481     0.319156  1.68612e-13    3.679e-10  2.92357e-05 -2.92357e-05   1.0926e-05 -9.08307e-14 -1.10116e-10  4.67574e-06 -5.93562e-14 -3.30932e-11 -6.03297e-14 -3.13124e-10   0.00204416   -0.0495092  1.55595e-05 -3.85285e-06  9.30533e-13 -5.25146e-10    0.0252874          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-4.41484e-14   -0.0516336   1.7076e-13  1.68612e-13     0.490609  8.04387e-15  1.69885e-09 -1.28897e-09   7.5566e-10    0.0134761  1.70873e-06  2.05863e-10    0.0080157  3.27827e-06    0.0309388 -1.28081e-13   5.3489e-14 -5.52132e-14 -1.87759e-10 -1.83891e-10    -0.053272  2.10938e-07  8.78267e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0516336  -4.4225e-14 -4.19801e-11    3.679e-10  7.99208e-15     0.490609  1.63929e-13 -1.61731e-13  9.26996e-14  1.70873e-06   -0.0134761   2.5327e-14  3.27827e-06   -0.0080157 -1.28165e-13    0.0309388 -1.41582e-11  1.80255e-11 -2.81931e-14 -2.64847e-14 -2.10938e-07    -0.053272   9.9837e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.61579e-13  1.74359e-09  2.92357e-05  2.92357e-05  1.69885e-09  1.63929e-13     0.549726    -0.220522    0.0861688 -7.16778e-10   1.0485e-14    0.0368756 -5.42592e-10 -1.51778e-13 -7.89529e-10 -5.85221e-14  9.59891e-06  9.81344e-06    0.0125301    -0.034935  6.78357e-09  8.49334e-13  7.97417e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.63119e-13 -2.01157e-09 -2.92357e-05 -2.92357e-05 -1.28897e-09 -1.61731e-13    -0.220522     0.549726   -0.0861688   7.8403e-10 -2.48893e-15   -0.0368756  5.50066e-10  1.54713e-13  4.60015e-10  5.70408e-14  9.81344e-06  9.59891e-06     0.034935   -0.0125301 -7.28252e-09 -8.49967e-13 -7.97417e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 6.53034e-14  5.34415e-10   1.0926e-05   1.0926e-05   7.5566e-10  9.26996e-14    0.0861688   -0.0861688     0.662739 -4.24852e-10 -1.93189e-15  -0.00625217 -6.14593e-11 -1.77497e-14 -4.50126e-10 -5.51127e-14  1.16857e-06 -1.16857e-06  -0.00414117  -0.00414117  1.82084e-09  2.09201e-13  4.22731e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.30218e-06   -0.0181563 -9.88616e-14 -9.08306e-14    0.0134761  1.70873e-06 -7.16778e-10   7.8403e-10 -4.24852e-10     0.680027  2.14829e-16 -3.11525e-11  -7.6988e-05 -2.17248e-08  -0.00866729 -1.09899e-06  -2.4982e-14  2.65192e-14  9.37653e-11  8.87455e-11   -0.0410255  -5.0395e-06 -1.33591e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0181563 -2.30218e-06 -4.28643e-11 -1.10116e-10  1.70873e-06   -0.0134761   1.0485e-14 -2.48892e-15 -1.93192e-15  2.66996e-16     0.680027 -6.14366e-17  2.17248e-08  -7.6988e-05 -1.09899e-06   0.00866729 -1.45183e-11  1.95381e-11 -5.09481e-15 -3.57204e-15  -5.0395e-06    0.0410255 -1.18007e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  3.8635e-14  3.16684e-10  4.67574e-06  4.67574e-06  2.05863e-10  2.53271e-14    0.0368756   -0.0368756  -0.00625217 -3.11525e-11  -6.1403e-17     0.797893 -2.21528e-10 -6.35636e-14   6.3947e-11   7.7465e-15  4.10165e-06 -4.10165e-06   -0.0145354   -0.0145354   9.5715e-10  1.10633e-13  1.71954e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.59419e-05    0.0389795 -6.23219e-14 -5.93562e-14    0.0080157  3.27827e-06 -5.42592e-10  5.50066e-10 -6.14593e-11  -7.6988e-05  2.17248e-08 -2.21528e-10     0.956279 -4.02054e-14   -0.0131238 -5.36741e-06 -8.49364e-14   8.4402e-14  2.31212e-10  3.46021e-10   -0.0200194 -8.10829e-06  4.27304e-15          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0389795  1.59419e-05 -2.56197e-11 -3.30932e-11  3.27827e-06   -0.0080157 -1.51778e-13  1.54713e-13 -1.77497e-14 -2.17248e-08  -7.6988e-05 -6.35636e-14 -4.02045e-14     0.956279 -5.36741e-06    0.0131238 -4.62595e-11 -6.85494e-11  8.63813e-14  8.58341e-14 -8.10829e-06    0.0200194 -4.89095e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.77392e-14    0.0421241 -6.17733e-14 -6.03296e-14    0.0309388 -1.28155e-13 -7.89529e-10  4.60015e-10 -4.50126e-10  -0.00866729 -1.09899e-06   6.3947e-11   -0.0131238 -5.36741e-06     0.987501 -6.92135e-14  2.14304e-14  5.23496e-14   1.3445e-10 -4.39277e-11    0.0224113 -8.87405e-08   -5.955e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0421241  3.76439e-14  1.63904e-11 -3.13124e-10 -1.28091e-13    0.0309388  -5.8522e-14  5.70404e-14 -5.51127e-14 -1.09899e-06   0.00866729  7.74651e-15 -5.36741e-06    0.0131238 -6.92745e-14     0.987501 -6.74218e-11 -1.10956e-10  4.85967e-14 -2.51893e-14  8.87406e-08    0.0224113  1.30106e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.94744e-11  9.25971e-14    0.0495092   0.00204416   5.3489e-14 -1.41582e-11  9.59891e-06  9.81344e-06  1.16857e-06  -2.4982e-14 -1.45183e-11  4.10165e-06 -8.49364e-14 -4.62595e-11  2.14304e-14 -6.74218e-11      1.02819   -0.0020693 -1.22576e-05 -1.22576e-05  3.53285e-13  -1.8014e-12   0.00469072          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.61567e-11 -8.97071e-14  -0.00204416   -0.0495092 -5.52132e-14  1.80255e-11  9.81344e-06  9.59891e-06 -1.16857e-06  2.65192e-14  1.95381e-11 -4.10165e-06   8.4402e-14 -6.85494e-11  5.23496e-14 -1.10956e-10   -0.0020693      1.02819  1.22576e-05  1.22576e-05 -3.16101e-13 -8.99701e-11  -0.00469072          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.30273e-14  -3.2947e-10 -3.85285e-06  1.55595e-05 -1.87759e-10 -2.81931e-14    0.0125301     0.034935  -0.00414117  9.37653e-11 -5.09481e-15   -0.0145354  2.31212e-10  8.63812e-14   1.3445e-10  4.85967e-14 -1.22576e-05  1.22576e-05      1.07163    0.0455077 -1.15778e-09 -1.07215e-13  7.48624e-07          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.59262e-14 -3.36152e-10  1.55595e-05 -3.85285e-06 -1.83891e-10 -2.64847e-14    -0.034935   -0.0125301  -0.00414117  8.87455e-11 -3.57203e-15   -0.0145354  3.46021e-10  8.58341e-14 -4.39277e-11 -2.51893e-14 -1.22576e-05  1.22576e-05    0.0455077      1.07163  -1.2482e-09 -1.45249e-13  7.48624e-07          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.97932e-07   -0.0752424 -4.99398e-13 -4.99504e-13    0.0690969  2.73598e-07 -3.52652e-09  3.85259e-09 -1.17253e-09    0.0309264  3.79894e-06 -8.30841e-10   0.00901647  3.65187e-06   -0.0363998  -1.4413e-07 -2.00959e-13  2.00266e-13  7.12841e-10  7.14106e-10    -0.194835 -5.97361e-13 -8.60778e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0752424  2.97932e-07  1.03398e-10  4.38777e-10 -2.73598e-07    0.0690969 -4.41117e-13  4.42129e-13 -1.27715e-13  3.79894e-06   -0.0309264 -9.37449e-14  3.65187e-06  -0.00901647   1.4413e-07   -0.0363998  7.75994e-12 -4.82563e-12  8.33544e-14  8.46957e-14  -5.9738e-13    -0.194835  2.30344e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.58821e-10  1.40499e-14    0.0143253    0.0143253 -4.24419e-14 -1.71047e-10 -4.55081e-06  4.55081e-06 -1.08355e-06  -1.2983e-14 -4.79002e-11   -3.658e-07  7.92466e-15 -8.18511e-12 -7.61718e-15  2.22421e-10   0.00613234  -0.00613234  3.40164e-06  3.40164e-06  9.51508e-14  2.19097e-09     0.954926          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0935659  2.75564e-14 -6.09654e-11 -2.33641e-10 -2.71571e-14   -0.0328713  1.13643e-13 -1.14602e-13  4.02996e-14 -1.96603e-06    0.0155052  2.66009e-14  1.97595e-05   -0.0483139  4.39053e-14    0.0481173  1.98718e-11 -2.29721e-11 -2.76819e-14 -2.91183e-14  9.91754e-08    0.0250466  5.23671e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.75847e-14    0.0935659  1.16366e-13  1.17297e-13   -0.0328713 -2.72035e-14  6.93484e-10  -8.6616e-10  3.29987e-10   -0.0155052 -1.96603e-06  2.18245e-10    0.0483139  1.97595e-05    0.0481173  4.37862e-14  7.70413e-14 -7.56156e-14 -2.78098e-10 -2.81198e-10    0.0250466 -9.91754e-08  5.77289e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.09654e-11  1.16366e-13      0.10504   -0.0056823  1.01559e-13 -2.62124e-11  1.47722e-05 -1.47722e-05  8.02144e-06 -7.53399e-14 -4.11684e-11   3.6645e-06 -5.54407e-14  -2.6251e-11 -7.04738e-14  2.15886e-11    0.0670098  -0.00240141 -3.23587e-06  2.31878e-05  1.68288e-13  9.09165e-11    0.0419176         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.33641e-10  1.17297e-13   -0.0056823      0.10504  1.00022e-13  2.63301e-10  1.47722e-05 -1.47722e-05  8.02144e-06 -6.72514e-14 -1.08726e-10   3.6645e-06 -5.25394e-14 -3.35763e-11 -6.87062e-14 -3.84219e-10   0.00240141   -0.0670098  2.31878e-05 -3.23587e-06  1.69236e-13 -8.33993e-11    0.0419176         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.71692e-14   -0.0328713  1.01559e-13  1.00022e-13     0.240584  3.70962e-15  1.05286e-09 -7.63349e-10  6.49827e-10    0.0144632  1.83389e-06  1.73493e-10   0.00916843  3.74972e-06    0.0440553 -1.77676e-13  4.89735e-14 -4.40506e-14 -1.51136e-10 -1.63432e-10   0.00432456 -1.71237e-08  5.04201e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0328713 -2.72237e-14 -2.62124e-11  2.63301e-10  3.66207e-15     0.240584  9.72279e-14  -9.5653e-14  7.96855e-14  1.83389e-06   -0.0144632  2.13379e-14  3.74972e-06  -0.00916843 -1.77791e-13    0.0440553 -2.41339e-11  1.18381e-11 -2.18727e-14 -2.68189e-14  1.71236e-08   0.00432456 -2.19108e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.13643e-13  6.93484e-10  1.47722e-05  1.47722e-05  1.05286e-09  9.72279e-14     0.221542     -0.11082    0.0632617 -5.30873e-10  1.11257e-14    0.0289004 -4.89916e-10 -1.36659e-13  -9.2688e-10 -6.66592e-14  8.40489e-06  1.80188e-05    0.0337442   -0.0308642  1.18894e-09  1.63848e-13  2.85368e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.14602e-13  -8.6616e-10 -1.47722e-05 -1.47722e-05 -7.63349e-10  -9.5653e-14     -0.11082     0.221542   -0.0632617   5.9843e-10 -3.06921e-15   -0.0289004  4.97241e-10  1.39523e-13  5.21073e-10  6.48486e-14  1.80188e-05  8.40489e-06    0.0308642   -0.0337442 -1.36166e-09 -1.63167e-13 -2.85368e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.02996e-14  3.29987e-10  8.02144e-06  8.02144e-06  6.49827e-10  7.96855e-14    0.0632617   -0.0632617     0.428924 -4.79328e-10 -2.18919e-15    -0.012098 -1.75714e-11 -5.19005e-15 -6.21668e-10 -7.61192e-14  7.73191e-09 -7.73189e-09 -2.74002e-05 -2.74002e-05  4.95217e-10  6.22551e-14  3.89497e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.96603e-06   -0.0155052 -7.53399e-14 -6.72513e-14    0.0144632  1.83389e-06 -5.30873e-10   5.9843e-10 -4.79328e-10     0.462759  2.88115e-16  2.95999e-13 -0.000635208 -1.79246e-07   -0.0104064  -1.3195e-06 -2.35637e-14  2.53313e-14  8.94162e-11  8.39335e-11   -0.0177344 -2.17846e-06 -3.07621e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0155052 -1.96603e-06 -4.11684e-11 -1.08726e-10  1.83389e-06   -0.0144632  1.11256e-14 -3.06916e-15 -2.18924e-15  3.57726e-16     0.462759  1.24268e-16  1.79246e-07 -0.000635208  -1.3195e-06    0.0104064 -3.07997e-11  3.62824e-11 -9.82106e-15 -8.07672e-15 -2.17846e-06    0.0177344 -1.14125e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.66009e-14  2.18245e-10   3.6645e-06   3.6645e-06  1.73493e-10   2.1338e-14    0.0289004   -0.0289004    -0.012098  2.95999e-13  1.24317e-16     0.635437    -3.22e-10 -9.23798e-14  1.32651e-10  1.61139e-14  5.92672e-06 -5.92672e-06    -0.021003    -0.021003  1.07108e-10  1.39541e-14  1.78932e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.97595e-05    0.0483139 -5.54407e-14 -5.25394e-14   0.00916843  3.74972e-06 -4.89916e-10  4.97241e-10 -1.75714e-11 -0.000635208  1.79246e-07    -3.22e-10     0.916802  -7.0732e-14   -0.0222399 -9.09573e-06 -1.45333e-13  1.44261e-13  3.71311e-10  6.02972e-10   -0.0232165 -9.40319e-06  2.57793e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0483139  1.97595e-05  -2.6251e-11 -3.35763e-11  3.74972e-06  -0.00916843 -1.36659e-13  1.39523e-13 -5.19004e-15 -1.79246e-07 -0.000635208 -9.23798e-14 -7.07307e-14     0.916802 -9.09573e-06    0.0222399 -9.04565e-11 -1.41204e-10  1.47759e-13  1.46662e-13 -9.40319e-06    0.0232165  -1.0423e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.38971e-14    0.0481173 -7.04741e-14 -6.87061e-14    0.0440553 -1.77772e-13  -9.2688e-10  5.21073e-10 -6.21668e-10   -0.0104064  -1.3195e-06  1.32651e-10   -0.0222399 -9.09573e-06      0.97942 -1.33144e-13  4.92561e-14  8.62846e-14  2.15076e-10  -1.1263e-10  -0.00417248  1.65215e-08 -1.01076e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481173  4.37873e-14  2.15886e-11 -3.84219e-10 -1.77688e-13    0.0440553 -6.66591e-14  6.48481e-14 -7.61192e-14  -1.3195e-06    0.0104064  1.61139e-14 -9.09573e-06    0.0222399 -1.33259e-13      0.97942 -1.31024e-10 -1.96682e-10  8.33462e-14 -5.22072e-14 -1.65215e-08  -0.00417248  4.31217e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.98718e-11  7.70412e-14    0.0670098   0.00240141  4.89735e-14 -2.41339e-11  8.40489e-06  1.80188e-05  7.73191e-09 -2.35637e-14 -3.07997e-11  5.92672e-06 -1.45333e-13 -9.04565e-11  4.92562e-14 -1.31024e-10       1.0596  -0.00440412 -2.28941e-05 -2.28941e-05  1.99068e-13  2.35523e-11    0.0159918         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.29721e-11 -7.56156e-14  -0.00240141   -0.0670098 -4.40506e-14  1.18381e-11  1.80188e-05  8.40489e-06 -7.73189e-09  2.53313e-14  3.62824e-11 -5.92672e-06  1.44261e-13 -1.41204e-10  8.62846e-14 -1.96682e-10  -0.00440412       1.0596  2.28941e-05  2.28941e-05 -1.41387e-13 -1.64384e-10   -0.0159918         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.76819e-14 -2.78098e-10 -3.23587e-06  2.31878e-05 -1.51136e-10 -2.18727e-14    0.0337442    0.0308642 -2.74002e-05  8.94162e-11 -9.82106e-15    -0.021003  3.71311e-10  1.47759e-13  2.15076e-10  8.33462e-14 -2.28941e-05  2.28941e-05      1.14073     0.085536  -5.6204e-10 -1.53822e-14  5.75321e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.91183e-14 -2.81198e-10  2.31878e-05 -3.23587e-06 -1.63432e-10 -2.68189e-14   -0.0308642   -0.0337442 -2.74002e-05  8.39335e-11 -8.07671e-15    -0.021003  6.02972e-10  1.46662e-13  -1.1263e-10 -5.22072e-14 -2.28941e-05  2.28941e-05     0.085536      1.14073 -7.02583e-10 -7.35661e-14  5.75321e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.26702e-07    0.0572532  5.52468e-13  5.53048e-13   0.00341529  1.35233e-08  4.12839e-09 -4.38904e-09  6.37934e-10   -0.0102623  -1.2606e-06  1.16523e-10   -0.0185867 -7.52804e-06   -0.0190696 -7.55087e-08  4.87251e-14  3.33397e-14  5.04665e-11 -1.50414e-10     0.599386 -4.24162e-13   2.3577e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0572532 -2.26702e-07  8.19173e-11 -1.79426e-10 -1.35233e-08   0.00341529  5.20466e-13 -5.20412e-13  8.18158e-14  -1.2606e-06    0.0102623   1.6739e-14 -7.52804e-06    0.0185867  7.55087e-08   -0.0190696 -2.12094e-11 -1.78422e-10  5.81905e-14 -2.40039e-14 -4.24269e-13     0.599386  2.61312e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.18673e-11   5.3777e-14    0.0423952    0.0423952  3.10948e-14  5.25863e-11  2.08207e-06 -2.08207e-06  2.57971e-06 -2.15453e-14  -8.8789e-11   1.1133e-06  4.17076e-14 -1.15882e-10 -8.07466e-14  4.93167e-10     0.016942    -0.016942  6.97143e-06  6.97143e-06  3.82703e-13  2.39357e-09       1.9863         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
