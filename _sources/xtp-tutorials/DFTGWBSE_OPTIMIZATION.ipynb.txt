{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2021-10-09T21:25:19.884462Z",
     "iopub.status.busy": "2021-10-09T21:25:19.883963Z",
     "iopub.status.idle": "2021-10-09T21:25:42.737264Z",
     "shell.execute_reply": "2021-10-09T21:25:42.737693Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2022-dev gitid: b1fae38 (compiled Oct  9 2021, 21:17:05)\r\n",
      "votca_csg, version 2022-dev gitid: b1fae38 (compiled Oct  9 2021, 21:03:50)\r\n",
      "votca_tools, version 2022-dev gitid: b1fae38 (compiled Oct  9 2021, 21:01:21)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 BohrA\r\n",
      "    0.306708 -4.26491e-14  1.22458e-10   3.9043e-10  3.12577e-14   -0.0516336   1.8438e-13 -1.81159e-13  -4.6732e-14 -1.36399e-06   -0.0181563 -2.75741e-14 -1.18382e-05    0.0389795  2.68447e-14   -0.0421241  1.94746e-11  -2.6157e-11  3.86924e-14  3.65495e-14  2.62379e-07     0.108303  -1.6043e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-4.25903e-14     0.306708  1.65066e-13  1.61835e-13   -0.0516336  3.11727e-14  -1.7436e-09  2.01157e-09  5.34415e-10    0.0181563 -1.36399e-06  3.16684e-10   -0.0389795 -1.18382e-05   -0.0421241  2.67798e-14    1.291e-13 -1.26941e-13  -3.2947e-10 -3.36152e-10    -0.108303  2.62379e-07 -2.21548e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.22458e-10  1.65066e-13     0.319156   -0.0100481  9.57728e-14    4.198e-11 -1.73215e-05  1.73215e-05  6.47341e-06  6.02244e-14 -4.28649e-11  2.77027e-06   5.1435e-14 -2.56197e-11  3.19612e-14  1.63903e-11   -0.0495092   0.00204416 -3.39887e-06 -1.78141e-05 -5.56786e-13  1.58331e-11   -0.0252874          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  3.9043e-10  1.61835e-13   -0.0100481     0.319156  1.00404e-13 -3.67901e-10 -1.73215e-05  1.73215e-05  6.47341e-06  5.42665e-14 -1.10116e-10  2.77027e-06  5.36085e-14 -3.30934e-11  3.59664e-14 -3.13125e-10  -0.00204416    0.0495092 -1.78141e-05 -3.39887e-06  -5.4969e-13  5.25148e-10   -0.0252874          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.12855e-14   -0.0516336  9.57728e-14  1.00404e-13     0.490609 -4.68736e-15 -1.69885e-09  1.28897e-09   7.5566e-10   -0.0134761  1.01239e-06  2.05863e-10   -0.0080157 -2.43439e-06   -0.0309388 -9.01823e-14  6.84021e-14 -6.97613e-14 -1.87759e-10 -1.83891e-10     0.053272 -1.29059e-07 -3.15461e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0516336  3.12066e-14    4.198e-11 -3.67901e-10 -4.73914e-15     0.490609  1.15078e-13 -1.19706e-13 -6.55186e-14  1.01239e-06    0.0134761 -1.80846e-14 -2.43439e-06    0.0080157 -9.02142e-14   -0.0309388 -1.41584e-11  1.80257e-11  9.38761e-15  1.07314e-14 -1.29059e-07    -0.053272  9.98374e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  1.8438e-13  -1.7436e-09 -1.73215e-05 -1.73215e-05 -1.69885e-09  1.15078e-13     0.549726    -0.220522   -0.0861688 -7.16777e-10  -1.7327e-14   -0.0368756 -5.42593e-10 -2.13201e-13 -7.89528e-10  4.07388e-14 -1.33879e-05 -1.02736e-06   -0.0125301     0.034935  6.78358e-09  6.08953e-13  2.39009e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -1.8116e-13  2.01157e-09  1.73215e-05  1.73215e-05  1.28897e-09 -1.19706e-13    -0.220522     0.549726    0.0861688  7.84029e-10  1.13219e-14    0.0368756  5.50067e-10  2.15396e-13  4.60013e-10 -4.47963e-14 -1.02736e-06 -1.33879e-05    -0.034935    0.0125301 -7.28253e-09  -6.0193e-13 -2.39009e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-4.67319e-14  5.34415e-10  6.47341e-06  6.47341e-06   7.5566e-10 -6.55186e-14   -0.0861688    0.0861688     0.662739  4.24852e-10  5.03028e-15  -0.00625217  6.14588e-11  2.39544e-14  4.50125e-10 -3.89711e-14  1.56879e-06 -1.56879e-06  -0.00414117  -0.00414117 -1.82084e-09 -1.50437e-13 -1.61357e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.36399e-06    0.0181563  6.02244e-14  5.42666e-14   -0.0134761  1.01239e-06 -7.16777e-10  7.84029e-10  4.24852e-10     0.680027 -1.77837e-15   3.1152e-11  -7.6988e-05 -2.91651e-08  -0.00866729  6.51128e-07  3.33785e-14 -3.47381e-14 -9.37654e-11  -8.8745e-11   -0.0410255 -2.98264e-06 -4.57446e-15          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0181563 -1.36399e-06 -4.28649e-11 -1.10116e-10  1.01239e-06    0.0134761  -1.7327e-14  1.13221e-14  5.03026e-15 -1.89429e-15     0.680027  3.70998e-16  2.91651e-08  -7.6988e-05  6.51128e-07   0.00866729  1.45176e-11  -1.9538e-11  6.37144e-15  5.03964e-15  2.98264e-06   -0.0410255  1.18009e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.75741e-14  3.16684e-10  2.77027e-06  2.77027e-06  2.05863e-10 -1.80844e-14   -0.0368756    0.0368756  -0.00625217   3.1152e-11  3.71038e-16     0.797893  2.21528e-10  8.63287e-14 -6.39474e-11  5.63531e-15  5.50639e-06 -5.50639e-06   -0.0145354   -0.0145354 -9.57151e-10 -7.92809e-14 -6.48939e-07          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.18382e-05   -0.0389795   5.1435e-14  5.36085e-14   -0.0080157 -2.43439e-06 -5.42593e-10  5.50067e-10  6.14588e-11  -7.6988e-05  2.91651e-08  2.21528e-10     0.956279 -5.44556e-14   -0.0131238 -3.98574e-06  1.14411e-13 -1.13034e-13 -2.31213e-10 -3.46022e-10   -0.0200194  6.12843e-06 -2.44874e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0389795 -1.18382e-05 -2.56197e-11 -3.30934e-11 -2.43439e-06    0.0080157 -2.13201e-13  2.15396e-13  2.39544e-14 -2.91651e-08  -7.6988e-05  8.63287e-14 -5.44712e-14     0.956279 -3.98574e-06    0.0131238  4.62596e-11  6.85497e-11 -1.17111e-13 -1.15779e-13 -6.12843e-06   -0.0200194  4.89096e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.68436e-14   -0.0421241  3.19609e-14  3.59664e-14   -0.0309388 -9.02226e-14 -7.89528e-10  4.60013e-10  4.50125e-10  -0.00866729  6.51128e-07 -6.39474e-11   -0.0131238 -3.98574e-06     0.987501  4.99577e-14 -1.28895e-14 -4.32279e-14  -1.3445e-10  4.39278e-11    0.0224113 -5.42946e-08 -2.49743e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0421241  2.67613e-14  1.63903e-11 -3.13125e-10 -9.01927e-14   -0.0309388  4.07388e-14 -4.47965e-14 -3.89711e-14  6.51128e-07   0.00866729  5.63531e-15 -3.98574e-06    0.0131238  4.98994e-14     0.987501  6.74219e-11  1.10956e-10 -3.24638e-14   2.3689e-14 -5.42946e-08   -0.0224113 -1.30106e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.94746e-11    1.291e-13   -0.0495092  -0.00204416  6.84021e-14 -1.41584e-11 -1.33879e-05 -1.02736e-06  1.56879e-06  3.33785e-14  1.45176e-11  5.50639e-06  1.14411e-13  4.62596e-11 -1.28895e-14  6.74219e-11      1.02819   -0.0020693 -1.64556e-05 -1.64556e-05 -4.74111e-13 -1.80129e-12   0.00469072          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -2.6157e-11 -1.26941e-13   0.00204416    0.0495092 -6.97613e-14  1.80257e-11 -1.02736e-06 -1.33879e-05 -1.56879e-06 -3.47381e-14  -1.9538e-11 -5.50639e-06 -1.13034e-13  6.85497e-11 -4.32279e-14  1.10956e-10   -0.0020693      1.02819  1.64556e-05  1.64556e-05  4.45392e-13 -8.99705e-11  -0.00469072          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.86924e-14  -3.2947e-10 -3.39887e-06 -1.78141e-05 -1.87759e-10  9.38761e-15   -0.0125301    -0.034935  -0.00414117 -9.37654e-11  6.37146e-15   -0.0145354 -2.31213e-10 -1.17111e-13  -1.3445e-10 -3.24638e-14 -1.64556e-05  1.64556e-05      1.07163    0.0455077  1.15778e-09  1.31538e-13  2.48781e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.65495e-14 -3.36152e-10 -1.78141e-05 -3.39887e-06 -1.83891e-10  1.07314e-14     0.034935    0.0125301  -0.00414117  -8.8745e-11  5.03962e-15   -0.0145354 -3.46022e-10 -1.15779e-13  4.39278e-11   2.3689e-14 -1.64556e-05  1.64556e-05    0.0455077      1.07163   1.2482e-09  1.02492e-13  2.48781e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.82286e-07    0.0752424  3.04553e-13   2.9981e-13   -0.0690969  1.67397e-07 -3.52652e-09   3.8526e-09  1.17254e-09    0.0309264 -2.24842e-06  8.30842e-10   0.00901647  2.76017e-06   -0.0363998  8.81839e-08  2.70223e-13 -2.69838e-13 -7.12841e-10 -7.14107e-10    -0.194835 -3.30291e-13 -2.86039e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0752424 -1.82285e-07 -1.03398e-10 -4.38779e-10  1.67397e-07    0.0690969 -3.23769e-13  3.19303e-13  9.53048e-14  2.24842e-06    0.0309264  6.86714e-14 -2.76017e-06   0.00901647  8.81838e-08    0.0363998  7.75984e-12 -4.82538e-12 -5.68239e-14 -5.59529e-14 -3.30378e-13    -0.194835  2.30345e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.58822e-10  3.09427e-14   -0.0143253   -0.0143253  2.93084e-14 -1.71047e-10 -5.41225e-06  5.41225e-06  1.63079e-06  6.41635e-15  4.79006e-11  6.56354e-07  4.92656e-15  8.18508e-12 -1.79221e-15 -2.22422e-10   0.00613235  -0.00613235  1.61826e-06  1.61826e-06 -3.46008e-13  2.19098e-09     0.954926          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0935659  -1.9021e-14  6.09655e-11  2.33642e-10  1.92222e-14   -0.0328713  8.00008e-14 -7.79125e-14 -2.88833e-14 -1.16483e-06   -0.0155052 -1.89951e-14  -1.4673e-05    0.0483139  3.11931e-14   -0.0481173   1.9872e-11 -2.29724e-11   3.2966e-14  3.19237e-14   6.0679e-08    0.0250466  5.23674e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.89861e-14    0.0935659  7.24846e-14   7.0399e-14   -0.0328713  1.91667e-14 -6.93485e-10  8.66161e-10  3.29987e-10    0.0155052 -1.16483e-06  2.18245e-10   -0.0483139  -1.4673e-05   -0.0481173   3.1124e-14  1.08261e-13 -1.07202e-13 -2.78098e-10 -2.81198e-10   -0.0250466  6.06791e-08  1.41735e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.09655e-11  7.24846e-14      0.10504  -0.00568231    5.631e-14  2.62123e-11 -8.75221e-06  8.75221e-06  4.75252e-06   4.6261e-14  -4.1169e-11  2.17113e-06  4.77086e-14  -2.6251e-11  3.60593e-14  2.15886e-11   -0.0670098   0.00240141 -3.22839e-06 -2.28501e-05 -9.65595e-14 -9.09167e-11   -0.0419176         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.33642e-10   7.0399e-14  -0.00568231      0.10504  5.95725e-14 -2.63301e-10 -8.75221e-06  8.75221e-06  4.75252e-06   4.0281e-14 -1.08726e-10  2.17113e-06  4.98384e-14 -3.35765e-11  4.10126e-14 -3.84219e-10  -0.00240141    0.0670098 -2.28501e-05 -3.22839e-06 -9.42287e-14  8.33994e-11   -0.0419176         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.92378e-14   -0.0328713    5.631e-14  5.95725e-14     0.240584 -1.68998e-15 -1.05286e-09  7.63349e-10  6.49827e-10   -0.0144632  1.08654e-06  1.73493e-10  -0.00916843 -2.78448e-06   -0.0440553 -1.25105e-13  5.99706e-14 -5.63209e-14 -1.51136e-10 -1.63432e-10  -0.00432456  1.04769e-08 -3.10271e-15         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0328713  1.92006e-14  2.62123e-11 -2.63301e-10 -1.74001e-15     0.240584  6.82787e-14 -7.15402e-14 -5.63382e-14  1.08654e-06    0.0144632 -1.53292e-14 -2.78448e-06   0.00916843 -1.25145e-13   -0.0440553 -2.41342e-11  1.18383e-11  8.73713e-15  5.06366e-15  1.04768e-08   0.00432456 -2.19111e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 8.00009e-14 -6.93485e-10 -8.75221e-06 -8.75221e-06 -1.05286e-09  6.82787e-14     0.221542     -0.11082   -0.0632617 -5.30872e-10 -1.50244e-14   -0.0289004 -4.89916e-10 -1.92595e-13 -9.26879e-10  4.64531e-14 -1.18726e-05 -7.74913e-06   -0.0337442    0.0308642  1.18894e-09  1.08963e-13  -3.2074e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-7.79126e-14  8.66161e-10  8.75221e-06  8.75221e-06  7.63349e-10 -7.15403e-14     -0.11082     0.221542    0.0632617   5.9843e-10  9.00139e-15    0.0289004  4.97242e-10  1.94746e-13  5.21071e-10 -5.14723e-14 -7.74913e-06 -1.18726e-05   -0.0308642    0.0337442 -1.36166e-09 -1.06342e-13   3.2074e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.88832e-14  3.29987e-10  4.75252e-06  4.75252e-06  6.49827e-10 -5.63382e-14   -0.0632617    0.0632617     0.428924  4.79328e-10  5.68323e-15    -0.012098  1.75706e-11  6.90188e-15  6.21667e-10 -5.38509e-14    1.038e-08 -1.03799e-08 -2.74002e-05 -2.74002e-05 -4.95218e-10 -4.11096e-14 -3.19475e-07         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.16483e-06    0.0155052   4.6261e-14  4.02811e-14   -0.0144632  1.08654e-06 -5.30872e-10   5.9843e-10  4.79328e-10     0.462759 -2.31745e-15 -2.96597e-13 -0.000635208 -2.40634e-07   -0.0104064  7.81776e-07  3.13512e-14 -3.24791e-14 -8.94165e-11 -8.39328e-11   -0.0177344 -1.28933e-06  8.50467e-16         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0155052 -1.16483e-06  -4.1169e-11 -1.08726e-10  1.08654e-06    0.0144632 -1.50245e-14  9.00158e-15  5.68321e-15 -2.48896e-15     0.462759  6.41596e-18  2.40634e-07 -0.000635208  7.81776e-07    0.0104064  3.07986e-11 -3.62823e-11  1.27827e-14  1.16963e-14  1.28933e-06   -0.0177344  1.14126e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.89951e-14  2.18245e-10  2.17113e-06  2.17113e-06  1.73493e-10  -1.5329e-14   -0.0289004    0.0289004    -0.012098 -2.96597e-13  6.47136e-18     0.635437     3.22e-10  1.25505e-13 -1.32652e-10  1.16407e-14  7.95652e-06 -7.95652e-06    -0.021003    -0.021003 -1.07108e-10 -8.35086e-15 -1.68144e-07         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " -1.4673e-05   -0.0483139  4.77086e-14  4.98384e-14  -0.00916843 -2.78448e-06 -4.89916e-10  4.97242e-10  1.75706e-11 -0.000635208  2.40634e-07     3.22e-10     0.916802 -9.55884e-14   -0.0222399 -6.75433e-06  1.95906e-13 -1.93121e-13 -3.71311e-10 -6.02973e-10   -0.0232165  7.10715e-06 -3.93307e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0483139  -1.4673e-05  -2.6251e-11 -3.35765e-11 -2.78448e-06   0.00916843 -1.92595e-13  1.94746e-13  6.90183e-15 -2.40634e-07 -0.000635208  1.25505e-13 -9.56192e-14     0.916802 -6.75433e-06    0.0222399  9.04567e-11  1.41205e-10 -2.00357e-13 -1.97657e-13 -7.10715e-06   -0.0232165   1.0423e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.11885e-14   -0.0481173   3.6059e-14  4.10126e-14   -0.0440553 -1.25157e-13 -9.26879e-10  5.21071e-10  6.21667e-10   -0.0104064  7.81776e-07 -1.32652e-10   -0.0222399 -6.75433e-06      0.97942  9.60866e-14 -3.51471e-14 -6.79457e-14 -2.15076e-10   1.1263e-10  -0.00417248  1.01085e-08 -4.11814e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0481173  3.11069e-14  2.15886e-11 -3.84219e-10 -1.25117e-13   -0.0440553  4.64532e-14 -5.14726e-14 -5.38509e-14  7.81776e-07    0.0104064  1.16407e-14 -6.75433e-06    0.0222399  9.59757e-14      0.97942  1.31024e-10  1.96683e-10 -5.96618e-14  4.34968e-14  1.01084e-08   0.00417248 -4.31217e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  1.9872e-11  1.08261e-13   -0.0670098  -0.00240141  5.99706e-14 -2.41342e-11 -1.18726e-05 -7.74913e-06    1.038e-08  3.13513e-14  3.07986e-11  7.95652e-06  1.95906e-13  9.04567e-11 -3.51471e-14  1.31024e-10       1.0596  -0.00440413  -3.0735e-05  -3.0735e-05 -2.69962e-13  2.35524e-11    0.0159918         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.29724e-11 -1.07202e-13   0.00240141    0.0670098 -5.63209e-14  1.18383e-11 -7.74913e-06 -1.18726e-05 -1.03799e-08 -3.24791e-14 -3.62823e-11 -7.95652e-06 -1.93121e-13  1.41205e-10 -6.79457e-14  1.96683e-10  -0.00440413       1.0596   3.0735e-05   3.0735e-05  2.25214e-13 -1.64385e-10   -0.0159918         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  3.2966e-14 -2.78098e-10 -3.22839e-06 -2.28501e-05 -1.51136e-10  8.73712e-15   -0.0337442   -0.0308642 -2.74002e-05 -8.94165e-11  1.27827e-14    -0.021003 -3.71311e-10 -2.00357e-13 -2.15076e-10 -5.96618e-14  -3.0735e-05   3.0735e-05      1.14073     0.085536  5.62041e-10  1.10753e-13  6.35778e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.19237e-14 -2.81198e-10 -2.28501e-05 -3.22839e-06 -1.63432e-10  5.06365e-15    0.0308642    0.0337442 -2.74002e-05 -8.39328e-11  1.16963e-14    -0.021003 -6.02973e-10 -1.97657e-13   1.1263e-10  4.34969e-14  -3.0735e-05   3.0735e-05     0.085536      1.14073  7.02584e-10  6.60211e-14  6.35778e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.38704e-07   -0.0572532 -3.25838e-13 -3.22221e-13  -0.00341529  8.27401e-09   4.1284e-09 -4.38905e-09 -6.37936e-10   -0.0102623  7.46091e-07 -1.16523e-10   -0.0185867 -5.68987e-06   -0.0190696  4.61989e-08  -5.7455e-14 -6.34038e-15 -5.04662e-11  1.50414e-10     0.599386 -3.11301e-13   -2.405e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0572532  1.38704e-07 -8.19174e-11  1.79426e-10  8.27403e-09   0.00341529  3.67488e-13 -3.63702e-13 -5.52676e-14 -7.46091e-07   -0.0102623 -1.03691e-14  5.68987e-06   -0.0185867  4.61989e-08    0.0190696 -2.12094e-11 -1.78422e-10  6.65757e-14  3.25636e-15 -3.11336e-13     0.599386  2.61312e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.18674e-11   6.6075e-15   -0.0423952   -0.0423952   7.6662e-15   5.2586e-11 -3.21217e-06  3.21217e-06  3.54936e-07  6.06045e-15  8.87906e-11  1.84042e-07 -3.63284e-14  1.15882e-10 -3.22709e-14 -4.93167e-10     0.016942    -0.016942  6.13725e-06  6.13725e-06 -3.05218e-13  2.39357e-09       1.9863         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.9.7"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
