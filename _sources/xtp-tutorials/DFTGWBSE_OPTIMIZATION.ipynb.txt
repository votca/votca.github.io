{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-11-11T06:12:12.785749Z",
     "iopub.status.busy": "2022-11-11T06:12:12.785304Z",
     "iopub.status.idle": "2022-11-11T06:13:00.582064Z",
     "shell.execute_reply": "2022-11-11T06:13:00.582427Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2023-dev gitid: 613916e (compiled Nov 11 2022, 06:04:26)\r\n",
      "votca_csg, version 2023-dev gitid: 613916e (compiled Nov 11 2022, 05:49:58)\r\n",
      "votca_tools, version 2023-dev gitid: 613916e (compiled Nov 11 2022, 05:47:19)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 Bohr\r\n",
      "... ... \r\n",
      "... ... =========== OPTIMIZATION SUMMARY ================================= \r\n",
      "... ... At iteration  0\r\n",
      "... ...  ---- POSITIONS (Angstrom)   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    +0.0000  +0.0000  +0.0000\r\n",
      "... ...    1    +1.2000  +0.0000  +0.0000\r\n",
      "... ...    Total energy:     -112.26831841 Hartree \r\n",
      "... ...    Trust radius:       0.01889726 Bohr     \r\n",
      "... ...  ---- FORCES (Hartree/Bohr)   \r\n",
      "... ...       central differences   \r\n",
      "... ...       displacement 0.0010 Angstrom   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    -0.1314  -0.0000  -0.0000\r\n",
      "... ...    1    +0.1314  +0.0000  +0.0000A\r\n",
      "     0.30157 -7.70558e-14  4.02367e-11  2.02985e-11  5.82904e-14    -0.051948  7.30011e-13 -7.42238e-13  2.37701e-13  5.42212e-05    0.0176765  9.65443e-14 -4.14217e-05    0.0390253  4.55837e-14   -0.0423787 -1.36715e-12 -1.26466e-12 -9.95092e-14  9.99912e-14 -1.46648e-05    -0.107191 -1.70517e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-7.70949e-14      0.30157  8.72092e-13  8.59857e-13    -0.051948   5.8145e-14 -2.47859e-10  2.67797e-10 -9.53362e-11   -0.0176765  5.42212e-05 -3.87782e-11    0.0390253  4.14217e-05   -0.0423787  4.56091e-14 -8.14108e-14 -8.09047e-14  3.88037e-11 -3.89062e-11     0.107191 -1.46648e-05 -5.58752e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.02367e-11  8.72092e-13      0.31083   -0.0100793    4.755e-13 -2.44303e-11 -0.000710152  0.000710152 -0.000278007 -3.11643e-13  1.10804e-11 -0.000124877 -4.73263e-14 -4.61611e-12  7.03748e-14 -5.02987e-11    0.0492368    0.0019574    5.798e-05 -0.000108163  3.43326e-12  -5.2919e-11   -0.0248118          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.02985e-11  8.59857e-13   -0.0100793      0.31083  4.90415e-13  4.19874e-13 -0.000710152  0.000710152 -0.000278007 -3.36119e-13  1.09742e-12 -0.000124877 -4.81313e-14 -2.75517e-12  9.94496e-14  4.09719e-13    0.0019574    0.0492368  0.000108163   -5.798e-05  3.41432e-12 -1.21934e-11   -0.0248118          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.82927e-14    -0.051948    4.755e-13  4.90415e-13     0.487116 -1.13587e-14 -1.79509e-10  1.54658e-10 -8.36877e-11    0.0136234 -4.17888e-05 -4.01345e-11   0.00828375  8.79241e-06   -0.0302057 -1.63858e-13 -4.94108e-14 -5.37356e-14  2.82844e-11 -2.58467e-11   -0.0548637  7.50586e-06 -2.02571e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   -0.051948   5.8153e-14 -2.44303e-11  4.19874e-13  -1.1323e-14     0.487116  3.89004e-13 -3.74098e-13  2.09376e-13 -4.17888e-05   -0.0136234  1.00359e-13 -8.79241e-06   0.00828375  -1.6377e-13   -0.0302057  2.31123e-12 -1.26462e-13 -6.76313e-14  6.33305e-14  7.50586e-06    0.0548637  5.55842e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 7.30011e-13 -2.47859e-10 -0.000710152 -0.000710152 -1.79509e-10  3.89004e-13     0.542342    -0.221433    0.0906319   1.0174e-10 -2.95827e-14    0.0407106  1.29282e-11 -3.32999e-14 -7.33085e-11  5.83065e-14  0.000124355  7.41721e-05     0.013298    0.0339814 -1.06723e-09 -2.57155e-12  9.97239e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-7.42238e-13  2.67797e-10  0.000710152  0.000710152  1.54658e-10 -3.74098e-13    -0.221433     0.542342   -0.0906319 -1.11723e-10  5.40606e-14   -0.0407106 -1.47892e-11  3.25253e-14     2.26e-11 -2.92271e-14 -7.41721e-05 -0.000124355    0.0339814     0.013298  1.10724e-09  2.58993e-12 -9.97239e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.37701e-13 -9.53362e-11 -0.000278007 -0.000278007 -8.36877e-11  2.09376e-13    0.0906319   -0.0906319     0.660145  6.15262e-11 -3.53733e-14  -0.00527337 -3.12098e-12  4.40185e-15 -3.30993e-11  8.28319e-14  9.47331e-06  9.47331e-06  -0.00472245   0.00472245 -3.60905e-10 -8.18692e-13  6.94478e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.42212e-05   -0.0176765 -3.11643e-13 -3.36119e-13    0.0136234 -4.17888e-05   1.0174e-10 -1.11723e-10  6.15262e-11     0.669023  6.36356e-15  8.25956e-12  9.83196e-06 -1.97231e-08   0.00903063 -2.77008e-05  1.48154e-14  2.21975e-14 -4.78374e-12  1.05564e-11   -0.0409883 -0.000120121  6.87451e-15          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0176765  5.42212e-05  1.10804e-11  1.09742e-12 -4.17888e-05   -0.0136234 -2.95827e-14  5.40609e-14 -3.53732e-14  6.28846e-15     0.669023 -4.54234e-15 -1.97231e-08 -9.83196e-06 -2.77008e-05  -0.00903063  1.87612e-12  7.64873e-12  9.67987e-15 -1.70558e-14  0.000120121   -0.0409883 -7.91672e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 9.65443e-14 -3.87782e-11 -0.000124877 -0.000124877 -4.01345e-11   1.0036e-13    0.0407106   -0.0407106  -0.00527337  8.25956e-12 -4.54233e-15     0.793384  1.18503e-11 -1.71798e-14  3.85087e-12 -9.37868e-15  3.05868e-05  3.05868e-05   -0.0152476    0.0152476 -1.38598e-10 -3.12744e-13   2.9085e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-4.14217e-05    0.0390253 -4.73263e-14 -4.81313e-14   0.00828375 -8.79241e-06  1.29282e-11 -1.47892e-11 -3.12098e-12  9.83196e-06 -1.97231e-08  1.18503e-11     0.954425  1.36161e-14    0.0128945 -1.36863e-05 -5.18663e-15 -1.35537e-14  1.11242e-11  3.32565e-12   -0.0199053 -1.84044e-05  -1.4968e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0390253  4.14217e-05 -4.61611e-12 -2.75517e-12  8.79241e-06   0.00828375 -3.32999e-14  3.25253e-14  4.40186e-15 -1.97231e-08 -9.83196e-06 -1.71798e-14   1.3544e-14     0.954425  1.36863e-05    0.0128945  6.21829e-12 -8.23154e-12 -1.13544e-14  2.99341e-15 -1.84044e-05    0.0199053  6.00233e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.55812e-14   -0.0423787  7.03748e-14  9.94496e-14   -0.0302057 -1.63777e-13 -7.33085e-11     2.26e-11 -3.30993e-11   0.00903063 -2.77008e-05  3.85087e-12    0.0128945  1.36863e-05     0.974684  9.13005e-14   1.1224e-14 -1.86471e-14  1.51507e-11  3.20133e-12   -0.0229107  3.13439e-06 -5.92434e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0423787  4.56183e-14 -5.02987e-11  4.09719e-13 -1.63882e-13   -0.0302057  5.83065e-14 -2.92271e-14  8.28319e-14 -2.77008e-05  -0.00903063 -9.37868e-15 -1.36863e-05    0.0128945  9.13277e-14     0.974684  1.25442e-11 -5.80792e-12 -2.32942e-14 -6.59408e-15  3.13439e-06    0.0229107 -5.52984e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.36715e-12 -8.14108e-14    0.0492368    0.0019574 -4.94108e-14  2.31123e-12  0.000124355 -7.41721e-05  9.47331e-06  1.48154e-14  1.87612e-12  3.05868e-05 -5.18663e-15  6.21829e-12   1.1224e-14  1.25442e-11      1.02179   0.00208429 -8.57859e-05  8.57859e-05  -3.2633e-13  8.34164e-12  -0.00474215          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.26466e-12 -8.09047e-14    0.0019574    0.0492368 -5.37356e-14 -1.26462e-13  7.41721e-05 -0.000124355  9.47331e-06  2.21976e-14  7.64873e-12  3.05868e-05 -1.35537e-14 -8.23154e-12 -1.86471e-14 -5.80792e-12   0.00208429      1.02179 -8.57859e-05  8.57859e-05 -3.17689e-13  2.71612e-12  -0.00474215          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-9.95092e-14  3.88037e-11    5.798e-05  0.000108163  2.82844e-11 -6.76313e-14     0.013298    0.0339814  -0.00472245 -4.78374e-12  9.67988e-15   -0.0152476  1.11242e-11 -1.13544e-14  1.51507e-11 -2.32942e-14 -8.57859e-05 -8.57859e-05      1.06455   -0.0448485  1.50634e-10  3.56444e-13 -3.76026e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 9.99912e-14 -3.89062e-11 -0.000108163   -5.798e-05 -2.58467e-11  6.33305e-14    0.0339814     0.013298   0.00472245  1.05564e-11 -1.70558e-14    0.0152476  3.32565e-12  2.99352e-15  3.20133e-12 -6.59409e-15  8.57859e-05  8.57859e-05   -0.0448485      1.06455 -1.56188e-10 -3.65253e-13  3.76026e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  1.0211e-05   -0.0746367  -2.0537e-12 -2.04446e-12    0.0699591 -9.57104e-06  6.27385e-10 -6.46466e-10  2.65819e-10    0.0304419 -8.92135e-05  1.18739e-10   0.00918485  8.49227e-06    0.0362981 -4.96591e-06  2.26542e-13   2.3204e-13 -1.15492e-10   1.1159e-10    -0.195037 -4.88972e-13  1.68385e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0746367   1.0211e-05   4.4677e-11  2.50193e-11 -9.57104e-06   -0.0699591  1.52686e-12 -1.53632e-12  5.96275e-13  8.92135e-05    0.0304419  2.66664e-13  8.49227e-06  -0.00918485 -4.96591e-06   -0.0362981  1.67464e-12 -2.11306e-12  -2.5908e-13  2.53541e-13 -4.88966e-13    -0.195037 -4.35657e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.96218e-11  1.81412e-13   -0.0141047   -0.0141047  2.22601e-13 -1.12398e-11 -0.000229919  0.000229919 -7.37113e-05 -2.33488e-14  1.93484e-11 -3.10326e-05 -4.33228e-15  -6.2348e-12 -2.88626e-14 -4.44164e-11  -0.00610208  -0.00610208  1.44179e-05 -1.44179e-05  2.13198e-12 -4.38801e-10     0.942225          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0906271 -3.39439e-14  2.37891e-11  9.47592e-12  3.56332e-14   -0.0326354  3.06891e-13 -3.15524e-13  1.49228e-13  4.56031e-05    0.0148669  6.35953e-14 -5.10788e-05    0.0481238  5.21474e-14   -0.0477892 -8.41089e-13 -3.24739e-13 -7.46309e-14  7.58628e-14 -3.34847e-06   -0.0244755  2.72447e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.39706e-14    0.0906271  3.65461e-13  3.56822e-13   -0.0326354  3.55529e-14 -9.71209e-11  1.11434e-10 -5.98683e-11   -0.0148669  4.56031e-05 -2.55573e-11    0.0481238  5.10788e-05   -0.0477892  5.21923e-14 -6.14053e-14 -6.01473e-14  2.93425e-11 -2.98589e-11    0.0244755 -3.34847e-06  1.36842e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.37891e-11  3.65461e-13    0.0997349  -0.00553732  2.81773e-13 -1.60468e-11 -0.000347564  0.000347564 -0.000200058 -2.21812e-13  1.04384e-11 -9.72096e-05 -8.90481e-15 -4.99351e-12  8.57646e-14 -6.16294e-11     0.065914    0.0022573  2.66406e-05 -9.42062e-05  4.49141e-13 -7.29525e-12   -0.0408446         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 9.47592e-12  3.56822e-13  -0.00553732    0.0997349  2.91662e-13  3.49244e-13 -0.000347564  0.000347564 -0.000200058 -2.46307e-13  4.62357e-13 -9.72096e-05 -1.00181e-14 -2.50867e-12  1.21723e-13  1.10449e-12    0.0022573     0.065914  9.42062e-05 -2.66406e-05  4.39153e-13  1.40927e-11   -0.0408446         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   3.564e-14   -0.0326354  2.81773e-13  2.91662e-13     0.236919 -5.23232e-15 -1.07962e-10  9.15658e-11 -7.17834e-11    0.0143889  -4.4137e-05 -3.85682e-11   0.00947402  1.00558e-05   -0.0425853 -2.24682e-13 -4.83987e-14 -5.37954e-14  2.85492e-11 -2.55363e-11   0.00365057 -4.99431e-07 -5.98485e-15         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0326354  3.55516e-14 -1.60468e-11  3.49244e-13 -5.19503e-15     0.236919  2.30581e-13 -2.20699e-13  1.79549e-13  -4.4137e-05   -0.0143889  9.63785e-14 -1.00558e-05   0.00947402 -2.24559e-13   -0.0425853  2.76359e-12  -2.4929e-13  -6.7707e-14  6.23443e-14 -4.99431e-07  -0.00365057 -3.19284e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.06891e-13 -9.71209e-11 -0.000347564 -0.000347564 -1.07962e-10  2.30581e-13     0.213042     -0.10777    0.0652203  7.23407e-11 -1.48079e-14     0.031691  1.10974e-13 -1.58014e-14 -8.97857e-11  7.15257e-14  0.000133137  6.55714e-05    0.0344212    0.0292355 -1.37229e-10  -3.3053e-13 -0.000135718         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.15524e-13  1.11434e-10  0.000347564  0.000347564  9.15658e-11 -2.20699e-13     -0.10777     0.213042   -0.0652203 -8.23167e-11  3.93048e-14    -0.031691 -2.59585e-12   1.4727e-14  2.70518e-11 -3.55627e-14 -6.55714e-05 -0.000133137    0.0292355    0.0344212  1.58423e-10  3.39422e-13  0.000135718         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.49228e-13 -5.98683e-11 -0.000200058 -0.000200058 -7.17834e-11  1.79549e-13    0.0652203   -0.0652203     0.424482  6.67823e-11 -3.84626e-14   -0.0113321 -1.12922e-11  1.62381e-14 -4.48468e-11  1.12216e-13  1.20667e-06  1.20667e-06 -0.000601528  0.000601528 -8.46637e-11 -1.91819e-13  1.06157e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.56031e-05   -0.0148669 -2.21812e-13 -2.46307e-13    0.0143889  -4.4137e-05  7.23407e-11 -8.23167e-11  6.67823e-11     0.448028  8.28518e-15  5.53511e-12 -0.000495541  9.94061e-07     0.010767 -3.30269e-05  5.22805e-15  1.83879e-14  1.93962e-12  8.26667e-12   -0.0177615  -5.2052e-05 -6.76993e-15         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0148669  4.56031e-05  1.04384e-11  4.62357e-13  -4.4137e-05   -0.0143889  -1.4808e-14  3.93052e-14 -3.84626e-14  8.18087e-15     0.448028  -2.9184e-15  9.94061e-07  0.000495541 -3.30269e-05    -0.010767  3.28157e-12  1.34878e-11   1.1138e-14 -2.42868e-14   5.2052e-05   -0.0177615  1.47304e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.35952e-14 -2.55573e-11 -9.72096e-05 -9.72096e-05 -3.85682e-11  9.63789e-14     0.031691    -0.031691   -0.0113321  5.53511e-12 -2.91837e-15     0.627711  1.66126e-11 -2.40469e-14   8.8033e-12  -2.1643e-14  4.38486e-05  4.38486e-05   -0.0218586    0.0218586 -1.37198e-11  -2.7867e-14  6.65672e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-5.10788e-05    0.0481238 -8.90481e-15 -1.00181e-14   0.00947402 -1.00558e-05  1.10974e-13 -2.59585e-12 -1.12922e-11 -0.000495541  9.94061e-07  1.66126e-11     0.913264  2.40045e-14    0.0216064 -2.29332e-05 -1.77432e-14 -3.46206e-14  2.62692e-11   2.8822e-12   -0.0227535 -2.10378e-05 -3.66967e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481238  5.10788e-05 -4.99351e-12 -2.50867e-12  1.00558e-05   0.00947402 -1.58014e-14   1.4727e-14  1.62381e-14  9.94061e-07  0.000495541 -2.40469e-14  2.38673e-14     0.913264  2.29332e-05    0.0216064  1.28121e-11 -1.63393e-11 -2.80276e-14  1.11608e-14 -2.10378e-05    0.0227535  4.45705e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 5.21484e-14   -0.0477892  8.57646e-14  1.21723e-13   -0.0425853  -2.2457e-13 -8.97857e-11  2.70518e-11 -4.48468e-11     0.010767 -3.30269e-05   8.8033e-12    0.0216064  2.29332e-05     0.954146  1.73353e-13  1.98997e-14 -3.40107e-14  2.56709e-11  7.44504e-12   0.00328347 -4.49208e-07 -1.31124e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0477892  5.21997e-14 -6.16294e-11  1.10449e-12 -2.24717e-13   -0.0425853  7.15257e-14 -3.55627e-14  1.12216e-13 -3.30269e-05    -0.010767  -2.1643e-14 -2.29332e-05    0.0216064  1.73406e-13     0.954146  2.11518e-11 -1.19642e-11 -4.08091e-14 -1.31366e-14 -4.49208e-07  -0.00328347 -5.04444e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-8.41089e-13 -6.14053e-14     0.065914    0.0022573 -4.83987e-14  2.76359e-12  0.000133137 -6.55714e-05  1.20667e-06  5.22807e-15  3.28157e-12  4.38486e-05 -1.77432e-14  1.28121e-11  1.98997e-14  2.11518e-11      1.04646   0.00440018 -0.000159272  0.000159272 -1.50531e-13  1.69235e-11   -0.0159304         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.24739e-13 -6.01473e-14    0.0022573     0.065914 -5.37954e-14  -2.4929e-13  6.55714e-05 -0.000133137  1.20667e-06   1.8388e-14  1.34878e-11  4.38486e-05 -3.46204e-14 -1.63393e-11 -3.40107e-14 -1.19642e-11   0.00440018      1.04646 -0.000159272  0.000159272 -1.29334e-13  2.99426e-12   -0.0159304         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-7.46309e-14  2.93425e-11  2.66406e-05  9.42062e-05  2.85492e-11 -6.77071e-14    0.0344212    0.0292355 -0.000601528  1.93962e-12  1.11381e-14   -0.0218586  2.62692e-11 -2.80276e-14  2.56709e-11  -4.0809e-14 -0.000159272 -0.000159272      1.12585   -0.0837973  5.05614e-11  1.40245e-13 -4.58856e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 7.58628e-14 -2.98589e-11 -9.42062e-05 -2.66406e-05 -2.55363e-11  6.23443e-14    0.0292355    0.0344212  0.000601528  8.26667e-12 -2.42867e-14    0.0218586   2.8822e-12   1.1161e-14  7.44504e-12 -1.31366e-14  0.000159272  0.000159272   -0.0837973      1.12585 -6.45039e-11 -1.61702e-13  4.58856e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-7.67195e-06    0.0560778  1.84823e-12  1.83532e-12   0.00265972 -3.63874e-07 -5.82942e-10  6.11047e-10 -9.01034e-11   -0.0109729  3.21574e-05 -1.84695e-11   -0.0178434 -1.64979e-05      0.01806 -2.47078e-06     6.47e-15   3.7977e-14 -3.11156e-11  9.89744e-12     0.585022 -5.37728e-13  1.29698e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0560778 -7.67195e-06  -1.9133e-11  9.07716e-12 -3.63874e-07  -0.00265972  -1.4107e-12  1.42304e-12 -2.16984e-13 -3.21574e-05   -0.0109729 -4.64008e-14 -1.64979e-05    0.0178434 -2.47078e-06     -0.01806  1.87676e-11 -2.33626e-12  -4.2651e-14  1.07731e-14 -5.37733e-13     0.585022 -4.37623e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.04364e-11  1.18962e-13   -0.0412953   -0.0412953 -8.08257e-15 -1.34017e-11 -0.000136092  0.000136092 -1.93463e-05 -4.37829e-14  1.74116e-12 -1.08248e-05 -2.03384e-14   4.6295e-12 -7.77818e-14  -4.9337e-11   -0.0168392   -0.0168392 -2.42859e-05  2.42859e-05  1.80538e-12 -4.32196e-10      1.94796         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.8"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
