{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2021-11-30T03:12:23.194332Z",
     "iopub.status.busy": "2021-11-30T03:12:23.193787Z",
     "iopub.status.idle": "2021-11-30T03:12:36.189626Z",
     "shell.execute_reply": "2021-11-30T03:12:36.190145Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2022-dev gitid: da70968 (compiled Nov 30 2021, 03:03:55)\r\n",
      "votca_csg, version 2022-dev gitid: da70968 (compiled Nov 30 2021, 02:48:48)\r\n",
      "votca_tools, version 2022-dev gitid: da70968 (compiled Nov 30 2021, 02:46:17)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 BohrA\r\n",
      "    0.307132 -3.09855e-11  4.45037e-11 -2.30665e-10  2.34824e-11   -0.0516061   8.5568e-10  7.79149e-10  -3.2263e-10    0.0181639  -0.00105559  -7.1546e-11    0.0103555    0.0375746 -2.02533e-11    0.0421019 -2.33107e-10  1.30736e-10 -3.01404e-10 -1.07171e-10  0.000481672    -0.108408 -1.28201e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.09855e-11     0.307132 -1.47384e-10  7.08532e-11   -0.0516061  2.34825e-11  9.00199e-10  1.08636e-09  -1.9739e-10   0.00105559    0.0181639 -2.25156e-10    0.0375746   -0.0103555    0.0421019 -2.02533e-11 -1.93685e-11  2.13602e-10 -9.73504e-11  5.02071e-12    -0.108408 -0.000481672 -1.34155e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.45037e-11 -1.47384e-10     0.320625   0.00926938  1.56326e-10  1.03026e-10    0.0133499    0.0133499   -0.0049784 -5.82026e-11 -1.47502e-11  -0.00212096 -8.92301e-11  1.82993e-10 -1.71594e-10  -2.0956e-11    0.0470609  -0.00128695  -0.00258153   -0.0151968  1.82127e-10 -3.04626e-10   -0.0254897          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.30665e-10  7.08532e-11   0.00926938     0.320625  -1.6966e-10  3.23916e-10   -0.0133499   -0.0133499    0.0049784 -5.01139e-11  6.88497e-11   0.00212096  7.28444e-11 -1.44543e-10  6.89644e-11 -1.85822e-10  -0.00128695    0.0470609    0.0151968   0.00258153 -1.68659e-10  7.88969e-10    0.0254897          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.34825e-11   -0.0516061  1.56326e-10  -1.6966e-10     0.490902 -2.88529e-12  1.80089e-09  1.37394e-09 -8.20741e-10 -0.000781089   -0.0134404 -1.98453e-10   0.00770654  -0.00212392    0.0309987  6.68958e-11  -6.5223e-11 -1.89612e-10 -1.33871e-10 -2.73751e-10    0.0531267   0.00023605  1.67536e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0516061  2.34825e-11  1.03026e-10  3.23916e-10 -2.88528e-12     0.490902  -2.5445e-10 -2.67784e-10  1.54944e-10   -0.0134404  0.000781089  1.92602e-11   0.00212392   0.00770654  6.68958e-11    0.0309987  1.91011e-10 -5.11311e-11  9.18312e-11 -1.63004e-10  -0.00023605    0.0531267  2.48391e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  8.5568e-10  9.00199e-10    0.0133499   -0.0133499  1.80089e-09  -2.5445e-10     0.549564      0.21967   -0.0856649 -7.13011e-12  6.43986e-10   -0.0364959 -1.85463e-09  2.97821e-09 -9.22355e-10  3.15801e-10   -0.0113395  -0.00127572    0.0127089    -0.033065  5.13544e-10  -7.4601e-09  -0.00156768          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 7.79149e-10  1.08636e-09    0.0133499   -0.0133499  1.37394e-09 -2.67784e-10      0.21967     0.549564   -0.0856649  4.69693e-11  7.52302e-10   -0.0364959 -1.89308e-09  2.96183e-09 -7.15577e-10  2.13172e-10   0.00127572    0.0113395    -0.033065    0.0127089  4.30063e-11 -7.44289e-09  -0.00156768          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -3.2263e-10  -1.9739e-10   -0.0049784    0.0049784 -8.20741e-10  1.54944e-10   -0.0856649   -0.0856649     0.662947 -1.74987e-10 -2.31597e-10  -0.00632525  4.08468e-10 -7.41255e-10  5.58334e-10 -1.54207e-10   0.00131497  -0.00131497    0.0038773    0.0038773 -9.20038e-10  2.85824e-09    0.0011417          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0181639   0.00105559 -5.82026e-11 -5.01139e-11 -0.000781089   -0.0134404 -7.13011e-12  4.69693e-11 -1.74987e-10     0.680922  1.58831e-12  8.85914e-11  2.70392e-05  7.97275e-05  0.000501088   0.00862237 -3.65702e-10 -3.65561e-11  6.96078e-11  8.83898e-10  -0.00219829   -0.0409686 -8.96061e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -0.00105559    0.0181639 -1.47502e-11  6.88497e-11   -0.0134404  0.000781089  6.43986e-10  7.52302e-10 -2.31597e-10  1.58825e-12     0.680922 -1.12764e-10  7.97274e-05 -2.70392e-05   0.00862237 -0.000501088 -5.78318e-11  8.72122e-10 -5.51747e-10  -1.4949e-10   -0.0409686   0.00219829 -8.14786e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -7.1546e-11 -2.25156e-10  -0.00212096   0.00212096 -1.98453e-10  1.92602e-11   -0.0364959   -0.0364959  -0.00632525  8.85914e-11 -1.12764e-10      0.79826   3.9855e-10   -4.682e-10 -1.57865e-11 -4.96622e-11   0.00464896  -0.00464896    0.0137079    0.0137079  8.86232e-11   8.7074e-10  0.000452534          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0103555    0.0375746 -8.92301e-11  7.28444e-11   0.00770654   0.00212392 -1.85463e-09 -1.89308e-09  4.08468e-10  2.70392e-05  7.97274e-05   3.9855e-10     0.956418  4.28191e-11   -0.0126698   -0.0034918  3.03761e-10 -4.15966e-10    1.051e-09  1.05038e-09    0.0192792   0.00540561  3.05421e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0375746   -0.0103555  1.82993e-10 -1.44543e-10  -0.00212392   0.00770654  2.97821e-09  2.96183e-09 -7.41255e-10  7.97275e-05 -2.70392e-05   -4.682e-10  4.28192e-11     0.956418    0.0034918   -0.0126698 -5.76245e-10  5.76862e-10 -1.67361e-09 -1.78581e-09  -0.00540561    0.0192792 -7.78721e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.02533e-11    0.0421019 -1.71594e-10  6.89644e-11    0.0309987  6.68958e-11 -9.22355e-10 -7.15577e-10  5.58334e-10  0.000501088   0.00862237 -1.57865e-11   -0.0126698    0.0034918     0.988566  3.78071e-11   8.5261e-12 -1.86327e-10  2.23371e-10 -1.97747e-11   -0.0223628 -9.93614e-05  3.65977e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0421019 -2.02533e-11  -2.0956e-11 -1.85822e-10  6.68958e-11    0.0309987  3.15801e-10  2.13172e-10 -1.54207e-10   0.00862237 -0.000501088 -4.96622e-11   -0.0034918   -0.0126698  3.78071e-11     0.988566   1.2211e-10  1.21036e-10 -1.17989e-11 -1.89599e-10  9.93615e-05   -0.0223628  4.45801e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.33107e-10 -1.93685e-11    0.0470609  -0.00128695  -6.5223e-11  1.91011e-10   -0.0113395   0.00127572   0.00131497 -3.65702e-10 -5.78318e-11   0.00464896  3.03761e-10 -5.76245e-10   8.5261e-12   1.2211e-10      1.03319  -0.00655478    0.0132297    0.0132297 -5.77261e-11    5.058e-10  -0.00427414          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.30736e-10  2.13602e-10  -0.00128695    0.0470609 -1.89612e-10 -5.11311e-11  -0.00127572    0.0113395  -0.00131497 -3.65561e-11  8.72122e-10  -0.00464896 -4.15966e-10  5.76862e-10 -1.86327e-10  1.21036e-10  -0.00655478      1.03319   -0.0132297   -0.0132297  6.23408e-11 -5.84851e-10   0.00427414          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.01404e-10 -9.73504e-11  -0.00258153    0.0151968 -1.33871e-10  9.18312e-11    0.0127089    -0.033065    0.0038773  6.96078e-11 -5.51747e-10    0.0137079    1.051e-09 -1.67361e-09  2.23371e-10 -1.17989e-11    0.0132297   -0.0132297      1.06772    0.0410768 -2.87748e-10  1.40611e-09   0.00204765          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.07171e-10  5.02071e-12   -0.0151968   0.00258153 -2.73751e-10 -1.63004e-10    -0.033065    0.0127089    0.0038773  8.83898e-10  -1.4949e-10    0.0137079  1.05038e-09 -1.78581e-09 -1.97747e-11 -1.89599e-10    0.0132297   -0.0132297    0.0410768      1.06772 -2.10372e-10  1.41083e-09   0.00204765          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-0.000334332    0.0752465 -2.48518e-10  3.00383e-10   -0.0690159  0.000306648 -1.37709e-09 -1.00908e-09  9.71276e-10   0.00165858    0.0309104 -4.50766e-11  -0.00866904   0.00243067    0.0364086 -0.000161769  1.19804e-10 -1.21075e-10  4.88054e-10  4.85264e-10    -0.194424  2.24166e-10  3.79896e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0752465  0.000334332  1.78092e-10  -5.5757e-10 -0.000306648   -0.0690159     5.06e-09   5.1092e-09 -2.26114e-09    0.0309104  -0.00165858 -7.95698e-10  -0.00243067  -0.00866904  0.000161769    0.0364086 -4.43367e-10  4.48596e-10 -1.20883e-09 -1.21008e-09  2.24166e-10    -0.194424  1.19936e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.04844e-10 -4.79425e-10    -0.014184     0.014184  4.10972e-10  1.86455e-10   0.00437914   0.00437914  -0.00132877  -1.1424e-09 -1.07753e-09 -0.000532641  7.69217e-11  1.04298e-10 -4.14778e-11  1.63505e-10  -0.00597823   0.00597823   0.00149849   0.00149849  3.89335e-09  1.35012e-09     0.958359          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "    0.093811 -1.37731e-11  1.67628e-11 -1.31176e-10  1.44419e-11   -0.0328898  3.54565e-10   2.9968e-10 -1.98335e-10     0.015531 -0.000902581 -3.66648e-11    0.0128406    0.0465916 -2.35316e-11    0.0481429 -2.87518e-10  1.38675e-10 -3.10674e-10 -3.81085e-11  0.000111558   -0.0251078 -4.01155e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.37731e-11     0.093811 -9.50913e-11  4.02062e-11   -0.0328898  1.44419e-11  3.69103e-10  4.83515e-10 -1.23085e-10  0.000902581     0.015531  -1.6676e-10    0.0465916   -0.0128406    0.0481429 -2.35317e-11 -1.28249e-11   2.8539e-10 -7.56055e-11  7.32379e-11   -0.0251078 -0.000111558 -5.11017e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.67628e-11 -9.50913e-11     0.105881   0.00530115  1.02625e-10  7.15327e-11   0.00676302   0.00676302  -0.00366093 -5.18471e-11 -2.03208e-11    -0.001663 -9.63877e-11  2.02984e-10 -2.10564e-10 -2.54909e-11    0.0640662  -0.00170409   -0.0024771    -0.019664 -6.23576e-11 -1.11236e-11   -0.0418855         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.31176e-10  4.02062e-11   0.00530115     0.105881 -1.09715e-10  2.29062e-10  -0.00676302  -0.00676302   0.00366093 -5.46522e-11  7.12214e-11     0.001663  7.31446e-11 -1.52709e-10  7.34673e-11 -2.18422e-10  -0.00170409    0.0640662     0.019664    0.0024771  1.33424e-10  1.11376e-10    0.0418855         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.44419e-11   -0.0328898  1.02625e-10 -1.09715e-10     0.240891 -6.89617e-13  1.10446e-09   8.0387e-10 -6.98473e-10 -0.000839392   -0.0144437 -1.60499e-10   0.00881479  -0.00242935    0.0441772  9.29898e-11  -5.6654e-11 -3.34173e-10 -5.74905e-11 -2.87338e-10  -0.00438142 -1.94673e-05  5.20769e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0328898  1.44419e-11  7.15327e-11  2.29062e-10  -6.8962e-13     0.240891 -1.39687e-10 -1.46777e-10  1.24227e-10   -0.0144437  0.000839392  9.88931e-12   0.00242935   0.00881479  9.29898e-11    0.0441772  2.79863e-10 -5.00156e-11  1.11408e-10  -2.7942e-10  1.94673e-05  -0.00438142  4.31972e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.54565e-10  3.69103e-10   0.00676302  -0.00676302  1.10446e-09 -1.39687e-10     0.221861     0.110679   -0.0629948  -1.3274e-12  4.62562e-10   -0.0286158 -1.92767e-09  3.22412e-09 -1.03146e-09  3.28795e-10   -0.0100724   -0.0071145    0.0330986   -0.0292635 -8.01261e-10 -3.84431e-10    0.0029301         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  2.9968e-10  4.83515e-10   0.00676302  -0.00676302   8.0387e-10 -1.46777e-10     0.110679     0.221861   -0.0629948  4.95733e-11  5.69061e-10   -0.0286158 -1.97794e-09  3.20088e-09 -7.87549e-10  1.91698e-10    0.0071145    0.0100724   -0.0292635    0.0330986 -8.98703e-10 -3.12385e-10    0.0029301         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.98335e-10 -1.23085e-10  -0.00366093   0.00366093 -6.98473e-10  1.24227e-10   -0.0629948   -0.0629948     0.429278 -2.25285e-10 -2.34116e-10   -0.0121538  4.56486e-10 -9.09082e-10  7.69117e-10 -2.08905e-10  -6.1994e-06  6.19943e-06 -1.82795e-05 -1.82795e-05 -7.45669e-11  5.84272e-10   5.8532e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "    0.015531  0.000902581 -5.18471e-11 -5.46522e-11 -0.000839392   -0.0144437  -1.3274e-12  4.95733e-11 -2.25285e-10     0.463967   2.1212e-12  1.17679e-10  0.000207736  0.000612526  0.000601953     0.010358 -6.16177e-10 -6.25659e-11  1.11963e-10   1.4906e-09 -0.000950247   -0.0177094 -1.86775e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-0.000902581     0.015531 -2.03208e-11  7.12214e-11   -0.0144437  0.000839392  4.62562e-10  5.69061e-10 -2.34116e-10  2.12113e-12     0.463967 -1.09256e-10  0.000612526 -0.000207736     0.010358 -0.000601953 -7.67961e-11  1.45544e-09 -8.67004e-10 -1.88261e-10   -0.0177094  0.000950247 -1.77773e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.66648e-11  -1.6676e-10    -0.001663     0.001663 -1.60499e-10  9.88931e-12   -0.0286158   -0.0286158   -0.0121538  1.17679e-10 -1.09256e-10     0.636067  5.47694e-10 -6.15258e-10 -6.46651e-11 -6.62034e-11    0.0067218   -0.0067218    0.0198198    0.0198198  1.03284e-10  -8.5867e-12  4.54602e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0128406    0.0465916 -9.63877e-11  7.31446e-11   0.00881479   0.00242935 -1.92767e-09 -1.97794e-09  4.56486e-10  0.000207736  0.000612526  5.47694e-10     0.917068  7.50662e-11   -0.0214902  -0.00592268  5.28407e-10  -7.5823e-10  1.85972e-09  1.85518e-09    0.0223829   0.00627585  1.65249e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0465916   -0.0128406  2.02984e-10 -1.52709e-10  -0.00242935   0.00881479  3.22412e-09  3.20088e-09 -9.09082e-10  0.000612526 -0.000207736 -6.15258e-10  7.50663e-11     0.917068   0.00592268   -0.0214902 -1.02313e-09  1.02766e-09 -2.98452e-09 -3.21434e-09  -0.00627585    0.0223829   1.2642e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.35316e-11    0.0481429 -2.10564e-10  7.34673e-11    0.0441772  9.29897e-11 -1.03146e-09 -7.87549e-10  7.69117e-10  0.000601953     0.010358 -6.46651e-11   -0.0214902   0.00592268     0.981535  7.28761e-11 -3.51204e-12 -3.05966e-10  3.62877e-10 -7.51191e-11   0.00424838  1.88762e-05  3.17037e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481429 -2.35317e-11 -2.54909e-11 -2.18422e-10  9.29898e-11    0.0441772  3.28795e-10  1.91698e-10 -2.08905e-10     0.010358 -0.000601953 -6.62034e-11  -0.00592268   -0.0214902  7.28761e-11     0.981535  2.22884e-10  2.15113e-10 -7.20803e-12 -3.16686e-10 -1.88762e-05   0.00424838  6.75847e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.87518e-10 -1.28249e-11    0.0640662  -0.00170409  -5.6654e-11  2.79863e-10   -0.0100724    0.0071145  -6.1994e-06 -6.16177e-10 -7.67961e-11    0.0067218  5.28407e-10 -1.02313e-09 -3.51204e-12  2.22884e-10      1.06906   -0.0127885    0.0247216    0.0247216  4.19512e-11  2.29613e-10   -0.0150525         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.38675e-10   2.8539e-10  -0.00170409    0.0640662 -3.34173e-10 -5.00156e-11   -0.0071145    0.0100724  6.19943e-06 -6.25659e-11  1.45544e-09   -0.0067218  -7.5823e-10  1.02766e-09 -3.05966e-10  2.15113e-10   -0.0127885      1.06906   -0.0247216   -0.0247216 -1.38864e-10 -2.90729e-10    0.0150525         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.10674e-10 -7.56055e-11   -0.0024771     0.019664 -5.74905e-11  1.11408e-10    0.0330986   -0.0292635 -1.82795e-05  1.11963e-10 -8.67004e-10    0.0198198  1.85972e-09 -2.98452e-09  3.62877e-10 -7.20803e-12    0.0247216   -0.0247216      1.13357    0.0772979  1.18973e-10  4.33684e-10    0.0054483         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.81085e-11  7.32379e-11    -0.019664    0.0024771 -2.87338e-10  -2.7942e-10   -0.0292635    0.0330986 -1.82795e-05   1.4906e-09 -1.88261e-10    0.0198198  1.85518e-09 -3.21434e-09 -7.51191e-11 -3.16686e-10    0.0247216   -0.0247216    0.0772979      1.13357  1.80305e-10  3.37041e-10    0.0054483         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 0.000254844   -0.0573567  6.50968e-13  4.59938e-11  -0.00347861   1.5456e-05 -3.27897e-10 -5.32508e-10 -4.02505e-12 -0.000546819   -0.0101909 -2.33243e-11    0.0179489  -0.00503261    0.0191591  -8.5127e-05 -6.43422e-14   9.0785e-11  5.04974e-11  2.62756e-10     0.600541  2.24699e-10  2.81252e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0573567 -0.000254844 -1.63849e-10  3.70682e-10  -1.5456e-05  -0.00347861 -3.85771e-09 -3.80973e-09  6.45026e-10   -0.0101909  0.000546819  1.38946e-10   0.00503261    0.0179489   8.5127e-05    0.0191591 -1.49294e-10 -6.08966e-11 -1.42145e-10 -5.13216e-11    2.247e-10     0.600541  7.09067e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.28218e-10  -3.2124e-10   -0.0423663    0.0423663  6.07588e-10  5.83247e-10    0.0028994    0.0028994 -0.000442771 -1.66946e-09 -1.60314e-09 -0.000216721  1.09831e-10  1.72886e-10  4.07533e-10  8.27907e-10   -0.0160942    0.0160942   0.00533101   0.00533101  3.14877e-09  5.25836e-10       1.9849         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
