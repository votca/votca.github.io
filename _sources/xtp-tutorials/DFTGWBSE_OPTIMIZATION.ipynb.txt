{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2021-12-16T00:48:40.448056Z",
     "iopub.status.busy": "2021-12-16T00:48:40.447388Z",
     "iopub.status.idle": "2021-12-16T00:49:01.069609Z",
     "shell.execute_reply": "2021-12-16T00:49:01.069008Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2022-dev gitid: 41a7218 (compiled Dec 16 2021, 00:39:52)\r\n",
      "votca_csg, version 2022-dev gitid: 41a7218 (compiled Dec 16 2021, 00:24:56)\r\n",
      "votca_tools, version 2022-dev gitid: 41a7218 (compiled Dec 16 2021, 00:21:57)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 BohrA\r\n",
      "    0.307132 -3.10898e-11  4.46689e-11 -2.30831e-10  2.35542e-11   -0.0516061   8.5545e-10  7.78924e-10  -3.2259e-10    0.0181637   -0.0010588    -7.15e-11    0.0103622    0.0375727 -2.03142e-11    0.0421019 -2.33136e-10  1.30804e-10  -3.0134e-10 -1.07086e-10 -0.000481316    -0.108408 -1.28154e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.10897e-11     0.307132 -1.47178e-10   7.0652e-11   -0.0516061  2.35541e-11  9.00383e-10  1.08654e-09 -1.97455e-10    0.0010588    0.0181637  -2.2517e-10    0.0375727   -0.0103622    0.0421019 -2.03142e-11 -1.94112e-11  2.13666e-10 -9.73311e-11  5.00077e-12     0.108408 -0.000481316 -1.35024e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.46689e-11 -1.47178e-10      0.32063   0.00926466  1.56579e-10  1.02947e-10    0.0133903    0.0133903  -0.00499353 -5.81925e-11  -1.4616e-11   -0.0021274 -8.94957e-11  1.83549e-10 -1.71718e-10 -2.08864e-11    0.0470557  -0.00128403  -0.00258782   -0.0152112 -1.82061e-10 -3.05987e-10   -0.0254906          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.30831e-10   7.0652e-11   0.00926466      0.32063 -1.69924e-10  3.23994e-10   -0.0133903   -0.0133903   0.00499353 -5.01127e-11  6.87374e-11    0.0021274  7.31158e-11 -1.45097e-10  6.90951e-11 -1.85894e-10  -0.00128403    0.0470557    0.0152112   0.00258782  1.68603e-10  7.90329e-10    0.0254906          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.35542e-11   -0.0516061  1.56579e-10 -1.69924e-10     0.490902 -2.90137e-12  1.80081e-09  1.37387e-09 -8.20711e-10 -0.000783463   -0.0134403  -1.9845e-10   0.00770617  -0.00212529    0.0309987  6.71058e-11 -6.52853e-11 -1.89579e-10 -1.33926e-10 -2.73754e-10   -0.0531267  0.000235875  1.67523e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0516061  2.35542e-11  1.02947e-10  3.23994e-10 -2.90139e-12     0.490902 -2.54748e-10 -2.68093e-10  1.55111e-10   -0.0134403  0.000783463  1.93008e-11   0.00212529   0.00770617  6.71057e-11    0.0309987   1.9096e-10 -5.11316e-11  9.18441e-11  -1.6302e-10  0.000235875    0.0531267   2.4833e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  8.5545e-10  9.00383e-10    0.0133903   -0.0133903  1.80081e-09 -2.54748e-10      0.54956     0.219665   -0.0856641 -7.15936e-12  6.43999e-10   -0.0364956 -1.85348e-09   2.9789e-09 -9.22283e-10   3.1595e-10   -0.0113515  -0.00127192    0.0127111   -0.0330605 -5.12015e-10  -7.4601e-09   -0.0015738          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 7.78924e-10  1.08654e-09    0.0133903   -0.0133903  1.37387e-09 -2.68093e-10     0.219665      0.54956   -0.0856641  4.69621e-11  7.52305e-10   -0.0364956 -1.89194e-09  2.96252e-09 -7.15502e-10  2.13326e-10   0.00127192    0.0113515   -0.0330605    0.0127111  -4.1478e-11  -7.4429e-09   -0.0015738          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -3.2259e-10 -1.97455e-10  -0.00499353   0.00499353 -8.20711e-10  1.55111e-10   -0.0856641   -0.0856641     0.662947  -1.7498e-10 -2.31601e-10  -0.00632525  4.08185e-10 -7.41411e-10  5.58304e-10  -1.5432e-10   0.00131634  -0.00131634   0.00387683   0.00387683  9.19463e-10  2.85844e-09   0.00114571          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0181637    0.0010588 -5.81925e-11 -5.01127e-11 -0.000783463   -0.0134403 -7.15936e-12  4.69621e-11  -1.7498e-10     0.680922  1.59193e-12  8.85946e-11  2.70675e-05  7.97179e-05  0.000502611   0.00862229 -3.65366e-10 -3.65824e-11   6.9599e-11  8.84043e-10   0.00220566   -0.0409682 -8.96012e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0010588    0.0181637  -1.4616e-11  6.87374e-11   -0.0134403  0.000783463  6.43999e-10  7.52305e-10 -2.31601e-10   1.5919e-12     0.680922 -1.12763e-10  7.97178e-05 -2.70675e-05   0.00862229 -0.000502611  -5.7884e-11  8.72328e-10 -5.51416e-10 -1.49467e-10    0.0409682   0.00220566 -8.14855e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   -7.15e-11  -2.2517e-10   -0.0021274    0.0021274  -1.9845e-10  1.93007e-11   -0.0364956   -0.0364956  -0.00632525  8.85946e-11 -1.12763e-10      0.79826  3.98372e-10 -4.68352e-10 -1.57965e-11  -4.9659e-11   0.00465383  -0.00465383    0.0137062    0.0137062 -8.87968e-11  8.70729e-10  0.000454124          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0103622    0.0375727 -8.94957e-11  7.31158e-11   0.00770617   0.00212529 -1.85348e-09 -1.89194e-09  4.08185e-10  2.70675e-05  7.97178e-05  3.98372e-10     0.956418  4.28626e-11   -0.0126692  -0.00349405  3.03914e-10 -4.16119e-10  1.05021e-09   1.0496e-09   -0.0192783   0.00540898  3.06192e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0375727   -0.0103622  1.83549e-10 -1.45097e-10  -0.00212529   0.00770617   2.9789e-09  2.96252e-09 -7.41411e-10  7.97179e-05 -2.70675e-05 -4.68352e-10  4.28626e-11     0.956418   0.00349405   -0.0126692 -5.76997e-10  5.77611e-10  -1.6738e-09 -1.78601e-09   0.00540898    0.0192783 -7.94357e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.03143e-11    0.0421019 -1.71718e-10  6.90951e-11    0.0309987  6.71056e-11 -9.22283e-10 -7.15502e-10  5.58304e-10  0.000502611   0.00862229 -1.57965e-11   -0.0126692   0.00349405     0.988566  3.79161e-11  8.53748e-12 -1.86388e-10  2.23299e-10 -1.98114e-11    0.0223628 -9.92879e-05  3.66101e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0421019 -2.03143e-11 -2.08864e-11 -1.85894e-10  6.71057e-11    0.0309987   3.1595e-10  2.13326e-10  -1.5432e-10   0.00862229 -0.000502611  -4.9659e-11  -0.00349405   -0.0126692  3.79161e-11     0.988566  1.22037e-10  1.21073e-10 -1.17949e-11 -1.89645e-10 -9.92879e-05   -0.0223628  4.45731e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.33136e-10 -1.94112e-11    0.0470557  -0.00128403 -6.52853e-11   1.9096e-10   -0.0113515   0.00127192   0.00131634 -3.65366e-10  -5.7884e-11   0.00465383  3.03914e-10 -5.76997e-10  8.53748e-12  1.22037e-10       1.0332  -0.00656417    0.0132419    0.0132419  5.76967e-11  5.06316e-10  -0.00427299          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.30804e-10  2.13666e-10  -0.00128403    0.0470557 -1.89579e-10 -5.11316e-11  -0.00127192    0.0113515  -0.00131634 -3.65824e-11  8.72328e-10  -0.00465383 -4.16119e-10  5.77611e-10 -1.86388e-10  1.21073e-10  -0.00656417       1.0332   -0.0132419   -0.0132419  -6.2327e-11 -5.85365e-10   0.00427299          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -3.0134e-10 -9.73311e-11  -0.00258782    0.0152112 -1.33926e-10  9.18441e-11    0.0127111   -0.0330605   0.00387683   6.9599e-11 -5.51416e-10    0.0137062  1.05021e-09  -1.6738e-09  2.23299e-10 -1.17949e-11    0.0132419   -0.0132419      1.06771    0.0410674  2.87442e-10  1.40597e-09   0.00205052          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.07086e-10  5.00077e-12   -0.0152112   0.00258782 -2.73754e-10  -1.6302e-10   -0.0330605    0.0127111   0.00387683  8.84043e-10 -1.49467e-10    0.0137062   1.0496e-09 -1.78601e-09 -1.98114e-11 -1.89645e-10    0.0132419   -0.0132419    0.0410674      1.06771  2.10067e-10   1.4107e-09   0.00205052          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 0.000334084   -0.0752465  2.48651e-10 -3.00526e-10    0.0690159 -0.000306421  1.37603e-09  1.00803e-09 -9.70825e-10  -0.00166415   -0.0309101  4.52347e-11   0.00866861  -0.00243219   -0.0364086  0.000161649 -1.19886e-10  1.21158e-10 -4.87767e-10 -4.84978e-10    -0.194424 -2.24939e-10 -3.79932e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0752465  0.000334084  1.79055e-10 -5.58531e-10 -0.000306421   -0.0690159  5.06023e-09  5.10943e-09 -2.26136e-09    0.0309101  -0.00166415 -7.95697e-10  -0.00243219  -0.00866861  0.000161649    0.0364086 -4.43824e-10  4.49053e-10 -1.20878e-09 -1.21003e-09 -2.24939e-10    -0.194424  1.19835e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.04774e-10 -4.79445e-10   -0.0141829    0.0141829  4.11063e-10  1.86415e-10    0.0043904    0.0043904  -0.00133208  -1.1424e-09 -1.07753e-09 -0.000533932  7.68886e-11  1.04393e-10 -4.14646e-11  1.63498e-10  -0.00597825   0.00597825   0.00149905   0.00149905 -3.89371e-09  1.34904e-09     0.958372          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "    0.093811 -1.38201e-11  1.68335e-11 -1.31247e-10  1.44864e-11   -0.0328898  3.54463e-10  2.99581e-10 -1.98309e-10    0.0155308 -0.000905324 -3.66307e-11    0.0128489    0.0465893 -2.36028e-11    0.0481429 -2.87522e-10  1.38734e-10 -3.10613e-10 -3.80169e-11 -0.000111475   -0.0251078 -4.01037e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.38201e-11     0.093811 -9.49993e-11  4.01173e-11   -0.0328898  1.44863e-11   3.6918e-10  4.83594e-10 -1.23125e-10  0.000905324    0.0155308 -1.66767e-10    0.0465893   -0.0128489    0.0481429 -2.36028e-11 -1.28532e-11  2.85449e-10 -7.55606e-11  7.32275e-11    0.0251078 -0.000111475 -5.11113e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.68335e-11 -9.49993e-11     0.105883   0.00529876  1.02774e-10  7.14857e-11    0.0067835    0.0067835  -0.00367206 -5.18365e-11 -2.02188e-11  -0.00166805 -9.66609e-11  2.03585e-10 -2.10702e-10 -2.54181e-11    0.0640605  -0.00170143  -0.00248287   -0.0196809  6.25219e-11 -1.11649e-11   -0.0418853         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.31247e-10  4.01173e-11   0.00529876     0.105883 -1.09872e-10  2.29108e-10   -0.0067835   -0.0067835   0.00367206 -5.46522e-11  7.11411e-11   0.00166805  7.34255e-11 -1.53308e-10  7.36116e-11 -2.18498e-10  -0.00170143    0.0640605    0.0196809   0.00248287 -1.33587e-10  1.11419e-10    0.0418853         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.44864e-11   -0.0328898  1.02774e-10 -1.09872e-10     0.240891 -6.98512e-13  1.10442e-09  8.03823e-10 -6.98449e-10 -0.000841943   -0.0144435 -1.60497e-10   0.00881435  -0.00243092    0.0441772  9.32812e-11 -5.67055e-11 -3.34169e-10 -5.75963e-11 -2.87365e-10   0.00438142 -1.94529e-05  5.20843e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0328898  1.44863e-11  7.14857e-11  2.29108e-10 -6.98523e-13     0.240891 -1.39863e-10 -1.46961e-10  1.24369e-10   -0.0144435  0.000841943  9.92217e-12   0.00243092   0.00881435   9.3281e-11    0.0441772  2.79766e-10 -4.99972e-11  1.11408e-10 -2.79467e-10 -1.94529e-05  -0.00438142  4.31875e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.54463e-10   3.6918e-10    0.0067835   -0.0067835  1.10442e-09 -1.39863e-10     0.221859     0.110677   -0.0629941 -1.35246e-12  4.62576e-10   -0.0286155 -1.92643e-09  3.22483e-09 -1.03139e-09  3.28959e-10   -0.0100831  -0.00711493    0.0330996   -0.0292595  8.01317e-10  -3.8424e-10    0.0029357         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.99581e-10  4.83594e-10    0.0067835   -0.0067835  8.03823e-10 -1.46961e-10     0.110677     0.221859   -0.0629941  4.95699e-11  5.69065e-10   -0.0286155 -1.97671e-09   3.2016e-09  -7.8747e-10  1.91869e-10   0.00711493    0.0100831   -0.0292595    0.0330996   8.9876e-10 -3.12197e-10    0.0029357         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.98309e-10 -1.23125e-10  -0.00367206   0.00367206 -6.98449e-10  1.24369e-10   -0.0629941   -0.0629941     0.429278 -2.25279e-10 -2.34121e-10   -0.0121538   4.5614e-10 -9.09257e-10  7.69075e-10 -2.09061e-10 -6.20589e-06  6.20591e-06 -1.82773e-05 -1.82773e-05  7.44488e-11  5.84291e-10  6.00325e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0155308  0.000905324 -5.18365e-11 -5.46522e-11 -0.000841943   -0.0144435 -1.35246e-12  4.95699e-11 -2.25279e-10     0.463967    2.126e-12  1.17682e-10  0.000207953  0.000612452  0.000603783    0.0103579 -6.15611e-10 -6.26078e-11  1.11946e-10  1.49084e-09  0.000953433   -0.0177092  -1.8677e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-0.000905324    0.0155308 -2.02188e-11  7.11411e-11   -0.0144435  0.000841943  4.62576e-10  5.69065e-10 -2.34121e-10  2.12597e-12     0.463967 -1.09253e-10  0.000612452 -0.000207953    0.0103579 -0.000603783 -7.68613e-11  1.45576e-09  -8.6645e-10 -1.88232e-10    0.0177092  0.000953433  -1.7778e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.66307e-11 -1.66767e-10  -0.00166805   0.00166805 -1.60497e-10  9.92217e-12   -0.0286155   -0.0286155   -0.0121538  1.17682e-10 -1.09253e-10     0.636067   5.4746e-10 -6.15467e-10 -6.46784e-11 -6.61901e-11   0.00672884  -0.00672884    0.0198174    0.0198174 -1.03281e-10 -8.60598e-12  4.61901e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0128489    0.0465893 -9.66609e-11  7.34255e-11   0.00881435   0.00243092 -1.92643e-09 -1.97671e-09   4.5614e-10  0.000207953  0.000612452   5.4746e-10     0.917068  7.51426e-11   -0.0214892  -0.00592651  5.28676e-10 -7.58498e-10  1.85831e-09  1.85378e-09   -0.0223818   0.00627977  1.65349e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0465893   -0.0128489  2.03585e-10 -1.53308e-10  -0.00243092   0.00881435  3.22483e-09   3.2016e-09 -9.09257e-10  0.000612452 -0.000207953 -6.15467e-10  7.51427e-11     0.917068   0.00592651   -0.0214892 -1.02448e-09  1.02901e-09 -2.98486e-09 -3.21468e-09   0.00627977    0.0223818  1.26251e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.36029e-11    0.0481429 -2.10702e-10  7.36116e-11    0.0441772   9.3281e-11 -1.03139e-09  -7.8747e-10  7.69075e-10  0.000603783    0.0103579 -6.46784e-11   -0.0214892   0.00592651     0.981535  7.30857e-11 -3.50496e-12 -3.06063e-10   3.6276e-10 -7.51738e-11  -0.00424838  1.88622e-05  3.17208e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481429 -2.36029e-11 -2.54181e-11 -2.18498e-10  9.32811e-11    0.0441772  3.28959e-10  1.91869e-10 -2.09061e-10    0.0103579 -0.000603783 -6.61901e-11  -0.00592651   -0.0214892  7.30857e-11     0.981535  2.22764e-10  2.15169e-10  -7.1938e-12 -3.16762e-10  1.88622e-05   0.00424838  6.75771e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.87522e-10 -1.28532e-11    0.0640605  -0.00170143 -5.67055e-11  2.79766e-10   -0.0100831   0.00711493 -6.20589e-06 -6.15611e-10 -7.68613e-11   0.00672884  5.28676e-10 -1.02448e-09 -3.50496e-12  2.22764e-10      1.06907    -0.012806    0.0247444    0.0247444  -4.2063e-11  2.29722e-10   -0.0150506         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.38734e-10  2.85449e-10  -0.00170143    0.0640605 -3.34169e-10 -4.99972e-11  -0.00711493    0.0100831  6.20591e-06 -6.26078e-11  1.45576e-09  -0.00672884 -7.58498e-10  1.02901e-09 -3.06063e-10  2.15169e-10    -0.012806      1.06907   -0.0247444   -0.0247444  1.38963e-10 -2.90857e-10    0.0150506         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.10613e-10 -7.55606e-11  -0.00248287    0.0196809 -5.75963e-11  1.11408e-10    0.0330996   -0.0292595 -1.82773e-05  1.11946e-10  -8.6645e-10    0.0198174  1.85831e-09 -2.98486e-09   3.6276e-10  -7.1938e-12    0.0247444   -0.0247444      1.13355    0.0772803 -1.19009e-10  4.33557e-10   0.00545393         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.80169e-11  7.32275e-11   -0.0196809   0.00248287 -2.87365e-10 -2.79467e-10   -0.0292595    0.0330996 -1.82773e-05  1.49084e-09 -1.88232e-10    0.0198174  1.85378e-09 -3.21468e-09 -7.51738e-11 -3.16762e-10    0.0247444   -0.0247444    0.0772803      1.13355  -1.8036e-10  3.36927e-10   0.00545393         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-0.000254656    0.0573567 -5.17067e-13 -4.61235e-11   0.00347861 -1.54445e-05  3.28681e-10  5.33292e-10  3.88932e-12  0.000548652    0.0101908  2.32944e-11    -0.017948   0.00503575   -0.0191591   8.5064e-05 -4.17231e-15 -9.07595e-11 -5.05051e-11 -2.62746e-10     0.600541 -2.25461e-10 -2.81268e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0573567 -0.000254656 -1.64521e-10  3.71355e-10 -1.54446e-05  -0.00347861 -3.85757e-09 -3.80959e-09  6.45021e-10   -0.0101908  0.000548652  1.38948e-10   0.00503575     0.017948  8.50639e-05    0.0191591 -1.49311e-10 -6.08603e-11 -1.42186e-10 -5.13206e-11 -2.25461e-10     0.600541  7.02798e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.28117e-10 -3.21329e-10   -0.0423661    0.0423661  6.07704e-10  5.83131e-10   0.00290523   0.00290523 -0.000442838 -1.66942e-09 -1.60319e-09 -0.000216811   1.0986e-10   1.7289e-10    4.077e-10  8.27818e-10   -0.0160927    0.0160927   0.00533576   0.00533576 -3.14898e-09  5.25054e-10      1.98492         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
