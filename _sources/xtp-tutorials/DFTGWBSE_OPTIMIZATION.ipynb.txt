{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2023-02-21T20:37:30.687228Z",
     "iopub.status.busy": "2023-02-21T20:37:30.686581Z",
     "iopub.status.idle": "2023-02-21T20:38:19.997097Z",
     "shell.execute_reply": "2023-02-21T20:38:19.995574Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/votca/issues\r\n",
      "\r\n",
      "xtp_tools, version 2024-dev gitid: 97b96b2 (compiled Feb 21 2023, 20:04:20)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 BohrA\r\n",
      "    0.307132 -3.11357e-11  4.47462e-11  -2.3091e-10  2.35862e-11   -0.0516061  8.55346e-10  7.78822e-10 -3.22571e-10    0.0181636  -0.00106031 -7.14792e-11    0.0103323     0.037581 -2.03416e-11    0.0421019 -2.33056e-10  1.30571e-10 -3.01425e-10 -1.07252e-10  0.000481389    -0.108408 -1.28131e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.11357e-11     0.307132 -1.47081e-10  7.05577e-11   -0.0516061  2.35861e-11  9.00465e-10  1.08663e-09 -1.97484e-10   0.00106031    0.0181636 -2.25177e-10     0.037581   -0.0103323    0.0421019 -2.03416e-11 -1.94353e-11  2.13609e-10 -9.75089e-11   4.9757e-12    -0.108408 -0.000481389 -1.35528e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.47462e-11 -1.47081e-10     0.320632   0.00926243  1.56698e-10   1.0291e-10    0.0134093    0.0134093  -0.00500065 -5.81878e-11  -1.4553e-11  -0.00213043 -8.97827e-11  1.83732e-10 -1.71778e-10 -2.08538e-11    0.0470666  -0.00128493  -0.00258965   -0.0151766  1.82032e-10 -3.06627e-10   -0.0254912          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -2.3091e-10  7.05577e-11   0.00926243     0.320632 -1.70047e-10  3.24032e-10   -0.0134093   -0.0134093   0.00500065 -5.01124e-11  6.86846e-11   0.00213043  7.33719e-11 -1.45293e-10  6.91564e-11 -1.85928e-10  -0.00128493    0.0470666    0.0151766   0.00258965 -1.68579e-10  7.90969e-10    0.0254912          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.35861e-11   -0.0516061  1.56698e-10 -1.70047e-10     0.490902 -2.90755e-12  1.80077e-09  1.37383e-09 -8.20696e-10 -0.000784579   -0.0134402 -1.98447e-10   0.00770785  -0.00211915    0.0309987  6.71991e-11 -6.50735e-11  -1.8968e-10 -1.33784e-10 -2.73813e-10    0.0531267  0.000235911  1.67502e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0516061  2.35861e-11   1.0291e-10  3.24032e-10 -2.90754e-12     0.490902 -2.54881e-10  -2.6823e-10  1.55186e-10   -0.0134402  0.000784579  1.93188e-11   0.00211915   0.00770785  6.71992e-11    0.0309987   1.9108e-10 -5.10511e-11  9.18936e-11  -1.6286e-10 -0.000235911    0.0531267  2.48301e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 8.55346e-10  9.00465e-10    0.0134093   -0.0134093  1.80077e-09 -2.54881e-10     0.549558     0.219663   -0.0856636 -7.17019e-12  6.44005e-10   -0.0364954 -1.85558e-09  2.97758e-09 -9.22248e-10  3.16016e-10    -0.011328  -0.00125894    0.0127133   -0.0330684  5.11337e-10  -7.4601e-09  -0.00157865          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 7.78822e-10  1.08663e-09    0.0134093   -0.0134093  1.37383e-09  -2.6823e-10     0.219663     0.549558   -0.0856636  4.69615e-11  7.52305e-10   -0.0364954 -1.89402e-09  2.96117e-09 -7.15467e-10  2.13395e-10   0.00125894     0.011328   -0.0330684    0.0127133   4.0799e-11  -7.4429e-09  -0.00157865          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.22571e-10 -1.97484e-10  -0.00500065   0.00500065 -8.20696e-10  1.55186e-10   -0.0856636   -0.0856636     0.662947 -1.74978e-10 -2.31603e-10  -0.00632525  4.08708e-10 -7.41124e-10  5.58289e-10 -1.54371e-10   0.00131358  -0.00131358   0.00387777   0.00387777 -9.19209e-10  2.85853e-09   0.00114833          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0181636   0.00106031 -5.81878e-11 -5.01124e-11 -0.000784579   -0.0134402 -7.17019e-12  4.69615e-11 -1.74978e-10     0.680922  1.59406e-12  8.85953e-11  2.70107e-05  7.97371e-05  0.000503327   0.00862224 -3.65989e-10 -3.65332e-11  6.96262e-11  8.83786e-10  -0.00220903    -0.040968 -8.95988e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -0.00106031    0.0181636  -1.4553e-11  6.86846e-11   -0.0134402  0.000784579  6.44005e-10  7.52305e-10 -2.31603e-10  1.59401e-12     0.680922 -1.12761e-10  7.97371e-05 -2.70107e-05   0.00862224 -0.000503327  -5.7777e-11  8.71937e-10  -5.5203e-10 -1.49508e-10    -0.040968   0.00220903 -8.14889e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-7.14792e-11 -2.25177e-10  -0.00213043   0.00213043 -1.98447e-10  1.93188e-11   -0.0364954   -0.0364954  -0.00632525  8.85953e-11 -1.12761e-10      0.79826  3.98702e-10 -4.68071e-10 -1.58012e-11 -4.96574e-11   0.00464405  -0.00464405    0.0137095    0.0137095  8.88751e-11  8.70723e-10  0.000455185          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0103323     0.037581 -8.97827e-11  7.33719e-11   0.00770785   0.00211915 -1.85558e-09 -1.89402e-09  4.08708e-10  2.70107e-05  7.97371e-05  3.98702e-10     0.956418  4.27824e-11    -0.012672  -0.00348397  3.03572e-10 -4.15777e-10  1.05169e-09  1.05108e-09    0.0192826   0.00539365  3.06694e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "    0.037581   -0.0103323  1.83732e-10 -1.45293e-10  -0.00211915   0.00770785  2.97758e-09  2.96117e-09 -7.41124e-10  7.97371e-05 -2.70107e-05 -4.68071e-10  4.27825e-11     0.956418   0.00348397    -0.012672 -5.75511e-10  5.76124e-10 -1.67347e-09 -1.78568e-09  -0.00539365    0.0192826  -8.0032e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.03416e-11    0.0421019 -1.71778e-10  6.91564e-11    0.0309987  6.71992e-11 -9.22248e-10 -7.15467e-10  5.58289e-10  0.000503327   0.00862224 -1.58012e-11    -0.012672   0.00348397     0.988566  3.79658e-11  8.56061e-12  -1.8622e-10  2.23429e-10 -1.98213e-11   -0.0223628  -9.9303e-05  3.66169e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0421019 -2.03416e-11 -2.08538e-11 -1.85928e-10  6.71991e-11    0.0309987  3.16016e-10  2.13395e-10 -1.54371e-10   0.00862224 -0.000503327 -4.96574e-11  -0.00348397    -0.012672  3.79658e-11     0.988566   1.2217e-10   1.2108e-10 -1.18994e-11 -1.89558e-10   9.9303e-05   -0.0223628  4.45696e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.33056e-10 -1.94353e-11    0.0470666  -0.00128493 -6.50735e-11   1.9108e-10    -0.011328   0.00125894   0.00131358 -3.65989e-10  -5.7777e-11   0.00464405  3.03572e-10 -5.75511e-10  8.56061e-12   1.2217e-10      1.03318  -0.00654531    0.0132173    0.0132173 -5.75002e-11  5.05315e-10  -0.00427434          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.30571e-10  2.13609e-10  -0.00128493    0.0470666  -1.8968e-10 -5.10511e-11  -0.00125894     0.011328  -0.00131358 -3.65332e-11  8.71937e-10  -0.00464405 -4.15777e-10  5.76124e-10  -1.8622e-10   1.2108e-10  -0.00654531      1.03318   -0.0132173   -0.0132173  6.20701e-11 -5.84368e-10   0.00427434          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.01425e-10 -9.75089e-11  -0.00258965    0.0151766 -1.33784e-10  9.18936e-11    0.0127133   -0.0330684   0.00387777  6.96262e-11  -5.5203e-10    0.0137095  1.05169e-09 -1.67347e-09  2.23429e-10 -1.18994e-11    0.0132173   -0.0132173      1.06773    0.0410862 -2.87359e-10  1.40641e-09   0.00204784          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.07252e-10   4.9757e-12   -0.0151766   0.00258965 -2.73813e-10  -1.6286e-10   -0.0330684    0.0127133   0.00387777  8.83786e-10 -1.49508e-10    0.0137095  1.05108e-09 -1.78568e-09 -1.98213e-11 -1.89558e-10    0.0132173   -0.0132173    0.0410862      1.06773 -2.09981e-10  1.41108e-09   0.00204784          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-0.000334135    0.0752465 -2.48717e-10  3.00595e-10   -0.0690159  0.000306468 -1.37556e-09 -1.00756e-09  9.70627e-10   0.00166669      0.03091 -4.53051e-11  -0.00867054   0.00242529    0.0364086 -0.000161674    1.195e-10 -1.20769e-10  4.87745e-10  4.84954e-10    -0.194424  2.25319e-10  3.79957e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0752465  0.000334135  1.79505e-10 -5.58982e-10 -0.000306468   -0.0690159  5.06033e-09  5.10954e-09 -2.26145e-09      0.03091  -0.00166669 -7.95695e-10  -0.00242529  -0.00867054  0.000161674    0.0364086 -4.42973e-10  4.48203e-10 -1.20914e-09 -1.21039e-09  2.25319e-10    -0.194424  1.19797e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.04752e-10 -4.79472e-10   -0.0141825    0.0141825  4.11094e-10  1.86403e-10   0.00439344   0.00439344  -0.00133281  -1.1424e-09 -1.07753e-09 -0.000534182  7.67916e-11   1.0449e-10 -4.14489e-11  1.63487e-10  -0.00597968   0.00597968    0.0014938    0.0014938  3.89395e-09  1.34877e-09     0.958379          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "    0.093811 -1.38407e-11  1.68665e-11 -1.31281e-10   1.4506e-11   -0.0328898  3.54417e-10  2.99536e-10 -1.98298e-10    0.0155308 -0.000906614 -3.66153e-11    0.0128118    0.0465995 -2.36347e-11    0.0481429 -2.87491e-10  1.38489e-10 -3.10706e-10 -3.82273e-11  0.000111492   -0.0251078 -4.00992e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.38407e-11     0.093811 -9.49563e-11  4.00756e-11   -0.0328898   1.4506e-11  3.69215e-10  4.83629e-10 -1.23143e-10  0.000906614    0.0155308  -1.6677e-10    0.0465995   -0.0128118    0.0481429 -2.36347e-11 -1.29306e-11  2.85409e-10 -7.57899e-11  7.32127e-11   -0.0251078 -0.000111492 -5.11184e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.68665e-11 -9.49563e-11     0.105884   0.00529763  1.02844e-10  7.14641e-11   0.00679313   0.00679313  -0.00367729 -5.18316e-11 -2.01709e-11  -0.00167043 -9.69692e-11  2.03783e-10 -2.10767e-10 -2.53839e-11    0.0640751  -0.00170236  -0.00248409   -0.0196325 -6.26003e-11 -1.11868e-11   -0.0418854         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.31281e-10  4.00756e-11   0.00529763     0.105884 -1.09945e-10  2.29131e-10  -0.00679313  -0.00679313   0.00367729 -5.46524e-11  7.11032e-11   0.00167043  7.36934e-11 -1.53524e-10  7.36792e-11 -2.18533e-10  -0.00170236    0.0640751    0.0196325   0.00248409  1.33665e-10  1.11442e-10    0.0418854         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  1.4506e-11   -0.0328898  1.02844e-10 -1.09945e-10     0.240891 -7.01509e-13  1.10439e-09    8.038e-10 -6.98437e-10 -0.000843142   -0.0144435 -1.60496e-10   0.00881629   -0.0024239    0.0441772  9.34107e-11 -5.64767e-11 -3.34217e-10  -5.7351e-11 -2.87427e-10  -0.00438142 -1.94559e-05   5.2085e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0328898   1.4506e-11  7.14641e-11  2.29131e-10 -7.01512e-13     0.240891 -1.39942e-10 -1.47043e-10  1.24433e-10   -0.0144435  0.000843142  9.93678e-12    0.0024239   0.00881629  9.34107e-11    0.0441772  2.79967e-10 -4.98907e-11   1.1145e-10 -2.79243e-10  1.94558e-05  -0.00438142  4.31835e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.54417e-10  3.69215e-10   0.00679313  -0.00679313  1.10439e-09 -1.39942e-10     0.221858     0.110676   -0.0629938 -1.36207e-12  4.62582e-10   -0.0286153 -1.92869e-09  3.22346e-09 -1.03135e-09  3.29033e-10   -0.0100624  -0.00708601    0.0331063   -0.0292665 -8.01344e-10 -3.84154e-10   0.00293426         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.99536e-10  4.83629e-10   0.00679313  -0.00679313    8.038e-10 -1.47043e-10     0.110676     0.221858   -0.0629938  4.95703e-11  5.69066e-10   -0.0286153 -1.97895e-09  3.20019e-09 -7.87434e-10  1.91945e-10     0.007086    0.0100624   -0.0292665    0.0331063 -8.98788e-10 -3.12113e-10   0.00293426         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.98298e-10 -1.23143e-10  -0.00367729   0.00367729 -6.98437e-10  1.24433e-10   -0.0629938   -0.0629938     0.429278 -2.25276e-10 -2.34123e-10   -0.0121538   4.5678e-10 -9.08935e-10  7.69055e-10 -2.09131e-10 -6.19286e-06  6.19288e-06 -1.82818e-05 -1.82817e-05  -7.4395e-11  5.84298e-10  6.23915e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0155308  0.000906614 -5.18316e-11 -5.46524e-11 -0.000843142   -0.0144435 -1.36207e-12  4.95703e-11 -2.25276e-10     0.463967  2.12887e-12  1.17683e-10  0.000207516    0.0006126  0.000604643    0.0103578 -6.16662e-10 -6.25285e-11  1.11992e-10  1.49041e-09 -0.000954892   -0.0177091 -1.86768e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-0.000906614    0.0155308 -2.01709e-11  7.11032e-11   -0.0144435  0.000843142  4.62582e-10  5.69066e-10 -2.34123e-10   2.1288e-12     0.463967 -1.09252e-10    0.0006126 -0.000207516    0.0103578 -0.000604643 -7.67265e-11  1.45515e-09 -8.67475e-10 -1.88285e-10   -0.0177091  0.000954892 -1.77785e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.66153e-11  -1.6677e-10  -0.00167043   0.00167043 -1.60496e-10  9.93678e-12   -0.0286153   -0.0286153   -0.0121538  1.17683e-10 -1.09252e-10     0.636067  5.47894e-10 -6.15081e-10 -6.46846e-11 -6.61841e-11    0.0067147   -0.0067147    0.0198222    0.0198222  1.03281e-10 -8.61471e-12  4.72685e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0128118    0.0465995 -9.69692e-11  7.36934e-11   0.00881629    0.0024239 -1.92869e-09 -1.97895e-09   4.5678e-10  0.000207516    0.0006126  5.47894e-10     0.917068  7.50015e-11   -0.0214939   -0.0059094  5.28075e-10 -7.57897e-10  1.86095e-09  1.85642e-09    0.0223868   0.00626196  1.65303e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0465995   -0.0128118  2.03783e-10 -1.53524e-10   -0.0024239   0.00881629  3.22346e-09  3.20019e-09 -9.08935e-10    0.0006126 -0.000207516 -6.15081e-10  7.50015e-11     0.917068    0.0059094   -0.0214939 -1.02182e-09  1.02634e-09 -2.98428e-09 -3.21411e-09  -0.00626196    0.0223868  1.26285e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.36347e-11    0.0481429 -2.10767e-10  7.36792e-11    0.0441772  9.34108e-11 -1.03135e-09 -7.87434e-10  7.69055e-10  0.000604643    0.0103578 -6.46846e-11   -0.0214939    0.0059094     0.981535  7.31814e-11 -3.43486e-12 -3.05788e-10  3.62974e-10 -7.52028e-11   0.00424838  1.88651e-05  3.17313e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481429 -2.36347e-11 -2.53839e-11 -2.18533e-10  9.34107e-11    0.0441772  3.29033e-10  1.91945e-10 -2.09131e-10    0.0103578 -0.000604643 -6.61841e-11   -0.0059094   -0.0214939  7.31814e-11     0.981535  2.22987e-10  2.15189e-10 -7.37645e-12   -3.166e-10 -1.88651e-05   0.00424838  6.75724e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.87491e-10 -1.29306e-11    0.0640751  -0.00170236 -5.64767e-11  2.79967e-10   -0.0100624     0.007086 -6.19286e-06 -6.16662e-10 -7.67265e-11    0.0067147  5.28075e-10 -1.02182e-09 -3.43486e-12  2.22987e-10      1.06904   -0.0127708    0.0246984    0.0246985  4.19551e-11  2.29477e-10   -0.0150548         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.38489e-10  2.85409e-10  -0.00170236    0.0640751 -3.34217e-10 -4.98907e-11  -0.00708601    0.0100624  6.19288e-06 -6.25285e-11  1.45515e-09   -0.0067147 -7.57897e-10  1.02634e-09 -3.05788e-10  2.15189e-10   -0.0127708      1.06904   -0.0246984   -0.0246984 -1.38903e-10 -2.90536e-10    0.0150548         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.10706e-10 -7.57899e-11  -0.00248409    0.0196325  -5.7351e-11   1.1145e-10    0.0331063   -0.0292665 -1.82818e-05  1.11992e-10 -8.67475e-10    0.0198222  1.86095e-09 -2.98428e-09  3.62974e-10 -7.37645e-12    0.0246984   -0.0246984      1.13358    0.0773156  1.19145e-10  4.33755e-10   0.00544252         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.82273e-11  7.32127e-11   -0.0196325   0.00248409 -2.87427e-10 -2.79243e-10   -0.0292665    0.0331063 -1.82817e-05  1.49041e-09 -1.88285e-10    0.0198222  1.85642e-09 -3.21411e-09 -7.52028e-11   -3.166e-10    0.0246985   -0.0246984    0.0773156      1.13358   1.8042e-10  3.37076e-10   0.00544252         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 0.000254695   -0.0573567  4.53962e-13  4.61851e-11  -0.00347861  1.54469e-05 -3.29031e-10 -5.33643e-10 -3.82795e-12 -0.000549492   -0.0101907 -2.32799e-11     0.017952  -0.00502147    0.0191591 -8.50769e-05 -1.94863e-13  9.07921e-11  5.04292e-11  2.62741e-10     0.600541  2.25782e-10  2.81288e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0573567 -0.000254695 -1.64839e-10  3.71674e-10 -1.54469e-05  -0.00347861 -3.85749e-09 -3.80952e-09  6.45017e-10   -0.0101907  0.000549492  1.38948e-10   0.00502147     0.017952  8.50769e-05    0.0191591 -1.49275e-10 -6.09677e-11 -1.42151e-10 -5.14505e-11  2.25781e-10     0.600541   7.0146e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.28077e-10 -3.21394e-10   -0.0423663    0.0423663  6.07732e-10  5.83082e-10   0.00290426   0.00290426 -0.000441303  -1.6694e-09 -1.60323e-09 -0.000216154   1.0974e-10  1.72957e-10  4.07801e-10  8.27765e-10    -0.016097     0.016097   0.00532303   0.00532303   3.1492e-09  5.24981e-10      1.98493         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.1"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
