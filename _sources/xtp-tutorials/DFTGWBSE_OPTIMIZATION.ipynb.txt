{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-12-24T22:02:28.427054Z",
     "iopub.status.busy": "2022-12-24T22:02:28.426805Z",
     "iopub.status.idle": "2022-12-24T22:03:00.255368Z",
     "shell.execute_reply": "2022-12-24T22:03:00.254268Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2023-dev gitid: cc98c65 (compiled Dec 24 2022, 21:53:55)\r\n",
      "votca_csg, version 2023-dev gitid: cc98c65 (compiled Dec 24 2022, 21:38:30)\r\n",
      "votca_tools, version 2023-dev gitid: cc98c65 (compiled Dec 24 2022, 21:35:44)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 BohrA\r\n",
      "    0.307132  3.06076e-11   1.7988e-10 -5.20124e-10 -2.32193e-11   -0.0516061  1.11657e-09  1.03683e-09  3.87603e-10   -0.0181647  -0.00104127  1.10437e-10    0.0104039   -0.0375612  2.00287e-11    0.0421019 -2.08543e-10  9.11425e-11  3.57729e-10  1.58893e-10  0.000479588    -0.108408 -1.82905e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.06077e-11     0.307132 -3.88993e-10  3.09252e-10   -0.0516061 -2.32193e-11  2.45195e-09   2.7922e-09   8.2212e-10   0.00104127   -0.0181647  3.85174e-10   -0.0375612   -0.0104039    0.0421019  2.00286e-11 -1.92144e-10  -6.6924e-12  5.01658e-10  6.19059e-10     0.108408  0.000479588  1.68199e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  1.7988e-10 -3.88993e-10     0.320604    0.0092903  1.39957e-11 -3.03763e-11   -0.0131693   -0.0131693  -0.00491084 -1.46123e-10  1.02534e-10  -0.00209217  1.19157e-11  2.07184e-10 -1.19203e-10 -7.50915e-12   -0.0470523   0.00129462   -0.0025561   -0.0152303 -9.88293e-10  3.13746e-10   -0.0254857          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-5.20124e-10  3.09252e-10    0.0092903     0.320604 -2.23702e-11  4.35101e-10    0.0131693    0.0131693   0.00491084  1.66394e-10 -1.48443e-10   0.00209217  8.11391e-12 -1.82281e-10  1.27858e-11 -4.05429e-10   0.00129462   -0.0470523    0.0152303    0.0025561  9.64363e-10  2.06413e-10    0.0254857          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.32193e-11   -0.0516061  1.39957e-11 -2.23702e-11     0.490902  2.83292e-12  1.49001e-09  1.08528e-09  6.28849e-10 -0.000770489     0.013441  1.85914e-10   -0.0077038  -0.00213384    0.0309987 -6.61269e-11 -4.61686e-11  3.03303e-10  2.07891e-10  6.15049e-11   -0.0531267 -0.000235029   2.0948e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0516061 -2.32193e-11 -3.03763e-11  4.35101e-10  2.83289e-12     0.490902 -9.29691e-11 -1.01344e-10 -6.25894e-11     0.013441  0.000770489  5.22884e-12   0.00213384   -0.0077038  -6.6127e-11    0.0309987  1.53636e-10 -7.25018e-12  -8.2707e-11  1.74428e-10 -0.000235029    0.0531267 -4.46061e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.11657e-09  2.45195e-09   -0.0131693    0.0131693  1.49001e-09 -9.29691e-11     0.549585     0.219691    0.0856688 -1.42918e-11 -7.24908e-10    0.0364976 -8.31973e-10 -2.62354e-09 -6.31686e-10  2.54415e-10    -0.011355  -0.00131917   -0.0126963    0.0330614  1.34042e-08 -8.26896e-09   0.00154465          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.03683e-09   2.7922e-09   -0.0131693    0.0131693  1.08528e-09 -1.01344e-10     0.219691     0.549585    0.0856688 -6.02013e-11 -7.45179e-10    0.0364976 -8.56876e-10 -2.60351e-09 -2.18748e-10  1.47997e-10   0.00131917     0.011355    0.0330614   -0.0126963  1.39179e-08 -8.24148e-09   0.00154465          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.87603e-10   8.2212e-10  -0.00491084   0.00491084  6.28849e-10 -6.25894e-11    0.0856688    0.0856688     0.662947 -1.79992e-10 -5.81859e-10  -0.00632525  -2.9266e-10 -7.01981e-10 -3.36764e-10   9.7182e-11   -0.0013169    0.0013169   0.00387664   0.00387664  4.33998e-09 -3.05321e-09   0.00112542          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0181647   0.00104127 -1.46123e-10  1.66394e-10 -0.000770489     0.013441 -1.42918e-11 -6.02013e-11 -1.79992e-10     0.680922 -1.59451e-12  8.83631e-11  -2.7079e-05   7.9714e-05  0.000494288  -0.00862277  3.86472e-10  2.27636e-13  8.09529e-11  8.90766e-10   0.00216676    0.0409703 -6.68909e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -0.00104127   -0.0181647  1.02534e-10 -1.48443e-10     0.013441  0.000770489 -7.24908e-10 -7.45179e-10 -5.81859e-10 -1.59467e-12     0.680922  6.20527e-11  7.97139e-05   2.7079e-05  -0.00862277 -0.000494288 -4.18823e-12  8.14002e-10  3.77302e-10 -9.39726e-12   -0.0409703   0.00216676   8.0943e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.10437e-10  3.85174e-10  -0.00209217   0.00209217  1.85914e-10  5.22884e-12    0.0364976    0.0364976  -0.00632525  8.83631e-11  6.20527e-11      0.79826  1.22278e-11 -3.26474e-10  1.10199e-10  5.76925e-11   -0.0046558    0.0046558    0.0137055    0.0137055  1.73234e-09  -9.7561e-10   0.00044615          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0104039   -0.0375612  1.19157e-11  8.11391e-12   -0.0077038   0.00213384 -8.31973e-10 -8.56876e-10  -2.9266e-10  -2.7079e-05  7.97139e-05  1.22278e-11     0.956418 -4.29167e-11    0.0126653  -0.00350811  1.23859e-10 -2.37483e-10  -6.5315e-10 -4.30776e-10    0.0192723   0.00543006  6.81043e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0375612   -0.0104039  2.07184e-10 -1.82281e-10  -0.00213384   -0.0077038 -2.62354e-09 -2.60351e-09 -7.01981e-10   7.9714e-05   2.7079e-05 -3.26474e-10 -4.29167e-11     0.956418   0.00350811    0.0126653  4.24845e-10 -6.47219e-10 -1.49157e-09  -1.6052e-09   0.00543006   -0.0192723 -8.92715e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.00287e-11    0.0421019 -1.19203e-10  1.27858e-11    0.0309987  -6.6127e-11 -6.31686e-10 -2.18748e-10 -3.36764e-10  0.000494288  -0.00862277  1.10199e-10    0.0126653   0.00350811     0.988566 -3.73999e-11 -2.92349e-11  1.10929e-10 -3.59179e-11  6.16806e-11    0.0223628  9.89315e-05   3.2995e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0421019  2.00286e-11 -7.50915e-12 -4.05429e-10 -6.61269e-11    0.0309987  2.54415e-10  1.47997e-10   9.7182e-11  -0.00862277 -0.000494288  5.76925e-11  -0.00350811    0.0126653 -3.73999e-11     0.988566 -7.14429e-12 -9.04542e-11   6.7587e-11  1.49281e-10  9.89315e-05   -0.0223628  -1.7324e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.08543e-10 -1.92144e-10   -0.0470523   0.00129462 -4.61686e-11  1.53636e-10    -0.011355   0.00131917   -0.0013169  3.86472e-10 -4.18823e-12   -0.0046558  1.23859e-10  4.24845e-10 -2.92349e-11 -7.14429e-12      1.03321  -0.00656799   -0.0132469   -0.0132469 -8.26287e-10  5.53759e-10   0.00427519          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 9.11425e-11  -6.6924e-12   0.00129462   -0.0470523  3.03303e-10 -7.25018e-12  -0.00131917     0.011355    0.0013169  2.27636e-13  8.14002e-10    0.0046558 -2.37483e-10 -6.47219e-10  1.10929e-10 -9.04542e-11  -0.00656799      1.03321    0.0132469    0.0132469  7.79542e-10 -4.51888e-10  -0.00427519          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.57729e-10  5.01658e-10   -0.0025561    0.0152303  2.07891e-10  -8.2707e-11   -0.0126963    0.0330614   0.00387664  8.09529e-11  3.77302e-10    0.0137055  -6.5315e-10 -1.49157e-09 -3.59179e-11   6.7587e-11   -0.0132469    0.0132469       1.0677    0.0410636   2.3669e-09 -1.58684e-09   0.00204329          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.58893e-10  6.19059e-10   -0.0152303    0.0025561  6.15049e-11  1.74428e-10    0.0330614   -0.0126963   0.00387664  8.90766e-10 -9.39726e-12    0.0137055 -4.30776e-10  -1.6052e-09  6.16806e-11  1.49281e-10   -0.0132469    0.0132469    0.0410636       1.0677  2.46787e-09 -1.53954e-09   0.00204329          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-0.000332885   -0.0752465  6.87239e-10 -7.32171e-10    0.0690159  0.000305321 -8.05835e-09 -8.33594e-09 -3.16346e-09   -0.0016348    0.0309117 -1.54311e-09  -0.00866595  -0.00244167   -0.0364086 -0.000161069  5.59041e-10 -5.58476e-10 -1.77529e-09 -1.77879e-09    -0.194424  2.21557e-10 -4.21803e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0752465 -0.000332885  1.27116e-12  -2.8559e-10  0.000305321   -0.0690159  5.49009e-09  5.53266e-09  2.38386e-09   -0.0309117   -0.0016348  8.87004e-10  -0.00244167   0.00866595 -0.000161069    0.0364086 -4.81826e-10  4.77582e-10  1.28065e-09   1.2792e-09  2.21557e-10    -0.194424 -5.54395e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.99158e-10 -5.29758e-10   -0.0141894    0.0141894   3.6887e-10 -5.51709e-10  -0.00432404  -0.00432404  -0.00131221 -1.02982e-09  1.08955e-09  -0.00052614 -8.36122e-11  8.17422e-11 -4.06838e-11  2.51658e-10   0.00597522  -0.00597522   0.00150781   0.00150781  -4.4285e-09 -5.45783e-09     0.958307          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "    0.093811  1.36033e-11  9.61757e-11 -3.20878e-10 -1.42794e-11   -0.0328898  4.68215e-10  4.11258e-10   2.3851e-10   -0.0155317 -0.000890332  6.35291e-11    0.0129006    -0.046575  2.32697e-11    0.0481429   -2.593e-10  1.01682e-10  3.59469e-10  8.39298e-11  0.000111075   -0.0251078  4.90523e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.36033e-11     0.093811 -2.01212e-10  1.44255e-10   -0.0328898 -1.42794e-11  9.67756e-10  1.19246e-09  5.07325e-10  0.000890332   -0.0155317  2.54845e-10    -0.046575   -0.0129006    0.0481429  2.32697e-11 -1.64942e-10 -1.10596e-10   4.2988e-10  5.87498e-10    0.0251078  0.000111075 -5.38513e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 9.61757e-11 -2.01212e-10      0.10587   0.00531175  1.86444e-11 -2.58784e-11  -0.00667154  -0.00667154  -0.00361125 -1.36148e-10  8.75508e-11  -0.00164043   2.3994e-11   2.2996e-10 -1.50947e-10 -1.30609e-11   -0.0640508   0.00171081  -0.00245487   -0.0197221 -7.98769e-11  1.94513e-10   -0.0418869         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.20878e-10  1.44255e-10   0.00531175      0.10587 -2.22137e-11  3.15392e-10   0.00667154   0.00667154   0.00361125  1.60338e-10 -1.30128e-10   0.00164043  2.84954e-12 -1.93088e-10  9.17729e-12 -5.05909e-10   0.00171081   -0.0640508    0.0197221   0.00245487  5.29755e-12  4.79133e-11    0.0418869         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.42794e-11   -0.0328898  1.86444e-11 -2.22137e-11     0.240891  6.63653e-13  9.44025e-10  6.54512e-10  5.49395e-10 -0.000828001    0.0144443  1.60933e-10  -0.00881165  -0.00244069    0.0441772 -9.19226e-11 -4.10412e-11   4.2511e-10  2.14989e-10  1.15068e-11   0.00438142  1.93831e-05  5.21139e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0328898 -1.42794e-11 -2.58784e-11  3.15392e-10  6.63628e-13     0.240891  -4.3768e-11 -4.73374e-11 -4.47236e-11    0.0144443  0.000828001  1.05901e-11   0.00244069  -0.00881165 -9.19227e-11    0.0441772  2.22877e-10 -1.93948e-11 -1.02561e-10  2.81508e-10  1.93831e-05  -0.00438142 -4.88451e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.68215e-10  9.67756e-10  -0.00667154   0.00667154  9.44025e-10  -4.3768e-11     0.221872      0.11069    0.0629976 -1.78836e-11 -5.48446e-10    0.0286171 -9.98512e-10 -2.90205e-09 -7.94468e-10  2.58595e-10   -0.0100857  -0.00718153   -0.0330795    0.0292604  1.48727e-09 -5.30292e-10  -0.00289631         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.11258e-10  1.19246e-09  -0.00667154   0.00667154  6.54512e-10 -4.73374e-11      0.11069     0.221872    0.0629976 -6.04603e-11 -5.72636e-10    0.0286171 -1.03538e-09  -2.8752e-09 -2.75498e-10  1.16826e-10   0.00718152    0.0100857    0.0292604   -0.0330795  1.72933e-09  -4.5454e-10  -0.00289631         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  2.3851e-10  5.07325e-10  -0.00361125   0.00361125  5.49395e-10 -4.47236e-11    0.0629976    0.0629976     0.429278 -2.30961e-10 -6.84394e-10   -0.0121538 -4.21245e-10 -8.97895e-10 -4.70436e-10  1.29935e-10  6.20852e-06 -6.20855e-06 -1.82764e-05 -1.82764e-05  1.01351e-09 -6.37763e-10  5.54091e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0155317  0.000890332 -1.36148e-10  1.60338e-10 -0.000828001    0.0144443 -1.78836e-11 -6.04603e-11 -2.30961e-10     0.463967 -2.12939e-12  1.17863e-10 -0.000208041  0.000612422  0.000593784   -0.0103585  6.62995e-10 -5.06634e-12  1.34043e-10  1.50702e-09  0.000936621    0.0177101 -1.63375e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-0.000890332   -0.0155317  8.75508e-11 -1.30128e-10    0.0144443  0.000828001 -5.48446e-10 -5.72636e-10 -6.84394e-10 -2.12962e-12     0.463967  1.23379e-10  0.000612422  0.000208041   -0.0103585 -0.000593784 -2.66501e-11  1.39962e-09  6.96904e-10  3.89749e-11   -0.0177101  0.000936621  1.78273e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.35291e-11  2.54845e-10  -0.00164043   0.00164043  1.60933e-10  1.05901e-11    0.0286171    0.0286171   -0.0121538  1.17863e-10  1.23379e-10     0.636067  4.96735e-11 -4.09082e-10  1.95673e-10  8.27953e-11  -0.00673169   0.00673169    0.0198165    0.0198165    9.925e-11 -2.30695e-12  4.37803e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0129006    -0.046575   2.3994e-11  2.84954e-12  -0.00881165   0.00244069 -9.98512e-10 -1.03538e-09 -4.21245e-10 -0.000208041  0.000612422  4.96735e-11     0.917068 -7.52419e-11    0.0214826  -0.00595035  2.20598e-10 -4.53288e-10  -1.2258e-09  -7.7363e-10     0.022375   0.00630424 -1.02113e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   -0.046575   -0.0129006   2.2996e-10 -1.93088e-10  -0.00244069  -0.00881165 -2.90205e-09  -2.8752e-09 -8.97895e-10  0.000612422  0.000208041 -4.09082e-10 -7.52419e-11     0.917068   0.00595035    0.0214826  7.42152e-10 -1.19432e-09  -2.6733e-09 -2.90599e-09   0.00630424    -0.022375 -6.27951e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.32698e-11    0.0481429 -1.50947e-10  9.17729e-12    0.0441772 -9.19227e-11 -7.94468e-10 -2.75498e-10 -4.70436e-10  0.000593784   -0.0103585  1.95673e-10    0.0214826   0.00595035     0.981535 -7.20927e-11 -5.42885e-11  1.86568e-10 -5.46135e-11  1.35531e-10  -0.00424838 -1.87945e-05  2.61211e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481429  2.32697e-11 -1.30609e-11 -5.05909e-10 -9.19226e-11    0.0441772  2.58595e-10  1.16826e-10  1.29935e-10   -0.0103585 -0.000593784  8.27953e-11  -0.00595035    0.0214826 -7.20927e-11     0.981535 -2.95285e-11 -1.60615e-10  1.09537e-10  2.41817e-10 -1.87945e-05   0.00424838  1.75232e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -2.593e-10 -1.64942e-10   -0.0640508   0.00171081 -4.10412e-11  2.22877e-10   -0.0100857   0.00718152  6.20852e-06  6.62995e-10 -2.66501e-11  -0.00673169  2.20598e-10  7.42152e-10 -5.42885e-11 -2.95285e-11      1.06908   -0.0128132   -0.0247537   -0.0247537 -3.94967e-10  2.10957e-10    0.0150505         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.01682e-10 -1.10596e-10   0.00171081   -0.0640508   4.2511e-10 -1.93948e-11  -0.00718153    0.0100857 -6.20855e-06 -5.06634e-12  1.39962e-09   0.00673169 -4.53288e-10 -1.19432e-09  1.86568e-10 -1.60615e-10   -0.0128132      1.06908    0.0247537    0.0247537  2.19449e-10   9.1578e-13   -0.0150505         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.59469e-10   4.2988e-10  -0.00245487    0.0197221  2.14989e-10 -1.02561e-10   -0.0330795    0.0292604 -1.82764e-05  1.34043e-10  6.96904e-10    0.0198165  -1.2258e-09  -2.6733e-09 -5.46135e-11  1.09537e-10   -0.0247537    0.0247537      1.13354    0.0772732  8.79379e-10 -5.99807e-10   0.00545274         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 8.39298e-11  5.87498e-10   -0.0197221   0.00245487  1.15068e-11  2.81508e-10    0.0292604   -0.0330795 -1.82764e-05  1.50702e-09  3.89749e-11    0.0198165  -7.7363e-10 -2.90599e-09  1.35531e-10  2.41817e-10   -0.0247537    0.0247537    0.0772732      1.13354  1.09048e-09 -4.24464e-10   0.00545274         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 0.000253742    0.0573567 -4.72965e-10   4.2102e-10   0.00347861  1.53891e-05  7.51758e-09  7.82123e-09  1.20419e-09  0.000538978   -0.0101913  2.34312e-10    0.0179425   0.00505537   -0.0191591 -8.47586e-05 -9.06577e-11  7.11752e-11 -1.66094e-10  5.10026e-12     0.600541  2.21996e-10 -3.19229e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0573567  0.000253742  3.45066e-10 -4.22536e-11  1.53891e-05  -0.00347861 -4.34533e-09 -4.29197e-09 -7.17266e-10    0.0101913  0.000538978 -1.52066e-10   0.00505537   -0.0179425 -8.47586e-05    0.0191591  -1.0094e-10  2.71838e-10   3.2103e-11  5.07736e-11  2.21996e-10     0.600541 -5.04377e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.98216e-10 -3.36936e-10   -0.0423677    0.0423677  5.91142e-10 -4.73007e-10  -0.00286528  -0.00286528 -0.000439087 -1.50218e-09  1.61576e-09 -0.000214791 -5.05632e-11 -4.23348e-11  3.64388e-10  1.53238e-10    0.0160903   -0.0160903   0.00534159   0.00534159 -3.64907e-09 -5.04803e-09      1.98482         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
