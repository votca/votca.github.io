{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2023-05-26T05:50:24.497233Z",
     "iopub.status.busy": "2023-05-26T05:50:24.496694Z",
     "iopub.status.idle": "2023-05-26T05:50:36.467032Z",
     "shell.execute_reply": "2023-05-26T05:50:36.465946Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/votca/issues\r\n",
      "\r\n",
      "xtp_tools, version 2024-dev gitid: 7a5e334 (compiled May 26 2023, 05:46:21)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 BohrA\r\n",
      "    0.306708   6.3197e-14 -1.22458e-10 -3.90429e-10 -4.55654e-14   -0.0516336  2.69212e-13 -2.70829e-13  6.71965e-14 -2.37649e-06    0.0181563  3.97714e-14   1.6661e-05   -0.0389795   3.9068e-14    0.0421241  1.94744e-11 -2.61567e-11 -3.37874e-14 -3.68246e-14 -5.37039e-07    -0.108303  -1.6043e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 6.32021e-14     0.306708  2.77111e-13  2.78723e-13   -0.0516336 -4.55964e-14  1.74359e-09 -2.01157e-09  5.34415e-10   -0.0181563 -2.37649e-06  3.16684e-10    0.0389795   1.6661e-05    0.0421241  3.89628e-14   9.7352e-14 -9.43305e-14  -3.2947e-10 -3.36152e-10    -0.108303  5.37039e-07  5.53991e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.22458e-10  2.77111e-13     0.319156   -0.0100481  1.76403e-13 -4.19801e-11  3.01795e-05 -3.01795e-05  1.12787e-05 -1.01988e-13 -4.28643e-11  4.82667e-06 -6.41853e-14 -2.56198e-11 -6.39115e-14  1.63904e-11    0.0495092  -0.00204416 -3.96649e-06  1.63215e-05 -9.59529e-13  1.58329e-11    0.0252874          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.90429e-10  2.78723e-13   -0.0100481     0.319156  1.74051e-13    3.679e-10  3.01795e-05 -3.01795e-05  1.12787e-05 -9.37235e-14 -1.10116e-10  4.82667e-06 -6.10896e-14 -3.30932e-11 -6.22509e-14 -3.13124e-10   0.00204416   -0.0495092  1.63215e-05 -3.96649e-06 -9.60065e-13  5.25146e-10    0.0252874          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -4.558e-14   -0.0516336  1.76403e-13  1.74051e-13     0.490609  7.68495e-15  1.69885e-09 -1.28897e-09  7.55661e-10    0.0134761  1.76389e-06  2.05863e-10    0.0080157  3.42615e-06    0.0309388 -1.31867e-13  5.61835e-14 -5.79786e-14 -1.87759e-10 -1.83891e-10     0.053272 -2.64159e-07   9.0405e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0516336 -4.56103e-14 -4.19801e-11    3.679e-10  7.67627e-15     0.490609  1.68796e-13 -1.66405e-13  9.54316e-14  1.76389e-06   -0.0134761  2.61129e-14  3.42615e-06   -0.0080157 -1.31903e-13    0.0309388 -1.41583e-11  1.80255e-11 -2.91755e-14 -2.73802e-14  2.64159e-07     0.053272   9.9837e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.69212e-13  1.74359e-09  3.01795e-05  3.01795e-05  1.69885e-09  1.68796e-13     0.549726    -0.220522    0.0861688 -7.16779e-10  1.05616e-14    0.0368756 -5.42593e-10 -1.59592e-13 -7.89529e-10 -6.02423e-14   1.0092e-05   1.0196e-05    0.0125301    -0.034935 -6.78357e-09 -8.67319e-13  8.18673e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.70829e-13 -2.01157e-09 -3.01795e-05 -3.01795e-05 -1.28897e-09 -1.66405e-13    -0.220522     0.549726   -0.0861688   7.8403e-10 -2.29958e-15   -0.0368756  5.50066e-10  1.62703e-13  4.60015e-10  5.86356e-14   1.0196e-05   1.0092e-05     0.034935   -0.0125301  7.28252e-09  8.67632e-13 -8.18673e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 6.71966e-14  5.34415e-10  1.12787e-05  1.12787e-05  7.55661e-10  9.54316e-14    0.0861688   -0.0861688     0.662739 -4.24852e-10 -2.17446e-15  -0.00625217 -6.14593e-11 -1.85526e-14 -4.50126e-10 -5.67827e-14  1.22802e-06 -1.22802e-06  -0.00414117  -0.00414117 -1.82084e-09 -2.13305e-13  4.34699e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.37649e-06   -0.0181563 -1.01988e-13 -9.37234e-14    0.0134761  1.76389e-06 -7.16779e-10   7.8403e-10 -4.24852e-10     0.680027  3.38153e-16 -3.11525e-11  -7.6988e-05 -2.28299e-08  -0.00866729 -1.13447e-06 -2.62486e-14  2.78909e-14  9.37654e-11  8.87455e-11    0.0410255  5.16643e-06 -1.37096e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0181563 -2.37649e-06 -4.28643e-11 -1.10116e-10  1.76389e-06   -0.0134761  1.05616e-14 -2.29951e-15  -2.1744e-15  4.55558e-16     0.680027 -6.31197e-17  2.28299e-08  -7.6988e-05 -1.13447e-06   0.00866729 -1.45183e-11  1.95381e-11 -5.31535e-15 -3.66721e-15  5.16643e-06   -0.0410255 -1.18008e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.97714e-14  3.16684e-10  4.82667e-06  4.82667e-06  2.05863e-10   2.6113e-14    0.0368756   -0.0368756  -0.00625217 -3.11525e-11 -6.30983e-17     0.797893 -2.21528e-10 -6.68063e-14   6.3947e-11  7.99028e-15   4.3103e-06  -4.3103e-06   -0.0145354   -0.0145354  -9.5715e-10 -1.12915e-13  1.76759e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  1.6661e-05    0.0389795 -6.41853e-14 -6.10896e-14    0.0080157  3.42615e-06 -5.42593e-10  5.50066e-10 -6.14593e-11  -7.6988e-05  2.28299e-08 -2.21528e-10     0.956279 -4.25177e-14   -0.0131238 -5.60952e-06 -8.92403e-14  8.86815e-14  2.31212e-10  3.46021e-10    0.0200194   8.4576e-06  4.71629e-15          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0389795   1.6661e-05 -2.56198e-11 -3.30932e-11  3.42615e-06   -0.0080157 -1.59592e-13  1.62703e-13 -1.85526e-14 -2.28299e-08  -7.6988e-05 -6.68063e-14 -4.25189e-14     0.956279 -5.60952e-06    0.0131238 -4.62595e-11 -6.85494e-11  9.07952e-14  9.01822e-14   8.4576e-06   -0.0200194 -4.89095e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.90656e-14    0.0421241 -6.39115e-14 -6.22508e-14    0.0309388 -1.31896e-13 -7.89529e-10  4.60015e-10 -4.50126e-10  -0.00866729 -1.13447e-06   6.3947e-11   -0.0131238 -5.60952e-06     0.987501 -7.18862e-14  2.23941e-14  5.47662e-14   1.3445e-10 -4.39277e-11   -0.0224113   1.1113e-07 -6.12514e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0421241  3.89646e-14  1.63904e-11 -3.13124e-10 -1.31864e-13    0.0309388 -6.02423e-14  5.86357e-14 -5.67827e-14 -1.13447e-06   0.00866729  7.99028e-15 -5.60952e-06    0.0131238 -7.19074e-14     0.987501 -6.74218e-11 -1.10956e-10   5.0756e-14 -2.64252e-14  -1.1113e-07   -0.0224113  1.30106e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.94744e-11   9.7352e-14    0.0495092   0.00204416  5.61835e-14 -1.41583e-11   1.0092e-05   1.0196e-05  1.22802e-06 -2.62486e-14 -1.45183e-11   4.3103e-06 -8.92403e-14 -4.62595e-11  2.23941e-14 -6.74218e-11      1.02819   -0.0020693 -1.28812e-05 -1.28812e-05 -3.71263e-13  1.80139e-12   0.00469072          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.61567e-11 -9.43305e-14  -0.00204416   -0.0495092 -5.79786e-14  1.80255e-11   1.0196e-05   1.0092e-05 -1.22802e-06  2.78909e-14  1.95381e-11  -4.3103e-06  8.86815e-14 -6.85494e-11  5.47662e-14 -1.10956e-10   -0.0020693      1.02819  1.28812e-05  1.28812e-05  3.32458e-13  8.99701e-11  -0.00469072          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.37874e-14  -3.2947e-10 -3.96649e-06  1.63215e-05 -1.87759e-10 -2.91755e-14    0.0125301     0.034935  -0.00414117  9.37654e-11 -5.31536e-15   -0.0145354  2.31212e-10  9.07952e-14   1.3445e-10   5.0756e-14 -1.28812e-05  1.28812e-05      1.07163    0.0455077  1.15778e-09  1.08525e-13  7.92232e-07          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.68246e-14 -3.36152e-10  1.63215e-05 -3.96649e-06 -1.83891e-10 -2.73802e-14    -0.034935   -0.0125301  -0.00414117  8.87455e-11 -3.66718e-15   -0.0145354  3.46021e-10  9.01823e-14 -4.39277e-11 -2.64252e-14 -1.28812e-05  1.28812e-05    0.0455077      1.07163   1.2482e-09  1.48235e-13  7.92232e-07          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.73103e-07    0.0752424  5.15272e-13  5.15187e-13   -0.0690969 -3.42629e-07  3.52652e-09  -3.8526e-09  1.17254e-09   -0.0309264 -3.89463e-06  8.30841e-10  -0.00901647 -3.80919e-06    0.0363998  1.80495e-07  2.11193e-13 -2.10481e-13 -7.12841e-10 -7.14106e-10    -0.194835 -6.10727e-13  8.80225e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0752424 -3.73102e-07 -1.03398e-10 -4.38777e-10  3.42629e-07   -0.0690969  4.50344e-13 -4.51144e-13  1.30094e-13 -3.89463e-06    0.0309264  9.57245e-14 -3.80919e-06   0.00901647 -1.80495e-07    0.0363998 -7.75994e-12  4.82563e-12 -8.50328e-14 -8.64386e-14 -6.10787e-13    -0.194835 -2.30344e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.58821e-10  1.40293e-14    0.0143253    0.0143253  -4.4064e-14 -1.71047e-10 -4.74712e-06  4.74712e-06 -1.13684e-06  -1.3289e-14 -4.79003e-11 -3.85261e-07  8.27368e-15  -8.1851e-12 -7.60393e-15  2.22421e-10   0.00613234  -0.00613234  3.53655e-06  3.53655e-06 -9.57961e-14 -2.19098e-09     0.954926          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0935659  2.82218e-14 -6.09654e-11 -2.33641e-10 -2.79892e-14   -0.0328713  1.16976e-13 -1.17991e-13   4.1475e-14 -2.02949e-06    0.0155052  2.73805e-14  2.06508e-05   -0.0483139  4.53971e-14    0.0481173  1.98718e-11 -2.29721e-11 -2.83012e-14 -2.98143e-14 -1.24198e-07   -0.0250466  5.23671e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.82225e-14    0.0935659  1.20041e-13  1.21053e-13   -0.0328713 -2.80167e-14  6.93485e-10 -8.66161e-10  3.29988e-10   -0.0155052 -2.02949e-06  2.18245e-10    0.0483139  2.06508e-05    0.0481173  4.52822e-14  8.10041e-14 -7.95102e-14 -2.78098e-10 -2.81198e-10   -0.0250466  1.24198e-07  5.87757e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.09654e-11  1.20041e-13      0.10504   -0.0056823  1.04929e-13 -2.62124e-11  1.52491e-05 -1.52491e-05  8.28037e-06 -7.77107e-14 -4.11685e-11  3.78279e-06 -5.70756e-14  -2.6251e-11 -7.29257e-14  2.15886e-11    0.0670098  -0.00240141 -3.32773e-06  2.42878e-05 -1.73728e-13 -9.09166e-11    0.0419176         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.33641e-10  1.21053e-13   -0.0056823      0.10504  1.03249e-13  2.63301e-10  1.52491e-05 -1.52491e-05  8.28037e-06 -6.93915e-14 -1.08726e-10  3.78279e-06 -5.40521e-14 -3.35763e-11 -7.08883e-14 -3.84219e-10   0.00240141   -0.0670098  2.42878e-05 -3.32773e-06 -1.74632e-13  8.33993e-11    0.0419176         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.80035e-14   -0.0328713  1.04929e-13  1.03249e-13     0.240584  3.25753e-15  1.05286e-09 -7.63349e-10  6.49827e-10    0.0144632  1.89309e-06  1.73493e-10   0.00916843  3.91886e-06    0.0440553  -1.8298e-13  5.14209e-14 -4.62637e-14 -1.51136e-10 -1.63432e-10  -0.00432456  2.14441e-08  5.15557e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0328713 -2.80275e-14 -2.62124e-11  2.63301e-10   3.2505e-15     0.240584   1.0012e-13 -9.84072e-14  8.20283e-14  1.89309e-06   -0.0144632  2.20096e-14  3.91886e-06  -0.00916843 -1.83025e-13    0.0440553  -2.4134e-11   1.1838e-11 -2.26389e-14  -2.7798e-14 -2.14441e-08  -0.00432456 -2.19109e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.16976e-13  6.93485e-10  1.52491e-05  1.52491e-05  1.05286e-09   1.0012e-13     0.221542     -0.11082    0.0632617 -5.30873e-10  1.12879e-14    0.0289004 -4.89916e-10 -1.43663e-13  -9.2688e-10 -6.86042e-14  8.83812e-06  1.87774e-05    0.0337442   -0.0308642 -1.18894e-09 -1.67467e-13  2.85493e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.17991e-13 -8.66161e-10 -1.52491e-05 -1.52491e-05 -7.63349e-10 -9.84072e-14     -0.11082     0.221542   -0.0632617   5.9843e-10 -2.97223e-15   -0.0289004  4.97241e-10  1.46707e-13  5.21073e-10  6.66416e-14  1.87774e-05  8.83812e-06    0.0308642   -0.0337442  1.36166e-09  1.66681e-13 -2.85493e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.14751e-14  3.29988e-10  8.28037e-06  8.28037e-06  6.49827e-10  8.20283e-14    0.0632617   -0.0632617     0.428924 -4.79328e-10  -2.4613e-15    -0.012098 -1.75714e-11 -5.28804e-15 -6.21667e-10 -7.84261e-14  8.12524e-09 -8.12522e-09 -2.74002e-05 -2.74002e-05 -4.95217e-10 -6.35173e-14  3.98355e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.02949e-06   -0.0155052 -7.77107e-14 -6.93913e-14    0.0144632  1.89309e-06 -5.30873e-10   5.9843e-10 -4.79328e-10     0.462759  4.34462e-16  2.95981e-13 -0.000635208 -1.88364e-07   -0.0104064  -1.3621e-06 -2.47534e-14  2.66514e-14  8.94162e-11  8.39335e-11    0.0177344  2.23333e-06 -3.15889e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0155052 -2.02949e-06 -4.11685e-11 -1.08726e-10  1.89309e-06   -0.0144632  1.12879e-14 -2.97216e-15 -2.46122e-15  6.05565e-16     0.462759   1.4205e-16  1.88364e-07 -0.000635208  -1.3621e-06    0.0104064 -3.07997e-11  3.62824e-11 -1.02731e-14  -8.3649e-15  2.23333e-06   -0.0177344 -1.14125e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.73805e-14  2.18245e-10  3.78279e-06  3.78279e-06  1.73493e-10  2.20097e-14    0.0289004   -0.0289004    -0.012098  2.95981e-13  1.42084e-16     0.635437    -3.22e-10 -9.70935e-14  1.32651e-10  1.66195e-14  6.22822e-06 -6.22822e-06    -0.021003    -0.021003 -1.07108e-10 -1.41822e-14  1.83057e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.06508e-05    0.0483139 -5.70756e-14 -5.40521e-14   0.00916843  3.91886e-06 -4.89916e-10  4.97241e-10 -1.75714e-11 -0.000635208  1.88364e-07    -3.22e-10     0.916802 -7.48355e-14   -0.0222399 -9.50601e-06 -1.52695e-13  1.51571e-13  3.71311e-10  6.02972e-10    0.0232165  9.80829e-06  2.72574e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0483139  2.06508e-05  -2.6251e-11 -3.35763e-11  3.91886e-06  -0.00916843 -1.43663e-13  1.46707e-13 -5.28798e-15 -1.88364e-07 -0.000635208 -9.70935e-14 -7.48396e-14     0.916802 -9.50601e-06    0.0222399 -9.04565e-11 -1.41204e-10  1.55303e-13  1.54071e-13  9.80829e-06   -0.0232165  -1.0423e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.53968e-14    0.0481173 -7.29256e-14 -7.08882e-14    0.0440553 -1.83018e-13  -9.2688e-10  5.21073e-10 -6.21667e-10   -0.0104064  -1.3621e-06  1.32651e-10   -0.0222399 -9.50601e-06      0.97942 -1.38284e-13  5.15085e-14  9.02377e-14  2.15076e-10  -1.1263e-10   0.00417248   -2.069e-08 -1.03711e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481173  4.52836e-14  2.15886e-11 -3.84219e-10 -1.82976e-13    0.0440553 -6.86041e-14  6.66417e-14 -7.84261e-14  -1.3621e-06    0.0104064  1.66195e-14 -9.50601e-06    0.0222399 -1.38325e-13      0.97942 -1.31024e-10 -1.96682e-10  8.70918e-14  -5.4702e-14    2.069e-08   0.00417248  4.31217e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.98718e-11  8.10041e-14    0.0670098   0.00240141  5.14209e-14  -2.4134e-11  8.83812e-06  1.87774e-05  8.12524e-09 -2.47534e-14 -3.07997e-11  6.22822e-06 -1.52695e-13 -9.04565e-11  5.15085e-14 -1.31024e-10       1.0596  -0.00440412 -2.40588e-05 -2.40588e-05 -2.09236e-13 -2.35523e-11    0.0159918         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.29721e-11 -7.95102e-14  -0.00240141   -0.0670098 -4.62637e-14   1.1838e-11  1.87774e-05  8.83812e-06 -8.12522e-09  2.66514e-14  3.62824e-11 -6.22822e-06  1.51571e-13 -1.41204e-10  9.02377e-14 -1.96682e-10  -0.00440412       1.0596  2.40588e-05  2.40588e-05   1.4903e-13  1.64384e-10   -0.0159918         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.83012e-14 -2.78098e-10 -3.32773e-06  2.42878e-05 -1.51136e-10 -2.26389e-14    0.0337442    0.0308642 -2.74002e-05  8.94162e-11 -1.02731e-14    -0.021003  3.71311e-10  1.55303e-13  2.15076e-10  8.70918e-14 -2.40588e-05  2.40588e-05      1.14073     0.085536  5.62041e-10  1.41698e-14  6.00351e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.98143e-14 -2.81198e-10  2.42878e-05 -3.32773e-06 -1.63432e-10  -2.7798e-14   -0.0308642   -0.0337442 -2.74002e-05  8.39335e-11 -8.36485e-15    -0.021003  6.02972e-10  1.54071e-13  -1.1263e-10  -5.4702e-14 -2.40588e-05  2.40588e-05     0.085536      1.14073  7.02584e-10  7.49188e-14  6.00351e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -2.839e-07   -0.0572532 -5.70259e-13 -5.70745e-13  -0.00341529 -1.69353e-08 -4.12839e-09  4.38905e-09 -6.37935e-10    0.0102623  1.29235e-06 -1.16523e-10    0.0185867  7.85236e-06    0.0190696  9.45601e-08 -5.11186e-14 -3.45527e-14  -5.0466e-11  1.50414e-10     0.599386 -4.33336e-13 -2.42149e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0572532    2.839e-07 -8.19173e-11  1.79426e-10  1.69353e-08  -0.00341529 -5.31648e-13  5.31428e-13 -8.35768e-14  1.29235e-06   -0.0102623 -1.70423e-14  7.85236e-06   -0.0185867 -9.45601e-08    0.0190696  2.12094e-11  1.78422e-10 -6.10481e-14  2.47388e-14  -4.3343e-13     0.599386 -2.61312e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.18673e-11  5.47542e-14    0.0423952    0.0423952  3.16409e-14  5.25862e-11  2.06574e-06 -2.06574e-06  2.62787e-06 -2.20786e-14 -8.87893e-11  1.13335e-06  4.37573e-14 -1.15882e-10 -8.27372e-14  4.93167e-10     0.016942    -0.016942  7.26636e-06  7.26636e-06 -3.90682e-13 -2.39357e-09       1.9863         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
