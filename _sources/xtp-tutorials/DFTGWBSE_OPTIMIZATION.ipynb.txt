{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2023-02-10T06:10:20.044705Z",
     "iopub.status.busy": "2023-02-10T06:10:20.044455Z",
     "iopub.status.idle": "2023-02-10T06:11:26.483738Z",
     "shell.execute_reply": "2023-02-10T06:11:26.482769Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/votca/issues\r\n",
      "\r\n",
      "xtp_tools, version 2024-dev gitid: e0a61db (compiled Feb 10 2023, 05:42:44)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 Bohr\r\n",
      "... ... \r\n",
      "... ... =========== OPTIMIZATION SUMMARY ================================= \r\n",
      "... ... At iteration  0\r\n",
      "... ...  ---- POSITIONS (Angstrom)   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    +0.0000  +0.0000  +0.0000\r\n",
      "... ...    1    +1.2000  +0.0000  +0.0000\r\n",
      "... ...    Total energy:     -112.26831841 Hartree \r\n",
      "... ...    Trust radius:       0.01889726 Bohr     \r\n",
      "... ...  ---- FORCES (Hartree/Bohr)   \r\n",
      "... ...       central differences   \r\n",
      "... ...       displacement 0.0010 Angstrom   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    -0.1314  -0.0000  -0.0000\r\n",
      "... ...    1    +0.1314  +0.0000  +0.0000A\r\n",
      "    0.300728  5.97362e-15 -6.13378e-14  6.21545e-14   -0.0519964 -8.04099e-15  2.62676e-11  2.65271e-11  1.38417e-11   -0.0175948  3.86155e-05  4.56882e-12    0.0389989   0.00161394    0.0424178    6.897e-15  1.69931e-13 -1.56423e-13 -3.59513e-12 -3.93204e-12    -0.107004 -1.41362e-05 -1.69598e-14 -5.54437e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.96877e-15     0.300728  2.04353e-12 -2.30304e-12  -8.0492e-15   -0.0519964  5.57475e-14  5.65865e-14  2.69739e-14 -3.86155e-05   -0.0175948  8.68104e-15  -0.00161394    0.0389989  6.89563e-15    0.0424178  5.54562e-13  -2.1767e-13  2.61774e-15  1.61127e-14 -1.41362e-05     0.107004  1.39545e-13 -4.60697e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-6.13378e-14  2.04353e-12     0.309473    0.0100857  1.49619e-15 -1.27509e-12 -0.000508447 -0.000508447 -0.000200561  4.12973e-14  2.20817e-12 -9.07212e-05 -3.09566e-15 -3.12269e-13  1.57651e-14 -4.10504e-13    0.0491471  -0.00193843  0.000158791   0.00211248  3.63831e-13  1.97926e-12    0.0247309     0.015321          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 6.21545e-14 -2.30304e-12    0.0100857     0.309473 -2.28734e-15  4.92183e-13  0.000508447  0.000508447  0.000200561 -3.71045e-14  3.55014e-14  9.07212e-05 -8.48362e-17  3.85812e-13 -1.49543e-14 -3.84514e-12  -0.00193843    0.0491471  -0.00211248 -0.000158791 -3.65014e-13 -2.47564e-12   -0.0247309     0.015321          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0519964 -8.03666e-15  1.49612e-15 -2.28733e-15     0.486555 -1.34716e-15 -7.08081e-13  7.47837e-14 -7.46015e-13     0.013646  -2.9949e-05  1.84655e-12   0.00832126  0.000344369    0.0300841 -2.00272e-14  4.34122e-14    -6.08e-14 -1.39889e-12  -9.6895e-13    0.0551239  7.28237e-06 -4.28757e-14 -3.89773e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-8.04018e-15   -0.0519964 -1.27509e-12  4.92183e-13 -1.34439e-15     0.486555 -6.13026e-16 -1.38781e-15 -7.59916e-16   2.9949e-05     0.013646  4.07124e-15 -0.000344369   0.00832126 -2.00328e-14    0.0300841 -4.43352e-13  1.34504e-14 -3.83483e-15 -2.12169e-14  7.28237e-06   -0.0551239 -1.09263e-12  -3.1957e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.62676e-11  5.57475e-14 -0.000508447  0.000508447 -7.08081e-13 -6.13038e-16     0.541141     0.221582    0.0913838 -1.66945e-11  3.79905e-15    0.0413363  7.56861e-12  3.26611e-13 -1.06766e-11 -1.39722e-14    0.0014771  0.000476594    0.0134149   -0.0337938  -1.5988e-10   2.9374e-13 -0.000658295    0.0159498          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.65271e-11  5.65865e-14 -0.000508447  0.000508447  7.47837e-14 -1.38773e-15     0.221582     0.541141    0.0913838 -1.89381e-11  7.99972e-15    0.0413363  7.49508e-12  3.23456e-13 -6.42101e-12 -1.31533e-14 -0.000476594   -0.0014771   -0.0337938    0.0134149 -1.60386e-10  2.94687e-13 -0.000658295   -0.0159498          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.38417e-11   2.6974e-14 -0.000200561  0.000200561 -7.46015e-13 -7.59916e-16    0.0913838    0.0913838     0.659711  -9.5748e-12  2.38334e-15  -0.00509591  3.48149e-13  1.48771e-14 -3.26863e-12 -6.53919e-15  0.000209863 -0.000209863  -0.00481528  -0.00481528 -6.45348e-11  1.17203e-13 -0.000285101  4.62757e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0175948 -3.86155e-05  4.12973e-14 -3.71043e-14     0.013646   2.9949e-05 -1.66945e-11 -1.89381e-11  -9.5748e-12     0.667191  5.18939e-16 -2.33065e-12  2.39546e-05  1.04401e-06  -0.00908943 -1.99487e-05 -1.37875e-13   1.0415e-14  2.15522e-13  3.16282e-12    0.0409783 -8.45219e-05  3.02343e-14  4.88825e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.86155e-05   -0.0175948  2.20817e-12  3.55014e-14  -2.9949e-05     0.013646  3.79902e-15  7.99982e-15  2.38339e-15  3.85695e-16     0.667191  1.74354e-16 -1.04401e-06  2.39546e-05  1.99487e-05  -0.00908943  -3.3827e-12  4.35411e-13 -1.95135e-14 -1.46965e-13 -8.45219e-05   -0.0409783  4.69509e-12  3.69532e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.56882e-12  8.68104e-15 -9.07212e-05  9.07212e-05  1.84655e-12  4.07135e-15    0.0413363    0.0413363  -0.00509591 -2.33065e-12  1.74283e-16     0.792641   2.2901e-12  9.92313e-14 -3.34689e-12  -6.8198e-15  0.000668817 -0.000668817   -0.0153459   -0.0153459 -2.09918e-11  3.76222e-14   -0.0001315  2.01855e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0389989  -0.00161394 -3.09565e-15 -8.48359e-17   0.00832126 -0.000344369  7.56861e-12  7.49508e-12  3.48149e-13  2.39546e-05 -1.04401e-06   2.2901e-12     0.954094 -3.78943e-14   -0.0128446  0.000531564  3.71584e-13 -3.71225e-13 -8.36021e-12 -7.42381e-12    0.0198702  0.000824941 -9.19457e-16  1.78239e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  0.00161394    0.0389989 -3.12269e-13  3.85812e-13  0.000344369   0.00832126  3.26611e-13  3.23456e-13  1.48771e-14  1.04401e-06  2.39546e-05  9.92313e-14 -3.78822e-14     0.954094 -0.000531564   -0.0128446 -1.08328e-12  1.46906e-13 -3.69605e-13 -3.69227e-13  0.000824941   -0.0198702 -4.92143e-13  1.56761e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0424178  6.88041e-15  1.57651e-14 -1.49543e-14    0.0300841 -2.00427e-14 -1.06766e-11 -6.42101e-12 -3.26863e-12  -0.00908943  1.99487e-05 -3.34689e-12   -0.0128446 -0.000531564     0.972602 -1.52143e-14 -9.46267e-14  1.36646e-13  3.17204e-12   2.1506e-12     -0.02299 -3.03719e-06  3.98022e-14 -5.02914e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  6.9017e-15    0.0424178 -4.10504e-13 -3.84514e-12 -2.00451e-14    0.0300841 -1.39722e-14 -1.31532e-14 -6.53919e-15 -1.99487e-05  -0.00908943  -6.8198e-15  0.000531564   -0.0128446 -1.52314e-14     0.972602  2.93913e-13  7.27527e-13 -2.50854e-14  1.68858e-14 -3.03719e-06      0.02299 -4.54214e-13  -6.0454e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.69931e-13  5.54562e-13    0.0491471  -0.00193843  4.34122e-14 -4.43352e-13    0.0014771 -0.000476594  0.000209863 -1.37875e-13  -3.3827e-12  0.000668817  3.71584e-13 -1.08328e-12 -9.46267e-14  2.93913e-13       1.0208  -0.00216727  -0.00185559  -0.00185559 -9.72563e-13  8.64045e-14   0.00474558   1.6287e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.56423e-13  -2.1767e-13  -0.00193843    0.0491471    -6.08e-14  1.34504e-14  0.000476594   -0.0014771 -0.000209863   1.0415e-14  4.35411e-13 -0.000668817 -3.71225e-13  1.46906e-13  1.36646e-13  7.27527e-13  -0.00216727       1.0208   0.00185559   0.00185559  9.59801e-13  2.27777e-13  -0.00474558  1.62869e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.59513e-12  2.61774e-15  0.000158791  -0.00211248 -1.39889e-12 -3.83483e-15    0.0134149   -0.0337938  -0.00481528  2.15522e-13 -1.95135e-14   -0.0153459 -8.36021e-12 -3.69605e-13  3.17204e-12 -2.50854e-14  -0.00185559   0.00185559      1.06329    0.0446626  2.20401e-11 -4.73332e-14  0.000154171  0.000346854          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.93204e-12  1.61128e-14   0.00211248 -0.000158791  -9.6895e-13 -2.12169e-14   -0.0337938    0.0134149  -0.00481528  3.16282e-12 -1.46965e-13   -0.0153459 -7.42381e-12 -3.69226e-13   2.1506e-12  1.68858e-14  -0.00185559   0.00185559    0.0446626      1.06329  2.23584e-11 -3.50478e-14  0.000154171 -0.000346855          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0745352  9.84677e-06 -2.24611e-13  2.24915e-13   -0.0700995 -9.26078e-06  1.04269e-10  1.03004e-10   5.1352e-11   -0.0303572  6.26149e-05  1.77398e-11  -0.00920408 -0.000382121    0.0362794  4.79284e-06  7.70608e-13 -7.93319e-13 -1.81447e-11 -1.76022e-11    -0.195077  8.80855e-14  5.73028e-13  2.59382e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 9.84677e-06   -0.0745352 -3.48794e-12  2.20448e-12 -9.26078e-06    0.0700995 -1.75177e-13 -1.76353e-13 -8.60153e-14  6.26149e-05    0.0303572 -2.85181e-14 -0.000382121   0.00920408  4.79284e-06   -0.0362794  6.27716e-14  4.81087e-13  1.29679e-14   3.5709e-14  8.80726e-14    -0.195077 -4.87792e-11 -1.99546e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -1.044e-13 -5.99643e-12    0.0140616   -0.0140616  3.00843e-14  4.10364e-12 -0.000484619 -0.000484619 -0.000203193  6.12926e-14  5.97234e-12 -9.34351e-05 -5.82792e-14   1.5017e-12 -5.92733e-15 -1.10911e-12   0.00609459  -0.00609459  0.000155236  0.000155236  1.44376e-12 -5.03248e-11     0.939518 -1.46214e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-4.34004e-12 -3.32109e-12   -0.0051951   -0.0051951  4.97848e-12  4.02012e-12  -0.00394201     0.003942 -2.89561e-10  5.65245e-12   4.3186e-12 -1.38413e-10  1.02877e-12  8.01347e-13  3.52729e-12   2.9626e-12   0.00326435   0.00326435   0.00323209  -0.00323209  2.94097e-11 -2.25993e-11 -1.40896e-10     0.105277          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0901503  2.40381e-15 -2.39234e-14  2.44527e-14   -0.0325949 -4.77909e-15  9.86131e-12   1.0396e-11  8.89673e-12   -0.0147607  3.23955e-05  3.29333e-12    0.0480498    0.0019885    0.0477326  7.71168e-15  1.25419e-13 -1.00999e-13 -2.32486e-12 -2.92871e-12   -0.0243816 -3.22103e-06 -1.13521e-13 -4.37559e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.39997e-15    0.0901503  8.55274e-13 -1.38998e-12 -4.78566e-15   -0.0325949  2.19219e-14  2.24657e-14  1.73289e-14 -3.23955e-05   -0.0147607   6.2325e-15   -0.0019885    0.0480498  7.71179e-15    0.0477326   9.0133e-13 -2.97504e-13  8.63662e-15   3.3043e-14 -3.22103e-06    0.0243816  -5.7886e-12 -3.36039e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.39234e-14  8.55274e-13    0.0988836   0.00551419  9.20134e-16 -7.47354e-13 -0.000247531 -0.000247531  -0.00014385   3.0437e-14  2.22591e-12 -7.05293e-05 -7.15818e-15  -2.9803e-13  1.70297e-14  -4.9903e-13    0.0656759  -0.00222933  0.000160806   0.00278649   4.6861e-14 -1.65226e-12    0.0406663    0.0101583         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.44527e-14 -1.38998e-12   0.00551419    0.0988836 -1.52402e-15   2.5019e-13  0.000247531  0.000247531   0.00014385 -2.60366e-14  1.15664e-13  7.05293e-05  6.31291e-16  4.51746e-13 -1.60561e-14 -4.74174e-12  -0.00222933    0.0656759  -0.00278649 -0.000160806 -4.80252e-14 -2.98406e-13   -0.0406663    0.0101583         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0325949 -4.77398e-15  9.20082e-16 -1.52401e-15     0.236331  -1.8599e-15 -5.39509e-13 -4.23785e-14 -5.61412e-13    0.0143743 -3.15474e-05  2.17691e-12   0.00951656  0.000393835    0.0423454 -2.75455e-14   6.3552e-14 -9.51818e-14 -2.19139e-12 -1.41317e-12  -0.00354089 -4.67783e-07  -2.1247e-14  7.65076e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-4.77881e-15   -0.0325949 -7.47354e-13   2.5019e-13 -1.85569e-15     0.236331 -5.82923e-16 -1.17599e-15 -5.61871e-16  3.15474e-05    0.0143743  4.66191e-15 -0.000393835   0.00951656  -2.7548e-14    0.0423454 -7.76381e-13 -1.78582e-15 -4.82996e-15 -3.64501e-14 -4.67783e-07   0.00354089  3.05261e-12  5.24404e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 9.86131e-12   2.1922e-14 -0.000247531  0.000247531 -5.39509e-13 -5.82887e-16     0.211668      0.10727    0.0655438 -1.16463e-11  2.64877e-15     0.032136  9.20333e-12  3.97257e-13 -1.20811e-11 -1.50182e-14   0.00126638   0.00135931    0.0345024   -0.0289442 -1.28295e-11  4.49965e-14  -0.00108391    0.0120201         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  1.0396e-11  2.24657e-14 -0.000247531  0.000247531 -4.23785e-14 -1.17589e-15      0.10727     0.211668    0.0655438 -1.39878e-11  7.05252e-15     0.032136  9.04962e-12  3.90767e-13 -6.84047e-12 -1.40343e-14  -0.00135931  -0.00126638   -0.0289442    0.0345024 -1.47666e-11   4.4514e-14  -0.00108391   -0.0120201         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 8.89673e-12   1.7329e-14  -0.00014385   0.00014385 -5.61412e-13 -5.61864e-16    0.0655438    0.0655438     0.423732  -9.9245e-12  2.57227e-15   -0.0111903  3.58284e-13  1.52392e-14 -4.01265e-12 -8.03304e-15   3.0345e-05  -3.0345e-05 -0.000696259 -0.000696259 -1.32675e-11  3.24833e-14 -0.000524453  1.18819e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0147607 -3.23955e-05  3.04369e-14 -2.60365e-14    0.0143743  3.15474e-05 -1.16463e-11 -1.39878e-11  -9.9245e-12     0.445598  7.04676e-16 -2.20224e-12 -0.000472344 -2.05861e-05   -0.0108238 -2.37551e-05 -1.57526e-13 -5.62592e-14 -1.32982e-12  3.61314e-12     0.017764 -3.66401e-05  9.42508e-14  9.05758e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.23955e-05   -0.0147607  2.22591e-12  1.15664e-13 -3.15474e-05    0.0143743  2.64875e-15  7.05263e-15  2.57233e-15  5.19739e-16     0.445598  1.69081e-17  2.05861e-05 -0.000472344  2.37551e-05   -0.0108238 -5.62162e-12  6.78683e-13 -3.01534e-14 -2.43926e-13 -3.66401e-05    -0.017764    8.455e-12  6.85548e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.29333e-12  6.23249e-15 -7.05293e-05  7.05293e-05  2.17691e-12  4.66207e-15     0.032136     0.032136   -0.0111903 -2.20224e-12  1.68053e-17     0.626438  3.53734e-12  1.53292e-13 -5.04573e-12 -1.02619e-14  0.000957516 -0.000957516     -0.02197     -0.02197 -2.73942e-12  8.63791e-15 -0.000252086  4.11693e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0480498   -0.0019885 -7.15818e-15  6.31293e-16   0.00951656 -0.000393835  9.20333e-12  9.04962e-12  3.58284e-13 -0.000472344  2.05861e-05  3.53734e-12     0.912633 -6.38145e-14   -0.0214825  0.000889034  6.95959e-13 -6.95243e-13 -1.56464e-11 -1.37529e-11    0.0226593  0.000940734   -7.416e-14  3.53119e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0019885    0.0480498  -2.9803e-13  4.51746e-13  0.000393835   0.00951656  3.97257e-13  3.90767e-13  1.52392e-14 -2.05861e-05 -0.000472344  1.53292e-13 -6.37927e-14     0.912633 -0.000889034   -0.0214825 -2.18034e-12   2.8688e-13 -6.92315e-13  -6.9156e-13  0.000940734   -0.0226593  1.04108e-12   3.0256e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0477326  7.69307e-15  1.70296e-14 -1.60561e-14    0.0423454 -2.75635e-14 -1.20811e-11 -6.84047e-12 -4.01265e-12   -0.0108238  2.37551e-05 -5.04573e-12   -0.0214825 -0.000889034     0.950071 -2.90468e-14   -1.629e-13  2.40063e-13  5.56891e-12  3.69272e-12   0.00314125  4.14988e-07  5.31966e-14  3.13281e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 7.71752e-15    0.0477326  -4.9903e-13 -4.74174e-12 -2.75718e-14    0.0423454 -1.50182e-14 -1.40342e-14 -8.03305e-15 -2.37551e-05   -0.0108238 -1.02619e-14  0.000889034   -0.0214825 -2.90816e-14     0.950071  6.89011e-13  1.18718e-12 -4.01129e-14  3.69587e-14  4.14988e-07  -0.00314125 -2.13894e-12  2.30479e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.25419e-13   9.0133e-13    0.0656759  -0.00222933   6.3552e-14 -7.76381e-13   0.00126638  -0.00135931   3.0345e-05 -1.57526e-13 -5.62162e-12  0.000957516  6.95959e-13 -2.18034e-12   -1.629e-13  6.89011e-13      1.04442  -0.00454873   -0.0034417   -0.0034417 -3.31429e-13  4.62563e-13     0.015911    0.0044202         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.00999e-13 -2.97504e-13  -0.00222933    0.0656759 -9.51818e-14 -1.78583e-15   0.00135931  -0.00126638  -3.0345e-05 -5.62592e-14  6.78683e-13 -0.000957516 -6.95243e-13   2.8688e-13  2.40063e-13  1.18718e-12  -0.00454873      1.04442    0.0034417    0.0034417  2.75732e-13  8.92726e-13    -0.015911    0.0044202         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.32486e-12  8.63662e-15  0.000160806  -0.00278649 -2.19139e-12 -4.82997e-15    0.0345024   -0.0289442 -0.000696259 -1.32982e-12 -3.01534e-14     -0.02197 -1.56464e-11 -6.92315e-13  5.56891e-12 -4.01129e-14   -0.0034417    0.0034417      1.12324    0.0833678  6.45709e-12 -4.49662e-14  0.000447351    0.0049547         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.92871e-12   3.3043e-14   0.00278649 -0.000160806 -1.41317e-12 -3.64501e-14   -0.0289442    0.0345024 -0.000696259  3.61314e-12 -2.43926e-13     -0.02197 -1.37529e-11  -6.9156e-13  3.69272e-12  3.69587e-14   -0.0034417    0.0034417    0.0833678      1.12324  7.81634e-12  1.01524e-14  0.000447351   -0.0049547         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0558853 -7.38296e-06  1.95696e-13 -1.96562e-13  -0.00253709 -3.35172e-07 -8.09902e-11 -8.25591e-11 -1.27453e-11    0.0110902 -2.28746e-05 -3.12643e-12    0.0177076  0.000735157    0.0178963  2.36426e-06  1.20216e-13 -1.64495e-13 -3.66811e-12 -2.59748e-12     0.582693  5.76876e-14  1.20197e-12  3.25801e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-7.38296e-06    0.0558853 -9.27148e-13 -6.47775e-13 -3.35172e-07   0.00253709   1.5939e-13  1.59507e-13  2.97682e-14 -2.28746e-05   -0.0110902  8.95327e-15  0.000735157   -0.0177076  2.36426e-06   -0.0178963  5.24338e-15   1.0611e-12 -3.50597e-14   8.4624e-15  5.76829e-14     0.582693 -5.82025e-11 -2.54845e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-8.40646e-14 -5.49006e-12    0.0411126   -0.0411126 -2.27739e-14  3.67367e-12 -0.000986783 -0.000986783 -0.000474661  8.76651e-14  9.75844e-12 -0.000229174 -8.45507e-14  1.51054e-12  3.86008e-14 -3.07334e-12    0.0168132   -0.0168132  0.000474297  0.000474297  2.00251e-12 -6.13815e-11      1.94123  -2.1155e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-4.29013e-12 -3.34632e-12    0.0115788    0.0115788 -1.50306e-12 -1.08216e-12    0.0137569   -0.0137569  2.00783e-10  1.17664e-11  8.97217e-12  7.31716e-11   3.3556e-12  2.78834e-12   1.8488e-12  1.62034e-12    0.0053184    0.0053184   0.00566944  -0.00566944  3.69292e-11 -2.87895e-11 -2.07916e-10      0.78556         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.1"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
