{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2023-06-09T05:19:06.356701Z",
     "iopub.status.busy": "2023-06-09T05:19:06.356471Z",
     "iopub.status.idle": "2023-06-09T05:20:14.394572Z",
     "shell.execute_reply": "2023-06-09T05:20:14.393781Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/votca/issues\r\n",
      "\r\n",
      "xtp_tools, version 2023-rc.2 gitid: 891004f (compiled Jun  9 2023, 05:15:45)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 Bohr\r\n",
      "... ... \r\n",
      "... ... =========== OPTIMIZATION SUMMARY ================================= \r\n",
      "... ... At iteration  0\r\n",
      "... ...  ---- POSITIONS (Angstrom)   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    +0.0000  +0.0000  +0.0000\r\n",
      "... ...    1    +1.2000  +0.0000  +0.0000\r\n",
      "... ...    Total energy:     -112.26831841 Hartree \r\n",
      "... ...    Trust radius:       0.01889726 Bohr     \r\n",
      "... ...  ---- FORCES (Hartree/Bohr)   \r\n",
      "... ...       central differences   \r\n",
      "... ...       displacement 0.0010 Angstrom   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    -0.1314  -0.0000  -0.0000\r\n",
      "... ...    1    +0.1314  +0.0000  +0.0000A\r\n",
      "     0.30157 -2.16596e-13  4.02226e-11  2.02838e-11  1.70067e-13    -0.051948  2.09114e-12 -2.11201e-12  6.84547e-13  0.000145846    0.0176759  2.78612e-13  -0.00038181   -0.0390235   1.3381e-13   -0.0423787  1.36801e-12 -1.26551e-12 -2.76512e-13 -2.77377e-13 -8.30891e-05    -0.107191   1.7052e-11  1.45807e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.16581e-13      0.30157  2.35534e-12  2.33451e-12    -0.051948  1.70026e-13 -2.47846e-10  2.67784e-10 -9.53347e-11   -0.0176759  0.000145846 -3.87777e-11    0.0390235  -0.00038181   -0.0423787   1.3391e-13 -4.96186e-14  5.04937e-14  3.88033e-11  3.89057e-11     0.107191 -8.30891e-05  1.67732e-13 -2.17875e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.02226e-11  2.35534e-12     0.310844   -0.0100657    1.279e-12 -2.44394e-11  -0.00191014   0.00191014 -0.000747791 -8.38478e-13  1.10811e-11 -0.000335898 -9.66644e-14  4.61648e-12  1.89421e-13 -5.02999e-11   -0.0492351   0.00195799 -0.000185189  0.000277376  9.22038e-12   -5.287e-11    0.0248147    0.0216095          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.02838e-11  2.33451e-12   -0.0100657     0.310844  1.30487e-12  4.11886e-13  -0.00191014   0.00191014 -0.000747791 -9.10139e-13  1.09848e-12 -0.000335898 -1.12963e-13  2.75547e-12  2.43674e-13    4.085e-13  -0.00195799    0.0492351  0.000277376 -0.000185189  9.20891e-12 -1.21435e-11    0.0248147   -0.0216095          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  1.7005e-13    -0.051948    1.279e-12  1.30487e-12     0.487116 -2.84068e-14 -1.79501e-10  1.54649e-10 -8.36854e-11     0.013623 -0.000112405 -4.01332e-11   0.00828336 -8.10453e-05   -0.0302057 -4.71363e-13 -6.24301e-14  3.62623e-14  2.82836e-11  2.58461e-11   -0.0548637  4.25275e-05  5.57075e-13 -2.22774e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   -0.051948  1.70012e-13 -2.44394e-11  4.11886e-13 -2.84192e-14     0.487116  1.11337e-12  -1.0876e-12  6.00846e-13 -0.000112405    -0.013623  2.87911e-13 -8.10453e-05  -0.00828336 -4.71343e-13   -0.0302057 -2.31094e-12 -1.26584e-13 -2.09139e-13 -1.83023e-13  4.25275e-05    0.0548637 -5.56266e-12  1.43711e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.09114e-12 -2.47846e-10  -0.00191014  -0.00191014 -1.79501e-10  1.11337e-12     0.542328    -0.221419    0.0906292  1.01737e-10 -2.82097e-14    0.0407094  1.29304e-11  1.23993e-15 -7.33077e-11  1.65656e-13 -0.000426629 -3.59361e-05    0.0132966   -0.0339805 -1.06721e-09 -7.02844e-12 -0.000281352  -0.00254012          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.11201e-12  2.67784e-10   0.00191014   0.00191014  1.54649e-10  -1.0876e-12    -0.221419     0.542328   -0.0906292  -1.1172e-10  9.99348e-14   -0.0407094 -1.47914e-11  1.50443e-14  2.25992e-11 -1.11406e-13 -3.59361e-05 -0.000426629    0.0339805   -0.0132966  1.10722e-09  7.03902e-12  0.000281352  -0.00254012          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 6.84547e-13 -9.53347e-11 -0.000747791 -0.000747791 -8.36854e-11  6.00846e-13    0.0906292   -0.0906292     0.660145  6.15267e-11  -6.5619e-14  -0.00527337 -3.12069e-12  7.72791e-15 -3.30987e-11   2.3775e-13  7.23898e-06 -7.23898e-06  -0.00472246  -0.00472246 -3.60909e-10 -2.23267e-12 -0.000192177 -1.84253e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 0.000145846   -0.0176759 -8.38477e-13 -9.10139e-13     0.013623 -0.000112405  1.01737e-10  -1.1172e-10  6.15267e-11     0.669023  1.22355e-14  8.25918e-12  9.83197e-06 -1.50713e-08   0.00903036 -7.45105e-05 -4.93783e-16 -1.41322e-14 -4.78444e-12 -1.05561e-11   -0.0409873 -0.000306418 -2.48913e-14  3.24034e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0176759  0.000145846  1.10811e-11  1.09848e-12 -0.000112405    -0.013623 -2.82098e-14  9.99347e-14  -6.5619e-14  1.20366e-14     0.669023 -9.20227e-15  1.50713e-08  9.83197e-06 -7.45105e-05  -0.00903036 -1.87611e-12  7.64778e-12  8.63291e-15 -5.97083e-15  0.000306418   -0.0409873  7.91855e-12  2.23785e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.78612e-13 -3.87777e-11 -0.000335898 -0.000335898 -4.01332e-11  2.87911e-13    0.0407094   -0.0407094  -0.00527337  8.25918e-12 -9.20234e-15     0.793384  1.18508e-11 -3.09506e-14  3.85086e-12 -2.78081e-14  2.33728e-05 -2.33728e-05   -0.0152476   -0.0152476 -1.38599e-10 -8.55076e-13 -8.04905e-05 -8.07393e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -0.00038181    0.0390235 -9.66644e-14 -1.12963e-13   0.00828336 -8.10453e-05  1.29304e-11 -1.47914e-11 -3.12069e-12  9.83197e-06  1.50713e-08  1.18508e-11     0.954425  1.89608e-14    0.0128939 -0.000126155 -1.63412e-14  8.95464e-16  1.11226e-11 -3.32729e-12   -0.0199045 -0.000179318  7.93648e-14  2.61531e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0390235  -0.00038181  4.61648e-12  2.75547e-12 -8.10453e-05  -0.00828336  1.23993e-15  1.50443e-14  7.72786e-15 -1.50713e-08  9.83197e-06 -3.09506e-14  1.89449e-14     0.954425 -0.000126155   -0.0128939  6.21839e-12  8.23156e-12 -3.46419e-15 -1.89203e-14  0.000179318   -0.0199045  6.00228e-12  1.65877e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.33817e-13   -0.0423787  1.89421e-13  2.43673e-13   -0.0302057 -4.71336e-13 -7.33077e-11  2.25992e-11 -3.30987e-11   0.00903036 -7.45105e-05  3.85086e-12    0.0128939 -0.000126155     0.974684  2.70562e-13 -1.33039e-13 -6.61674e-14  1.51503e-11   -3.201e-12   -0.0229107  1.77592e-05  1.62986e-13   3.3088e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0423787  1.33915e-13 -5.02999e-11    4.085e-13 -4.71359e-13   -0.0302057  1.65655e-13 -1.11407e-13   2.3775e-13 -7.45105e-05  -0.00903036 -2.78081e-14 -0.000126155   -0.0128939  2.70553e-13     0.974684 -1.25437e-11 -5.80771e-12 -1.47568e-13  5.16256e-14  1.77592e-05    0.0229107  5.52637e-13 -3.58939e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.36801e-12 -4.96186e-14   -0.0492351  -0.00195799 -6.24301e-14 -2.31094e-12 -0.000426629 -3.59361e-05  7.23898e-06 -4.93831e-16 -1.87611e-12  2.33728e-05 -1.63412e-14  6.21839e-12 -1.33039e-13 -1.25437e-11      1.02179  -0.00208422 -6.55529e-05 -6.55529e-05 -1.68491e-13 -8.34402e-12  -0.00474241 -3.07105e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.26551e-12  5.04937e-14   0.00195799    0.0492351  3.62623e-14 -1.26584e-13 -3.59361e-05 -0.000426629 -7.23898e-06 -1.41322e-14  7.64778e-12 -2.33728e-05  8.95507e-16  8.23156e-12 -6.61674e-14 -5.80771e-12  -0.00208422      1.02179  6.55529e-05  6.55529e-05  2.23901e-13  2.71849e-12   0.00474241 -3.07105e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.76512e-13  3.88033e-11 -0.000185189  0.000277376  2.82836e-11 -2.09139e-13    0.0132966    0.0339805  -0.00472246 -4.78444e-12  8.63292e-15   -0.0152476  1.11226e-11 -3.46417e-15  1.51503e-11 -1.47568e-13 -6.55529e-05  6.55529e-05      1.06455    0.0448486  1.50637e-10  9.15791e-13   6.5715e-05 -5.64279e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.77377e-13  3.89057e-11  0.000277376 -0.000185189  2.58461e-11 -1.83023e-13   -0.0339805   -0.0132966  -0.00472246 -1.05561e-11 -5.97087e-15   -0.0152476 -3.32729e-12 -1.89203e-14   -3.201e-12  5.16256e-14 -6.55529e-05  6.55529e-05    0.0448486      1.06455   1.5619e-10  9.72372e-13   6.5715e-05   5.6428e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.78545e-05   -0.0746367 -5.51609e-12 -5.51178e-12     0.069959 -5.42286e-05  6.27374e-10 -6.46456e-10  2.65823e-10    0.0304412 -0.000227576  1.18741e-10   0.00918448 -8.27421e-05    0.0362981 -2.81364e-05  1.88897e-13 -1.49554e-13 -1.15493e-10 -1.11591e-10    -0.195037 -1.32717e-12 -4.42109e-12 -2.62216e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0746367  5.78545e-05  4.46484e-11    2.499e-11 -5.42286e-05    -0.069959  4.16361e-12 -4.16941e-12  1.62312e-12  0.000227576    0.0304412  7.27613e-13  8.27421e-05   0.00918448 -2.81364e-05   -0.0362981 -1.67281e-12 -2.11466e-12 -7.15979e-13 -6.77514e-13 -1.32723e-12    -0.195037  4.35647e-10 -1.72306e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.96203e-11 -4.80379e-13    0.0141013    0.0141013 -5.85237e-13  1.12447e-11  0.000602432 -0.000602432  0.000192169  6.30737e-14 -1.93472e-11   8.0487e-05 -3.05685e-14 -6.23475e-12    9.778e-14  4.44177e-11  -0.00610199   0.00610199 -8.23408e-05 -8.23408e-05 -5.47656e-12  4.38785e-10      0.94226 -1.13833e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.17953e-11  -3.2391e-12   -0.0070982    0.0070982 -1.26309e-12  9.39025e-12  0.000612478  0.000612477  1.13335e-10  1.28782e-12  7.19889e-12  5.58346e-11  2.14894e-12   1.3661e-11 -2.69023e-12  1.93341e-11  -0.00443614  -0.00443614 -0.000581472  0.000581472 -3.06587e-11 -2.00956e-10   -1.127e-09    0.0480969          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0906271 -9.50102e-14  2.37832e-11  9.46976e-12  1.03896e-13   -0.0326354  8.78648e-13 -8.93711e-13  4.29841e-13  0.000122665    0.0148665   1.8364e-13 -0.000470826   -0.0481215  1.52878e-13   -0.0477892   8.4185e-13 -3.25551e-13 -2.08914e-13 -2.14199e-13 -1.89721e-05   -0.0244754  -2.7243e-11  2.91924e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-9.50025e-14    0.0906271  9.87494e-13   9.7245e-13   -0.0326354  1.03867e-13 -9.71153e-11  1.11429e-10 -5.98673e-11   -0.0148665  0.000122665  -2.5557e-11    0.0481215 -0.000470826   -0.0477892  1.52988e-13 -3.84857e-14  4.37855e-14  2.93423e-11  2.98586e-11    0.0244754 -1.89721e-05 -3.46944e-13  -4.3741e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.37832e-11  9.87494e-13    0.0997416  -0.00553068  7.57945e-13 -1.60524e-11 -0.000934863  0.000934863 -0.000538124 -5.96571e-13  1.04389e-11 -0.000261478  9.40445e-15  4.99356e-12  2.31148e-13 -6.16309e-11   -0.0659115   0.00225778 -0.000385037  0.000237758  1.20173e-12 -7.28878e-12     0.040844    0.0145875         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 9.46976e-12   9.7245e-13  -0.00553068    0.0997416  7.74959e-13  3.44506e-13 -0.000934863  0.000934863 -0.000538124  -6.6818e-13  4.63221e-13 -0.000261478 -1.23421e-14  2.50865e-12  2.98292e-13  1.10301e-12  -0.00225778    0.0659115  0.000237758 -0.000385037  1.19399e-12  1.40994e-11     0.040844   -0.0145875         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  1.0388e-13   -0.0326354  7.57945e-13  7.74959e-13     0.236919 -1.09617e-14 -1.07957e-10  9.15606e-11 -7.17815e-11    0.0143885 -0.000118721 -3.85668e-11   0.00947358 -9.26905e-05   -0.0425853 -6.46884e-13 -6.66262e-14  3.43213e-14  2.85483e-11  2.55358e-11   0.00365057 -2.82973e-06   4.1295e-14 -3.75863e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0326354  1.03863e-13 -1.60524e-11  3.44506e-13 -1.09769e-14     0.236919      6.6e-13 -6.43053e-13  5.15404e-13 -0.000118721   -0.0143885  2.76649e-13 -9.26905e-05  -0.00947358 -6.46853e-13   -0.0425853 -2.76333e-12  -2.4927e-13 -2.12348e-13 -1.80111e-13 -2.82973e-06  -0.00365057  3.19277e-12  2.58116e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 8.78648e-13 -9.71153e-11 -0.000934863 -0.000934863 -1.07957e-10      6.6e-13     0.213035    -0.107763    0.0652184  7.23389e-11 -1.94242e-15      0.03169  1.13677e-13   3.6926e-14 -8.97847e-11  2.03361e-13 -0.000596608 -2.61871e-05     0.034419   -0.0292347 -1.37224e-10 -9.16835e-13  0.000336938  -0.00193317         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-8.93711e-13  1.11429e-10  0.000934863  0.000934863  9.15606e-11 -6.43053e-13    -0.107763     0.213035   -0.0652184 -8.23146e-11  7.36087e-14     -0.03169 -2.59855e-12 -1.51934e-14  2.70508e-11 -1.36217e-13 -2.61871e-05 -0.000596608    0.0292347    -0.034419  1.58419e-10  9.21294e-13 -0.000336938  -0.00193317         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.29841e-13 -5.98673e-11 -0.000538124 -0.000538124 -7.17815e-11  5.15404e-13    0.0652184   -0.0652184     0.424482  6.67829e-11 -7.11465e-14   -0.0113321  -1.1292e-11  2.88681e-14 -4.48461e-11  3.22133e-13  9.22073e-07 -9.22073e-07 -0.000601528 -0.000601528 -8.46645e-11 -5.25581e-13 -4.06102e-05  -4.6205e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 0.000122665   -0.0148665 -5.96571e-13  -6.6818e-13    0.0143885 -0.000118721  7.23389e-11 -8.23146e-11  6.67829e-11     0.448028  1.60049e-14  5.53456e-12 -0.000495541  7.59606e-07    0.0107667 -8.88368e-05 -1.68008e-14  -9.1011e-15  1.93845e-12 -8.26621e-12    -0.017761  -0.00013278   1.2333e-14  4.95063e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0148665  0.000122665  1.04389e-11  4.63221e-13 -0.000118721   -0.0143885 -1.94245e-15  7.36087e-14 -7.11465e-14  1.57251e-14     0.448028 -6.42403e-15 -7.59606e-07 -0.000495541 -8.88368e-05   -0.0107667 -3.28154e-12  1.34862e-11  4.13396e-15 -2.17369e-14   0.00013278    -0.017761 -1.47278e-11  3.26723e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  1.8364e-13  -2.5557e-11 -0.000261478 -0.000261478 -3.85668e-11  2.76649e-13      0.03169     -0.03169   -0.0113321  5.53456e-12 -6.42412e-15     0.627711  1.66133e-11 -4.33497e-14  8.80319e-12 -6.34474e-14  3.35066e-05 -3.35066e-05   -0.0218586   -0.0218586 -1.37209e-11 -7.82506e-14 -2.36993e-05 -1.49735e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-0.000470826    0.0481215  9.40445e-15 -1.23421e-14   0.00947358 -9.26905e-05  1.13677e-13 -2.59855e-12  -1.1292e-11 -0.000495541 -7.59606e-07  1.66133e-11     0.913264  3.25958e-14    0.0216054  -0.00021139 -3.81328e-14  6.97518e-15  2.62665e-11 -2.88511e-12   -0.0227526 -0.000204976  1.27016e-13  5.72976e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0481215 -0.000470826  4.99356e-12  2.50865e-12 -9.26905e-05  -0.00947358   3.6926e-14 -1.51934e-14  2.88681e-14  7.59606e-07 -0.000495541 -4.33497e-14  3.25635e-14     0.913264  -0.00021139   -0.0216054  1.28123e-11  1.63393e-11  -1.6667e-14 -4.78446e-14  0.000204976   -0.0227526  4.45705e-12  3.63632e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.52884e-13   -0.0477892  2.31148e-13  2.98292e-13   -0.0425853 -6.46848e-13 -8.97847e-11  2.70508e-11 -4.48461e-11    0.0107667 -8.88368e-05  8.80319e-12    0.0216054  -0.00021139     0.954146  5.14192e-13 -2.26854e-13 -1.32598e-13  2.56702e-11 -7.44439e-12   0.00328347 -2.54517e-06    3.815e-13 -2.48485e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0477892  1.52997e-13 -6.16309e-11  1.10301e-12 -6.46878e-13   -0.0425853  2.03361e-13 -1.36217e-13  3.22133e-13 -8.88368e-05   -0.0107667 -6.34474e-14  -0.00021139   -0.0216054  5.14174e-13     0.954146 -2.11509e-11 -1.19638e-11 -2.52011e-13  1.07416e-13 -2.54517e-06  -0.00328347   5.0445e-11  1.57994e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  8.4185e-13 -3.84857e-14   -0.0659115  -0.00225778 -6.66262e-14 -2.76333e-12 -0.000596608 -2.61871e-05  9.22073e-07 -1.68009e-14 -3.28154e-12  3.35066e-05 -3.81328e-14  1.28123e-11 -2.26854e-13 -2.11509e-11      1.04646  -0.00440005 -0.000121707 -0.000121707   4.7578e-14 -1.69244e-11   -0.0159307  -0.00602212         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.25551e-13  4.37855e-14   0.00225778    0.0659115  3.43213e-14  -2.4927e-13 -2.61871e-05 -0.000596608 -9.22073e-07 -9.10108e-15  1.34862e-11 -3.35066e-05  6.97526e-15  1.63393e-11 -1.32598e-13 -1.19638e-11  -0.00440005      1.04646  0.000121707  0.000121707  9.20538e-14  2.99545e-12    0.0159307  -0.00602212         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.08914e-13  2.93423e-11 -0.000385037  0.000237758  2.85483e-11 -2.12348e-13     0.034419    0.0292347 -0.000601528  1.93845e-12  4.13399e-15   -0.0218586  2.62665e-11  -1.6667e-14  2.56702e-11 -2.52011e-13 -0.000121707  0.000121707      1.12585    0.0837975  5.05637e-11  2.69909e-13  7.02216e-06  -0.00088118         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.14199e-13  2.98586e-11  0.000237758 -0.000385037  2.55358e-11 -1.80111e-13   -0.0292347    -0.034419 -0.000601528 -8.26621e-12  -2.1737e-14   -0.0218586 -2.88511e-12 -4.78445e-14 -7.44439e-12  1.07416e-13 -0.000121707  0.000121707    0.0837975      1.12585  6.45059e-11  4.10269e-13  7.02216e-06   0.00088118         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-4.34686e-05    0.0560778   4.9623e-12  4.95352e-12   0.00265972 -2.06168e-06 -5.82918e-10  6.11023e-10 -9.01008e-11   -0.0109726  8.20305e-05 -1.84687e-11   -0.0178427  0.000160743      0.01806 -1.39992e-05  1.88861e-13    2.414e-14 -3.11148e-11 -9.89723e-12     0.585022 -1.47412e-12 -3.26754e-12 -5.25547e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0560778 -4.34686e-05 -1.91058e-11  9.10472e-12 -2.06168e-06  -0.00265972 -3.86477e-12  3.87174e-12 -5.94739e-13 -8.20305e-05   -0.0109726 -1.28526e-13 -0.000160743   -0.0178427 -1.39992e-05     -0.01806  -1.8767e-11 -2.33622e-12 -2.37429e-13  -2.4277e-14 -1.47418e-12     0.585022  4.37619e-10 -3.50422e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " -1.0434e-11 -2.96061e-13    0.0412947    0.0412947  4.97094e-14  1.34015e-11  0.000340761 -0.000340761  4.05946e-05  1.05914e-13 -1.73854e-12  2.36919e-05  8.37971e-14  4.62975e-12  2.35947e-13  4.93383e-11   -0.0168393    0.0168393 -5.72627e-05 -5.72627e-05 -4.49586e-12  4.32183e-10      1.94801 -1.63356e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.97489e-11  -5.9789e-12    0.0165988   -0.0165988 -4.40572e-12  3.06115e-11  -0.00220954  -0.00220954 -8.49851e-11  6.45615e-12   4.1684e-11  -3.0727e-11  6.26228e-12  3.93445e-11 -1.48107e-12  1.07572e-11  -0.00725002  -0.00725002  -0.00101418   0.00101418 -5.66422e-11 -3.75637e-10 -1.62185e-09     0.690599         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
