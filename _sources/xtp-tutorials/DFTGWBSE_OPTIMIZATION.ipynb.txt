{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2023-06-02T16:17:29.334544Z",
     "iopub.status.busy": "2023-06-02T16:17:29.333743Z",
     "iopub.status.idle": "2023-06-02T16:18:02.130393Z",
     "shell.execute_reply": "2023-06-02T16:18:02.129418Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/votca/issues\r\n",
      "\r\n",
      "xtp_tools, version 2023-rc.2 gitid: 3706177 (compiled Jun  2 2023, 16:09:29)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 BohrA\r\n",
      "    0.307557  1.29764e-15 -1.61211e-14 -4.70708e-15   -0.0515784 -1.20607e-15   4.7825e-11 -2.37476e-11  6.05486e-12    0.0182326 -4.23865e-06  1.29805e-11    0.0389712  0.000105876   -0.0420794 -1.04357e-15 -4.02671e-14 -7.90671e-15 -1.51517e-11  4.96692e-12    -0.108498 -9.18568e-07  9.99967e-16          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.31474e-15     0.307557 -3.93709e-12  2.01404e-11 -1.22797e-15   -0.0515784  3.87196e-15 -1.52839e-14  1.59299e-15 -4.23865e-06   -0.0182326  3.05535e-15 -0.000105876    0.0389712 -1.14465e-15   -0.0420794 -8.72444e-12  1.46035e-12  2.30882e-14  9.24818e-15 -9.18568e-07     0.108498 -1.40789e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.61211e-14 -3.93709e-12     0.320545   -0.0100423 -2.55374e-14 -4.69836e-12 -5.35652e-05  5.35652e-05  1.98653e-05 -1.66975e-15   9.1787e-12  8.42466e-06 -6.67353e-18  2.23182e-13 -4.51923e-15 -2.22983e-15   0.00205856    0.0495543  3.04434e-06  0.000125991  2.39756e-15  -3.0815e-12    0.0253868          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-4.70707e-15  2.01404e-11   -0.0100423     0.320545 -4.82241e-14 -5.36645e-11 -5.35652e-05  5.35652e-05  1.98653e-05  1.55965e-15 -4.45549e-12  8.42466e-06  5.34457e-15 -2.18052e-12    9.322e-15  3.03449e-11    0.0495543   0.00205856 -0.000125991 -3.04434e-06 -1.39623e-14  3.04621e-11    0.0253868          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0515784 -1.24358e-15 -2.55374e-14 -4.82241e-14     0.491199  8.33755e-17  1.63507e-10 -2.12473e-10 -9.28079e-11     -0.01345   3.1268e-06 -4.06115e-11   0.00797202  2.16581e-05   -0.0310586    2.872e-15 -6.22543e-14  -7.8358e-14 -2.52723e-11  3.03589e-11    0.0529951  4.48667e-07  3.12934e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.22586e-15   -0.0515784 -4.69836e-12 -5.36645e-11  9.40081e-17     0.491199   4.8102e-14 -2.53312e-14 -2.13958e-14   3.1268e-06      0.01345 -9.29075e-15 -2.16581e-05   0.00797202  2.92334e-15   -0.0310586  7.63561e-12  2.54905e-12 -2.71753e-14  1.10185e-14  4.48667e-07   -0.0529951 -5.00635e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  4.7825e-11  3.87197e-15 -5.35652e-05 -5.35652e-05  1.63507e-10   4.8102e-14     0.550957    -0.220369   -0.0854511   1.1514e-11 -1.14821e-16   -0.0362389 -1.29166e-13  5.40223e-16 -9.80219e-12 -8.98112e-15  4.23313e-05 -8.67036e-05    0.0124024    0.0350934  2.10439e-11 -1.61282e-14  2.69505e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.37476e-11 -1.52839e-14  5.35652e-05  5.35652e-05 -2.12473e-10 -2.53312e-14    -0.220369     0.550957    0.0854511  2.12018e-12  3.32016e-15    0.0362389 -2.27455e-12 -5.90545e-15  4.01494e-11 -4.91866e-15  8.67036e-05 -4.23313e-05    0.0350934    0.0124024 -5.37886e-11  8.20418e-16 -2.69505e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 6.05486e-12  1.59294e-15  1.98653e-05  1.98653e-05 -9.28079e-11 -2.13958e-14   -0.0854511    0.0854511     0.663153  9.49862e-12 -4.60251e-15  -0.00639727 -7.94642e-12 -2.33894e-14  5.90361e-12  1.21871e-15  1.00548e-05  1.00548e-05   0.00404736  -0.00404736 -4.36226e-11  1.08013e-14 -7.76816e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0182326 -4.23865e-06 -1.66982e-15  1.55967e-15     -0.01345   3.1268e-06   1.1514e-11  2.12018e-12  9.49862e-12     0.681816  8.65663e-16  -9.4742e-12  9.13984e-05   2.2706e-07  -0.00860647   2.0008e-06   2.7989e-15 -1.90073e-15  7.42945e-13  8.06174e-13   -0.0410286  -9.8855e-06  9.36706e-15          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-4.23865e-06   -0.0182326   9.1787e-12 -4.45549e-12   3.1268e-06      0.01345 -1.14895e-16  3.32005e-15 -4.60247e-15  9.74141e-16     0.681816  4.44007e-15   2.2706e-07 -9.13984e-05   2.0008e-06   0.00860647  2.24174e-13  1.77331e-12  -3.2197e-17  4.69337e-15   9.8855e-06   -0.0410286  1.08987e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.29805e-11  3.05535e-15  8.42466e-06  8.42466e-06 -4.06115e-11  -9.2908e-15   -0.0362389    0.0362389  -0.00639727  -9.4742e-12  4.44006e-15      0.79863  6.72053e-12  1.96723e-14    1.021e-11  2.26523e-15  3.58079e-05  3.58079e-05    0.0144137   -0.0144137 -4.27021e-11  9.90444e-15 -3.61127e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0389712 -0.000105876 -6.67428e-18  5.34456e-15   0.00797202 -2.16581e-05 -1.29166e-13 -2.27455e-12 -7.94642e-12  9.13984e-05   2.2706e-07  6.72053e-12     0.956559  7.97523e-15    0.0131605 -3.57539e-05  2.52132e-14  2.60401e-14  7.32878e-12 -9.37612e-12    0.0200324   5.4593e-05 -5.48597e-15          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 0.000105876    0.0389712  2.23182e-13 -2.18052e-12  2.16581e-05   0.00797202  5.40223e-16 -5.90546e-15 -2.33895e-14   2.2706e-07 -9.13984e-05  1.96723e-14   7.9725e-15     0.956559  3.57539e-05    0.0131605 -2.70722e-12  -6.5988e-13  2.87183e-14 -2.79171e-14   5.4593e-05   -0.0200324  2.45904e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0420794 -1.14214e-15 -4.51918e-15  9.32201e-15   -0.0310586   2.9317e-15 -9.80219e-12  4.01494e-11  5.90361e-12  -0.00860647   2.0008e-06    1.021e-11    0.0131605  3.57539e-05     0.989636 -1.81318e-15  4.31936e-14  3.19041e-14  1.69082e-11 -1.33631e-11    0.0223203  1.88968e-07  -8.2368e-15          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.03588e-15   -0.0420794  -2.2298e-15  3.03449e-11  2.88202e-15   -0.0310586 -8.98112e-15 -4.91859e-15   1.2187e-15   2.0008e-06   0.00860647  2.26523e-15 -3.57539e-05    0.0131605 -1.80642e-15     0.989636  1.89065e-12 -1.65445e-12 -2.44365e-15  -8.8284e-15  1.88968e-07   -0.0223203   2.0415e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-4.02671e-14 -8.72444e-12   0.00205856    0.0495543 -6.22543e-14  7.63561e-12  4.23313e-05  8.67036e-05  1.00548e-05  2.79889e-15  2.24174e-13  3.58079e-05  2.52132e-14 -2.70722e-12  4.31936e-14  1.89065e-12      1.02923   0.00206695  0.000108198 -0.000108198  2.05827e-14 -1.80677e-11   0.00469353          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-7.90671e-15  1.46035e-12    0.0495543   0.00205856 -7.83579e-14  2.54905e-12 -8.67036e-05 -4.23313e-05  1.00548e-05 -1.90073e-15  1.77331e-12  3.58079e-05  2.60402e-14  -6.5988e-13  3.19041e-14 -1.65445e-12   0.00206695      1.02923  0.000108198 -0.000108198 -4.79465e-14  3.60512e-12   0.00469353          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.51517e-11  2.30882e-14  3.04434e-06 -0.000125991 -2.52723e-11 -2.71753e-14    0.0124024    0.0350934   0.00404736  7.42945e-13  -3.2192e-17    0.0144137  7.32878e-12  2.87183e-14  1.69082e-11 -2.44364e-15  0.000108198  0.000108198      1.07278   -0.0456194  5.96681e-12  5.47677e-14  -5.4983e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.96692e-12  9.24818e-15  0.000125991 -3.04434e-06  3.03589e-11  1.10185e-14    0.0350934    0.0124024  -0.00404736  8.06174e-13  4.69333e-15   -0.0144137 -9.37612e-12 -2.79171e-14 -1.33631e-11  -8.8284e-15 -0.000108198 -0.000108198   -0.0456194      1.07278  1.55519e-11  1.42503e-14   5.4983e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "    0.075296  6.37471e-07 -5.16833e-15  9.30569e-15   -0.0689447 -5.83699e-07 -7.70672e-12  3.73683e-11  3.99091e-11    0.0309921 -7.46729e-06  2.69239e-11  -0.00898917 -2.44976e-05   -0.0364163 -3.08308e-07 -3.26742e-14 -2.15408e-15 -1.20395e-11  2.49002e-12     -0.19441 -1.94205e-15 -2.93308e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 6.37471e-07    -0.075296  3.44381e-12 -2.71668e-11 -5.83699e-07    0.0689447  1.19882e-14  2.33353e-15 -9.93038e-15  7.46729e-06    0.0309921  -6.3815e-15 -2.44976e-05   0.00898917 -3.08308e-07    0.0364163  7.91925e-12 -1.73897e-12 -2.16659e-14 -8.92371e-15 -1.89789e-15     -0.19441  7.98694e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 6.96462e-15  6.01924e-12    0.0144102    0.0144102  4.07627e-14  5.60632e-11  5.44165e-05 -5.44165e-05   -1.882e-05 -3.27512e-15 -1.65277e-11 -7.71009e-06   1.1714e-14  -3.4469e-12  6.27131e-16 -4.11861e-11     0.006144     0.006144 -1.20952e-05  1.20952e-05 -8.50796e-15  9.63325e-11     0.957552          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "    0.094057  6.20212e-16 -8.29786e-15 -2.02079e-15   -0.0329085 -8.01384e-16  2.39177e-11 -1.07039e-11  5.66257e-12    0.0156091 -3.62874e-06  1.35051e-11    0.0483433  0.000131337   -0.0481685 -1.26426e-15 -4.50994e-14 -6.70898e-15 -1.69246e-11  4.83706e-12   -0.0251553  -2.1297e-07  8.19328e-15         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.30845e-16     0.094057 -2.23078e-12  1.09831e-11  -8.1174e-16   -0.0329085   1.6598e-15 -7.93896e-15  1.43674e-15 -3.62874e-06   -0.0156091  3.13576e-15 -0.000131337    0.0483433 -1.37633e-15   -0.0481685 -1.06188e-11  1.46871e-12  2.82621e-14  1.00976e-14  -2.1297e-07    0.0251553  1.73443e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-8.29782e-15 -2.23078e-12     0.105938  -0.00570609 -1.10854e-14  -2.7736e-12 -2.72069e-05  2.72069e-05  1.46321e-05 -2.97037e-15   9.4756e-12  6.60853e-06  2.23779e-16  1.31604e-13 -7.16992e-15 -2.46697e-14   0.00242557    0.0671916  1.21282e-06  0.000174741   1.4626e-15 -4.28735e-13    0.0420449         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.02079e-15  1.09831e-11  -0.00570609     0.105938 -2.89475e-14 -4.13361e-11 -2.72069e-05  2.72069e-05  1.46321e-05  5.61542e-16 -5.52142e-12  6.60853e-06  5.96013e-15 -2.44466e-12  1.10387e-14  3.98859e-11    0.0671916   0.00242557 -0.000174741 -1.21282e-06 -1.19757e-15  4.23104e-12    0.0420449         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0329085 -8.22383e-16 -1.10854e-14 -2.89475e-14     0.241204 -2.79698e-17  8.89809e-11 -1.27543e-10 -7.79348e-11   -0.0144728  3.36458e-06 -3.67565e-11   0.00911844  2.47727e-05   -0.0442994  4.10957e-15 -5.87513e-14 -7.26805e-14 -2.36958e-11  2.81057e-11  -0.00443755 -3.75692e-08  7.57964e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-8.18134e-16   -0.0329085  -2.7736e-12 -4.13361e-11 -1.87242e-17     0.241204  2.89227e-14  -1.0998e-14 -1.79749e-14  3.36458e-06    0.0144728 -8.38783e-15 -2.47727e-05   0.00911844  4.18026e-15   -0.0442994  7.97806e-12  3.56817e-12 -2.73506e-14   1.3348e-14 -3.75692e-08   0.00443755  4.12292e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.39177e-11  1.65981e-15 -2.72069e-05 -2.72069e-05  8.89809e-11  2.89226e-14      0.22297    -0.111325   -0.0629404  1.63899e-11 -1.95831e-15   -0.0284268  2.15399e-13  1.57654e-15 -7.63023e-12 -1.07011e-14  9.91648e-05 -7.67894e-05     0.033629     0.031137 -4.14024e-12 -8.39856e-16  7.91945e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.07039e-11 -7.93895e-15  2.72069e-05  2.72069e-05 -1.27543e-10  -1.0998e-14    -0.111325      0.22297    0.0629404 -1.39287e-12  5.46965e-15    0.0284268 -2.79168e-12 -7.32934e-15  4.75409e-11 -7.57859e-15  7.67894e-05 -9.91648e-05     0.031137     0.033629 -6.57269e-13 -1.02762e-15 -7.91945e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 5.66257e-12   1.4367e-15  1.46321e-05  1.46321e-05 -7.79348e-11 -1.79749e-14   -0.0629404    0.0629404      0.42963  9.32866e-12 -4.59743e-15   -0.0122085 -1.22461e-11 -3.60133e-14  7.86983e-12  1.62023e-15 -1.63752e-07 -1.63752e-07 -6.59151e-05  6.59151e-05 -6.82927e-12  1.85169e-15 -2.70586e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0156091 -3.62874e-06 -2.97044e-15  5.61565e-16   -0.0144728  3.36458e-06  1.63899e-11 -1.39287e-12  9.32866e-12     0.465176   1.1218e-15 -1.57166e-11  0.000658396  1.63565e-06   -0.0103444  2.40482e-06  7.16775e-15 -3.05978e-15   2.1904e-12  1.20108e-12   -0.0177317  -4.2723e-06  6.37554e-15         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.62874e-06   -0.0156091   9.4756e-12 -5.52142e-12  3.36458e-06    0.0144728 -1.95838e-15  5.46953e-15 -4.59739e-15  1.28295e-15     0.465176  7.34475e-15  1.63565e-06 -0.000658396  2.40482e-06    0.0103444 -1.49281e-13  3.24223e-12  1.16988e-15  8.99179e-15   4.2723e-06   -0.0177317 -1.06283e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.35051e-11  3.13576e-15  6.60853e-06  6.60853e-06 -3.67565e-11 -8.38789e-15   -0.0284268    0.0284268   -0.0122085 -1.57166e-11  7.34473e-15     0.636701  1.15999e-11  3.40001e-14  1.83937e-11  4.10988e-15  5.18065e-05  5.18065e-05    0.0208536   -0.0208536 -2.55626e-11  5.75231e-15 -1.18065e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0483433 -0.000131337  2.23773e-16  5.96013e-15   0.00911844 -2.47727e-05  2.15399e-13 -2.79168e-12 -1.22461e-11  0.000658396  1.63565e-06  1.15999e-11     0.917337   1.4773e-14    0.0223428 -6.07003e-05   4.8595e-14  5.04157e-14  1.37017e-11 -1.81401e-11     0.023285   6.3457e-05  8.73404e-15         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 0.000131337    0.0483433  1.31604e-13 -2.44466e-12  2.47727e-05   0.00911844  1.57654e-15 -7.32934e-15 -3.60133e-14  1.63565e-06 -0.000658396  3.40001e-14  1.47672e-14     0.917337  6.07003e-05    0.0223428 -5.65314e-12 -1.21481e-12  5.54631e-14 -5.36958e-14   6.3457e-05    -0.023285  -1.4928e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0481685  -1.3735e-15 -7.16985e-15  1.10387e-14   -0.0442994  4.19267e-15 -7.63023e-12  4.75409e-11  7.86983e-12   -0.0103444  2.40482e-06  1.83937e-11    0.0223428  6.07003e-05     0.983661 -3.59246e-15  8.27106e-14  5.62991e-14  3.22676e-11 -2.39699e-11  -0.00432401 -3.66079e-08 -1.15861e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.25574e-15   -0.0481685 -2.46697e-14  3.98859e-11  4.12305e-15   -0.0442994 -1.07011e-14 -7.57848e-15  1.62023e-15  2.40482e-06    0.0103444  4.10988e-15 -6.07003e-05    0.0223428 -3.58108e-15     0.983661  5.47476e-12 -2.82301e-12  -9.9966e-15 -1.63784e-14 -3.66079e-08   0.00432401 -1.26237e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-4.50994e-14 -1.06188e-11   0.00242557    0.0671916 -5.87513e-14  7.97806e-12  9.91648e-05  7.67894e-05 -1.63752e-07  7.16773e-15 -1.49281e-13  5.18065e-05  4.85951e-14 -5.65314e-12  8.27107e-14  5.47476e-12      1.06175   0.00440489  0.000202282 -0.000202282   2.4565e-14 -2.13921e-11    0.0159971         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.70897e-15  1.46871e-12    0.0671916   0.00242557 -7.26805e-14  3.56817e-12 -7.67894e-05 -9.91648e-05 -1.63752e-07 -3.05977e-15  3.24223e-12  5.18065e-05  5.04159e-14 -1.21481e-12  5.62991e-14 -2.82301e-12   0.00440489      1.06175  0.000202282 -0.000202282 -5.32409e-14  3.21478e-12    0.0159971         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.69246e-11  2.82621e-14  1.21282e-06 -0.000174741 -2.36958e-11 -2.73506e-14     0.033629     0.031137 -6.59151e-05   2.1904e-12  1.16989e-15    0.0208536  1.37017e-11  5.54631e-14  3.22676e-11  -9.9966e-15  0.000202282  0.000202282      1.14317   -0.0858287  7.42092e-12  6.41327e-14 -2.41239e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.83706e-12  1.00976e-14  0.000174741 -1.21282e-06  2.81057e-11   1.3348e-14     0.031137     0.033629  6.59151e-05  1.20108e-12  8.99172e-15   -0.0208536 -1.81401e-11 -5.36958e-14 -2.39699e-11 -1.63785e-14 -0.000202282 -0.000202282   -0.0858287      1.14317  1.70531e-11   1.4467e-14  2.41239e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0574548 -4.86423e-07 -2.42821e-16 -3.21733e-15  -0.00354178 -2.99854e-08  4.68762e-12 -9.68579e-12  2.23446e-12   -0.0101472   2.4449e-06 -1.18411e-11    0.0187031  5.09705e-05    -0.019244 -1.62923e-07 -1.67921e-14 -5.29569e-14 -7.84505e-12  1.92408e-11     0.601743  1.54751e-14 -8.32933e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-4.86423e-07    0.0574548  3.79742e-13  5.19072e-12 -2.99854e-08   0.00354178  -1.7846e-15 -5.79739e-17 -8.91423e-16  -2.4449e-06   -0.0101472  2.43385e-15  5.09705e-05   -0.0187031 -1.62923e-07     0.019244 -9.65455e-12  1.74388e-12  3.18663e-14  4.72774e-15  1.55558e-14     0.601743 -5.26056e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 8.41885e-15 -5.13894e-12    0.0425254    0.0425254  7.96672e-14  1.05694e-11  7.36181e-05 -7.36181e-05 -2.75835e-05   2.1972e-14  2.14386e-11 -1.24012e-05  3.50691e-15  2.74427e-13 -1.71379e-14  1.75379e-12      0.01695      0.01695 -2.85324e-05  2.85324e-05 -5.51908e-14 -4.41385e-11       1.9854         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
