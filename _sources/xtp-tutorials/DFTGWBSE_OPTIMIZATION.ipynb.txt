{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2021-12-05T15:24:24.226868Z",
     "iopub.status.busy": "2021-12-05T15:24:24.226379Z",
     "iopub.status.idle": "2021-12-05T15:24:52.274931Z",
     "shell.execute_reply": "2021-12-05T15:24:52.275358Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2022-dev gitid: bfa8833 (compiled Dec  5 2021, 15:17:05)\r\n",
      "votca_csg, version 2022-dev gitid: bfa8833 (compiled Dec  5 2021, 15:04:30)\r\n",
      "votca_tools, version 2022-dev gitid: bfa8833 (compiled Dec  5 2021, 15:02:03)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 BohrA\r\n",
      "    0.307132 -3.06386e-11  1.79834e-10  5.20074e-10    2.324e-11   -0.0516061  1.11677e-09 -1.03701e-09  3.87661e-10    0.0181647   0.00104166  1.10464e-10   -0.0103655    0.0375718 -2.00461e-11    0.0421019 -2.08388e-10  9.07934e-11  3.57861e-10   1.5914e-10  0.000479585    -0.108408 -1.82909e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.06386e-11     0.307132  3.89081e-10  3.09325e-10   -0.0516061    2.324e-11 -2.45187e-09  2.79211e-09 -8.22092e-10   0.00104166   -0.0181647 -3.85166e-10   -0.0375718   -0.0103655    0.0421019 -2.00461e-11  1.91514e-10  7.20733e-12 -5.01635e-10 -6.19229e-10    -0.108408 -0.000479585 -1.68373e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.79834e-10  3.89081e-10     0.320605  -0.00928973 -1.39935e-11 -3.03729e-11   -0.0131742    0.0131742  -0.00491267  1.46114e-10 -1.02558e-10  -0.00209295 -1.21327e-11 -2.07227e-10  1.19219e-10 -7.51551e-12   -0.0470675   0.00129693   -0.0025555   -0.0151829 -9.88595e-10  3.13992e-10   -0.0254859          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.20074e-10  3.09325e-10  -0.00928973     0.320605 -2.23493e-11 -4.35098e-10   -0.0131742    0.0131742  -0.00491267  1.66388e-10 -1.48466e-10  -0.00209295  7.92376e-12 -1.82346e-10  1.27805e-11  4.05417e-10  -0.00129693    0.0470675   -0.0151829   -0.0025555  -9.6464e-10 -2.06165e-10   -0.0254859          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   2.324e-11   -0.0516061 -1.39935e-11 -2.23493e-11     0.490902 -2.83796e-12 -1.49001e-09  1.08529e-09 -6.28852e-10 -0.000770776     0.013441 -1.85913e-10  -0.00770598  -0.00212595    0.0309987  6.61876e-11  4.61109e-11 -3.03103e-10 -2.08187e-10 -6.15512e-11    0.0531267  0.000235027 -2.09509e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0516061    2.324e-11 -3.03729e-11 -4.35098e-10 -2.83795e-12     0.490902   -9.289e-11  1.01246e-10 -6.25438e-11    -0.013441 -0.000770776  5.24264e-12  -0.00212595   0.00770598  6.61875e-11    0.0309987  1.53794e-10 -7.15835e-12 -8.27064e-11  1.74285e-10 -0.000235027    0.0531267 -4.45846e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.11677e-09 -2.45187e-09   -0.0131742   -0.0131742 -1.49001e-09   -9.289e-11     0.549585     -0.21969    0.0856687  1.43327e-11  7.24901e-10    0.0364976  8.34471e-10  2.62274e-09  6.31699e-10  2.54399e-10   -0.0113219  -0.00130544   -0.0126979    0.0330727  1.34036e-08 -8.26993e-09   0.00154661          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.03701e-09  2.79211e-09    0.0131742    0.0131742  1.08529e-09  1.01246e-10     -0.21969     0.549585   -0.0856687  -6.0241e-11 -7.45175e-10   -0.0364976 -8.59353e-10 -2.60268e-09 -2.18766e-10 -1.47961e-10  -0.00130544   -0.0113219   -0.0330727    0.0126979 -1.39173e-08  8.24243e-09  -0.00154661          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.87661e-10 -8.22092e-10  -0.00491267  -0.00491267 -6.28852e-10 -6.25438e-11    0.0856687   -0.0856687     0.662947  1.80021e-10  5.81849e-10  -0.00632525  2.93328e-10  7.01702e-10  3.36771e-10  9.71581e-11  -0.00131302   0.00131302   0.00387796   0.00387796  4.33976e-09 -3.05352e-09   0.00112637          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0181647   0.00104166  1.46114e-10  1.66388e-10 -0.000770776    -0.013441  1.43327e-11  -6.0241e-11  1.80021e-10     0.680922 -1.60226e-12 -8.83658e-11 -2.69991e-05   7.9741e-05  0.000494472   0.00862276 -3.87324e-10 -1.46667e-13 -8.09523e-11 -8.90397e-10  -0.00216764   -0.0409702  6.68863e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  0.00104166   -0.0181647 -1.02558e-10 -1.48466e-10     0.013441 -0.000770776  7.24901e-10 -7.45175e-10  5.81849e-10 -1.60227e-12     0.680922 -6.20485e-11   7.9741e-05  2.69991e-05  -0.00862276  0.000494472  4.19772e-12 -8.13642e-10 -3.78073e-10   9.3971e-12    0.0409702  -0.00216764 -8.09465e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.10464e-10 -3.85166e-10  -0.00209295  -0.00209295 -1.85913e-10  5.24264e-12    0.0364976   -0.0364976  -0.00632525 -8.83658e-11 -6.20485e-11      0.79826  -1.1917e-11  3.26486e-10 -1.10195e-10  5.77001e-11  -0.00464207   0.00464207    0.0137102    0.0137102  1.73227e-09  -9.7573e-10  0.000446535          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0103655   -0.0375718 -1.21327e-11  7.92376e-12  -0.00770598  -0.00212595  8.34471e-10 -8.59353e-10  2.93328e-10 -2.69991e-05   7.9741e-05  -1.1917e-11     0.956418 -4.28057e-11    0.0126689   0.00349515 -1.23819e-10  2.37455e-10  6.54803e-10  4.32434e-10   -0.0192779  -0.00541034 -6.71552e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0375718   -0.0103655 -2.07227e-10 -1.82346e-10  -0.00212595   0.00770598  2.62274e-09 -2.60268e-09  7.01702e-10   7.9741e-05  2.69991e-05  3.26486e-10 -4.28056e-11     0.956418   0.00349515   -0.0126689 -4.23125e-10  6.45494e-10  1.49159e-09  1.60522e-09  -0.00541034    0.0192779  8.93021e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.00461e-11    0.0421019  1.19219e-10  1.27805e-11    0.0309987  6.61875e-11  6.31699e-10 -2.18766e-10  3.36771e-10  0.000494472  -0.00862276 -1.10195e-10    0.0126689   0.00349515     0.988566  3.74309e-11  2.91774e-11 -1.10966e-10  3.58157e-11 -6.17033e-11   -0.0223628 -9.89308e-05 -3.29952e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0421019 -2.00461e-11 -7.51551e-12  4.05417e-10  6.61876e-11    0.0309987  2.54399e-10 -1.47961e-10  9.71581e-11   0.00862276  0.000494472  5.77001e-11   0.00349515   -0.0126689  3.74309e-11     0.988566 -7.00099e-12  -9.0518e-11  6.74985e-11  1.49288e-10  9.89309e-05   -0.0223628 -1.73216e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.08388e-10  1.91514e-10   -0.0470675  -0.00129693  4.61109e-11  1.53794e-10   -0.0113219  -0.00130544  -0.00131302 -3.87324e-10  4.19772e-12  -0.00464207 -1.23819e-10 -4.23125e-10  2.91774e-11 -7.00099e-12      1.03318  -0.00654148   -0.0132123   -0.0132123 -8.23777e-10  5.52271e-10   0.00427724          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 9.07934e-11  7.20733e-12   0.00129693    0.0470675 -3.03103e-10 -7.15835e-12  -0.00130544   -0.0113219   0.00131302 -1.46667e-13 -8.13642e-10   0.00464207  2.37455e-10  6.45494e-10 -1.10966e-10  -9.0518e-11  -0.00654148      1.03318    0.0132123    0.0132123  7.77131e-10 -4.50353e-10  -0.00427724          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.57861e-10 -5.01635e-10   -0.0025555   -0.0151829 -2.08187e-10 -8.27064e-11   -0.0126979   -0.0330727   0.00387796 -8.09523e-11 -3.78073e-10    0.0137102  6.54803e-10  1.49159e-09  3.58157e-11  6.74985e-11   -0.0132123    0.0132123      1.06773    0.0410901  2.36757e-09 -1.58746e-09   0.00203898          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  1.5914e-10 -6.19229e-10   -0.0151829   -0.0025555 -6.15512e-11  1.74285e-10    0.0330727    0.0126979   0.00387796 -8.90397e-10   9.3971e-12    0.0137102  4.32434e-10  1.60522e-09 -6.17033e-11  1.49288e-10   -0.0132123    0.0132123    0.0410901      1.06773  2.46858e-09 -1.54026e-09   0.00203898          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-0.000332883    0.0752465   6.8743e-10  7.32348e-10   -0.0690159  0.000305319 -8.05794e-09  8.33554e-09  -3.1633e-09   0.00163546   -0.0309116 -1.54305e-09   0.00866844    0.0024328    0.0364086 -0.000161068  5.57223e-10 -5.56662e-10 -1.77575e-09 -1.77925e-09    -0.194424  2.21783e-10 -4.21831e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0752465  0.000332883  1.10257e-12  2.85424e-10 -0.000305319   -0.0690159  5.49067e-09 -5.53323e-09  2.38408e-09    0.0309116   0.00163546   8.8711e-10    0.0024328  -0.00866844  0.000161068    0.0364086 -4.80582e-10  4.76337e-10  1.28125e-09   1.2798e-09  2.21783e-10    -0.194424 -5.54368e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.99131e-10  5.29775e-10   -0.0141894   -0.0141894 -3.68892e-10 -5.51693e-10  -0.00432397   0.00432397   -0.0013121  1.02977e-09 -1.08959e-09 -0.000526068  8.35316e-11 -8.18269e-11  4.06958e-11  2.51661e-10   0.00597686  -0.00597686   0.00150149   0.00150149 -4.42863e-09 -5.45763e-09     0.958309          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "    0.093811 -1.36173e-11  9.61554e-11  3.20855e-10  1.42922e-11   -0.0328898  4.68302e-10 -4.11334e-10  2.38546e-10    0.0155317  0.000890664  6.35469e-11   -0.0128529    0.0465882 -2.32902e-11    0.0481429 -2.59214e-10  1.01328e-10  3.59609e-10  8.42237e-11  0.000111074   -0.0251078   4.9049e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.36173e-11     0.093811  2.01255e-10  1.44287e-10   -0.0328898  1.42922e-11 -9.67722e-10  1.19242e-09 -5.07308e-10  0.000890664   -0.0155317  -2.5484e-10   -0.0465882   -0.0128529    0.0481429 -2.32902e-11  1.64343e-10  1.11042e-10 -4.29757e-10 -5.87643e-10   -0.0251078 -0.000111074  5.38519e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 9.61554e-11  2.01255e-10      0.10587  -0.00531146 -1.86458e-11 -2.58761e-11  -0.00667402   0.00667402  -0.00361259   1.3614e-10 -8.75706e-11  -0.00164104 -2.42371e-11 -2.29997e-10  1.50966e-10 -1.30671e-11   -0.0640706   0.00171305  -0.00245378   -0.0196572 -7.99156e-11  1.94527e-10   -0.0418871         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.20855e-10  1.44287e-10  -0.00531146      0.10587 -2.22016e-11  -3.1539e-10  -0.00667402   0.00667402  -0.00361259  1.60333e-10 -1.30146e-10  -0.00164104  2.64613e-12 -1.93154e-10  9.17037e-12  5.05895e-10  -0.00171305    0.0640706   -0.0196572  -0.00245378 -5.32444e-12 -4.78955e-11   -0.0418871         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.42922e-11   -0.0328898 -1.86458e-11 -2.22016e-11     0.240891  -6.6654e-13 -9.44028e-10  6.54515e-10 -5.49398e-10 -0.000828309    0.0144443 -1.60932e-10  -0.00881414  -0.00243168    0.0441772  9.20068e-11  4.10356e-11 -4.24906e-10 -2.15403e-10 -1.15467e-11  -0.00438142 -1.93829e-05 -5.21185e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0328898  1.42922e-11 -2.58761e-11  -3.1539e-10 -6.66528e-13     0.240891 -4.37205e-11  4.72764e-11 -4.46838e-11   -0.0144443 -0.000828309  1.06021e-11  -0.00243168   0.00881414  9.20068e-11    0.0441772  2.23137e-10 -1.92807e-11 -1.02575e-10  2.81295e-10  1.93829e-05  -0.00438142 -4.88416e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.68302e-10 -9.67722e-10  -0.00667402  -0.00667402 -9.44028e-10 -4.37205e-11     0.221871    -0.110689    0.0629976  1.79157e-11  5.48439e-10     0.028617  1.00128e-09  2.90109e-09   7.9448e-10  2.58575e-10   -0.0100564  -0.00714702   -0.0330871    0.0292704  1.48723e-09 -5.30418e-10  -0.00289443         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-4.11334e-10  1.19242e-09   0.00667402   0.00667402  6.54515e-10  4.72764e-11    -0.110689     0.221871   -0.0629976 -6.04909e-11 -5.72632e-10    -0.028617 -1.03812e-09 -2.87421e-09 -2.75517e-10  -1.1678e-10  -0.00714702   -0.0100564   -0.0292704    0.0330871 -1.72929e-09  4.54654e-10   0.00289443         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.38546e-10 -5.07308e-10  -0.00361259  -0.00361259 -5.49398e-10 -4.46838e-11    0.0629976   -0.0629976     0.429278  2.30994e-10  6.84382e-10   -0.0121538    4.221e-10  8.97493e-10  4.70446e-10  1.29902e-10  6.19021e-06 -6.19024e-06 -1.82826e-05 -1.82826e-05  1.01347e-09 -6.37837e-10  5.66266e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0155317  0.000890664   1.3614e-10  1.60333e-10 -0.000828309   -0.0144443  1.79157e-11 -6.04909e-11  2.30994e-10     0.463967 -2.13978e-12 -1.17868e-10 -0.000207427   0.00061263  0.000594005    0.0103585 -6.64435e-10  5.19942e-12  -1.3404e-10 -1.50639e-09    -0.000937   -0.0177101  1.63365e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 0.000890664   -0.0155317 -8.75706e-11 -1.30146e-10    0.0144443 -0.000828309  5.48439e-10 -5.72632e-10  6.84382e-10 -2.13978e-12     0.463967 -1.23373e-10   0.00061263  0.000207427   -0.0103585  0.000594005  2.66114e-11 -1.39896e-09 -6.98231e-10 -3.89949e-11    0.0177101    -0.000937  -1.7828e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.35469e-11  -2.5484e-10  -0.00164104  -0.00164104 -1.60932e-10  1.06021e-11     0.028617    -0.028617   -0.0121538 -1.17868e-10 -1.23373e-10     0.636067  -4.9284e-11  4.09129e-10 -1.95667e-10  8.28088e-11  -0.00671184   0.00671184    0.0198232    0.0198232  9.92501e-11 -2.31509e-12  4.43306e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0128529   -0.0465882 -2.42371e-11  2.64613e-12  -0.00881414  -0.00243168  1.00128e-09 -1.03812e-09    4.221e-10 -0.000207427   0.00061263  -4.9284e-11     0.917068 -7.50461e-11    0.0214886   0.00592836 -2.20505e-10  4.53217e-10  1.22879e-09   7.7663e-10   -0.0223814  -0.00628134  1.02186e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0465882   -0.0128529 -2.29997e-10 -1.93154e-10  -0.00243168   0.00881414  2.90109e-09 -2.87421e-09  8.97493e-10   0.00061263  0.000207427  4.09129e-10 -7.50461e-11     0.917068   0.00592836   -0.0214886 -7.39043e-10   1.1912e-09  2.67331e-09  2.90602e-09  -0.00628134    0.0223814  6.27304e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.32902e-11    0.0481429  1.50966e-10  9.17037e-12    0.0441772  9.20067e-11   7.9448e-10 -2.75517e-10  4.70446e-10  0.000594005   -0.0103585 -1.95667e-10    0.0214886   0.00592836     0.981535  7.21524e-11    5.416e-11 -1.86625e-10   5.4441e-11 -1.35574e-10   0.00424838  1.87944e-05 -2.61189e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481429 -2.32902e-11 -1.30671e-11  5.05895e-10  9.20068e-11    0.0441772  2.58575e-10  -1.1678e-10  1.29902e-10    0.0103585  0.000594005  8.28088e-11   0.00592836   -0.0214886  7.21524e-11     0.981535 -2.92969e-11 -1.60718e-10  1.09382e-10  2.41847e-10 -1.87944e-05   0.00424838  1.75257e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.59214e-10  1.64343e-10   -0.0640706  -0.00171305  4.10356e-11  2.23137e-10   -0.0100564  -0.00714702  6.19021e-06 -6.64435e-10  2.66114e-11  -0.00671184 -2.20505e-10 -7.39043e-10    5.416e-11 -2.92969e-11      1.06903   -0.0127636   -0.0246891   -0.0246891 -3.93868e-10   2.1055e-10    0.0150561         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.01328e-10  1.11042e-10   0.00171305    0.0640706 -4.24906e-10 -1.92807e-11  -0.00714702   -0.0100564 -6.19024e-06  5.19942e-12 -1.39896e-09   0.00671184  4.53217e-10   1.1912e-09 -1.86625e-10 -1.60718e-10   -0.0127636      1.06903    0.0246891    0.0246891  2.18556e-10  1.49392e-12   -0.0150561         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.59609e-10 -4.29757e-10  -0.00245378   -0.0196572 -2.15403e-10 -1.02575e-10   -0.0330871   -0.0292704 -1.82826e-05  -1.3404e-10 -6.98231e-10    0.0198232  1.22879e-09  2.67331e-09   5.4441e-11  1.09382e-10   -0.0246891    0.0246891      1.13359    0.0773227  8.79565e-10 -5.99877e-10   0.00543719         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 8.42237e-11 -5.87643e-10   -0.0196572  -0.00245378 -1.15467e-11  2.81295e-10    0.0292704    0.0330871 -1.82826e-05 -1.50639e-09 -3.89949e-11    0.0198232   7.7663e-10  2.90602e-09 -1.35574e-10  2.41847e-10   -0.0246891    0.0246891    0.0773227      1.13359  1.09084e-09 -4.24741e-10   0.00543719         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  0.00025374   -0.0573567 -4.73125e-10 -4.21166e-10  -0.00347861   1.5389e-05  7.51725e-09  -7.8209e-09  1.20413e-09 -0.000539196    0.0101913  2.34299e-10   -0.0179477  -0.00503701    0.0191591 -8.47581e-05 -9.06665e-11  7.13509e-11 -1.66019e-10  5.19417e-12     0.600541  2.22219e-10 -3.19238e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0573567  -0.00025374   3.4519e-10  4.23806e-11  -1.5389e-05  -0.00347861 -4.34587e-09   4.2925e-09 -7.17353e-10   -0.0101913 -0.000539196 -1.52083e-10  -0.00503701    0.0179477   8.4758e-05    0.0191591 -1.00884e-10  2.71801e-10  3.23801e-11   5.0884e-11  2.22219e-10     0.600541 -5.04365e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.98193e-10  3.36931e-10   -0.0423678   -0.0423678 -5.91186e-10 -4.72967e-10  -0.00286366   0.00286366 -0.000438114  1.50209e-09 -1.61583e-09 -0.000214364  5.06105e-11  4.23013e-11 -3.64373e-10   1.5327e-10    0.0160959   -0.0160959   0.00532485   0.00532485 -3.64903e-09 -5.04796e-09      1.98482         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
