{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2023-02-01T19:24:13.475830Z",
     "iopub.status.busy": "2023-02-01T19:24:13.475459Z",
     "iopub.status.idle": "2023-02-01T19:25:24.289872Z",
     "shell.execute_reply": "2023-02-01T19:25:24.289205Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/votca/issues\r\n",
      "\r\n",
      "xtp_tools, version 2023-dev gitid: 8dbaf94 (compiled Feb  1 2023, 18:57:38)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 Bohr\r\n",
      "... ... \r\n",
      "... ... =========== OPTIMIZATION SUMMARY ================================= \r\n",
      "... ... At iteration  0\r\n",
      "... ...  ---- POSITIONS (Angstrom)   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    +0.0000  +0.0000  +0.0000\r\n",
      "... ...    1    +1.2000  +0.0000  +0.0000\r\n",
      "... ...    Total energy:     -112.26831841 Hartree \r\n",
      "... ...    Trust radius:       0.01889726 Bohr     \r\n",
      "... ...  ---- FORCES (Hartree/Bohr)   \r\n",
      "... ...       central differences   \r\n",
      "... ...       displacement 0.0010 Angstrom   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    -0.1314  -0.0000  -0.0000\r\n",
      "... ...    1    +0.1314  +0.0000  +0.0000A\r\n",
      "     0.30157 -2.39257e-13  4.02246e-11 -2.02848e-11 -1.83827e-13     0.051948  2.19675e-12  2.18878e-12 -7.29696e-13 -0.000128557    0.0176761  2.96749e-13   0.00023628    0.0390246  1.44281e-13   -0.0423787 -1.36747e-12  -1.2644e-12  2.98477e-13 -2.98884e-13  6.46285e-05    -0.107191 -1.70519e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.39281e-13      0.30157   2.1029e-12 -2.11099e-12     0.051948 -1.83733e-13 -2.47846e-10 -2.67786e-10  9.53347e-11    0.0176761  0.000128557 -3.87779e-11   -0.0390246   0.00023628   -0.0423787  1.44272e-13 -5.76511e-14 -5.72917e-14 -3.88024e-11  3.89055e-11    -0.107191 -6.46285e-05 -1.58392e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.02246e-11   2.1029e-12      0.31084    0.0100692 -1.12795e-12  2.44403e-11  -0.00168372  -0.00168372  0.000659148  7.40185e-13  1.10802e-11  -0.00029608  1.00643e-13  -4.6162e-12  1.67447e-13 -5.02997e-11    0.0492358   0.00195727  3.67284e-05  0.000249526 -8.14581e-12 -5.28729e-11   -0.0248138          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.02848e-11 -2.11099e-12    0.0100692      0.31084  1.11818e-12   4.1257e-13   0.00168372   0.00168372 -0.000659148 -8.16867e-13 -1.09709e-12   0.00029608 -1.12738e-13  2.75504e-12 -1.48338e-13 -4.08459e-13  -0.00195727   -0.0492358  0.000249526  3.67284e-05  8.18613e-12  1.21448e-11    0.0248138          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.83828e-13     0.051948 -1.12795e-12  1.11818e-12     0.487116 -3.43055e-14    1.795e-10  1.54647e-10 -8.36839e-11    0.0136231  9.90804e-05  4.01325e-11    0.0082836 -5.01541e-05    0.0302057  5.12768e-13  1.77773e-14  3.14295e-14  2.82838e-11 -2.58455e-11   -0.0548637 -3.30788e-05  4.63513e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "    0.051948 -1.83746e-13  2.44403e-11   4.1257e-13 -3.42768e-14     0.487116 -1.18474e-12 -1.19448e-12  6.39569e-13 -9.90804e-05    0.0136231 -3.06908e-13 -5.01541e-05   -0.0082836  5.12708e-13    0.0302057 -2.31174e-12  1.26614e-13 -2.12471e-13  1.98813e-13  3.30788e-05   -0.0548637  -5.5612e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.19675e-12 -2.47846e-10  -0.00168372   0.00168372    1.795e-10 -1.18474e-12     0.542332     0.221423   -0.0906299 -1.01738e-10  1.22549e-13    0.0407097 -1.29233e-11 -5.34859e-14 -7.33072e-11  1.75228e-13  0.000341889  5.56355e-05   -0.0132978   -0.0339807  1.06722e-09 -7.74226e-12  0.000229775          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.18878e-12 -2.67786e-10  -0.00168372   0.00168372  1.54647e-10 -1.19448e-12     0.221423     0.542332   -0.0906299 -1.11721e-10  4.58638e-14    0.0407097 -1.47845e-11 -4.14476e-14  -2.2599e-11   1.9435e-13  5.56355e-05  0.000341889    0.0339807    0.0132978  1.10723e-09  -7.7023e-12  0.000229775          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-7.29696e-13  9.53347e-11  0.000659148 -0.000659148 -8.36839e-11  6.39569e-13   -0.0906299   -0.0906299     0.660145   6.1527e-11 -2.33508e-14   0.00527337 -3.12109e-12 -5.23605e-15  3.30985e-11 -2.52922e-13 -5.75329e-06 -5.75329e-06  -0.00472246   0.00472246 -3.60911e-10  2.47357e-12  -0.00016208          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-0.000128557    0.0176761  7.40185e-13 -8.16867e-13    0.0136231 -9.90804e-05 -1.01738e-10 -1.11721e-10   6.1527e-11     0.669023  4.39898e-15 -8.25878e-12  9.83198e-06  1.19781e-08  -0.00903043   6.5678e-05 -2.55819e-15 -1.21698e-14 -4.78104e-12   1.0556e-11   -0.0409876  0.000273387 -2.61502e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0176761  0.000128557  1.10802e-11 -1.09709e-12  9.90804e-05    0.0136231  1.22549e-13  4.58639e-14 -2.33508e-14  4.35281e-15     0.669023  3.02137e-15  1.19781e-08 -9.83197e-06  -6.5678e-05  -0.00903043  1.87607e-12  7.65104e-12  1.64574e-15  8.02426e-15 -0.000273387   -0.0409876 -7.91496e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.96749e-13 -3.87779e-11  -0.00029608   0.00029608  4.01325e-11 -3.06908e-13    0.0407097    0.0407097   0.00527337 -8.25878e-12  3.02136e-15     0.793384 -1.18498e-11  -1.8634e-14  3.85095e-12 -2.95492e-14  1.85759e-05  1.85759e-05    0.0152476   -0.0152476  1.38601e-10 -9.47341e-13  6.76627e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  0.00023628   -0.0390246  1.00643e-13 -1.12738e-13    0.0082836 -5.01541e-05 -1.29233e-11 -1.47845e-11 -3.12109e-12  9.83198e-06  1.19781e-08 -1.18498e-11     0.954425 -1.56684e-14   -0.0128942  7.80699e-05   9.0991e-15  3.52282e-15  1.11258e-11   3.3242e-12   -0.0199051  0.000108516  4.53722e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0390246   0.00023628  -4.6162e-12  2.75504e-12 -5.01541e-05   -0.0082836 -5.34859e-14 -4.14476e-14 -5.23608e-15  1.19781e-08 -9.83197e-06  -1.8634e-14 -1.56765e-14     0.954425  7.80699e-05    0.0128942  6.21843e-12 -8.23151e-12  5.35728e-15 -1.08716e-14  0.000108516    0.0199051  6.00275e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.44277e-13   -0.0423787  1.67447e-13 -1.48338e-13    0.0302057  5.12723e-13 -7.33072e-11  -2.2599e-11  3.30985e-11  -0.00903043  -6.5678e-05  3.85095e-12   -0.0128942  7.80699e-05     0.974684  2.89306e-13  7.07311e-14 -3.35681e-14 -1.51503e-11 -3.20143e-12    0.0229107  1.38135e-05 -1.37671e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0423787  1.44263e-13 -5.02997e-11 -4.08459e-13  5.12774e-13    0.0302057  1.75228e-13   1.9435e-13 -2.52922e-13   6.5678e-05  -0.00903043 -2.95492e-14  7.80699e-05    0.0128942  2.89337e-13     0.974684  1.25443e-11 -5.80744e-12  9.35764e-14  1.06724e-14 -1.38135e-05    0.0229107 -5.51619e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.36747e-12 -5.76511e-14    0.0492358  -0.00195727  1.77773e-14 -2.31174e-12  0.000341889  5.56355e-05 -5.75329e-06 -2.55823e-15  1.87607e-12  1.85759e-05   9.0991e-15  6.21843e-12   7.0731e-14  1.25443e-11      1.02179   0.00208418  5.20992e-05 -5.20992e-05  2.43381e-13  8.34189e-12   -0.0047422          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -1.2644e-12 -5.72917e-14   0.00195727   -0.0492358  3.14295e-14  1.26614e-13  5.56355e-05  0.000341889 -5.75329e-06 -1.21698e-14  7.65104e-12  1.85759e-05   3.5228e-15 -8.23151e-12 -3.35681e-14 -5.80744e-12   0.00208418      1.02179  5.20992e-05 -5.20992e-05  2.15639e-13  2.71581e-12   -0.0047422          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.98477e-13 -3.88024e-11  3.67284e-05  0.000249526  2.82838e-11 -2.12471e-13   -0.0132978    0.0339807  -0.00472246 -4.78104e-12  1.64573e-15    0.0152476  1.11258e-11  5.35728e-15 -1.51503e-11  9.35764e-14  5.20992e-05  5.20992e-05      1.06455   -0.0448486  1.50636e-10 -1.04742e-12  7.28264e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.98884e-13  3.89055e-11  0.000249526  3.67284e-05 -2.58455e-11  1.98813e-13   -0.0339807    0.0132978   0.00472246   1.0556e-11  8.02423e-15   -0.0152476   3.3242e-12 -1.08716e-14 -3.20143e-12  1.06724e-14 -5.20992e-05 -5.20992e-05   -0.0448486      1.06455  -1.5619e-10  1.07607e-12 -7.28264e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-4.50004e-05    0.0746367  4.90121e-12 -4.92156e-12     0.069959 -4.21801e-05  -6.2738e-10 -6.46463e-10  2.65824e-10    0.0304414  0.000203044 -1.18742e-10   0.00918472 -5.00722e-05   -0.0362981  2.18851e-05 -1.32279e-13 -1.52239e-13 -1.15494e-10  1.11592e-10    -0.195037  1.48962e-12 -4.70881e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0746367  4.50004e-05  4.46503e-11 -2.49907e-11  4.21801e-05     0.069959  4.58019e-12   4.5616e-12 -1.80608e-12 -0.000203044    0.0304414  8.08656e-13 -5.00722e-05  -0.00918472 -2.18851e-05   -0.0362981  1.67466e-12 -2.11282e-12   7.8279e-13 -7.63552e-13  1.48954e-12    -0.195037 -4.35649e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.96208e-11  5.12782e-13    -0.014102     0.014102 -5.07815e-13  1.12459e-11 -0.000551912 -0.000551912  0.000177486  9.73491e-14  1.93509e-11    -7.47e-05  -2.7176e-16 -6.23477e-12 -1.45238e-13 -4.44167e-11  -0.00610216  -0.00610216 -5.44442e-05  5.44442e-05 -5.84396e-12 -4.38785e-10      0.94225          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0906271 -1.05315e-13  2.37842e-11 -9.47017e-12 -1.12399e-13    0.0326354  9.21603e-13  9.15951e-13  -4.5827e-13 -0.000108124    0.0148666  1.95578e-13  0.000291366    0.0481229  1.65001e-13   -0.0477892 -8.41545e-13 -3.24449e-13  2.25574e-13 -2.28283e-13  1.47569e-05   -0.0244754  2.72436e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.05336e-13    0.0906271  8.82914e-13 -8.88621e-13    0.0326354 -1.12341e-13 -9.71155e-11  -1.1143e-10  5.98673e-11    0.0148666  0.000108124 -2.55571e-11   -0.0481229  0.000291366   -0.0477892   1.6499e-13 -4.19156e-14 -3.92554e-14 -2.93412e-11  2.98583e-11   -0.0244754 -1.47569e-05   3.8861e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.37842e-11  8.82914e-13    0.0997399    0.0055324 -6.68585e-13  1.60531e-11 -0.000824051 -0.000824051  0.000474334   5.2613e-13  1.04383e-11 -0.000230482   7.7867e-15 -4.99371e-12  2.05145e-13 -6.16305e-11    0.0659127   0.00225717  0.000170036  0.000215374 -1.03643e-12 -7.28925e-12   -0.0408439         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-9.47017e-12 -8.88621e-13    0.0055324    0.0997399  6.62101e-13   3.4494e-13  0.000824051  0.000824051 -0.000474334 -6.02747e-13  -4.6218e-13  0.000230482 -2.39047e-14  2.50864e-12 -1.81495e-13 -1.10297e-12  -0.00225717   -0.0659127  0.000215374  0.000170036  1.05644e-12 -1.40993e-11    0.0408439         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.12406e-13    0.0326354 -6.68585e-13  6.62101e-13     0.236919 -1.52061e-14  1.07957e-10  9.15592e-11 -7.17803e-11    0.0143886  0.000104648  3.85663e-11   0.00947386 -5.73607e-05    0.0425853  7.03519e-13  1.49051e-14  3.17432e-14  2.85489e-11 -2.55351e-11   0.00365057  2.20102e-06  1.20659e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0326354 -1.12345e-13  1.60531e-11   3.4494e-13 -1.51751e-14     0.236919 -7.02231e-13 -7.08684e-13  5.48627e-13 -0.000104648    0.0143886 -2.95007e-13 -5.73607e-05  -0.00947386  7.03435e-13    0.0425853 -2.76415e-12  2.49589e-13 -2.13775e-13   1.9693e-13 -2.20102e-06   0.00365057    3.195e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 9.21603e-13 -9.71155e-11 -0.000824051  0.000824051  1.07957e-10 -7.02231e-13     0.213037     0.107765   -0.0652189 -7.23388e-11  1.06822e-13    0.0316903 -1.06096e-13 -3.59045e-14 -8.97843e-11  2.14356e-13  0.000437445  5.20345e-05   -0.0344207   -0.0292349  1.37225e-10 -1.02006e-12 -0.000334544         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 9.15951e-13  -1.1143e-10 -0.000824051  0.000824051  9.15592e-11 -7.08684e-13     0.107765     0.213037   -0.0652189  -8.2315e-11    3.021e-14    0.0316903 -2.59118e-12 -1.98463e-14 -2.70507e-11  2.38012e-13  5.20345e-05  0.000437445    0.0292349    0.0344207   1.5842e-10 -9.98107e-13 -0.000334544         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " -4.5827e-13  5.98673e-11  0.000474334 -0.000474334 -7.17803e-11  5.48627e-13   -0.0652189   -0.0652189     0.424482  6.67833e-11 -2.53857e-14    0.0113321  -1.1292e-11 -1.83171e-14  4.48458e-11 -3.42703e-13 -7.32832e-07 -7.32832e-07 -0.000601529  0.000601529 -8.46648e-11  5.78488e-13 -1.95856e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-0.000108124    0.0148666   5.2613e-13 -6.02747e-13    0.0143886 -0.000104648 -7.23388e-11  -8.2315e-11  6.67833e-11     0.448028  5.70551e-15 -5.53396e-12 -0.000495541 -6.03709e-07   -0.0107667  7.83061e-05  8.07959e-15 -8.85383e-15  1.94416e-12  8.26604e-12   -0.0177611  0.000118467  5.40795e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0148666  0.000108124  1.04383e-11  -4.6218e-13  0.000104648    0.0143886  1.06822e-13  3.02101e-14 -2.53857e-14  5.63995e-15     0.448028  1.96058e-15 -6.03709e-07  0.000495541 -7.83061e-05   -0.0107667   3.2815e-12  1.34917e-11 -9.49686e-16  1.79785e-14 -0.000118467   -0.0177611  1.47344e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.95578e-13 -2.55571e-11 -0.000230482  0.000230482  3.85663e-11 -2.95007e-13    0.0316903    0.0316903    0.0113321 -5.53396e-12  1.96057e-15     0.627711  -1.6612e-11 -2.61243e-14  8.80325e-12 -6.74397e-14  2.66299e-05  2.66299e-05    0.0218586   -0.0218586  1.37208e-11 -8.64052e-14  1.31663e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 0.000291366   -0.0481229   7.7867e-15 -2.39047e-14   0.00947386 -5.73607e-05 -1.06096e-13 -2.59118e-12  -1.1292e-11 -0.000495541 -6.03709e-07  -1.6612e-11     0.913264 -2.74539e-14   -0.0216061  0.000130817  2.26013e-14  1.13581e-14   2.6272e-11  2.87975e-12   -0.0227532  0.000124043   9.3806e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481229  0.000291366 -4.99371e-12  2.50864e-12 -5.73607e-05  -0.00947386 -3.59045e-14 -1.98462e-14 -1.83172e-14 -6.03709e-07  0.000495541 -2.61243e-14  -2.7468e-14     0.913264  0.000130817    0.0216061  1.28124e-11 -1.63393e-11  1.64332e-14 -2.75609e-14  0.000124043    0.0227532  4.45787e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "    1.65e-13   -0.0477892  2.05145e-13 -1.81495e-13    0.0425853  7.03455e-13 -8.97843e-11 -2.70507e-11  4.48458e-11   -0.0107667 -7.83061e-05  8.80325e-12   -0.0216061  0.000130817     0.954146  5.49563e-13  1.18305e-13 -6.98839e-14 -2.56702e-11 -7.44515e-12  -0.00328347 -1.97969e-06 -3.92927e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0477892  1.64974e-13 -6.16305e-11 -1.10297e-12  7.03525e-13    0.0425853  2.14356e-13  2.38012e-13 -3.42703e-13  7.83061e-05   -0.0107667 -6.74397e-14  0.000130817    0.0216061  5.49623e-13     0.954146   2.1152e-11 -1.19634e-11  1.57953e-13  3.01391e-14  1.97969e-06  -0.00328347 -5.04431e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-8.41545e-13 -4.19156e-14    0.0659127  -0.00225717  1.49051e-14 -2.76415e-12  0.000437445  5.20345e-05 -7.32832e-07  8.07952e-15   3.2815e-12  2.66299e-05  2.26013e-14  1.28124e-11  1.18305e-13   2.1152e-11      1.04646   0.00439998  9.67288e-05 -9.67288e-05  1.79137e-13  1.69243e-11   -0.0159306         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.24449e-13 -3.92554e-14   0.00225717   -0.0659127  3.17432e-14  2.49589e-13  5.20345e-05  0.000437445 -7.32832e-07 -8.85384e-15  1.34917e-11  2.66299e-05   1.1358e-14 -1.63393e-11  -6.9884e-14 -1.19634e-11   0.00439998      1.04646  9.67288e-05 -9.67288e-05  1.08965e-13  2.99405e-12   -0.0159306         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.25574e-13 -2.93412e-11  0.000170036  0.000215374  2.85489e-11 -2.13775e-13   -0.0344207    0.0292349 -0.000601529  1.94416e-12 -9.49695e-16    0.0218586   2.6272e-11  1.64332e-14 -2.56702e-11  1.57953e-13  9.67288e-05  9.67288e-05      1.12585   -0.0837975   5.0561e-11 -3.72281e-13  5.52094e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.28283e-13  2.98583e-11  0.000215374  0.000170036 -2.55351e-11   1.9693e-13   -0.0292349    0.0344207  0.000601529  8.26604e-12  1.79784e-14   -0.0218586  2.87975e-12  -2.7561e-14 -7.44515e-12  3.01391e-14 -9.67288e-05 -9.67288e-05   -0.0837975      1.12585 -6.45044e-11  4.42991e-13 -5.52094e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.38108e-05   -0.0560778 -4.35936e-12   4.3866e-12   0.00265972 -1.60362e-06  5.82929e-10  6.11034e-10 -9.01027e-11   -0.0109727 -7.31881e-05   1.8469e-11   -0.0178431  9.72751e-05     -0.01806  1.08889e-05  8.66833e-14 -2.06529e-14 -3.11167e-11  9.89838e-12     0.585022   1.6456e-12  -3.8441e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0560778 -3.38108e-05 -1.91072e-11 -9.10384e-12  1.60362e-06   0.00265972 -4.25541e-12 -4.22708e-12    6.477e-13  7.31881e-05   -0.0109727 -1.37679e-13  9.72751e-05    0.0178431 -1.08889e-05     -0.01806  1.87681e-11 -2.33591e-12  1.75162e-13 -6.78496e-14  1.64559e-12     0.585022 -4.37618e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.04345e-11    3.136e-13   -0.0412946    0.0412946  3.47609e-14  1.34035e-11 -0.000334582 -0.000334582  5.11317e-05  1.18736e-13  1.74502e-12 -2.82267e-05  5.53862e-14  4.63035e-12 -2.64969e-13 -4.93364e-11   -0.0168394   -0.0168394  7.39921e-07  -7.3992e-07 -5.10572e-12 -4.32182e-10        1.948         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.1"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
