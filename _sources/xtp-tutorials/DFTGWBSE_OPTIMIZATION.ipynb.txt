{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2021-07-17T11:51:18.611029Z",
     "iopub.status.busy": "2021-07-17T11:51:18.610454Z",
     "iopub.status.idle": "2021-07-17T11:52:25.846009Z",
     "shell.execute_reply": "2021-07-17T11:52:25.847301Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2022-dev gitid: 6fec8a4 (compiled Jul 17 2021, 11:41:52)\r\n",
      "votca_csg, version 2022-dev gitid: 6fec8a4 (compiled Jul 17 2021, 11:25:27)\r\n",
      "votca_tools, version 2022-dev gitid: 6fec8a4 (compiled Jul 17 2021, 11:22:30)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 Bohr\r\n",
      "... ... \r\n",
      "... ... =========== OPTIMIZATION SUMMARY ================================= \r\n",
      "... ... At iteration  0\r\n",
      "... ...  ---- POSITIONS (Angstrom)   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    +0.0000  +0.0000  +0.0000\r\n",
      "... ...    1    +1.2000  +0.0000  +0.0000\r\n",
      "... ...    Total energy:     -112.26831841 Hartree \r\n",
      "... ...    Trust radius:       0.01889726 Bohr     \r\n",
      "... ...  ---- FORCES (Hartree/Bohr)   \r\n",
      "... ...       central differences   \r\n",
      "... ...       displacement 0.0010 Angstrom   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    -0.1314  -0.0000  -0.0000\r\n",
      "... ...    1    +0.1314  +0.0000  +0.0000A\r\n",
      "    0.300728 -2.87933e-15  1.74789e-14 -1.66161e-14   -0.0519964   5.4058e-16  2.62776e-11   2.6538e-11  1.38487e-11   -0.0175948 -1.04245e-05  4.57132e-12   -0.0390309 -0.000325813   -0.0424178  3.20905e-16 -3.05159e-14  2.78971e-14  3.59935e-12  3.93698e-12    -0.107004  1.10261e-05  1.22034e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.87265e-15     0.300728  2.04425e-12  -2.3046e-12  5.94999e-16   -0.0519964 -1.29124e-14 -1.19682e-14  -5.6157e-15  1.04245e-05   -0.0175948 -2.03062e-15  0.000325813   -0.0390309  3.65202e-16   -0.0424178 -5.55246e-13  2.17644e-13 -3.11559e-15 -5.72277e-15 -1.10261e-05    -0.107004  1.40173e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.74788e-14  2.04425e-12     0.309472    0.0100867 -1.60618e-15 -1.27567e-12  0.000137258  0.000137258  5.41426e-05 -1.15216e-14  2.21031e-12  2.44907e-05 -6.77612e-15  3.11929e-13  4.70652e-15  4.10705e-13    -0.049191   0.00194361  4.96893e-06 -0.000389432 -1.02291e-13 -1.98021e-12    0.0247319          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.66161e-14  -2.3046e-12    0.0100867     0.309472  5.15918e-16  4.93617e-13 -0.000137258 -0.000137258 -5.41426e-05  1.04926e-14   3.5517e-14 -2.44907e-05   7.5511e-15 -3.85593e-13 -3.93111e-15  3.84625e-12   0.00194361    -0.049191  0.000389432 -4.96893e-06  1.01147e-13  2.47793e-12   -0.0247319          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0519964  5.95688e-16 -1.60612e-15  5.15914e-16     0.486555 -1.61707e-15 -7.14549e-13  6.75254e-14 -7.49833e-13     0.013646  8.08489e-06  1.84633e-12   -0.0083281 -6.95193e-05   -0.0300841 -3.45594e-15 -7.46496e-15  1.09497e-14  1.39998e-12  9.69295e-13    0.0551239 -5.68017e-06   2.2563e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.36707e-16   -0.0519964 -1.27567e-12  4.93617e-13  -1.6107e-15     0.486555  1.84027e-15  7.08214e-16  5.09107e-16 -8.08489e-06     0.013646 -4.40517e-16  6.95193e-05   -0.0083281 -3.43981e-15   -0.0300841  4.44202e-13 -1.35546e-14 -3.74678e-16  3.11049e-15  5.68017e-06    0.0551239 -1.09304e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.62776e-11 -1.29124e-14  0.000137258 -0.000137258 -7.14549e-13  1.84027e-15     0.541142     0.221583     0.091384 -1.67023e-11 -4.20714e-15    0.0413364  -7.5811e-12 -6.07805e-14  1.06821e-11 -2.09377e-15 -0.000261164 -0.000133237   -0.0134223    0.0338251 -1.59951e-10  8.87511e-14  0.000360069          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  2.6538e-11 -1.19682e-14  0.000137258 -0.000137258  6.75254e-14  7.08179e-16     0.221583     0.541142     0.091384 -1.89482e-11 -5.28741e-15    0.0413364 -7.50735e-12 -5.99794e-14   6.4251e-12  -1.3744e-15  0.000133237  0.000261164    0.0338251   -0.0134223 -1.60458e-10  8.73947e-14  0.000360069          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.38487e-11 -5.61587e-15  5.41426e-05 -5.41426e-05 -7.49833e-13  5.09108e-16     0.091384     0.091384     0.659711 -9.57981e-12  -1.6965e-15  -0.00509591 -3.48548e-13 -2.63812e-15  3.26999e-12 -1.10646e-15  -3.7377e-05   3.7377e-05    0.0048197    0.0048197 -6.45648e-11  3.43638e-14  0.000150685          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0175948  1.04245e-05 -1.15216e-14  1.04925e-14     0.013646 -8.08489e-06 -1.67023e-11 -1.89482e-11 -9.57981e-12     0.667191 -9.72497e-16 -2.33181e-12 -2.39766e-05  -1.8594e-07   0.00908945 -5.38526e-06  2.44042e-14 -8.83899e-16 -2.15698e-13 -3.16772e-12    0.0409784 -2.85012e-05 -1.72064e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.04245e-05   -0.0175948  2.21031e-12  3.55171e-14  8.08489e-06     0.013646 -4.20712e-15 -5.28766e-15 -1.69654e-15 -9.11854e-16     0.667191 -8.33606e-16   1.8594e-07 -2.39766e-05  5.38526e-06   0.00908945  3.38813e-12 -4.36128e-13  2.44468e-15  2.59466e-14  2.85012e-05    0.0409784  4.69624e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.57132e-12 -2.03062e-15  2.44907e-05 -2.44907e-05  1.84634e-12 -4.40686e-16    0.0413364    0.0413364  -0.00509591 -2.33181e-12 -8.33558e-16     0.792641 -2.29409e-12 -1.84577e-14  3.34929e-12 -9.57121e-16 -0.000119117  0.000119117      0.01536      0.01536 -2.10019e-11  1.21517e-14  6.90938e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0390309  0.000325813 -6.77612e-15   7.5511e-15   -0.0083281  6.95193e-05  -7.5811e-12 -7.50735e-12 -3.48548e-13 -2.39766e-05   1.8594e-07 -2.29409e-12     0.954094 -4.16569e-15   -0.0128552  0.000107309  6.65042e-14 -6.65137e-14 -8.38187e-12 -7.44508e-12   -0.0198866  0.000168054 -1.35977e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-0.000325813   -0.0390309  3.11929e-13 -3.85593e-13 -6.95193e-05   -0.0083281 -6.07805e-14 -5.99794e-14 -2.63809e-15  -1.8594e-07 -2.39766e-05 -1.84577e-14 -4.18735e-15     0.954094 -0.000107309   -0.0128552 -1.09949e-12  1.62727e-13 -6.84296e-14 -6.84199e-14 -0.000168054   -0.0198866  4.91943e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0424178  3.90945e-16  4.70644e-15 -3.93108e-15   -0.0300841 -3.43774e-15  1.06821e-11  6.42509e-12  3.26999e-12   0.00908945  5.38526e-06  3.34929e-12   -0.0128552 -0.000107309     0.972602 -8.27798e-17 -1.65293e-14  2.51601e-14  3.17707e-12   2.1542e-12      0.02299 -2.36897e-06  1.96996e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.51426e-16   -0.0424178  4.10705e-13  3.84626e-12 -3.45977e-15   -0.0300841 -2.09373e-15 -1.37457e-15 -1.10646e-15 -5.38526e-06   0.00908945 -9.57117e-16  0.000107309   -0.0128552  -9.5252e-17     0.972602  2.94529e-13  7.28326e-13 -6.92816e-15  1.68055e-15  2.36897e-06      0.02299  4.54769e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.05159e-14 -5.55246e-13    -0.049191   0.00194361 -7.46496e-15  4.44202e-13 -0.000261164  0.000133237  -3.7377e-05  2.44042e-14  3.38813e-12 -0.000119117  6.65042e-14 -1.09949e-12 -1.65293e-14  2.94529e-13      1.02072  -0.00208896 -0.000330788 -0.000330788  1.74115e-13  8.50643e-14  -0.00474854          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.78971e-14  2.17644e-13   0.00194361    -0.049191  1.09497e-14 -1.35546e-14 -0.000133237  0.000261164   3.7377e-05  -8.8388e-16 -4.36128e-13  0.000119117 -6.65137e-14  1.62727e-13  2.51601e-14  7.28326e-13  -0.00208896      1.02072  0.000330788  0.000330788 -1.71907e-13  2.30091e-13   0.00474854          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.59935e-12 -3.11559e-15  4.96893e-06  0.000389432  1.39998e-12 -3.74678e-16   -0.0134223    0.0338251    0.0048197 -2.15698e-13  2.44468e-15      0.01536 -8.38187e-12 -6.84296e-14  3.17707e-12 -6.92815e-15 -0.000330788  0.000330788      1.06337    0.0447409 -2.20699e-11  8.91141e-15 -7.74754e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.93698e-12 -5.72277e-15 -0.000389432 -4.96893e-06  9.69295e-13  3.11048e-15    0.0338251   -0.0134223    0.0048197 -3.16772e-12  2.59466e-14      0.01536 -7.44508e-12 -6.84199e-14   2.1542e-12  1.68055e-15 -0.000330788  0.000330788    0.0447409      1.06337 -2.23892e-11  1.12476e-14 -7.74754e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0745352  7.68037e-06  5.95374e-14 -5.77559e-14   -0.0700995  -7.2233e-06  1.04321e-10  1.03056e-10  5.13787e-11   -0.0303573  -2.1114e-05  1.77496e-11   0.00921168  7.78443e-05   -0.0362794 -3.73836e-06 -1.34469e-13  1.39409e-13  1.81699e-11  1.76269e-11    -0.195077 -1.74586e-14 -3.82216e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-7.68037e-06    0.0745352  3.48968e-12 -2.20655e-12   7.2233e-06   -0.0700995 -4.62638e-14 -4.49476e-14 -2.24231e-14   2.1114e-05   -0.0303573 -7.90019e-15 -7.78443e-05   0.00921168  3.73836e-06   -0.0362794  6.41407e-14  4.80238e-13 -1.36188e-14 -8.63891e-15 -1.74444e-14    -0.195077  4.88027e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 6.57244e-14 -5.99814e-12    0.0140656   -0.0140656 -1.53323e-14  4.10635e-12  0.000338385  0.000338385  0.000136173 -3.77836e-14  5.97374e-12  6.30488e-05  1.36437e-14 -1.50306e-12 -5.44941e-16  1.10869e-12  -0.00609576   0.00609576 -0.000102315 -0.000102315 -9.06594e-13  5.03464e-11     0.939949          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0901503 -1.35462e-15  6.93129e-15 -6.55072e-15   -0.0325949  3.33579e-16  9.86486e-12  1.04003e-11  8.90144e-12   -0.0147607 -8.74534e-06  3.29526e-12   -0.0480892 -0.000401427   -0.0477326  4.06488e-16 -2.28731e-14  1.80044e-14  2.32724e-12  2.93221e-12   -0.0243816  2.51237e-06  7.31022e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.34891e-15    0.0901503  8.55531e-13 -1.39089e-12  3.57119e-16   -0.0325949 -5.16373e-15 -4.73664e-15 -3.60381e-15  8.74534e-06   -0.0147607 -1.46051e-15  0.000401427   -0.0480892  4.54375e-16   -0.0477326  -9.0264e-13  2.97696e-13 -3.13009e-15 -7.98886e-15 -2.51237e-06   -0.0243816 -5.78955e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.93128e-15  8.55531e-13    0.0988831    0.0055147  -1.1381e-15 -7.47659e-13  6.68225e-05  6.68225e-05   3.8833e-05 -8.53578e-15    2.228e-12  1.90398e-05 -7.59044e-15  2.97528e-13  5.19395e-15  4.99256e-13   -0.0657329   0.00223428 -1.61374e-07  -0.00053022 -1.82198e-14  1.65327e-12    0.0406719         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.55072e-15 -1.39089e-12    0.0055147    0.0988831  3.65404e-16  2.51223e-13 -6.68225e-05 -6.68225e-05  -3.8833e-05   7.4948e-15   1.1577e-13 -1.90398e-05  9.03218e-15 -4.51457e-13 -4.21176e-15  4.74308e-12   0.00223428   -0.0657329   0.00053022  1.61374e-07  1.90872e-14  2.98547e-13   -0.0406719         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0325949  3.58438e-16 -1.13805e-15    3.654e-16     0.236331  -1.4285e-15 -5.42996e-13 -4.65454e-14 -5.64506e-13    0.0143743   8.5164e-06  2.17715e-12  -0.00952437 -7.95053e-05   -0.0423454 -4.55429e-15 -1.07643e-14  1.71884e-14  2.19369e-12  1.41427e-12  -0.00354089  3.64866e-07  1.12059e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.29812e-16   -0.0325949 -7.47659e-13  2.51223e-13 -1.42178e-15     0.236331  1.12843e-15  3.28924e-16  3.74931e-16  -8.5164e-06    0.0143743 -5.81848e-16  7.95053e-05  -0.00952437 -4.53525e-15   -0.0423454  7.77794e-13  1.58342e-15 -8.72764e-16  5.55591e-15 -3.64866e-07  -0.00354089  3.05439e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 9.86486e-12 -5.16375e-15  6.68225e-05 -6.68225e-05 -5.42996e-13  1.12842e-15     0.211669     0.107271    0.0655439 -1.16511e-11 -2.97392e-15    0.0321361 -9.21825e-12 -7.37501e-14  1.20874e-11 -2.28055e-15 -0.000223348 -0.000306711   -0.0345276     0.028971 -1.28313e-11  2.04786e-14  0.000666199         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.04003e-11 -4.73671e-15  6.68225e-05 -6.68225e-05 -4.65454e-14  3.28882e-16     0.107271     0.211669    0.0655439 -1.39949e-11 -4.06095e-15    0.0321361 -9.06422e-12 -7.22789e-14  6.84499e-12 -1.36855e-15  0.000306711  0.000223348     0.028971   -0.0345276 -1.47695e-11  2.03541e-14  0.000666199         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 8.90144e-12 -3.60398e-15   3.8833e-05  -3.8833e-05 -5.64506e-13  3.74942e-16    0.0655439    0.0655439     0.423732 -9.92954e-12 -1.62292e-15   -0.0111903 -3.58481e-13 -2.57997e-15  4.01425e-12 -1.34799e-15 -5.40449e-06  5.40449e-06  0.000696899  0.000696899 -1.32716e-11  1.22182e-14   0.00030455         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0147607  8.74534e-06 -8.53577e-15  7.49472e-15    0.0143743  -8.5164e-06 -1.16511e-11 -1.39949e-11 -9.92954e-12     0.445598  -1.2727e-15  -2.2032e-12  0.000472779  3.66642e-06    0.0108238 -6.41281e-06  2.78208e-14  1.16373e-14  1.33201e-12 -3.61886e-12    0.0177641 -1.23552e-05 -5.58583e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-8.74534e-06   -0.0147607    2.228e-12   1.1577e-13   8.5164e-06    0.0143743 -2.97395e-15 -4.06124e-15 -1.62299e-15 -1.19248e-15     0.445598  -9.2076e-16 -3.66642e-06  0.000472779  6.41281e-06    0.0108238  5.63062e-12 -6.79798e-13  4.11021e-15  4.35426e-14  1.23552e-05    0.0177641  8.45624e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.29526e-12  -1.4605e-15  1.90398e-05 -1.90398e-05  2.17715e-12 -5.82062e-16    0.0321361    0.0321361   -0.0111903  -2.2032e-12 -9.20682e-16     0.626438  -3.5435e-12  -2.8501e-14   5.0495e-12 -1.44823e-15 -0.000170535  0.000170535    0.0219902    0.0219902 -2.74021e-12  4.27484e-15  0.000146334         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0480892  0.000401427 -7.59044e-15  9.03218e-15  -0.00952437  7.95053e-05 -9.21825e-12 -9.06422e-12 -3.58481e-13  0.000472779 -3.66642e-06  -3.5435e-12     0.912633 -6.32909e-15   -0.0215001  0.000179473  1.24571e-13 -1.24604e-13 -1.56869e-11 -1.37926e-11    -0.022678  0.000191643 -5.67571e-15         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-0.000401427   -0.0480892  2.97528e-13 -4.51457e-13 -7.95053e-05  -0.00952437 -7.37501e-14 -7.22789e-14 -2.57993e-15  3.66642e-06  0.000472779  -2.8501e-14 -6.36618e-15     0.912633 -0.000179473   -0.0215001 -2.21079e-12  3.16536e-13 -1.28095e-13 -1.28092e-13 -0.000191643    -0.022678 -1.04305e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0477326  4.85371e-16  5.19385e-15 -4.21172e-15   -0.0423454 -4.53314e-15  1.20874e-11  6.84499e-12  4.01425e-12    0.0108238  6.41281e-06   5.0495e-12   -0.0215001 -0.000179473     0.950071  -2.8467e-16 -2.83156e-14   4.4151e-14  5.57786e-12  3.69901e-12  -0.00314125  3.23686e-07   2.8544e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.46058e-16   -0.0477326  4.99256e-13  4.74308e-12 -4.55912e-15   -0.0423454 -2.28051e-15 -1.36879e-15   -1.348e-15 -6.41281e-06    0.0108238 -1.44823e-15  0.000179473   -0.0215001 -3.07304e-16     0.950071  6.90327e-13  1.18851e-12 -1.14949e-14  4.29996e-15 -3.23686e-07  -0.00314125  2.13954e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.28731e-14  -9.0264e-13   -0.0657329   0.00223428 -1.07643e-14  7.77794e-13 -0.000223348  0.000306711 -5.40449e-06  2.78208e-14  5.63062e-12 -0.000170535  1.24571e-13 -2.21079e-12 -2.83156e-14  6.90327e-13      1.04427  -0.00440349 -0.000613535 -0.000613535  6.50248e-14     4.63e-13   -0.0159169         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.80044e-14  2.97696e-13   0.00223428   -0.0657329  1.71884e-14  1.58341e-15 -0.000306711  0.000223348  5.40449e-06  1.16373e-14 -6.79798e-13  0.000170535 -1.24604e-13  3.16536e-13   4.4151e-14  1.18851e-12  -0.00440349      1.04427  0.000613535  0.000613535 -5.39168e-14   8.9472e-13    0.0159169         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.32724e-12 -3.13009e-15 -1.61374e-07   0.00053022  2.19369e-12 -8.72771e-16   -0.0345276     0.028971  0.000696899  1.33201e-12  4.11021e-15    0.0219902 -1.56869e-11 -1.28095e-13  5.57786e-12 -1.14949e-14 -0.000613535  0.000613535      1.12338    0.0835131 -6.46511e-12  -6.0908e-15  -0.00027053         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.93221e-12 -7.98886e-15  -0.00053022  1.61374e-07  1.41427e-12   5.5559e-15     0.028971   -0.0345276  0.000696899 -3.61886e-12  4.35427e-14    0.0219902 -1.37926e-11 -1.28092e-13  3.69901e-12  4.29994e-15 -0.000613535  0.000613535    0.0835131      1.12338 -7.82686e-12  5.21964e-15  -0.00027053         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0558853 -5.75862e-06   -5.848e-14   5.8641e-14  -0.00253709  -2.6143e-07 -8.10193e-11 -8.25892e-11 -1.27474e-11    0.0110902  7.71342e-06 -3.12635e-12   -0.0177222 -0.000149763   -0.0178963  -1.8441e-06 -1.65397e-14  2.53574e-14  3.67336e-12  2.60089e-12     0.582693  1.77828e-14 -7.41881e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 5.75862e-06   -0.0558853  9.27619e-13  6.48187e-13   2.6143e-07  -0.00253709  5.28011e-14  5.24805e-14  1.13833e-14 -7.71342e-06    0.0110902  4.19181e-15  0.000149763   -0.0177222   1.8441e-06   -0.0178963  5.63383e-15  1.06243e-12 -1.21895e-14 -3.04019e-15  1.77927e-14     0.582693  5.82361e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 5.70507e-14 -5.49126e-12    0.0411183   -0.0411183  1.10277e-14  3.67518e-12   0.00060725   0.00060725  0.000282398 -5.34792e-14  9.76092e-12  0.000136391  1.60063e-15 -1.51279e-12  2.17152e-14  3.07468e-12   -0.0168193    0.0168193 -0.000279487 -0.000279487 -1.22867e-12  6.14137e-11      1.94187         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.9.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
