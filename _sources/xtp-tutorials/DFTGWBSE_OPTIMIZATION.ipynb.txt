{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2021-10-14T15:38:17.246390Z",
     "iopub.status.busy": "2021-10-14T15:38:17.245893Z",
     "iopub.status.idle": "2021-10-14T15:38:31.943683Z",
     "shell.execute_reply": "2021-10-14T15:38:31.944502Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2022-dev gitid: 297230b (compiled Oct 14 2021, 15:29:39)\r\n",
      "votca_csg, version 2022-dev gitid: 297230b (compiled Oct 14 2021, 15:15:14)\r\n",
      "votca_tools, version 2022-dev gitid: 297230b (compiled Oct 14 2021, 15:13:08)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 BohrA\r\n",
      "    0.307132 -3.05413e-11  1.80089e-10   5.2033e-10  2.31707e-11   -0.0516061   1.1162e-09 -1.03645e-09  3.87503e-10    0.0181649   0.00103848   1.1039e-10   -0.0103934    0.0375641 -1.99869e-11    0.0421019 -2.08445e-10  9.09948e-11  3.57711e-10  1.58905e-10  0.000478965    -0.108408 -1.82868e-10   -2.574e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.05412e-11     0.307132  3.88553e-10  3.08801e-10   -0.0516061  2.31707e-11 -2.45214e-09  2.79238e-09 -8.22166e-10   0.00103848   -0.0181649 -3.85187e-10   -0.0375641   -0.0103934    0.0421019 -1.99869e-11  1.91904e-10  6.90239e-12 -5.01705e-10 -6.19155e-10    -0.108408 -0.000478965 -1.68126e-11  2.98939e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.80089e-10  3.88553e-10       0.3206  -0.00929434 -1.41711e-11 -3.03935e-11   -0.0131341    0.0131341  -0.00489768  1.46128e-10 -1.02425e-10  -0.00208656 -1.18677e-11 -2.06779e-10  1.19251e-10 -7.46863e-12   -0.0470587   0.00129747  -0.00255045   -0.0152118 -9.86192e-10  3.12358e-10    -0.025485    0.0212027          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  5.2033e-10  3.08801e-10  -0.00929434       0.3206 -2.25333e-11 -4.35118e-10   -0.0131341    0.0131341  -0.00489768  1.66393e-10 -1.48337e-10  -0.00208656  8.16961e-12 -1.81881e-10  1.28202e-11  4.05466e-10  -0.00129747    0.0470587   -0.0152118  -0.00255045 -9.62249e-10   -2.078e-10    -0.025485   -0.0212027          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.31707e-11   -0.0516061 -1.41711e-11 -2.25333e-11     0.490902 -2.82531e-12 -1.48999e-09  1.08527e-09 -6.28841e-10 -0.000768423    0.0134412 -1.85914e-10   -0.0077044  -0.00213168    0.0309987  6.59868e-11  4.61188e-11 -3.03217e-10 -2.08004e-10 -6.15545e-11    0.0531267  0.000234724  -2.0937e-10 -3.29789e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0516061  2.31707e-11 -3.03935e-11 -4.35118e-10 -2.82536e-12     0.490902 -9.30943e-11  1.01456e-10 -6.26649e-11   -0.0134412 -0.000768423  5.20672e-12  -0.00213168    0.0077044  6.59868e-11    0.0309987  1.53709e-10 -7.25944e-12 -8.27398e-11  1.74358e-10 -0.000234724    0.0531267 -4.46654e-11  1.26362e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  1.1162e-09 -2.45214e-09   -0.0131341   -0.0131341 -1.48999e-09 -9.30943e-11     0.549589    -0.219695    0.0856696  1.42907e-11  7.24928e-10    0.0364979  8.33024e-10  2.62323e-09  6.31651e-10  2.54442e-10   -0.0113405  -0.00132089   -0.0126945    0.0330667  1.34052e-08  -8.2674e-09   0.00153981  -0.00569938          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.03645e-09  2.79238e-09    0.0131341    0.0131341  1.08527e-09  1.01456e-10    -0.219695     0.549589   -0.0856696 -6.02027e-11 -7.45193e-10   -0.0364979 -8.57921e-10 -2.60319e-09 -2.18715e-10 -1.48011e-10  -0.00132089   -0.0113405   -0.0330667    0.0126945 -1.39189e-08   8.2399e-09  -0.00153981  -0.00569937          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.87503e-10 -8.22166e-10  -0.00489768  -0.00489768 -6.28841e-10 -6.26649e-11    0.0856696   -0.0856696     0.662947  1.80011e-10  5.81853e-10  -0.00632525  2.92942e-10  7.01863e-10  3.36753e-10  9.72229e-11  -0.00131522   0.00131522   0.00387721   0.00387721  4.34029e-09 -3.05271e-09   0.00112212 -2.21988e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0181649   0.00103848  1.46128e-10  1.66393e-10 -0.000768423   -0.0134412  1.42907e-11 -6.02027e-11  1.80011e-10     0.680922 -1.59766e-12 -8.83647e-11 -2.70444e-05  7.97257e-05  0.000492963   0.00862284 -3.86831e-10 -1.92536e-13 -8.09524e-11 -8.90609e-10   -0.0021607   -0.0409706  6.68908e-10 -1.01109e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  0.00103848   -0.0181649 -1.02425e-10 -1.48337e-10    0.0134412 -0.000768423  7.24928e-10 -7.45193e-10  5.81853e-10  -1.5974e-12     0.680922   -6.205e-11  7.97257e-05  2.70444e-05  -0.00862284  0.000492963  4.19241e-12 -8.13849e-10 -3.77626e-10  9.39795e-12    0.0409706   -0.0021607 -8.09427e-10 -5.25425e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  1.1039e-10 -3.85187e-10  -0.00208656  -0.00208656 -1.85914e-10  5.20672e-12    0.0364979   -0.0364979  -0.00632525 -8.83647e-11   -6.205e-11      0.79826  -1.2097e-11  3.26479e-10 -1.10206e-10  5.76792e-11  -0.00464986   0.00464986    0.0137076    0.0137076  1.73244e-09 -9.75408e-10  0.000444846 -9.05299e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0103934   -0.0375641 -1.18677e-11  8.16961e-12   -0.0077044  -0.00213168  8.33024e-10 -8.57921e-10  2.92942e-10 -2.70444e-05  7.97257e-05  -1.2097e-11     0.956418 -4.28703e-11    0.0126663   0.00350456 -1.23835e-10  2.37467e-10  6.53848e-10  4.31477e-10   -0.0192739  -0.00542455 -6.82206e-12 -2.98946e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0375641   -0.0103934 -2.06779e-10 -1.81881e-10  -0.00213168    0.0077044  2.62323e-09 -2.60319e-09  7.01863e-10  7.97257e-05  2.70444e-05  3.26479e-10 -4.28702e-11     0.956418   0.00350456   -0.0126663 -4.24102e-10  6.46473e-10  1.49158e-09  1.60521e-09  -0.00542455    0.0192739  8.91577e-11  1.16836e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.99868e-11    0.0421019  1.19251e-10  1.28202e-11    0.0309987  6.59868e-11  6.31651e-10 -2.18715e-10  3.36753e-10  0.000492963  -0.00862284 -1.10206e-10    0.0126663   0.00350456     0.988566   3.7323e-11  2.92121e-11  -1.1093e-10  3.58644e-11  -6.1714e-11   -0.0223628 -9.88031e-05  -3.2996e-10 -3.82715e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0421019 -1.99869e-11 -7.46863e-12  4.05466e-10  6.59868e-11    0.0309987  2.54442e-10 -1.48011e-10  9.72229e-11   0.00862284  0.000492963  5.76792e-11   0.00350456   -0.0126663   3.7323e-11     0.988566 -7.07881e-12 -9.04996e-11  6.75552e-11  1.49273e-10  9.88031e-05   -0.0223628 -1.73273e-10  2.16358e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.08445e-10  1.91904e-10   -0.0470587  -0.00129747  4.61188e-11  1.53709e-10   -0.0113405  -0.00132089  -0.00131522 -3.86831e-10  4.19241e-12  -0.00464986 -1.23835e-10 -4.24102e-10  2.92121e-11 -7.07881e-12       1.0332  -0.00655651   -0.0132319   -0.0132319 -8.25277e-10  5.52993e-10   0.00427647 -7.57398e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 9.09948e-11  6.90239e-12   0.00129747    0.0470587 -3.03217e-10 -7.25944e-12  -0.00132089   -0.0113405   0.00131522 -1.92536e-13 -8.13849e-10   0.00464986  2.37467e-10  6.46473e-10  -1.1093e-10 -9.04996e-11  -0.00655651       1.0332    0.0132319    0.0132319  7.78558e-10  -4.5111e-10  -0.00427647 -7.57406e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.57711e-10 -5.01705e-10  -0.00255045   -0.0152118 -2.08004e-10 -8.27398e-11   -0.0126945   -0.0330667   0.00387721 -8.09524e-11 -3.77626e-10    0.0137076  6.53848e-10  1.49158e-09  3.58644e-11  6.75552e-11   -0.0132319    0.0132319      1.06771     0.041075  2.36741e-09 -1.58677e-09   0.00204019  0.000183741          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.58905e-10 -6.19155e-10   -0.0152118  -0.00255045 -6.15545e-11  1.74358e-10    0.0330667    0.0126945   0.00387721 -8.90609e-10  9.39795e-12    0.0137076  4.31477e-10  1.60521e-09  -6.1714e-11  1.49273e-10   -0.0132319    0.0132319     0.041075      1.06771  2.46839e-09 -1.53949e-09   0.00204019 -0.000183742          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-0.000332453    0.0752465  6.85953e-10  7.30877e-10   -0.0690159  0.000304925   -8.059e-09  8.33659e-09  -3.1637e-09   0.00163023   -0.0309119  -1.5432e-09   0.00866665   0.00243919    0.0364086  -0.00016086  5.58319e-10 -5.57755e-10 -1.77566e-09 -1.77916e-09    -0.194424  2.21063e-10 -4.21702e-09 -5.53077e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0752465  0.000332453   2.2053e-12  2.86526e-10 -0.000304925   -0.0690159  5.48912e-09 -5.53169e-09  2.38349e-09    0.0309119   0.00163023  8.86824e-10   0.00243919  -0.00866665   0.00016086    0.0364086 -4.81205e-10  4.76961e-10  1.28065e-09   1.2792e-09  2.21063e-10    -0.194424 -5.54466e-09  2.71978e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.99204e-10   5.2967e-10   -0.0141904   -0.0141904 -3.68919e-10 -5.51704e-10  -0.00431366   0.00431366  -0.00130912  1.02976e-09 -1.08959e-09 -0.000524927  8.36165e-11 -8.16738e-11  4.06997e-11  2.51645e-10   0.00597542  -0.00597542   0.00150652   0.00150652 -4.42732e-09 -5.45866e-09     0.958296   1.2242e-08          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.90392e-10  1.25414e-10  -0.00590802   0.00590802 -3.07817e-10  1.56923e-12   0.00106365   0.00106364  1.27202e-09 -9.02609e-10 -5.20786e-10  6.44832e-10 -4.10364e-11  2.43052e-10 -9.55417e-11  1.90357e-10  -0.00401014  -0.00401014     0.002402    -0.002402 -5.62719e-10  3.06428e-09   1.2374e-08    0.0958603          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "    0.093811 -1.35737e-11  9.62651e-11  3.20966e-10  1.42494e-11   -0.0328898  4.68056e-10 -4.11092e-10  2.38448e-10    0.0155318  0.000887945  6.34982e-11   -0.0128875    0.0465786 -2.32211e-11    0.0481429 -2.59235e-10  1.01549e-10  3.59466e-10  8.39663e-11  0.000110931   -0.0251078  4.90606e-10 -5.54354e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.35736e-11     0.093811  2.01025e-10   1.4406e-10   -0.0328898  1.42494e-11 -9.67837e-10  1.19254e-09 -5.07354e-10  0.000887945   -0.0155318 -2.54853e-10   -0.0465786   -0.0128875    0.0481429  -2.3221e-11  1.64724e-10  1.10775e-10 -4.29885e-10 -5.87571e-10   -0.0251078 -0.000110931  5.38424e-10  1.56812e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 9.62651e-11  2.01025e-10     0.105868  -0.00531379 -1.87507e-11  -2.5888e-11  -0.00665371   0.00665371  -0.00360157  1.36154e-10 -8.74678e-11  -0.00163603 -2.39282e-11 -2.29507e-10  1.51008e-10 -1.30202e-11   -0.0640582   0.00171342  -0.00244963   -0.0196994 -7.96408e-11  1.94431e-10   -0.0418871    0.0155345         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.20966e-10   1.4406e-10  -0.00531379     0.105868 -2.23112e-11 -3.15401e-10  -0.00665371   0.00665371  -0.00360157  1.60338e-10 -1.30048e-10  -0.00163603  2.92689e-12 -1.92644e-10  9.22105e-12  5.05945e-10  -0.00171342    0.0640582   -0.0196994  -0.00244963 -5.05498e-12 -4.79934e-11   -0.0418871   -0.0155345         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.42494e-11   -0.0328898 -1.87507e-11 -2.23112e-11     0.240891 -6.60659e-13 -9.44017e-10  6.54504e-10  -5.4939e-10 -0.000825781    0.0144445 -1.60934e-10  -0.00881233  -0.00243823    0.0441772  9.17279e-11  4.10028e-11  -4.2502e-10 -2.15148e-10 -1.15713e-11  -0.00438142 -1.93579e-05 -5.21075e-10  -2.9639e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0328898  1.42494e-11  -2.5888e-11 -3.15401e-10 -6.60728e-13     0.240891 -4.38424e-11  4.74028e-11 -4.47895e-11   -0.0144445 -0.000825781   1.0571e-11  -0.00243823   0.00881233  9.17279e-11    0.0441772  2.22992e-10 -1.94144e-11 -1.02602e-10  2.81416e-10  1.93579e-05  -0.00438142 -4.88508e-10  5.79132e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.68056e-10 -9.67837e-10  -0.00665371  -0.00665371 -9.44017e-10 -4.38424e-11     0.221874    -0.110692    0.0629982  1.78777e-11  5.48464e-10    0.0286173  9.99676e-10  2.90167e-09  7.94432e-10  2.58631e-10   -0.0100727  -0.00717703   -0.0330796    0.0292652  1.48734e-09 -5.30121e-10  -0.00289041   -0.0046996         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-4.11092e-10  1.19254e-09   0.00665371   0.00665371  6.54504e-10  4.74028e-11    -0.110692     0.221874   -0.0629982 -6.04574e-11 -5.72648e-10   -0.0286173 -1.03654e-09 -2.87482e-09 -2.75466e-10 -1.16844e-10  -0.00717703   -0.0100727   -0.0292652    0.0330796 -1.72939e-09  4.54362e-10   0.00289041   -0.0046996         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.38448e-10 -5.07354e-10  -0.00360157  -0.00360157  -5.4939e-10 -4.47895e-11    0.0629982   -0.0629982     0.429278  2.30982e-10  6.84386e-10   -0.0121538  4.21606e-10  8.97725e-10  4.70421e-10  1.29992e-10   6.2006e-06 -6.20062e-06 -1.82791e-05 -1.82791e-05  1.01358e-09 -6.37646e-10  5.45187e-05 -5.58291e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0155318  0.000887945  1.36154e-10  1.60338e-10 -0.000825781   -0.0144445  1.78777e-11 -6.04574e-11  2.30982e-10     0.463967 -2.13369e-12 -1.17866e-10 -0.000207775  0.000612512  0.000592192    0.0103586 -6.63602e-10  5.12381e-12 -1.34042e-10 -1.50675e-09 -0.000934001   -0.0177102  1.63369e-09  -1.8586e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 0.000887945   -0.0155318 -8.74678e-11 -1.30048e-10    0.0144445 -0.000825781  5.48464e-10 -5.72648e-10  6.84386e-10 -2.13332e-12     0.463967 -1.23375e-10  0.000612512  0.000207775   -0.0103586  0.000592192  2.66335e-11 -1.39934e-09 -6.97461e-10 -3.89823e-11    0.0177102 -0.000934001 -1.78276e-09 -9.44907e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.34982e-11 -2.54853e-10  -0.00163603  -0.00163603 -1.60934e-10   1.0571e-11    0.0286173   -0.0286173   -0.0121538 -1.17866e-10 -1.23375e-10     0.636067 -4.95097e-11  4.09101e-10 -1.95683e-10  8.27716e-11   -0.0067231    0.0067231    0.0198194    0.0198194   9.9247e-11 -2.29537e-12  4.33295e-05 -1.10305e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0128875   -0.0465786 -2.39282e-11  2.92689e-12  -0.00881233  -0.00243823  9.99676e-10 -1.03654e-09  4.21606e-10 -0.000207775  0.000612512 -4.95097e-11     0.917068 -7.51602e-11    0.0214842   0.00594433 -2.20545e-10   4.5325e-10  1.22706e-09  7.74899e-10   -0.0223768  -0.00629784  1.02095e-10 -7.61031e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0465786   -0.0128875 -2.29507e-10 -1.92644e-10  -0.00243823   0.00881233  2.90167e-09 -2.87482e-09  8.97725e-10  0.000612512  0.000207775  4.09101e-10 -7.51602e-11     0.917068   0.00594433   -0.0214842  -7.4081e-10  1.19297e-09  2.67331e-09  2.90602e-09  -0.00629784    0.0223768  6.26678e-11  4.28307e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " -2.3221e-11    0.0481429  1.51008e-10  9.22105e-12    0.0441772  9.17279e-11  7.94432e-10 -2.75466e-10  4.70421e-10  0.000592192   -0.0103586 -1.95683e-10    0.0214842   0.00594433     0.981535  7.19446e-11  5.42394e-11 -1.86566e-10  5.45238e-11 -1.35588e-10   0.00424838  1.87701e-05 -2.61233e-10  -7.0491e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481429 -2.32211e-11 -1.30202e-11  5.05945e-10  9.17279e-11    0.0441772  2.58631e-10 -1.16844e-10  1.29992e-10    0.0103586  0.000592192  8.27716e-11   0.00594433   -0.0214842  7.19445e-11     0.981535 -2.94216e-11  -1.6069e-10   1.0948e-10  2.41807e-10 -1.87701e-05   0.00424838   1.7519e-10  3.91271e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.59235e-10  1.64724e-10   -0.0640582  -0.00171342  4.10028e-11  2.22992e-10   -0.0100727  -0.00717703   6.2006e-06 -6.63602e-10  2.66335e-11   -0.0067231 -2.20545e-10  -7.4081e-10  5.42394e-11 -2.94216e-11      1.06906   -0.0127917   -0.0247258   -0.0247258 -3.94523e-10  2.10722e-10    0.0150529  -0.00552487         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.01549e-10  1.10775e-10   0.00171342    0.0640582  -4.2502e-10 -1.94144e-11  -0.00717703   -0.0100727 -6.20062e-06  5.12381e-12 -1.39934e-09    0.0067231   4.5325e-10  1.19297e-09 -1.86566e-10  -1.6069e-10   -0.0127917      1.06906    0.0247258    0.0247258  2.19058e-10  1.19519e-12   -0.0150529  -0.00552487         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.59466e-10 -4.29885e-10  -0.00244963   -0.0196994 -2.15148e-10 -1.02602e-10   -0.0330796   -0.0292652 -1.82791e-05 -1.34042e-10 -6.97461e-10    0.0198194  1.22706e-09  2.67331e-09  5.45238e-11   1.0948e-10   -0.0247258    0.0247258      1.13356    0.0772947  8.79544e-10 -5.99713e-10   0.00544576   0.00355337         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 8.39663e-11 -5.87571e-10   -0.0196994  -0.00244963 -1.15713e-11  2.81416e-10    0.0292652    0.0330796 -1.82791e-05 -1.50675e-09 -3.89823e-11    0.0198194  7.74899e-10  2.90602e-09 -1.35588e-10  2.41807e-10   -0.0247258    0.0247258    0.0772947      1.13356  1.09069e-09 -4.24424e-10   0.00544576  -0.00355338         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 0.000253412   -0.0573567 -4.71811e-10 -4.19859e-10  -0.00347861  1.53691e-05  7.51814e-09  -7.8218e-09  1.20428e-09  -0.00053747    0.0101913  2.34333e-10   -0.0179439  -0.00505024    0.0191591 -8.46486e-05 -9.06522e-11   7.1213e-11  -1.6606e-10  5.13933e-12     0.600541   2.2152e-10 -3.19164e-09 -1.17747e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0573567 -0.000253412   3.4435e-10  4.15385e-11 -1.53691e-05  -0.00347861 -4.34447e-09  4.29111e-09 -7.17126e-10   -0.0101913  -0.00053747 -1.52038e-10  -0.00505024    0.0179439  8.46486e-05    0.0191591 -1.00928e-10  2.71831e-10  3.21956e-11   5.0823e-11   2.2152e-10     0.600541 -5.04421e-09  3.67033e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.98294e-10  3.36864e-10   -0.0423679   -0.0423679 -5.91087e-10 -4.73074e-10  -0.00285927   0.00285927 -0.000438635  1.50212e-09 -1.61579e-09 -0.000214535  5.05852e-11  4.23497e-11 -3.64381e-10  1.53185e-10    0.0160924   -0.0160924   0.00533525   0.00533525 -3.64818e-09 -5.04866e-09       1.9848  1.56388e-08         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-5.81064e-10  1.09483e-10    0.0175183   -0.0175183 -2.54363e-10  8.10143e-11  -0.00531848  -0.00531847 -1.20651e-09 -1.78789e-09 -9.48624e-10 -3.74367e-10 -9.60714e-11  4.79981e-10  -9.2236e-11  4.13475e-10  -0.00667258  -0.00667258   0.00416576  -0.00416576 -2.59503e-10  4.14873e-09  1.57572e-08     0.781782         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.9.7"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
