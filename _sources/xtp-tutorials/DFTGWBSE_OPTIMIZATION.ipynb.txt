{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-08-19T06:20:51.819728Z",
     "iopub.status.busy": "2022-08-19T06:20:51.819251Z",
     "iopub.status.idle": "2022-08-19T06:22:08.348688Z",
     "shell.execute_reply": "2022-08-19T06:22:08.349104Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2023-dev gitid: 97a4ed8 (compiled Aug 19 2022, 06:12:41)\r\n",
      "votca_csg, version 2023-dev gitid: 97a4ed8 (compiled Aug 19 2022, 05:57:21)\r\n",
      "votca_tools, version 2023-dev gitid: 97a4ed8 (compiled Aug 19 2022, 05:54:44)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 Bohr\r\n",
      "... ... \r\n",
      "... ... =========== OPTIMIZATION SUMMARY ================================= \r\n",
      "... ... At iteration  0\r\n",
      "... ...  ---- POSITIONS (Angstrom)   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    +0.0000  +0.0000  +0.0000\r\n",
      "... ...    1    +1.2000  +0.0000  +0.0000\r\n",
      "... ...    Total energy:     -112.26831841 Hartree \r\n",
      "... ...    Trust radius:       0.01889726 Bohr     \r\n",
      "... ...  ---- FORCES (Hartree/Bohr)   \r\n",
      "... ...       central differences   \r\n",
      "... ...       displacement 0.0010 Angstrom   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    -0.1314  -0.0000  -0.0000\r\n",
      "... ...    1    +0.1314  +0.0000  +0.0000A\r\n",
      "    0.301149 -1.39368e-12  7.75055e-10 -8.96056e-10  -1.2115e-09 -1.05382e-09   -0.0519724  1.02469e-12 -5.96441e-10   -0.0141646    0.0105064 -2.27606e-10    0.0390246 -0.000571451    0.0423984 -8.09064e-13 -1.53051e-10 -3.08782e-10  1.93593e-10 -4.06306e-10     0.107078   0.00207261 -6.16797e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.39368e-12     0.301149 -1.58598e-10  3.16273e-10 -2.11848e-10 -9.08475e-11   1.0248e-12   -0.0519724  7.80766e-12   -0.0105064   -0.0141646  3.45233e-12 -0.000571451   -0.0390246 -8.09025e-13    0.0423984 -2.09144e-10  3.56858e-12 -1.62383e-10  6.65128e-12   0.00207261    -0.107078 -6.00492e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 7.75055e-10 -1.58598e-10     0.392344   -0.0721108    -0.110814    -0.110814 -1.74438e-10  9.04006e-11   -0.0542173 -3.36389e-11   1.2056e-10   -0.0244398  1.89357e-09 -6.35759e-11  1.18087e-10 -2.97397e-11    0.0362346   -0.0110246    0.0169962   -0.0176883  8.00144e-09  4.15938e-10    0.0241771          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-8.96056e-10  3.16273e-10   -0.0721108     0.392344     0.110814     0.110814  2.18227e-10 -1.45287e-10    0.0542173  3.42222e-11  -1.2586e-10    0.0244398 -1.91333e-09  3.81194e-11 -2.12826e-10  1.52269e-10    0.0110246   -0.0362346   -0.0176883    0.0169962  -8.0903e-09 -5.34145e-10   -0.0241771          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -1.2115e-09 -2.11848e-10    -0.110814     0.110814     0.459547     0.139314  2.95595e-10  1.10679e-10    0.0730951   1.4484e-10 -3.90283e-11    0.0329494  -2.5792e-09 -1.95576e-12 -2.87511e-10 -1.13533e-10     0.016772    0.0174641   -0.0209252   -0.0263339 -1.09115e-08 -1.57345e-10   0.00983472          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.05382e-09 -9.08475e-11    -0.110814     0.110814     0.139314     0.459547  2.40709e-10  6.68913e-11    0.0730951  1.39541e-10 -3.96117e-11    0.0329494 -2.55375e-09 -2.17181e-11 -1.64982e-10 -1.87944e-11    0.0174641     0.016772    0.0263339    0.0209252 -1.07924e-08 -2.46994e-10   0.00983472          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0519724   1.0248e-12 -1.74438e-10  2.18227e-10  2.95595e-10  2.40709e-10     0.486835 -2.42741e-13  1.72842e-10    0.0109511  -0.00812285  3.80702e-11   0.00830517 -0.000121615    0.0301449  2.92675e-12  -9.0818e-11  1.00853e-10  1.26814e-10  1.34837e-10   -0.0549837  -0.00106427  4.05971e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.02469e-12   -0.0519724  9.04006e-11 -1.45287e-10  1.10679e-10  6.68913e-11 -2.42747e-13     0.486835  6.71444e-13   0.00812285    0.0109511  3.74345e-13 -0.000121615  -0.00830517  2.92663e-12    0.0301449  2.69063e-10  7.41123e-12  2.01246e-10 -9.57443e-12  -0.00106427    0.0549837 -2.31811e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-5.96441e-10  7.80766e-12   -0.0542173    0.0542173    0.0730951    0.0730951  1.72842e-10  6.71444e-13     0.659928  2.69244e-10 -2.05748e-10  -0.00518518 -7.77549e-10  4.28429e-12 -1.32471e-10  3.16407e-13   0.00289817   0.00289817  -0.00379002   0.00379002  -5.2487e-09 -1.70628e-10  -0.00256997          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0141646   -0.0105064 -3.36389e-11  3.42222e-11   1.4484e-10  1.39541e-10    0.0109511   0.00812285  2.69244e-10     0.668107  7.23741e-13 -7.86084e-11  1.34362e-05 -1.02745e-05  -0.00727685  -0.00539751 -2.58758e-11 -3.26916e-11  1.08804e-09 -4.35037e-11   -0.0333833    0.0237741 -8.03692e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0105064   -0.0141646   1.2056e-10  -1.2586e-10 -3.90283e-11 -3.96117e-11  -0.00812285    0.0109511 -2.05748e-10  7.23797e-13     0.668107  5.93997e-11 -1.02745e-05 -1.34362e-05   0.00539751  -0.00727685  1.07327e-09  2.87353e-11 -2.52279e-11   1.8412e-11    0.0237741    0.0333833 -1.12621e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.27606e-10  3.45233e-12   -0.0244398    0.0244398    0.0329494    0.0329494  3.80702e-11  3.74346e-13  -0.00518518 -7.86084e-11  5.93997e-11     0.793012 -5.00993e-10  3.68521e-12 -7.51913e-11  8.98461e-13   0.00929639   0.00929639   -0.0121571    0.0121571 -2.00024e-09 -6.68952e-11  -0.00104946          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0390246 -0.000571451  1.89357e-09 -1.91333e-09  -2.5792e-09 -2.55375e-09   0.00830517 -0.000121615 -7.77549e-10  1.34362e-05 -1.02745e-05 -5.00993e-10     0.954263 -3.99712e-13   -0.0128737  0.000188514 -1.22461e-09 -1.11724e-09  1.60197e-09  -1.4608e-09   -0.0198848 -0.000676264   1.2041e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-0.000571451   -0.0390246 -6.35759e-11  3.81194e-11 -1.95576e-12 -2.17181e-11 -0.000121615  -0.00830517  4.28429e-12 -1.02745e-05 -1.34362e-05  3.68521e-12 -3.99706e-13     0.954263  0.000188514    0.0128737 -5.53751e-11  8.57916e-11 -5.70215e-11  -5.0351e-11  0.000676264   -0.0198848 -3.53172e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0423984 -8.09025e-13  1.18087e-10 -2.12826e-10 -2.87511e-10 -1.64982e-10    0.0301449  2.92663e-12 -1.32471e-10  -0.00727685   0.00539751 -7.51913e-11   -0.0128737  0.000188514     0.973645  1.58444e-12 -1.18714e-10 -3.32313e-11  1.59706e-10 -4.16882e-11    0.0229462   0.00044415 -1.75941e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-8.09063e-13    0.0423984 -2.97397e-11  1.52269e-10 -1.13533e-10 -1.87944e-11  2.92675e-12    0.0301449  3.16407e-13  -0.00539751  -0.00727685  8.98461e-13  0.000188514    0.0128737  1.58443e-12     0.973645  1.25897e-10  7.87949e-12  9.28033e-11 -7.32105e-12   0.00044415   -0.0229462 -5.37839e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.53051e-10 -2.09144e-10    0.0362346    0.0110246     0.016772    0.0174641  -9.0818e-11  2.69063e-10   0.00289817 -2.58758e-11  1.07327e-09   0.00929639 -1.22461e-09 -5.53751e-11 -1.18714e-10  1.25897e-10      1.03701    0.0178448   -0.0206092    0.0206092 -1.53116e-09  1.53723e-11   0.00299604          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.08782e-10  3.56858e-12   -0.0110246   -0.0362346    0.0174641     0.016772  1.00853e-10  7.41123e-12   0.00289817 -3.26916e-11  2.87353e-11   0.00929639 -1.11724e-09  8.57916e-11 -3.32313e-11  7.87949e-12    0.0178448      1.03701   -0.0206092    0.0206092 -1.58121e-09  -5.5144e-11   0.00299604          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.93593e-10 -1.62383e-10    0.0169962   -0.0176883   -0.0209252    0.0263339  1.26814e-10  2.01246e-10  -0.00379002  1.08804e-09 -2.52279e-11   -0.0121571  1.60197e-09 -5.70215e-11  1.59706e-10  9.28033e-11   -0.0206092   -0.0206092      1.04821   -0.0290364   1.9962e-09     1.12e-10   0.00432669          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-4.06306e-10  6.65128e-12   -0.0176883    0.0169962   -0.0263339    0.0209252  1.34837e-10 -9.57443e-12   0.00379002 -4.35037e-11   1.8412e-11    0.0121571  -1.4608e-09  -5.0351e-11 -4.16882e-11 -7.32105e-12    0.0206092    0.0206092   -0.0290364      1.04821  -2.0667e-09 -6.19866e-11  -0.00432669          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0745721  -0.00144343 -5.46766e-09  5.48705e-09  7.39831e-09  7.37441e-09    0.0700163   0.00135525  4.11133e-09    0.0247623   -0.0176346  1.74833e-09   0.00919316 -0.000312651    -0.036282 -0.000702279  1.23974e-09  1.26798e-09 -1.61511e-09  1.65582e-09    -0.195058 -8.52513e-12 -3.71821e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -0.00144343    0.0745721 -4.33498e-10  4.57151e-10  3.38589e-11  5.33111e-11   0.00135525   -0.0700163   1.3222e-10   -0.0176346   -0.0247623  5.71289e-11  0.000312651   0.00919316 -0.000702279     0.036282 -4.18938e-11 -1.38843e-12 -1.14272e-10  8.58421e-11  -8.5251e-12    -0.195058 -6.16353e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  1.1761e-11  8.01759e-10   0.00561776  -0.00561776    0.0181373    0.0181373 -5.73435e-11 -6.99966e-10   0.00443665 -1.14302e-09 -1.47637e-09    0.0019058 -1.44511e-10  1.20264e-10  1.84362e-11  3.41326e-11   0.00562461   0.00562461   0.00305169  -0.00305169 -8.29726e-10 -6.32091e-09      1.05415          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0903883 -6.21687e-13   2.8503e-10 -3.61798e-10 -4.89466e-10 -3.89409e-10   -0.0326152  6.28483e-13 -3.69431e-10   -0.0118981   0.00882527 -1.51549e-10    0.0481023 -0.000704378    0.0477611 -9.28649e-13 -1.01478e-10 -3.11575e-10  1.23572e-10 -4.10603e-10    0.0244239  0.000472752 -4.32391e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.21691e-13    0.0903883 -7.73446e-11  1.77401e-10  -1.2315e-10 -4.63824e-11  6.28555e-13   -0.0326152  4.83569e-12  -0.00882527   -0.0118981  2.34183e-12 -0.000704378   -0.0481023 -9.28605e-13    0.0477611 -2.96314e-10 -9.28247e-12 -2.27075e-10  1.69778e-11  0.000472752   -0.0244239  7.66446e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  2.8503e-10 -7.73446e-11     0.139429   -0.0345952   -0.0540916   -0.0540916 -8.41177e-11  6.17876e-11   -0.0389511 -2.42127e-11  1.02156e-10   -0.0190127  2.04054e-09 -7.09518e-11   9.9541e-11 -3.05651e-11    0.0544729  -0.00909912    0.0148687   -0.0157996  4.08022e-10 -8.59867e-11    0.0315056         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.61798e-10  1.77401e-10   -0.0345952     0.139429    0.0540916    0.0540916  1.19035e-10 -1.05858e-10    0.0389511  2.47849e-11 -1.08633e-10    0.0190127 -2.06978e-09  3.33405e-11 -2.21028e-10  1.87861e-10   0.00909912   -0.0544729   -0.0157996    0.0148687 -4.79037e-10 -1.06667e-11   -0.0315056         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-4.89466e-10  -1.2315e-10   -0.0540916    0.0540916     0.172233     0.067399  1.61436e-10  8.09809e-11    0.0525134  1.22614e-10 -2.83481e-11    0.0256327 -2.78983e-09  3.08794e-12 -2.98574e-10  -1.4102e-10     0.014331    0.0152619   -0.0177558   -0.0458162 -6.49812e-10  -3.5971e-11    0.0289947         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.89409e-10 -4.63824e-11   -0.0540916    0.0540916     0.067399     0.172233  1.17366e-10  4.60634e-11    0.0525134  1.16137e-10 -2.89205e-11    0.0256327 -2.75222e-09 -2.61528e-11 -1.41277e-10 -1.95327e-11    0.0152619     0.014331    0.0458162    0.0177558 -5.52503e-10 -1.07672e-10    0.0289947         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0326152  6.28556e-13 -8.41177e-11  1.19035e-10  1.61436e-10  1.17366e-10     0.236624 -1.35985e-13  1.31184e-10     0.011551  -0.00856783  2.26181e-11   0.00949837 -0.000139088    0.0424653  4.01701e-12 -1.62899e-10   1.2295e-10  2.25165e-10  1.65192e-10   0.00359497  6.95848e-05 -5.87738e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.28483e-13   -0.0326152  6.17876e-11 -1.05858e-10  8.09809e-11  4.60634e-11 -1.35989e-13     0.236624  8.23124e-13   0.00856783     0.011551   4.8803e-13 -0.000139088  -0.00949837  4.01685e-12    0.0424653  4.03497e-10  1.31403e-11  3.01631e-10 -1.57819e-11  6.95848e-05  -0.00359497 -8.20077e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.69431e-10  4.83569e-12   -0.0389511    0.0389511    0.0525134    0.0525134  1.31184e-10  8.23124e-13     0.424108  3.29603e-10 -2.51581e-10   -0.0112617 -9.33328e-10  4.66452e-12 -1.79933e-10  4.18448e-13  0.000394373  0.000394373 -0.000515733  0.000515733 -1.09674e-09 -3.93832e-11   0.00123161         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0118981  -0.00882527 -2.42127e-11  2.47849e-11  1.22614e-10  1.16137e-10     0.011551   0.00856783  3.29603e-10     0.446812  9.52523e-13 -1.11947e-10 -0.000384593  0.000294093  -0.00867071  -0.00643139 -4.67709e-11 -5.81222e-11  1.82473e-09 -7.92757e-11   -0.0144688     0.010304 -1.77597e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  0.00882527   -0.0118981  1.02156e-10 -1.08633e-10 -2.83481e-11 -2.89205e-11  -0.00856783     0.011551 -2.51581e-10  9.52602e-13     0.446812  8.48258e-11  0.000294093  0.000384593   0.00643139  -0.00867071  1.79831e-09  5.28552e-11 -4.59092e-11  3.45579e-11     0.010304    0.0144688  -2.3855e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.51549e-10  2.34183e-12   -0.0190127    0.0190127    0.0256327    0.0256327  2.26181e-11   4.8803e-13   -0.0112617 -1.11947e-10  8.48258e-11     0.627074 -6.51482e-10  4.83745e-12 -1.03755e-10  1.33707e-12    0.0133182    0.0133182   -0.0174166    0.0174166 -2.10897e-10   -1.013e-11  0.000508498         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481023 -0.000704378  2.04054e-09 -2.06978e-09 -2.78983e-09 -2.75222e-09   0.00949837 -0.000139088 -9.33328e-10 -0.000384593  0.000294093 -6.51482e-10     0.912954 -7.13037e-13   -0.0215514  0.000315585 -2.19994e-09 -1.98227e-09  2.87786e-09 -2.59166e-09    -0.022703 -0.000772109  5.40303e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-0.000704378   -0.0481023 -7.09518e-11  3.33405e-11  3.08794e-12 -2.61528e-11 -0.000139088  -0.00949837  4.66452e-12  0.000294093  0.000384593  4.83745e-12 -7.13025e-13     0.912954  0.000315585    0.0215514 -1.18906e-10  1.67299e-10 -1.16784e-10 -1.00888e-10  0.000772109    -0.022703  1.06658e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0477611 -9.28607e-13   9.9541e-11 -2.21028e-10 -2.98574e-10 -1.41277e-10    0.0424653  4.01685e-12 -1.79933e-10  -0.00867071   0.00643139 -1.03755e-10   -0.0215514  0.000315585     0.952112  3.01027e-12 -1.95246e-10 -5.08831e-11  2.62805e-10 -6.33737e-11  -0.00321145 -6.21613e-05 -2.53983e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-9.28649e-13    0.0477611 -3.05651e-11  1.87861e-10  -1.4102e-10 -1.95327e-11  4.01701e-12    0.0424653  4.18448e-13  -0.00643139  -0.00867071  1.33707e-12  0.000315585    0.0215514  3.01027e-12     0.952112  2.08593e-10  9.16176e-12  1.53701e-10 -9.33733e-12 -6.21613e-05   0.00321145 -4.76023e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.01478e-10 -2.96314e-10    0.0544729   0.00909912     0.014331    0.0152619 -1.62899e-10  4.03497e-10  0.000394373 -4.67709e-11  1.79831e-09    0.0133182 -2.19994e-09 -1.18906e-10 -1.95246e-10  2.08593e-10      1.07461    0.0336443   -0.0382445    0.0382445 -4.71247e-10  1.00555e-10    0.0123064         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.11575e-10 -9.28247e-12  -0.00909912   -0.0544729    0.0152619     0.014331   1.2295e-10  1.31403e-11  0.000394373 -5.81222e-11  5.28552e-11    0.0133182 -1.98227e-09  1.67299e-10 -5.08831e-11  9.16176e-12    0.0336443      1.07461   -0.0382445    0.0382445 -5.94069e-10 -7.28633e-11    0.0123064         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.23572e-10 -2.27075e-10    0.0148687   -0.0157996   -0.0177558    0.0458162  2.25165e-10  3.01631e-10 -0.000515733  1.82473e-09 -4.59092e-11   -0.0174166  2.87786e-09 -1.16784e-10  2.62805e-10  1.53701e-10   -0.0382445   -0.0382445      1.09538   -0.0544127  6.05373e-10  1.06071e-10    0.0113456         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-4.10603e-10  1.69778e-11   -0.0157996    0.0148687   -0.0458162    0.0177558  1.65192e-10 -1.57819e-11  0.000515733 -7.92757e-11  3.45579e-11    0.0174166 -2.59166e-09 -1.00888e-10 -6.33737e-11 -9.33733e-12    0.0382445    0.0382445   -0.0544127      1.09538 -7.78489e-10  1.64119e-11   -0.0113456         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "    0.055971   0.00108338   3.9236e-09 -3.99151e-09  -5.3886e-09 -5.29601e-09   0.00259781  5.02837e-05 -1.12611e-09  -0.00898583   0.00639932 -2.79941e-10   -0.0177727  0.000604435   -0.0179747 -0.000347922  5.52704e-11  7.79177e-11 -6.31826e-11  9.78927e-11     0.583856 -9.31314e-12 -2.80385e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  0.00108338    -0.055971  8.56401e-11 -1.77393e-10 -1.33204e-10 -2.01996e-10  5.02837e-05  -0.00259781 -3.52779e-11   0.00639932   0.00898583 -8.97388e-12 -0.000604435   -0.0177727 -0.000347922    0.0179747  -1.4109e-10 -1.06706e-10  -1.1459e-10  9.16022e-11 -9.31311e-12     0.583856 -4.58198e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.74469e-11  4.39637e-10    0.0321192   -0.0321192    0.0289641    0.0289641 -3.56641e-12 -8.79487e-10   0.00258936 -1.63719e-09  -2.1965e-09   0.00132391  -9.3794e-11  7.03415e-11 -4.85535e-12 -6.05028e-10    0.0137014    0.0137014    0.0109774   -0.0109774 -7.72234e-10 -5.08497e-09      2.11676         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
