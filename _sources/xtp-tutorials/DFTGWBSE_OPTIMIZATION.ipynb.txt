{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2021-09-18T00:01:58.633307Z",
     "iopub.status.busy": "2021-09-18T00:01:58.632818Z",
     "iopub.status.idle": "2021-09-18T00:02:49.210731Z",
     "shell.execute_reply": "2021-09-18T00:02:49.210199Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2022-dev gitid: e121420 (compiled Sep 17 2021, 23:54:05)\r\n",
      "votca_csg, version 2022-dev gitid: e121420 (compiled Sep 17 2021, 23:41:23)\r\n",
      "votca_tools, version 2022-dev gitid: e121420 (compiled Sep 17 2021, 23:38:59)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 Bohr\r\n",
      "... ... \r\n",
      "... ... =========== OPTIMIZATION SUMMARY ================================= \r\n",
      "... ... At iteration  0\r\n",
      "... ...  ---- POSITIONS (Angstrom)   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    +0.0000  +0.0000  +0.0000\r\n",
      "... ...    1    +1.2000  +0.0000  +0.0000\r\n",
      "... ...    Total energy:     -112.26831841 Hartree \r\n",
      "... ...    Trust radius:       0.01889726 Bohr     \r\n",
      "... ...  ---- FORCES (Hartree/Bohr)   \r\n",
      "... ...       central differences   \r\n",
      "... ...       displacement 0.0010 Angstrom   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    -0.1314  -0.0000  -0.0000\r\n",
      "... ...    1    +0.1314  +0.0000  +0.0000A\r\n",
      "    0.301149 -1.39144e-12  7.69865e-10 -8.86828e-10 -1.19988e-09 -1.04252e-09   -0.0519724  1.01962e-12  5.92028e-10    0.0141737   -0.0104942  2.25008e-10   -0.0390252  0.000528931    0.0423984  -8.0445e-13  1.50688e-10  3.07135e-10 -1.92127e-10  4.05016e-10    -0.107077   0.00209545 -6.04793e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.39145e-12     0.301149 -1.48684e-10  3.06034e-10 -2.19959e-10 -1.02996e-10  1.01961e-12   -0.0519724 -2.98413e-12    0.0104942    0.0141737 -6.56534e-13  0.000528931    0.0390252 -8.04471e-13    0.0423984  2.10938e-10 -1.95122e-12   1.6055e-10 -4.10173e-12  -0.00209545    -0.107077 -5.83602e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 7.69865e-10 -1.48684e-10     0.392153   -0.0719194    -0.110756    -0.110756 -1.83176e-10  9.48677e-11    0.0541542  3.42576e-11 -1.16424e-10    0.0244113 -1.89601e-09    5.744e-11  1.23643e-10 -3.05633e-11   -0.0362836    0.0109763   -0.0169996    0.0176402 -7.96736e-09  3.80425e-10     0.024223          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-8.86828e-10  3.06034e-10   -0.0719194     0.392153     0.110756     0.110756  2.21905e-10 -1.49235e-10   -0.0541542 -3.37478e-11  1.20709e-10   -0.0244113  1.91589e-09 -3.19195e-11 -2.13481e-10  1.52494e-10   -0.0109763    0.0362836    0.0176402   -0.0169996  8.04917e-09 -4.97754e-10    -0.024223          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.19988e-09 -2.19959e-10    -0.110756     0.110756     0.459739     0.139506  3.01811e-10  1.00349e-10   -0.0731419 -1.43233e-10  3.35263e-11   -0.0329705  2.58751e-09  9.89028e-12 -2.88836e-10 -1.07475e-10   -0.0167921   -0.0174327     0.020974    0.0262859  1.08756e-08 -1.16793e-10   0.00976035          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.04252e-09 -1.02996e-10    -0.110756     0.110756     0.139506     0.459739  2.47444e-10  6.16195e-11   -0.0731419 -1.38948e-10  3.30165e-11   -0.0329705  2.56199e-09  2.97747e-11 -1.66905e-10 -1.76365e-11   -0.0174327   -0.0167921   -0.0262859    -0.020974  1.07573e-08 -1.99432e-10   0.00976035          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0519724  1.01961e-12 -1.83176e-10  2.21905e-10  3.01811e-10  2.47444e-10     0.486835 -2.44682e-13 -1.77663e-10   -0.0109581   0.00811339 -3.96542e-11   -0.0083053  0.000112566    0.0301449  2.91439e-12  9.06607e-11 -1.01623e-10 -1.26424e-10  -1.3539e-10    0.0549835    -0.001076  4.05815e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.01962e-12   -0.0519724  9.48677e-11 -1.49235e-10  1.00349e-10  6.16195e-11 -2.44683e-13     0.486835  4.01514e-12  -0.00811339   -0.0109581  1.15367e-12  0.000112566    0.0083053  2.91444e-12    0.0301449 -2.69082e-10 -7.26837e-12 -2.01879e-10  9.59553e-12     0.001076    0.0549835 -2.31508e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.92028e-10 -2.98413e-12    0.0541542   -0.0541542   -0.0731419   -0.0731419 -1.77663e-10  4.01514e-12     0.659928   2.6894e-10 -2.00697e-10  -0.00518518 -7.77965e-10  3.35017e-12  1.34331e-10  -2.1843e-12   0.00289076   0.00289076  -0.00379567   0.00379567 -5.23428e-09  1.54145e-10   0.00259588          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0141737    0.0104942  3.42576e-11 -3.37478e-11 -1.43233e-10 -1.38948e-10   -0.0109581  -0.00811339   2.6894e-10     0.668107  7.22973e-13 -7.87246e-11  1.34562e-05 -1.02482e-05   0.00728151   0.00539122 -2.62988e-11 -2.97819e-11   1.0907e-09 -4.34647e-11   -0.0334089   -0.0237382   8.0902e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0104942    0.0141737 -1.16424e-10  1.20709e-10  3.35263e-11  3.30165e-11   0.00811339   -0.0109581 -2.00697e-10  7.23091e-13     0.668107  5.94792e-11 -1.02482e-05 -1.34562e-05  -0.00539122   0.00728151  1.07658e-09  2.93531e-11 -2.62581e-11  2.27751e-11    0.0237382   -0.0334089  1.12858e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.25008e-10 -6.56534e-13    0.0244113   -0.0244113   -0.0329705   -0.0329705 -3.96542e-11  1.15367e-12  -0.00518518 -7.87246e-11  5.94792e-11     0.793012 -5.03133e-10  1.23763e-12  7.47808e-11 -4.83949e-13   0.00927262   0.00927262   -0.0121753    0.0121753 -1.99229e-09  5.79177e-11   0.00106074          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0390252  0.000528931 -1.89601e-09  1.91589e-09  2.58751e-09  2.56199e-09   -0.0083053  0.000112566 -7.77965e-10  1.34562e-05 -1.02482e-05 -5.03133e-10     0.954263 -3.99751e-13    0.0128739 -0.000174487 -1.22308e-09 -1.11723e-09  1.60703e-09 -1.46592e-09   -0.0198854  0.000658839 -1.21038e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 0.000528931    0.0390252    5.744e-11 -3.19195e-11  9.89028e-12  2.97747e-11  0.000112566    0.0083053  3.35017e-12 -1.02482e-05 -1.34562e-05  1.23763e-12 -3.99754e-13     0.954263 -0.000174487   -0.0128739  -5.8219e-11  8.28977e-11 -5.24351e-11 -5.34128e-11  0.000658839    0.0198854  3.45576e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0423984 -8.04471e-13  1.23643e-10 -2.13481e-10 -2.88836e-10 -1.66905e-10    0.0301449  2.91444e-12  1.34331e-10   0.00728151  -0.00539122  7.47808e-11    0.0128739 -0.000174487     0.973645  1.57418e-12  1.20227e-10  3.22631e-11 -1.60495e-10   4.2081e-11   -0.0229461  0.000449043 -1.84986e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -8.0445e-13    0.0423984 -3.05633e-11  1.52494e-10 -1.07475e-10 -1.76365e-11  2.91439e-12    0.0301449  -2.1843e-12   0.00539122   0.00728151 -4.83949e-13 -0.000174487   -0.0128739  1.57418e-12     0.973645 -1.26511e-10 -8.09785e-12 -9.33885e-11  5.42492e-12 -0.000449043   -0.0229461 -5.39145e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.50688e-10  2.10938e-10   -0.0362836   -0.0109763   -0.0167921   -0.0174327  9.06607e-11 -2.69082e-10   0.00289076 -2.62988e-11  1.07658e-09   0.00927262 -1.22308e-09  -5.8219e-11  1.20227e-10 -1.26511e-10      1.03693    0.0177643   -0.0205871    0.0205871 -1.52296e-09 -2.08329e-11  -0.00300083          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.07135e-10 -1.95122e-12    0.0109763    0.0362836   -0.0174327   -0.0167921 -1.01623e-10 -7.26837e-12   0.00289076 -2.97819e-11  2.93531e-11   0.00927262 -1.11723e-09  8.28977e-11  3.22631e-11 -8.09785e-12    0.0177643      1.03693   -0.0205871    0.0205871 -1.57217e-09  4.96116e-11  -0.00300083          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.92127e-10   1.6055e-10   -0.0169996    0.0176402     0.020974   -0.0262859 -1.26424e-10 -2.01879e-10  -0.00379567   1.0907e-09 -2.62581e-11   -0.0121753  1.60703e-09 -5.24351e-11 -1.60495e-10 -9.33885e-11   -0.0205871   -0.0205871      1.04829   -0.0291169  1.99308e-09 -1.04687e-10  -0.00432386          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.05016e-10 -4.10173e-12    0.0176402   -0.0169996    0.0262859    -0.020974  -1.3539e-10  9.59553e-12   0.00379567 -4.34647e-11  2.27751e-11    0.0121753 -1.46592e-09 -5.34128e-11   4.2081e-11  5.42492e-12    0.0205871    0.0205871   -0.0291169      1.04829 -2.06352e-09   5.5501e-11   0.00432386          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0745718   0.00145933  5.45008e-09  -5.4646e-09 -7.38026e-09 -7.35703e-09    -0.070016  -0.00137018  4.10158e-09    0.0247813   -0.0176079  1.74227e-09   0.00919343 -0.000304595    0.0362818  0.000710016  1.23313e-09  1.26199e-09 -1.61401e-09  1.65487e-09    -0.195058  8.52658e-12  3.87882e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -0.00145933    0.0745718 -4.14578e-10  4.37566e-10  1.44234e-11  2.90611e-11   0.00137018    -0.070016 -1.21111e-10    0.0176079    0.0247813 -5.03301e-11 -0.000304595  -0.00919343 -0.000710016    0.0362818  4.50932e-11  4.44283e-12  1.10095e-10 -8.10426e-11  8.52662e-12    -0.195058 -6.14511e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.16383e-11  8.00627e-10   0.00561492  -0.00561492      0.01815      0.01815  -5.6766e-11 -7.00552e-10  -0.00444668  1.14669e-09  1.47833e-09  -0.00190979  1.45475e-10 -1.19818e-10  1.53193e-11  3.11352e-11  -0.00563606  -0.00563606   -0.0030324    0.0030324  8.41156e-10 -6.30108e-09      1.05372          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0903883 -6.20571e-13  2.83732e-10 -3.57963e-10 -4.84525e-10 -3.84676e-10   -0.0326152  6.25323e-13  3.66711e-10    0.0119057  -0.00881499  1.49744e-10   -0.0481031  0.000651967    0.0477611 -9.23331e-13  9.92257e-11  3.10383e-10 -1.22355e-10  4.09634e-10   -0.0244238  0.000477961 -4.26895e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.20574e-13    0.0903883 -7.31441e-11  1.72993e-10 -1.25695e-10 -5.14641e-11  6.25315e-13   -0.0326152 -1.84727e-12   0.00881499    0.0119057 -3.93512e-13  0.000651967    0.0481031 -9.23354e-13    0.0477611  2.97953e-10  1.06739e-11  2.25653e-10 -1.44961e-11 -0.000477961   -0.0244238  7.66505e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.83732e-10 -7.31441e-11     0.139336   -0.0345017   -0.0540631   -0.0540631 -8.99196e-11  6.45954e-11    0.0389057   2.4976e-11 -9.94874e-11    0.0189906 -2.04243e-09   6.5113e-11   1.0644e-10 -3.16805e-11   -0.0545161    0.0090569    -0.014871    0.0157327 -4.02771e-10 -9.25539e-11    0.0315482         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.57963e-10  1.72993e-10   -0.0345017     0.139336    0.0540631    0.0540631  1.21315e-10 -1.08319e-10   -0.0389057  -2.4499e-11  1.04996e-10   -0.0189906  2.07177e-09 -2.74159e-11 -2.21937e-10   1.8825e-10   -0.0090569    0.0545161    0.0157327    -0.014871  4.71561e-10 -3.88662e-12   -0.0315482         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-4.84525e-10 -1.25695e-10   -0.0540631    0.0540631     0.172326    0.0674924  1.65285e-10  7.41759e-11    -0.052547 -1.21271e-10  2.48163e-11   -0.0256491  2.79775e-09  4.47946e-12 -3.00287e-10 -1.33507e-10   -0.0143734    -0.015235    0.0177985    0.0457745  6.41964e-10 -2.81828e-11    0.0289328         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.84676e-10 -5.14641e-11   -0.0540631    0.0540631    0.0674924     0.172326  1.21562e-10  4.27802e-11    -0.052547 -1.15762e-10  2.43393e-11   -0.0256491  2.76005e-09  3.38108e-11 -1.43718e-10 -1.80097e-11    -0.015235   -0.0143734   -0.0457745   -0.0177985  5.44869e-10 -9.76548e-11    0.0289328         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0326152  6.25313e-13 -8.99196e-11  1.21315e-10  1.65285e-10  1.21562e-10     0.236624 -1.37894e-13 -1.35483e-10   -0.0115584   0.00855785 -2.41285e-11  -0.00949851  0.000128739    0.0424653  3.99929e-12  1.63126e-10 -1.23864e-10 -2.25153e-10 -1.65473e-10  -0.00359496  7.03514e-05 -5.49701e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.25324e-13   -0.0326152  6.45954e-11 -1.08319e-10  7.41759e-11  4.27802e-11 -1.37898e-13     0.236624  3.37795e-12  -0.00855785   -0.0115584  9.80962e-13  0.000128739   0.00949851  3.99936e-12    0.0424653 -4.03904e-10 -1.32777e-11 -3.02177e-10  1.51872e-11 -7.03514e-05  -0.00359496 -8.20382e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.66711e-10 -1.84727e-12    0.0389057   -0.0389057    -0.052547    -0.052547 -1.35483e-10  3.37795e-12     0.424108   3.2931e-10  -2.4606e-10   -0.0112617  -9.3286e-10  4.49808e-12  1.82484e-10 -2.97723e-12  0.000393365  0.000393365 -0.000516502  0.000516502 -1.09306e-09  3.51325e-11  -0.00121103         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0119057   0.00881499   2.4976e-11  -2.4499e-11 -1.21271e-10 -1.15762e-10   -0.0115584  -0.00855785   3.2931e-10     0.446812   9.5115e-13 -1.12051e-10 -0.000385167  0.000293341   0.00867626   0.00642389 -4.74236e-11 -5.32827e-11    1.829e-09  -7.9129e-11   -0.0144799   -0.0102884  1.78421e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " -0.00881499    0.0119057 -9.94874e-11  1.04996e-10  2.48163e-11  2.43393e-11   0.00855785   -0.0115584  -2.4606e-10  9.51324e-13     0.446812  8.44116e-11  0.000293341  0.000385167  -0.00642389   0.00867626  1.80327e-09  5.33995e-11 -4.70094e-11  4.11504e-11    0.0102884   -0.0144799  2.38948e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.49744e-10 -3.93512e-13    0.0189906   -0.0189906   -0.0256491   -0.0256491 -2.41285e-11  9.80962e-13   -0.0112617 -1.12051e-10  8.44116e-11     0.627074 -6.54358e-10   1.5635e-12  1.02976e-10 -5.64567e-13    0.0132841    0.0132841   -0.0174425    0.0174425 -2.09069e-10   8.0423e-12 -0.000498271         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0481031  0.000651967 -2.04243e-09  2.07177e-09  2.79775e-09  2.76005e-09  -0.00949851  0.000128739  -9.3286e-10 -0.000385167  0.000293341 -6.54358e-10     0.912954 -7.12846e-13    0.0215518 -0.000292103 -2.19673e-09 -1.98211e-09  2.88658e-09 -2.60047e-09   -0.0227037  0.000752214 -5.38026e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 0.000651967    0.0481031   6.5113e-11 -2.74159e-11  4.47946e-12  3.38108e-11  0.000128739   0.00949851  4.49808e-12  0.000293341  0.000385167   1.5635e-12 -7.12851e-13     0.912954 -0.000292103   -0.0215518 -1.23756e-10  1.62354e-10   -1.088e-10 -1.05821e-10  0.000752214    0.0227037 -1.07606e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0477611 -9.23353e-13   1.0644e-10 -2.21937e-10 -3.00287e-10 -1.43718e-10    0.0424653  3.99935e-12  1.82484e-10   0.00867626  -0.00642389  1.02976e-10    0.0215518 -0.000292103     0.952112  2.99018e-12  1.97862e-10  4.91098e-11 -2.64158e-10  6.40336e-11   0.00321144 -6.28461e-05 -6.97385e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-9.23331e-13    0.0477611 -3.16805e-11   1.8825e-10 -1.33507e-10 -1.80097e-11  3.99929e-12    0.0424653 -2.97723e-12   0.00642389   0.00867626 -5.64566e-13 -0.000292103   -0.0215518  2.99017e-12     0.952112 -2.09674e-10 -9.54941e-12 -1.54834e-10  6.08172e-12  6.28461e-05   0.00321144 -4.80795e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 9.92257e-11  2.97953e-10   -0.0545161   -0.0090569   -0.0143734    -0.015235  1.63126e-10 -4.03904e-10  0.000393365 -4.74236e-11  1.80327e-09    0.0132841 -2.19673e-09 -1.23756e-10  1.97862e-10 -2.09674e-10      1.07446     0.033495   -0.0382036    0.0382036 -4.68748e-10 -1.03776e-10   -0.0123296         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.10383e-10  1.06739e-11    0.0090569    0.0545161    -0.015235   -0.0143734 -1.23864e-10 -1.32777e-11  0.000393365 -5.32827e-11  5.33995e-11    0.0132841 -1.98211e-09  1.62354e-10  4.91098e-11 -9.54941e-12     0.033495      1.07446   -0.0382036    0.0382036 -5.90108e-10  6.95082e-11   -0.0123296         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.22355e-10  2.25653e-10    -0.014871    0.0157327    0.0177985   -0.0457745 -2.25153e-10 -3.02177e-10 -0.000516502    1.829e-09 -4.70094e-11   -0.0174425  2.88658e-09   -1.088e-10 -2.64158e-10 -1.54834e-10   -0.0382036   -0.0382036      1.09553    -0.054562  6.02873e-10 -1.02221e-10   -0.0113157         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.09634e-10 -1.44961e-11    0.0157327    -0.014871    0.0457745   -0.0177985 -1.65473e-10  1.51872e-11  0.000516502  -7.9129e-11  4.11504e-11    0.0174425 -2.60047e-09 -1.05821e-10  6.40336e-11  6.08172e-12    0.0382036    0.0382036    -0.054562      1.09553 -7.75855e-10 -1.88089e-11    0.0113157         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0559707  -0.00109532  -3.9035e-09   3.9681e-09  5.36768e-09  5.27547e-09   -0.0025978 -5.08376e-05 -1.12201e-09  -0.00899272   0.00638963 -2.78505e-10   -0.0177733   0.00058886    0.0179747  0.000351755  5.25879e-11  7.86786e-11 -6.30219e-11  9.83203e-11     0.583856  9.31822e-12  2.98845e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  0.00109532   -0.0559707  6.54542e-11 -1.56822e-10 -1.08408e-10 -1.73874e-10  5.08376e-05   -0.0025978  3.04831e-11  -0.00638963  -0.00899272  7.25381e-12   0.00058886    0.0177733 -0.000351755    0.0179747  1.41404e-10  1.06432e-10  1.15321e-10 -8.88911e-11  9.31827e-12     0.583856 -4.55859e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.63976e-11   4.4025e-10    0.0321599   -0.0321599    0.0289041    0.0289041 -2.51115e-12 -8.79265e-10  -0.00257743  1.64636e-09   2.2003e-09  -0.00131855  9.49923e-11 -7.08637e-11 -9.50815e-12 -6.09811e-10   -0.0137275   -0.0137275   -0.0109402    0.0109402  7.85009e-10 -5.06137e-09      2.11612         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.9.7"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
