{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-22T06:27:48.372984Z",
     "iopub.status.busy": "2022-04-22T06:27:48.371903Z",
     "iopub.status.idle": "2022-04-22T06:28:10.828867Z",
     "shell.execute_reply": "2022-04-22T06:28:10.827636Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2023-dev gitid: 9f6d0dd (compiled Apr 22 2022, 06:18:46)\r\n",
      "votca_csg, version 2023-dev gitid: 9f6d0dd (compiled Apr 22 2022, 06:03:03)\r\n",
      "votca_tools, version 2023-dev gitid: 9f6d0dd (compiled Apr 22 2022, 06:00:03)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 BohrA\r\n",
      "    0.307132 -3.06429e-11  1.79836e-10  5.20075e-10  2.32408e-11   -0.0516061  1.11678e-09 -1.03702e-09  3.87666e-10    0.0181647   0.00104159  1.10466e-10   -0.0104019    0.0375618 -2.00466e-11    0.0421019 -2.08541e-10  9.11406e-11  3.57777e-10  1.58941e-10  0.000478761    -0.108408 -1.82908e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.06429e-11     0.307132  3.89076e-10  3.09316e-10   -0.0516061   2.3241e-11 -2.45187e-09  2.79211e-09 -8.22089e-10   0.00104159   -0.0181647 -3.85165e-10   -0.0375618   -0.0104019    0.0421019 -2.00466e-11  1.92112e-10   6.7245e-12 -5.01642e-10 -6.19042e-10    -0.108408  -0.00047876 -1.68352e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.79836e-10  3.89076e-10     0.320605  -0.00928983 -1.40025e-11 -3.03729e-11   -0.0131734    0.0131734  -0.00491237  1.46114e-10 -1.02557e-10  -0.00209282 -1.19276e-11  -2.0723e-10  1.19223e-10 -7.51473e-12   -0.0470528   0.00129451  -0.00255664   -0.0152283 -9.88546e-10  3.13975e-10   -0.0254859          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.20075e-10  3.09316e-10  -0.00928983     0.320605 -2.23534e-11 -4.35098e-10   -0.0131734    0.0131734  -0.00491237  1.66388e-10 -1.48465e-10  -0.00209282  8.10472e-12 -1.82329e-10  1.27813e-11  4.05417e-10  -0.00129451    0.0470528   -0.0152283  -0.00255664 -9.64589e-10 -2.06182e-10   -0.0254859          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.32408e-11   -0.0516061 -1.40025e-11 -2.23534e-11     0.490902 -2.84024e-12 -1.49002e-09  1.08529e-09 -6.28853e-10 -0.000770728     0.013441 -1.85913e-10  -0.00770392  -0.00213342    0.0309987  6.61928e-11  4.61695e-11 -3.03305e-10 -2.07893e-10 -6.15083e-11    0.0531267  0.000234623 -2.09501e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0516061   2.3241e-11 -3.03729e-11 -4.35098e-10 -2.84025e-12     0.490902 -9.28871e-11  1.01238e-10 -6.25416e-11    -0.013441 -0.000770728  5.24293e-12  -0.00213342   0.00770392  6.61929e-11    0.0309987  1.53623e-10 -7.23899e-12 -8.27001e-11  1.74435e-10 -0.000234623    0.0531267  -4.4585e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.11678e-09 -2.45187e-09   -0.0131734   -0.0131734 -1.49002e-09 -9.28871e-11     0.549585     -0.21969    0.0856688  1.43382e-11  7.24901e-10    0.0364976  8.31914e-10  2.62355e-09    6.317e-10  2.54398e-10   -0.0113538  -0.00131787   -0.0126966    0.0330617  1.34035e-08 -8.27013e-09   0.00154581          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.03702e-09  2.79211e-09    0.0131734    0.0131734  1.08529e-09  1.01238e-10     -0.21969     0.549585   -0.0856688 -6.02464e-11 -7.45175e-10   -0.0364976 -8.56815e-10 -2.60352e-09 -2.18768e-10 -1.47956e-10  -0.00131787   -0.0113538   -0.0330617    0.0126966 -1.39172e-08  8.24262e-09  -0.00154581          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.87666e-10 -8.22089e-10  -0.00491237  -0.00491237 -6.28853e-10 -6.25416e-11    0.0856688   -0.0856688     0.662947  1.80027e-10  5.81848e-10  -0.00632525  2.92644e-10  7.01987e-10  3.36772e-10  9.71565e-11  -0.00131676   0.00131676   0.00387669   0.00387669  4.33972e-09 -3.05358e-09   0.00112603          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0181647   0.00104159  1.46114e-10  1.66388e-10 -0.000770728    -0.013441  1.43382e-11 -6.02464e-11  1.80027e-10     0.680922  -1.6017e-12 -8.83668e-11 -2.70761e-05  7.97149e-05  0.000494441   0.00862276 -3.86456e-10 -2.24977e-13 -8.09523e-11 -8.90774e-10  -0.00216781   -0.0409702  6.68857e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  0.00104159   -0.0181647 -1.02557e-10 -1.48465e-10     0.013441 -0.000770728  7.24901e-10 -7.45175e-10  5.81848e-10 -1.60169e-12     0.680922 -6.20479e-11  7.97149e-05  2.70761e-05  -0.00862276  0.000494441  4.18866e-12  -8.1401e-10 -3.77279e-10  9.40161e-12    0.0409702  -0.00216781 -8.09471e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.10466e-10 -3.85165e-10  -0.00209282  -0.00209282 -1.85913e-10  5.24293e-12    0.0364976   -0.0364976  -0.00632525 -8.83668e-11 -6.20479e-11      0.79826 -1.22354e-11  3.26474e-10 -1.10195e-10  5.77009e-11   -0.0046553    0.0046553    0.0137057    0.0137057  1.73226e-09 -9.75756e-10  0.000446399          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0104019   -0.0375618 -1.19276e-11  8.10472e-12  -0.00770392  -0.00213342  8.31914e-10 -8.56815e-10  2.92644e-10 -2.70761e-05  7.97149e-05 -1.22354e-11     0.956418 -4.29194e-11    0.0126655   0.00350742  -1.2382e-10  2.37458e-10  6.53118e-10   4.3075e-10   -0.0192727  -0.00542887 -6.80524e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0375618   -0.0104019  -2.0723e-10 -1.82329e-10  -0.00213342   0.00770392  2.62355e-09 -2.60352e-09  7.01987e-10  7.97149e-05  2.70761e-05  3.26474e-10 -4.29194e-11     0.956418   0.00350742   -0.0126655 -4.24796e-10  6.47164e-10   1.4916e-09  1.60524e-09  -0.00542887    0.0192727  8.92888e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.00466e-11    0.0421019  1.19223e-10  1.27813e-11    0.0309987  6.61929e-11    6.317e-10 -2.18768e-10  3.36772e-10  0.000494441  -0.00862276 -1.10195e-10    0.0126655   0.00350742     0.988566  3.74305e-11  2.92379e-11 -1.10932e-10  3.59239e-11  -6.1675e-11   -0.0223628 -9.87608e-05 -3.29957e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0421019 -2.00467e-11 -7.51473e-12  4.05417e-10  6.61928e-11    0.0309987  2.54398e-10 -1.47956e-10  9.71565e-11   0.00862276  0.000494441  5.77009e-11   0.00350742   -0.0126655  3.74305e-11     0.988566 -7.14602e-12 -9.04529e-11  6.75867e-11   1.4928e-10  9.87609e-05   -0.0223628 -1.73214e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.08541e-10  1.92112e-10   -0.0470528  -0.00129451  4.61695e-11  1.53623e-10   -0.0113538  -0.00131787  -0.00131676 -3.86456e-10  4.18866e-12   -0.0046553  -1.2382e-10 -4.24796e-10  2.92379e-11 -7.14602e-12      1.03321  -0.00656702   -0.0132456   -0.0132456 -8.26156e-10   5.5377e-10   0.00427525          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 9.11406e-11   6.7245e-12   0.00129451    0.0470528 -3.03305e-10 -7.23899e-12  -0.00131787   -0.0113538   0.00131676 -2.24977e-13  -8.1401e-10    0.0046553  2.37458e-10  6.47164e-10 -1.10932e-10 -9.04529e-11  -0.00656702      1.03321    0.0132456    0.0132456  7.79412e-10 -4.51898e-10  -0.00427525          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.57777e-10 -5.01642e-10  -0.00255664   -0.0152283 -2.07893e-10 -8.27001e-11   -0.0126966   -0.0330617   0.00387669 -8.09523e-11 -3.77279e-10    0.0137057  6.53118e-10   1.4916e-09  3.59239e-11  6.75867e-11   -0.0132456    0.0132456       1.0677    0.0410645   2.3668e-09 -1.58706e-09    0.0020432          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.58941e-10 -6.19042e-10   -0.0152283  -0.00255664 -6.15083e-11  1.74435e-10    0.0330617    0.0126966   0.00387669 -8.90774e-10  9.40161e-12    0.0137057   4.3075e-10  1.60524e-09  -6.1675e-11   1.4928e-10   -0.0132456    0.0132456    0.0410645       1.0677  2.46777e-09 -1.53976e-09    0.0020432          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-0.000332311    0.0752465  6.87405e-10  7.32321e-10   -0.0690159  0.000304795 -8.05787e-09  8.33547e-09 -3.16326e-09   0.00163559   -0.0309116 -1.54303e-09    0.0086661   0.00244113    0.0364086 -0.000160791  5.58936e-10 -5.58371e-10  -1.7752e-09  -1.7787e-09    -0.194424  2.21818e-10 -4.21846e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0752465  0.000332311  1.11202e-12  2.85434e-10 -0.000304795   -0.0690159  5.49078e-09 -5.53335e-09  2.38412e-09    0.0309116   0.00163559  8.87133e-10   0.00244113   -0.0086661  0.000160791    0.0364086 -4.81826e-10  4.77583e-10  1.28082e-09  1.27937e-09  2.21818e-10    -0.194424  -5.5436e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.99123e-10  5.29793e-10   -0.0141893   -0.0141893 -3.68899e-10 -5.51688e-10  -0.00432455   0.00432455  -0.00131232  1.02976e-09 -1.08961e-09 -0.000526173  8.36105e-11 -8.17481e-11  4.06978e-11  2.51658e-10   0.00597536  -0.00597536   0.00150736   0.00150736 -4.42887e-09 -5.45749e-09     0.958309          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "    0.093811 -1.36194e-11  9.61563e-11  3.20856e-10  1.42928e-11   -0.0328898  4.68308e-10 -4.11337e-10  2.38549e-10    0.0155317  0.000890608  6.35486e-11   -0.0128981    0.0465757 -2.32907e-11    0.0481429 -2.59294e-10  1.01677e-10  3.59514e-10  8.39748e-11  0.000110883   -0.0251078  4.90483e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.36194e-11     0.093811  2.01254e-10  1.44284e-10   -0.0328898  1.42929e-11  -9.6772e-10  1.19242e-09 -5.07306e-10  0.000890608   -0.0155317  -2.5484e-10   -0.0465757   -0.0128981    0.0481429 -2.32908e-11  1.64911e-10  1.10629e-10 -4.29865e-10 -5.87482e-10   -0.0251078 -0.000110883  5.38539e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 9.61563e-11  2.01254e-10      0.10587  -0.00531151 -1.86518e-11  -2.5876e-11   -0.0066736    0.0066736  -0.00361237   1.3614e-10 -8.75703e-11  -0.00164094 -2.40093e-11  -2.3001e-10  1.50971e-10 -1.30663e-11   -0.0640516   0.00171072  -0.00245533   -0.0197192 -7.99072e-11  1.94524e-10    -0.041887         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.20856e-10  1.44284e-10  -0.00531151      0.10587 -2.22041e-11  -3.1539e-10   -0.0066736    0.0066736  -0.00361237  1.60333e-10 -1.30145e-10  -0.00164094  2.83834e-12 -1.93141e-10  9.17138e-12  5.05894e-10  -0.00171072    0.0640516   -0.0197192  -0.00245533 -5.31549e-12  -4.7898e-11    -0.041887         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.42928e-11   -0.0328898 -1.86518e-11 -2.22041e-11     0.240891 -6.68592e-13 -9.44029e-10  6.54515e-10 -5.49399e-10 -0.000828257    0.0144443 -1.60932e-10  -0.00881178  -0.00244022    0.0441772  9.20139e-11  4.10458e-11 -4.25116e-10  -2.1499e-10 -1.15093e-11  -0.00438142 -1.93496e-05 -5.21182e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0328898  1.42929e-11  -2.5876e-11  -3.1539e-10 -6.68601e-13     0.240891 -4.37187e-11   4.7271e-11 -4.46818e-11   -0.0144443 -0.000828257  1.06023e-11  -0.00244022   0.00881178   9.2014e-11    0.0441772  2.22862e-10  -1.9381e-11 -1.02557e-10  2.81512e-10  1.93496e-05  -0.00438142 -4.88412e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.68308e-10  -9.6772e-10   -0.0066736   -0.0066736 -9.44029e-10 -4.37187e-11     0.221871     -0.11069    0.0629976  1.79199e-11  5.48439e-10     0.028617  9.98448e-10  2.90207e-09   7.9448e-10  2.58574e-10   -0.0100847  -0.00717919   -0.0330802    0.0292607  1.48722e-09 -5.30436e-10  -0.00289574         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-4.11337e-10  1.19242e-09    0.0066736    0.0066736  6.54515e-10   4.7271e-11     -0.11069     0.221871   -0.0629976 -6.04949e-11 -5.72632e-10    -0.028617 -1.03532e-09 -2.87522e-09 -2.75519e-10 -1.16774e-10  -0.00717919   -0.0100847   -0.0292607    0.0330802 -1.72928e-09  4.54671e-10   0.00289574         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.38549e-10 -5.07306e-10  -0.00361237  -0.00361237 -5.49399e-10 -4.46818e-11    0.0629976   -0.0629976     0.429278  2.31001e-10   6.8438e-10   -0.0121538  4.21225e-10  8.97905e-10  4.70447e-10  1.29899e-10  6.20786e-06 -6.20788e-06 -1.82767e-05 -1.82766e-05  1.01346e-09  -6.3785e-10  5.60185e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0155317  0.000890608   1.3614e-10  1.60333e-10 -0.000828257   -0.0144443  1.79199e-11 -6.04949e-11  2.31001e-10     0.463967 -2.13899e-12  -1.1787e-10 -0.000208019   0.00061243  0.000593968    0.0103585 -6.62967e-10  5.06961e-12 -1.34045e-10 -1.50703e-09 -0.000937071   -0.0177101  1.63364e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 0.000890608   -0.0155317 -8.75703e-11 -1.30145e-10    0.0144443 -0.000828257  5.48439e-10 -5.72632e-10   6.8438e-10 -2.13897e-12     0.463967 -1.23372e-10   0.00061243  0.000208019   -0.0103585  0.000593968  2.66491e-11 -1.39964e-09 -6.96865e-10 -3.89683e-11    0.0177101 -0.000937071 -1.78282e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.35486e-11  -2.5484e-10  -0.00164094  -0.00164094 -1.60932e-10  1.06023e-11     0.028617    -0.028617   -0.0121538  -1.1787e-10 -1.23372e-10     0.636067 -4.96831e-11  4.09081e-10 -1.95667e-10  8.28102e-11  -0.00673097   0.00673097    0.0198167    0.0198167    9.925e-11 -2.31607e-12  4.40571e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0128981   -0.0465757 -2.40093e-11  2.83834e-12  -0.00881178  -0.00244022  9.98448e-10 -1.03532e-09  4.21225e-10 -0.000208019   0.00061243 -4.96831e-11     0.917068 -7.52467e-11    0.0214829   0.00594918 -2.20526e-10  4.53243e-10  1.22574e-09  7.73586e-10   -0.0223754  -0.00630286   1.0212e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0465757   -0.0128981  -2.3001e-10 -1.93141e-10  -0.00244022   0.00881178  2.90207e-09 -2.87522e-09  8.97905e-10   0.00061243  0.000208019  4.09081e-10 -7.52468e-11     0.917068   0.00594918   -0.0214829 -7.42065e-10  1.19422e-09  2.67335e-09  2.90606e-09  -0.00630286    0.0223754   6.2817e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.32907e-11    0.0481429  1.50971e-10  9.17138e-12    0.0441772   9.2014e-11   7.9448e-10 -2.75519e-10  4.70447e-10  0.000593968   -0.0103585 -1.95667e-10    0.0214829   0.00594918     0.981535  7.21512e-11  5.42926e-11 -1.86571e-10   5.4623e-11 -1.35522e-10   0.00424838  1.87621e-05 -2.61193e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481429 -2.32908e-11 -1.30663e-11  5.05894e-10  9.20139e-11    0.0441772  2.58574e-10 -1.16774e-10  1.29899e-10    0.0103585  0.000593968  8.28102e-11   0.00594918   -0.0214829  7.21512e-11     0.981535 -2.95318e-11 -1.60613e-10  1.09539e-10  2.41817e-10 -1.87621e-05   0.00424838  1.75256e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.59294e-10  1.64911e-10   -0.0640516  -0.00171072  4.10458e-11  2.22862e-10   -0.0100847  -0.00717919  6.20786e-06 -6.62967e-10  2.66491e-11  -0.00673097 -2.20526e-10 -7.42065e-10  5.42926e-11 -2.95318e-11      1.06908   -0.0128114   -0.0247514   -0.0247514 -3.94922e-10  2.10964e-10    0.0150508         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.01677e-10  1.10629e-10   0.00171072    0.0640516 -4.25116e-10  -1.9381e-11  -0.00717919   -0.0100847 -6.20788e-06  5.06961e-12 -1.39964e-09   0.00673097  4.53243e-10  1.19422e-09 -1.86571e-10 -1.60613e-10   -0.0128114      1.06908    0.0247514    0.0247514  2.19404e-10    9.095e-13   -0.0150508         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.59514e-10 -4.29865e-10  -0.00245533   -0.0197192  -2.1499e-10 -1.02557e-10   -0.0330802   -0.0292607 -1.82767e-05 -1.34045e-10 -6.96865e-10    0.0198167  1.22574e-09  2.67335e-09   5.4623e-11  1.09539e-10   -0.0247514    0.0247514      1.13354     0.077275  8.79347e-10 -5.99893e-10     0.005452         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 8.39748e-11 -5.87482e-10   -0.0197192  -0.00245533 -1.15093e-11  2.81512e-10    0.0292607    0.0330802 -1.82766e-05 -1.50703e-09 -3.89683e-11    0.0198167  7.73586e-10  2.90606e-09 -1.35522e-10  2.41817e-10   -0.0247514    0.0247514     0.077275      1.13354  1.09045e-09 -4.24551e-10     0.005452         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 0.000253304   -0.0573567 -4.73094e-10 -4.21134e-10  -0.00347861  1.53626e-05   7.5172e-09 -7.82085e-09  1.20412e-09 -0.000539237    0.0101913  2.34298e-10   -0.0179428  -0.00505426    0.0191591 -8.46124e-05 -9.06754e-11  7.11935e-11 -1.66087e-10  5.10705e-12     0.600541  2.22261e-10  -3.1926e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0573567 -0.000253304   3.4518e-10  4.23702e-11 -1.53626e-05  -0.00347861 -4.34598e-09  4.29261e-09 -7.17368e-10   -0.0101913 -0.000539237 -1.52086e-10  -0.00505426    0.0179428  8.46124e-05    0.0191591 -1.00932e-10  2.71831e-10  3.21173e-11  5.07875e-11  2.22261e-10     0.600541 -5.04354e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.98188e-10  3.36945e-10   -0.0423678   -0.0423678 -5.91183e-10 -4.72963e-10  -0.00286483   0.00286483  -0.00043866  1.50208e-09 -1.61585e-09 -0.000214606   5.0565e-11   4.2341e-11 -3.64376e-10  1.53269e-10    0.0160907   -0.0160907   0.00534069   0.00534069 -3.64933e-09  -5.0478e-09      1.98482         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
