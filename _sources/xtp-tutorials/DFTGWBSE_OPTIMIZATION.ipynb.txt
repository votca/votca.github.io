{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2021-11-30T21:53:19.442623Z",
     "iopub.status.busy": "2021-11-30T21:53:19.442046Z",
     "iopub.status.idle": "2021-11-30T21:54:05.166974Z",
     "shell.execute_reply": "2021-11-30T21:54:05.166009Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2022-dev gitid: 7f12095 (compiled Nov 30 2021, 21:44:31)\r\n",
      "votca_csg, version 2022-dev gitid: 7f12095 (compiled Nov 30 2021, 21:29:24)\r\n",
      "votca_tools, version 2022-dev gitid: 7f12095 (compiled Nov 30 2021, 21:26:25)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 Bohr\r\n",
      "... ... \r\n",
      "... ... =========== OPTIMIZATION SUMMARY ================================= \r\n",
      "... ... At iteration  0\r\n",
      "... ...  ---- POSITIONS (Angstrom)   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    +0.0000  +0.0000  +0.0000\r\n",
      "... ...    1    +1.2000  +0.0000  +0.0000\r\n",
      "... ...    Total energy:     -112.26831841 Hartree \r\n",
      "... ...    Trust radius:       0.01889726 Bohr     \r\n",
      "... ...  ---- FORCES (Hartree/Bohr)   \r\n",
      "... ...       central differences   \r\n",
      "... ...       displacement 0.0010 Angstrom   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    -0.1314  -0.0000  -0.0000\r\n",
      "... ...    1    +0.1314  +0.0000  +0.0000A\r\n",
      "    0.301149  1.51158e-13  4.75095e-13  2.43403e-12 -1.06192e-13   -0.0519724 -5.85596e-13  5.88345e-13 -1.68297e-13    0.0176098 -0.000956624 -9.97165e-14  -0.00794474   -0.0382117  8.32513e-14    0.0423984  2.20782e-13 -1.43666e-13 -1.20312e-13  4.38073e-14  -0.00115189    -0.107092 -1.01158e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.51132e-13     0.301149 -5.99323e-13 -6.02035e-13   -0.0519724 -1.06152e-13 -8.63375e-12  1.05927e-11 -3.19266e-12 -0.000956624   -0.0176098 -1.88687e-12   -0.0382117   0.00794474    0.0423984  8.33027e-14  2.07605e-13  2.84128e-13 -1.81029e-12  1.44588e-12     0.107092  -0.00115189  9.90345e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.75095e-13 -5.99323e-13     0.310831  -0.00940273 -2.84701e-13  3.16383e-13    0.0125439   -0.0125439   0.00493656 -1.75449e-14  2.27876e-13   0.00222527 -2.95039e-13  1.31132e-13  6.14183e-14  2.54709e-14   -0.0484764  -0.00220175   0.00152576   0.00809539 -1.99617e-12  1.90969e-13   -0.0249162          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.43403e-12 -6.02035e-13  -0.00940273     0.310831 -2.81035e-13 -2.25306e-12    0.0125439   -0.0125439   0.00493656  7.44847e-13  1.87435e-13   0.00222527 -2.75912e-13  2.23859e-13  5.72957e-14  2.39331e-12  -0.00220175   -0.0484764  -0.00809539  -0.00152576 -2.03973e-12 -3.36183e-12   -0.0249162          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.06168e-13   -0.0519724 -2.84701e-13 -2.81035e-13     0.486835  2.91952e-14 -7.42045e-12  4.85106e-12  -3.3272e-12  0.000739597    0.0136147  -1.0783e-12  -0.00813214   0.00169079    0.0301449 -3.07536e-13  1.06839e-13  3.96786e-14 -2.80339e-13   6.0072e-13   -0.0549908  0.000591485  1.24262e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0519724 -1.06135e-13  3.16383e-13 -2.25306e-12  2.92275e-14     0.486835 -2.71796e-13  2.68025e-13 -1.74595e-13   -0.0136147  0.000739597 -5.63547e-14  -0.00169079  -0.00813214 -3.07481e-13    0.0301449  -2.7397e-13  4.63829e-14 -7.10601e-15  7.41812e-14  0.000591485    0.0549908  2.84764e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-5.85596e-13 -8.63375e-12    0.0125439    0.0125439 -7.42045e-12 -2.71796e-13     0.541061    -0.220828    0.0908736 -3.37486e-14  3.45389e-12    0.0409635 -5.57838e-12  8.45385e-13  3.44496e-12  5.52163e-14  -0.00497868   0.00464247   -0.0127886    -0.033486 -3.33022e-11  2.23235e-12  -0.00183119          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.88345e-13  1.05927e-11   -0.0125439   -0.0125439  4.85106e-12  2.68025e-13    -0.220828     0.541061   -0.0908736  -6.6702e-15 -4.21623e-12   -0.0409635  5.67112e-12 -8.64489e-13 -1.07716e-12 -5.10556e-14  -0.00464247   0.00497868    -0.033486   -0.0127886  3.67706e-11 -2.27484e-12   0.00183119          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.68297e-13 -3.19266e-12   0.00493656   0.00493656  -3.3272e-12 -1.74595e-13    0.0908736   -0.0908736     0.659928   3.7025e-15  2.40886e-12  -0.00518522  -2.9324e-13  4.44568e-14  1.34517e-12  7.08241e-14 -0.000716398 -0.000716398   0.00471702  -0.00471702 -9.73064e-12  5.92245e-13  -0.00126456          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0176098 -0.000956624 -1.75449e-14  7.44847e-13  0.000739597   -0.0136147 -3.37486e-14 -6.67018e-15  3.70249e-15     0.668107 -1.37736e-15  1.46207e-16  2.53931e-06  1.67197e-05  -0.00049145   0.00904676   1.6335e-12  -2.2217e-13 -3.27676e-14 -2.51989e-13  -0.00266311    -0.040897 -3.15175e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-0.000956624   -0.0176098  2.27876e-13  1.87435e-13    0.0136147  0.000739597  3.45389e-12 -4.21623e-12  2.40886e-12 -1.34477e-15     0.668107  8.41921e-14 -1.67197e-05  2.53931e-06  -0.00904676  -0.00049145 -9.28528e-14 -3.77627e-13  2.46965e-12 -6.14011e-13    -0.040897   0.00266311 -1.50696e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-9.97165e-14 -1.88687e-12   0.00222527   0.00222527  -1.0783e-12 -5.63547e-14    0.0409635   -0.0409635  -0.00518522  1.46159e-16  8.41922e-14     0.793012 -1.48518e-12  2.27795e-13  -2.6775e-13 -1.41232e-14  -0.00229798  -0.00229798    0.0151307   -0.0151307 -5.52617e-12  3.40815e-13 -0.000527886          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -0.00794474   -0.0382117 -2.95039e-13 -2.75912e-13  -0.00813214  -0.00169079 -5.57838e-12  5.67112e-12  -2.9324e-13  2.53931e-06 -1.67197e-05 -1.48518e-12     0.954263  1.11976e-13    0.0126055   0.00262086  3.65644e-13  3.64604e-13 -2.10806e-12  2.78521e-12     0.019435  -0.00425938  1.18527e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0382117   0.00794474  1.31132e-13  2.23859e-13   0.00169079  -0.00813214  8.45385e-13 -8.64489e-13  4.44568e-14  1.67197e-05  2.53931e-06  2.27795e-13  1.11999e-13     0.954263  -0.00262086    0.0126055 -4.36154e-13  2.40974e-13  3.69014e-13  -3.6794e-13  -0.00425938    -0.019435 -3.15781e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 8.32355e-14    0.0423984  6.14183e-14  5.72957e-14    0.0301449  -3.0747e-13  3.44496e-12 -1.07716e-12  1.34517e-12  -0.00049145  -0.00904676  -2.6775e-13    0.0126055  -0.00262086     0.973646 -1.60889e-13  5.79567e-14 -2.02469e-13   1.0804e-12   1.6214e-13    0.0229492 -0.000246843 -7.49333e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0423984  8.32964e-14  2.54709e-14  2.39331e-12 -3.07534e-13    0.0301449  5.52163e-14 -5.10556e-14  7.08241e-14   0.00904676  -0.00049145 -1.41232e-14   0.00262086    0.0126055 -1.60869e-13     0.973646 -5.77048e-13  6.65427e-13  1.61605e-13   9.8766e-14 -0.000246843   -0.0229492  7.37919e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.20782e-13  2.07605e-13   -0.0484764  -0.00220175  1.06839e-13  -2.7397e-13  -0.00497868  -0.00464247 -0.000716398   1.6335e-12 -9.28528e-14  -0.00229798  3.65644e-13 -4.36154e-13  5.79567e-14 -5.77048e-13      1.02222   0.00304822  -0.00634045   0.00634045  8.47928e-13  1.16481e-13   0.00476639          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.43666e-13  2.84128e-13  -0.00220175   -0.0484764  3.96786e-14  4.63829e-14   0.00464247   0.00497868 -0.000716398  -2.2217e-13 -3.77627e-13  -0.00229798  3.64604e-13  2.40974e-13 -2.02469e-13  6.65427e-13   0.00304822      1.02222  -0.00634045   0.00634045  7.57196e-13 -3.06369e-13   0.00476639          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.20312e-13 -1.81029e-12   0.00152576  -0.00809539 -2.80339e-13 -7.10601e-15   -0.0127886    -0.033486   0.00471702 -3.27676e-14  2.46965e-12    0.0151307 -2.10806e-12  3.69014e-13   1.0804e-12  1.61605e-13  -0.00634045  -0.00634045        1.063    -0.043833 -5.10075e-12  2.75016e-13  0.000257097          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.38073e-14  1.44588e-12   0.00809539  -0.00152576   6.0072e-13  7.41812e-14    -0.033486   -0.0127886  -0.00471702 -2.51989e-13 -6.14011e-13   -0.0151307  2.78521e-12  -3.6794e-13   1.6214e-13   9.8766e-14   0.00634045   0.00634045    -0.043833        1.063  5.51276e-12 -3.68115e-13 -0.000257097          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 0.000802207   -0.0745818  1.01565e-12   1.0459e-12    0.0700253 -0.000753197  1.57385e-11 -1.81695e-11  6.32093e-12   0.00197538    0.0303356  4.11709e-12  -0.00898521    0.0019692   -0.0362867  0.000390302 -4.38153e-13 -5.06957e-13  3.16545e-12 -2.85414e-12    -0.195058  9.68091e-13 -1.00907e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0745818  0.000802207  3.16837e-13  2.82619e-12 -0.000753197   -0.0700253 -1.08437e-12  1.11424e-12 -3.75402e-13    0.0303356  -0.00197538 -2.50945e-13    0.0019692   0.00898521  0.000390302    0.0362867 -6.78393e-14 -3.66432e-13 -2.51517e-13  1.85201e-13  9.68057e-13    -0.195058 -1.15499e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.35791e-13 -9.39254e-14   -0.0139145   -0.0139145 -1.34545e-13 -5.93781e-14   0.00392511  -0.00392511   0.00125844 -2.42696e-12   3.0992e-14  0.000525077 -6.52584e-14  2.22286e-14 -6.06234e-14  2.04064e-12   0.00596355   0.00596355   0.00137459  -0.00137459 -1.23037e-12 -1.08665e-11     0.942965          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0903884  6.77755e-14   2.2818e-13  1.45618e-12 -6.52535e-14   -0.0326152 -2.48504e-13  2.50277e-13 -1.04276e-13    0.0147921 -0.000803555 -6.96661e-14   -0.0097928   -0.0471002  9.57421e-14    0.0477612   3.0512e-13 -2.34422e-13  -1.2391e-13  1.07124e-14 -0.000262739   -0.0244271 -2.38738e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.77547e-14    0.0903884 -2.53639e-13 -2.55392e-13   -0.0326152 -6.52195e-14 -3.23982e-12  4.46782e-12 -1.97788e-12 -0.000803555   -0.0147921 -1.31708e-12   -0.0471002    0.0097928    0.0477612  9.57952e-14  1.46243e-13  2.59461e-13 -1.61432e-12  1.07483e-12    0.0244271 -0.000262739 -1.43514e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  2.2818e-13 -2.53639e-13    0.0996403  -0.00519394 -1.78296e-13  2.13041e-13   0.00612304  -0.00612304   0.00354655 -1.21168e-14  1.58973e-13   0.00173113 -2.70547e-13  1.26583e-13  8.08157e-14  1.53293e-14   -0.0647018  -0.00245416   0.00122406    0.0117181 -3.91094e-13  5.08725e-13   -0.0407309         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.45618e-12 -2.55392e-13  -0.00519394    0.0996403 -1.75772e-13  -1.5751e-12   0.00612304  -0.00612304   0.00354655  7.19287e-13   1.2019e-13   0.00173113  -2.5166e-13  2.18227e-13  7.57716e-14   2.9025e-12  -0.00245416   -0.0647018   -0.0117181  -0.00122406 -4.04827e-13 -5.53522e-13   -0.0407309         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.52359e-14   -0.0326152 -1.78296e-13 -1.75772e-13     0.236624  1.77608e-14 -4.80747e-12  3.01935e-12 -2.97556e-12  0.000780114    0.0143606 -1.03237e-12  -0.00930048    0.0019337    0.0424654 -4.21746e-13  1.03144e-13 -2.13365e-14   8.3608e-14  5.10382e-13   0.00359546  -3.8673e-05  4.30057e-15         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0326152 -6.52094e-14  2.13041e-13  -1.5751e-12  1.77998e-14     0.236624 -1.70117e-13  1.67524e-13 -1.56196e-13   -0.0143606  0.000780114 -5.39635e-14   -0.0019337  -0.00930048 -4.21664e-13    0.0424654 -4.52167e-13  1.41781e-13  2.75359e-14  9.68256e-14  -3.8673e-05  -0.00359546  5.33099e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.48504e-13 -3.23982e-12   0.00612304   0.00612304 -4.80747e-12 -1.70117e-13     0.212022    -0.107188     0.065286 -3.44365e-14  2.21576e-12    0.0318672  -5.1265e-12  7.75977e-13  4.29384e-12  7.31436e-14  -0.00424315   0.00869901    -0.033498   -0.0287497  -6.7434e-12  4.58811e-13   0.00219308         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.50277e-13  4.46782e-12  -0.00612304  -0.00612304  3.01935e-12  1.67524e-13    -0.107188     0.212022    -0.065286 -4.33277e-15 -2.94713e-12   -0.0318672  5.21815e-12 -7.94836e-13 -1.40672e-12 -6.80558e-14  -0.00869901   0.00424315   -0.0287497    -0.033498  7.79625e-12 -4.71409e-13  -0.00219308         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.04276e-13 -1.97788e-12   0.00354655   0.00354655 -2.97556e-12 -1.56196e-13     0.065286    -0.065286     0.424108  3.98154e-15   2.6092e-12   -0.0112618   3.1858e-13 -4.97009e-14  1.84231e-12  9.70022e-14 -9.74824e-05 -9.74824e-05  0.000641858 -0.000641858 -2.50203e-12  1.53488e-13 -0.000273342         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0147921 -0.000803555 -1.21169e-14  7.19287e-13  0.000780114   -0.0143606 -3.44365e-14 -4.33276e-15  3.98154e-15     0.446813 -1.83553e-15 -2.00558e-16 -7.26977e-05 -0.000478667 -0.000585587    0.0107796  2.66597e-12 -3.80856e-13 -5.68472e-14 -4.10673e-13  -0.00115423   -0.0177253 -5.11718e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-0.000803555   -0.0147921  1.58973e-13   1.2019e-13    0.0143606  0.000780114  2.21576e-12 -2.94713e-12   2.6092e-12 -1.78287e-15     0.446813 -1.50662e-13  0.000478667 -7.26977e-05   -0.0107796 -0.000585587  -9.5418e-14 -5.62967e-13  3.67952e-12 -6.32744e-13   -0.0177253   0.00115423  1.01471e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.96661e-14 -1.31708e-12   0.00173113   0.00173113 -1.03237e-12 -5.39635e-14    0.0318672   -0.0318672   -0.0112618  -2.0063e-16 -1.50662e-13     0.627074 -1.99531e-12  3.06059e-13 -5.09644e-13 -2.68376e-14  -0.00329213  -0.00329213    0.0216765   -0.0216765 -1.26432e-12  7.75278e-14 -0.000161172         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0097928   -0.0471002 -2.70547e-13  -2.5166e-13  -0.00930048   -0.0019337  -5.1265e-12  5.21815e-12   3.1858e-13 -7.26977e-05  0.000478667 -1.99531e-12     0.912954  1.98687e-13    0.0211025    0.0043875  6.11537e-13  6.09444e-13 -3.38815e-12  4.74036e-12    0.0221895  -0.00486305 -7.46912e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0471002    0.0097928  1.26583e-13  2.18227e-13    0.0019337  -0.00930048  7.75977e-13 -7.94836e-13 -4.97008e-14 -0.000478667 -7.26977e-05  3.06059e-13  1.98739e-13     0.912954   -0.0043875    0.0211025 -8.12844e-13  5.39335e-13  6.16994e-13 -6.14837e-13  -0.00486305   -0.0221895 -5.99524e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 9.57169e-14    0.0477612  8.08157e-14  7.57716e-14    0.0424654 -4.21649e-13  4.29384e-12 -1.40672e-12  1.84231e-12 -0.000585587   -0.0107796 -5.09644e-13    0.0211025   -0.0043875     0.952113 -3.05317e-13  1.11455e-13 -3.49456e-13  1.86741e-12  3.31613e-13  -0.00321189  3.45473e-05 -1.70738e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0477612  9.57903e-14  1.53294e-14   2.9025e-12 -4.21739e-13    0.0424654  7.31437e-14 -6.80558e-14  9.70022e-14    0.0107796 -0.000585587 -2.68376e-14    0.0043875    0.0211025 -3.05271e-13     0.952113 -1.06008e-12  1.13883e-12  2.77702e-13  1.83097e-13  3.45473e-05   0.00321189  3.04949e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  3.0512e-13  1.46243e-13   -0.0647018  -0.00245416  1.03144e-13 -4.52167e-13  -0.00424315  -0.00869901 -9.74824e-05  2.66597e-12 -9.54179e-14  -0.00329213  6.11537e-13 -8.12844e-13  1.11455e-13 -1.06008e-12      1.04716   0.00618629    -0.011766     0.011766  4.70559e-13 -1.69915e-13    0.0157872         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.34422e-13  2.59461e-13  -0.00245416   -0.0647018 -2.13365e-14  1.41781e-13   0.00869901   0.00424315 -9.74824e-05 -3.80856e-13 -5.62967e-13  -0.00329213  6.09444e-13  5.39335e-13 -3.49456e-13  1.13883e-12   0.00618629      1.04716    -0.011766     0.011766  3.14632e-13 -8.80155e-13    0.0157872         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " -1.2391e-13 -1.61432e-12   0.00122406   -0.0117181   8.3608e-14  2.75359e-14    -0.033498   -0.0287497  0.000641858 -5.68471e-14  3.67952e-12    0.0216765 -3.38815e-12  6.16994e-13  1.86741e-12  2.77702e-13    -0.011766    -0.011766      1.12284   -0.0818708 -2.44675e-12  2.08718e-14   0.00219346         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.07124e-14  1.07483e-12    0.0117181  -0.00122406  5.10382e-13  9.68256e-14   -0.0287497    -0.033498 -0.000641858 -4.10673e-13 -6.32744e-13   -0.0216765  4.74036e-12 -6.14837e-13  3.31613e-13  1.83097e-13     0.011766     0.011766   -0.0818708      1.12284  3.15425e-12 -1.77637e-13  -0.00219346         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-0.000602106    0.0559783 -1.18497e-12 -1.20519e-12   0.00259817 -2.79462e-05 -2.07791e-11  2.23946e-11 -3.15154e-12 -0.000716831   -0.0110083 -1.17177e-12    0.0173708  -0.00380698   -0.0179771  0.000193363  1.42626e-13 -2.38054e-13  9.93647e-13  7.31655e-13     0.583856  1.12458e-12 -9.89969e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0559783 -0.000602106  5.32353e-13 -1.08669e-12 -2.79462e-05  -0.00259817  1.38133e-12 -1.40117e-12  2.05799e-13   -0.0110083  0.000716831  7.79496e-14  -0.00380698   -0.0173708  0.000193363    0.0179771  4.26445e-13 -1.29051e-12 -2.58231e-13 -1.21204e-13  1.12454e-12     0.583856 -1.55183e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-5.76474e-13 -5.90921e-15   -0.0411785   -0.0411785  4.93688e-15 -3.20663e-13    0.0022281   -0.0022281  0.000260806 -5.39305e-12  2.72112e-14   0.00015516 -1.30766e-13 -5.28898e-13 -1.41769e-13  3.20626e-12    0.0166204    0.0166204   0.00273487  -0.00273487  -1.2056e-12 -1.40379e-11      1.94782         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
