{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-15T03:52:30.210321Z",
     "iopub.status.busy": "2022-01-15T03:52:30.209747Z",
     "iopub.status.idle": "2022-01-15T03:52:43.852380Z",
     "shell.execute_reply": "2022-01-15T03:52:43.853562Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2022-dev gitid: 7607071 (compiled Jan 15 2022, 03:43:01)\r\n",
      "votca_csg, version 2022-dev gitid: 7607071 (compiled Jan 15 2022, 03:26:15)\r\n",
      "votca_tools, version 2022-dev gitid: 7607071 (compiled Jan 15 2022, 03:22:57)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 BohrA\r\n",
      "    0.307132 -3.09903e-11  4.45124e-11 -2.30673e-10  2.34856e-11   -0.0516061   8.5567e-10  7.79139e-10 -3.22629e-10    0.0181639  -0.00105577 -7.15441e-11    0.0103557    0.0375745 -2.02558e-11    0.0421019 -2.33109e-10  1.30738e-10 -3.01401e-10 -1.07167e-10  0.000481556    -0.108408 -1.28198e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.09903e-11     0.307132 -1.47373e-10  7.08424e-11   -0.0516061  2.34856e-11  9.00206e-10  1.08637e-09 -1.97393e-10   0.00105577    0.0181639 -2.25156e-10    0.0375745   -0.0103557    0.0421019 -2.02559e-11 -1.93705e-11  2.13604e-10 -9.73498e-11  5.02032e-12    -0.108408 -0.000481556 -1.34198e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.45124e-11 -1.47373e-10     0.320625   0.00926913  1.56341e-10  1.03022e-10     0.013352     0.013352  -0.00497922 -5.82022e-11 -1.47431e-11   -0.0021213 -8.92454e-11  1.83022e-10 -1.71601e-10 -2.09525e-11    0.0470606   -0.0012868  -0.00258186   -0.0151974  1.82125e-10 -3.04699e-10   -0.0254897          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.30673e-10  7.08424e-11   0.00926913     0.320625 -1.69674e-10   3.2392e-10    -0.013352    -0.013352   0.00497922 -5.01138e-11  6.88434e-11    0.0021213    7.286e-11 -1.44572e-10  6.89714e-11 -1.85825e-10   -0.0012868    0.0470606    0.0151974   0.00258186 -1.68656e-10  7.89042e-10    0.0254897          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.34856e-11   -0.0516061  1.56341e-10 -1.69674e-10     0.490902 -2.88632e-12  1.80088e-09  1.37394e-09  -8.2074e-10 -0.000781216   -0.0134404 -1.98453e-10   0.00770653  -0.00212396    0.0309987  6.69043e-11 -6.52255e-11 -1.89611e-10 -1.33873e-10 -2.73751e-10    0.0531267  0.000235993  1.67536e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0516061  2.34856e-11  1.03022e-10   3.2392e-10 -2.88634e-12     0.490902 -2.54462e-10 -2.67796e-10  1.54951e-10   -0.0134404  0.000781216  1.92619e-11   0.00212396   0.00770653  6.69042e-11    0.0309987  1.91009e-10 -5.11306e-11  9.18314e-11 -1.63005e-10 -0.000235993    0.0531267  2.48388e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  8.5567e-10  9.00206e-10     0.013352    -0.013352  1.80088e-09 -2.54462e-10     0.549564      0.21967   -0.0856649 -7.12986e-12  6.43986e-10   -0.0364959 -1.85459e-09  2.97824e-09 -9.22352e-10  3.15807e-10   -0.0113401  -0.00127547     0.012709   -0.0330648  5.13468e-10  -7.4601e-09  -0.00156795          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 7.79139e-10  1.08637e-09     0.013352    -0.013352  1.37394e-09 -2.67796e-10      0.21967     0.549564   -0.0856649  4.69704e-11  7.52302e-10   -0.0364959 -1.89304e-09  2.96185e-09 -7.15574e-10  2.13178e-10   0.00127547    0.0113401   -0.0330648     0.012709  4.29307e-11 -7.44289e-09  -0.00156795          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.22629e-10 -1.97393e-10  -0.00497922   0.00497922  -8.2074e-10  1.54951e-10   -0.0856649   -0.0856649     0.662947 -1.74987e-10 -2.31597e-10  -0.00632525  4.08457e-10 -7.41261e-10  5.58333e-10 -1.54212e-10   0.00131503  -0.00131503   0.00387728   0.00387728  -9.2001e-10  2.85824e-09   0.00114189          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0181639   0.00105577 -5.82022e-11 -5.01138e-11 -0.000781216   -0.0134404 -7.12986e-12  4.69704e-11 -1.74987e-10     0.680922  1.58781e-12  8.85913e-11  2.70405e-05   7.9727e-05   0.00050117   0.00862237 -3.65689e-10 -3.65571e-11  6.96071e-11  8.83903e-10  -0.00219872   -0.0409686  -8.9606e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -0.00105577    0.0181639 -1.47431e-11  6.88434e-11   -0.0134404  0.000781216  6.43986e-10  7.52302e-10 -2.31597e-10  1.58789e-12     0.680922 -1.12764e-10   7.9727e-05 -2.70405e-05   0.00862237  -0.00050117 -5.78342e-11  8.72131e-10 -5.51735e-10 -1.49489e-10   -0.0409686   0.00219872 -8.14787e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-7.15441e-11 -2.25156e-10   -0.0021213    0.0021213 -1.98453e-10  1.92619e-11   -0.0364959   -0.0364959  -0.00632525  8.85913e-11 -1.12764e-10      0.79826  3.98543e-10 -4.68206e-10 -1.57869e-11 -4.96621e-11   0.00464918  -0.00464918    0.0137078    0.0137078  8.86319e-11  8.70739e-10  0.000452611          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0103557    0.0375745 -8.92454e-11    7.286e-11   0.00770653   0.00212396 -1.85459e-09 -1.89304e-09  4.08457e-10  2.70405e-05   7.9727e-05  3.98543e-10     0.956418   4.2821e-11   -0.0126698  -0.00349187  3.03769e-10 -4.15974e-10  1.05097e-09  1.05035e-09    0.0192792   0.00540571  3.05462e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0375745   -0.0103557  1.83022e-10 -1.44572e-10  -0.00212396   0.00770653  2.97824e-09  2.96185e-09 -7.41261e-10   7.9727e-05 -2.70405e-05 -4.68206e-10  4.28211e-11     0.956418   0.00349187   -0.0126698 -5.76277e-10  5.76894e-10 -1.67361e-09 -1.78582e-09  -0.00540571    0.0192792 -7.79503e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.02558e-11    0.0421019 -1.71601e-10  6.89714e-11    0.0309987  6.69042e-11 -9.22352e-10 -7.15574e-10  5.58333e-10   0.00050117   0.00862237 -1.57869e-11   -0.0126698   0.00349187     0.988566  3.78113e-11  8.52704e-12 -1.86329e-10  2.23369e-10 -1.97766e-11   -0.0223628 -9.93375e-05  3.65982e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0421019 -2.02558e-11 -2.09525e-11 -1.85825e-10  6.69043e-11    0.0309987  3.15807e-10  2.13178e-10 -1.54212e-10   0.00862237  -0.00050117 -4.96621e-11  -0.00349187   -0.0126698  3.78114e-11     0.988566  1.22107e-10  1.21038e-10 -1.17991e-11 -1.89601e-10  9.93376e-05   -0.0223628  4.45798e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.33109e-10 -1.93705e-11    0.0470606   -0.0012868 -6.52255e-11  1.91009e-10   -0.0113401   0.00127547   0.00131503 -3.65689e-10 -5.78342e-11   0.00464918  3.03769e-10 -5.76277e-10  8.52704e-12  1.22107e-10      1.03319  -0.00655519    0.0132302    0.0132302 -5.77245e-11  5.05823e-10  -0.00427408          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.30738e-10  2.13604e-10   -0.0012868    0.0470606 -1.89611e-10 -5.11306e-11  -0.00127547    0.0113401  -0.00131503 -3.65571e-11  8.72131e-10  -0.00464918 -4.15974e-10  5.76894e-10 -1.86329e-10  1.21038e-10  -0.00655519      1.03319   -0.0132302   -0.0132302  6.23395e-11 -5.84874e-10   0.00427408          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.01401e-10 -9.73498e-11  -0.00258186    0.0151974 -1.33873e-10  9.18314e-11     0.012709   -0.0330648   0.00387728  6.96071e-11 -5.51735e-10    0.0137078  1.05097e-09 -1.67361e-09  2.23369e-10 -1.17991e-11    0.0132302   -0.0132302      1.06772    0.0410763 -2.87733e-10   1.4061e-09    0.0020478          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.07167e-10  5.02032e-12   -0.0151974   0.00258186 -2.73751e-10 -1.63005e-10   -0.0330648     0.012709   0.00387728  8.83903e-10 -1.49489e-10    0.0137078  1.05035e-09 -1.78582e-09 -1.97766e-11 -1.89601e-10    0.0132302   -0.0132302    0.0410763      1.06772 -2.10357e-10  1.41082e-09    0.0020478          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-0.000334251    0.0752465 -2.48526e-10   3.0039e-10   -0.0690159  0.000306575 -1.37704e-09 -1.00903e-09  9.71254e-10   0.00165891    0.0309104 -4.50844e-11  -0.00866903   0.00243072    0.0364086  -0.00016173  1.19807e-10 -1.21078e-10   4.8804e-10  4.85251e-10    -0.194424  2.24199e-10  3.79897e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0752465  0.000334251  1.78143e-10 -5.57622e-10 -0.000306574   -0.0690159  5.06001e-09  5.10921e-09 -2.26115e-09    0.0309104  -0.00165891 -7.95698e-10  -0.00243072  -0.00866903   0.00016173    0.0364086 -4.43387e-10  4.48616e-10 -1.20883e-09 -1.21008e-09  2.24199e-10    -0.194424  1.19931e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.04842e-10 -4.79425e-10    -0.014184     0.014184  4.10976e-10  1.86453e-10    0.0043798    0.0043798  -0.00132897  -1.1424e-09 -1.07752e-09  -0.00053272  7.69191e-11  1.04304e-10 -4.14776e-11  1.63504e-10  -0.00597824   0.00597824   0.00149851   0.00149851  3.89336e-09  1.35007e-09      0.95836          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "    0.093811 -1.37753e-11  1.67665e-11 -1.31179e-10  1.44438e-11   -0.0328898  3.54561e-10  2.99676e-10 -1.98333e-10     0.015531 -0.000902728 -3.66634e-11    0.0128409    0.0465915 -2.35346e-11    0.0481429 -2.87519e-10  1.38677e-10 -3.10671e-10 -3.81047e-11  0.000111531   -0.0251078  -4.0115e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.37753e-11     0.093811 -9.50866e-11  4.02015e-11   -0.0328898  1.44439e-11  3.69106e-10  4.83519e-10 -1.23087e-10  0.000902728     0.015531  -1.6676e-10    0.0465915   -0.0128409    0.0481429 -2.35346e-11 -1.28264e-11  2.85393e-10 -7.56039e-11   7.3238e-11   -0.0251078 -0.000111531  -5.1102e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.67665e-11 -9.50866e-11     0.105881   0.00530102  1.02634e-10  7.15304e-11   0.00676412   0.00676412  -0.00366153 -5.18467e-11 -2.03154e-11  -0.00166327 -9.64035e-11  2.03015e-10 -2.10572e-10 -2.54872e-11     0.064066  -0.00170395   -0.0024774   -0.0196647 -6.23661e-11  -1.1126e-11   -0.0418854         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.31179e-10  4.02015e-11   0.00530102     0.105881 -1.09724e-10  2.29065e-10  -0.00676412  -0.00676412   0.00366153 -5.46522e-11  7.12169e-11   0.00166327  7.31608e-11 -1.52741e-10   7.3475e-11 -2.18425e-10  -0.00170395     0.064066    0.0196647    0.0024774  1.33433e-10  1.11378e-10    0.0418854         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.44438e-11   -0.0328898  1.02634e-10 -1.09724e-10     0.240891 -6.90354e-13  1.10446e-09  8.03867e-10 -6.98472e-10 -0.000839529   -0.0144437 -1.60499e-10   0.00881477   -0.0024294    0.0441772  9.30015e-11 -5.66559e-11 -3.34173e-10 -5.74942e-11  -2.8734e-10  -0.00438142 -1.94626e-05  5.20773e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0328898  1.44439e-11  7.15304e-11  2.29065e-10 -6.90359e-13     0.240891 -1.39694e-10 -1.46784e-10  1.24233e-10   -0.0144437  0.000839529  9.89068e-12    0.0024294   0.00881477  9.30015e-11    0.0441772   2.7986e-10 -5.00141e-11  1.11407e-10 -2.79421e-10  1.94626e-05  -0.00438142  4.31968e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.54561e-10  3.69106e-10   0.00676412  -0.00676412  1.10446e-09 -1.39694e-10     0.221861     0.110679   -0.0629947 -1.32737e-12  4.62562e-10   -0.0286158 -1.92762e-09  3.22415e-09 -1.03146e-09  3.28802e-10   -0.0100729  -0.00711441    0.0330987   -0.0292633 -8.01264e-10 -3.84422e-10   0.00293051         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.99676e-10  4.83519e-10   0.00676412  -0.00676412  8.03867e-10 -1.46784e-10     0.110679     0.221861   -0.0629947  4.95742e-11  5.69061e-10   -0.0286158 -1.97789e-09  3.20091e-09 -7.87546e-10  1.91704e-10   0.00711441    0.0100729   -0.0292633    0.0330987 -8.98706e-10 -3.12376e-10   0.00293051         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.98333e-10 -1.23087e-10  -0.00366153   0.00366153 -6.98472e-10  1.24233e-10   -0.0629947   -0.0629947     0.429278 -2.25285e-10 -2.34116e-10   -0.0121538  4.56472e-10 -9.09089e-10  7.69115e-10 -2.08911e-10 -6.19969e-06  6.19971e-06 -1.82794e-05 -1.82794e-05  -7.4561e-11  5.84273e-10  5.85671e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "    0.015531  0.000902728 -5.18467e-11 -5.46522e-11 -0.000839529   -0.0144437 -1.32737e-12  4.95742e-11 -2.25285e-10     0.463967  2.12052e-12  1.17679e-10  0.000207745  0.000612522  0.000602052     0.010358 -6.16155e-10 -6.25675e-11  1.11962e-10  1.49061e-09 -0.000950434   -0.0177094 -1.86775e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-0.000902728     0.015531 -2.03154e-11  7.12169e-11   -0.0144437  0.000839529  4.62562e-10  5.69061e-10 -2.34116e-10  2.12064e-12     0.463967 -1.09256e-10  0.000612522 -0.000207745     0.010358 -0.000602052 -7.67991e-11  1.45545e-09 -8.66983e-10  -1.8826e-10   -0.0177094  0.000950434 -1.77772e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.66634e-11  -1.6676e-10  -0.00166327   0.00166327 -1.60499e-10  9.89068e-12   -0.0286158   -0.0286158   -0.0121538  1.17679e-10 -1.09256e-10     0.636067  5.47685e-10 -6.15266e-10 -6.46656e-11 -6.62028e-11   0.00672211  -0.00672211    0.0198197    0.0198197  1.03284e-10 -8.58753e-12  4.54792e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0128409    0.0465915 -9.64035e-11  7.31608e-11   0.00881477    0.0024294 -1.92762e-09 -1.97789e-09  4.56472e-10  0.000207745  0.000612522  5.47685e-10     0.917068  7.50695e-11   -0.0214902  -0.00592281  5.28422e-10 -7.58244e-10  1.85967e-09  1.85513e-09    0.0223829   0.00627597  1.65254e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0465915   -0.0128409  2.03015e-10 -1.52741e-10   -0.0024294   0.00881477  3.22415e-09  3.20091e-09 -9.09089e-10  0.000612522 -0.000207745 -6.15266e-10  7.50696e-11     0.917068   0.00592281   -0.0214902 -1.02319e-09  1.02772e-09 -2.98453e-09 -3.21435e-09  -0.00627597    0.0223829  1.26413e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.35346e-11    0.0481429 -2.10572e-10   7.3475e-11    0.0441772  9.30015e-11 -1.03146e-09 -7.87546e-10  7.69115e-10  0.000602052     0.010358 -6.46656e-11   -0.0214902   0.00592281     0.981535  7.28842e-11 -3.51093e-12  -3.0597e-10  3.62873e-10  -7.5122e-11   0.00424838  1.88717e-05  3.17044e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481429 -2.35346e-11 -2.54872e-11 -2.18425e-10  9.30015e-11    0.0441772  3.28802e-10  1.91704e-10 -2.08911e-10     0.010358 -0.000602052 -6.62028e-11  -0.00592281   -0.0214902  7.28842e-11     0.981535  2.22879e-10  2.15116e-10 -7.20817e-12 -3.16689e-10 -1.88716e-05   0.00424838  6.75844e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.87519e-10 -1.28264e-11     0.064066  -0.00170395 -5.66559e-11   2.7986e-10   -0.0100729   0.00711441 -6.19969e-06 -6.16155e-10 -7.67991e-11   0.00672211  5.28422e-10 -1.02319e-09 -3.51093e-12  2.22879e-10      1.06906   -0.0127892    0.0247226    0.0247226  4.19563e-11  2.29618e-10   -0.0150525         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.38677e-10  2.85393e-10  -0.00170395     0.064066 -3.34173e-10 -5.00141e-11  -0.00711441    0.0100729  6.19971e-06 -6.25675e-11  1.45545e-09  -0.00672211 -7.58244e-10  1.02772e-09  -3.0597e-10  2.15116e-10   -0.0127892      1.06906   -0.0247226   -0.0247226 -1.38869e-10 -2.90735e-10    0.0150525         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.10671e-10 -7.56039e-11   -0.0024774    0.0196647 -5.74942e-11  1.11407e-10    0.0330987   -0.0292633 -1.82794e-05  1.11962e-10 -8.66983e-10    0.0198197  1.85967e-09 -2.98453e-09  3.62873e-10 -7.20817e-12    0.0247226   -0.0247226      1.13356    0.0772971  1.18975e-10  4.33678e-10   0.00544857         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.81047e-11   7.3238e-11   -0.0196647    0.0024774  -2.8734e-10 -2.79421e-10   -0.0292633    0.0330987 -1.82794e-05  1.49061e-09  -1.8826e-10    0.0198197  1.85513e-09 -3.21435e-09  -7.5122e-11 -3.16689e-10    0.0247226   -0.0247226    0.0772971      1.13356  1.80308e-10  3.37036e-10   0.00544857         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 0.000254783   -0.0573567  6.44441e-13  4.60008e-11  -0.00347861  1.54523e-05 -3.27937e-10 -5.32548e-10 -4.01792e-12 -0.000546927   -0.0101908 -2.33225e-11    0.0179489   -0.0050327    0.0191591 -8.51065e-05 -6.16827e-14  9.07832e-11  5.04978e-11  2.62756e-10     0.600541  2.24732e-10  2.81253e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0573567 -0.000254783 -1.63885e-10  3.70718e-10 -1.54523e-05  -0.00347861  -3.8577e-09 -3.80972e-09  6.45025e-10   -0.0101908  0.000546927  1.38946e-10    0.0050327    0.0179489  8.51065e-05    0.0191591 -1.49295e-10 -6.08952e-11 -1.42147e-10 -5.13223e-11  2.24732e-10     0.600541  7.08733e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.28213e-10 -3.21243e-10   -0.0423663    0.0423663  6.07593e-10  5.83242e-10   0.00289981   0.00289981 -0.000442818 -1.66946e-09 -1.60314e-09 -0.000216745  1.09831e-10  1.72888e-10  4.07539e-10  8.27903e-10   -0.0160942    0.0160942   0.00533123   0.00533123  3.14878e-09  5.25791e-10       1.9849         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.1"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
