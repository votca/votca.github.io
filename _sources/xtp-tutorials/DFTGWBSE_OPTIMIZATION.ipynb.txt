{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2021-10-04T08:40:33.722165Z",
     "iopub.status.busy": "2021-10-04T08:40:33.721340Z",
     "iopub.status.idle": "2021-10-04T08:41:27.296292Z",
     "shell.execute_reply": "2021-10-04T08:41:27.300242Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2022-dev gitid: 0c165ff (compiled Oct  4 2021, 08:29:02)\r\n",
      "votca_csg, version 2022-dev gitid: 0c165ff (compiled Oct  4 2021, 08:10:07)\r\n",
      "votca_tools, version 2022-dev gitid: 0c165ff (compiled Oct  4 2021, 08:06:41)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 Bohr\r\n",
      "... ... \r\n",
      "... ... =========== OPTIMIZATION SUMMARY ================================= \r\n",
      "... ... At iteration  0\r\n",
      "... ...  ---- POSITIONS (Angstrom)   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    +0.0000  +0.0000  +0.0000\r\n",
      "... ...    1    +1.2000  +0.0000  +0.0000\r\n",
      "... ...    Total energy:     -112.26831841 Hartree \r\n",
      "... ...    Trust radius:       0.01889726 Bohr     \r\n",
      "... ...  ---- FORCES (Hartree/Bohr)   \r\n",
      "... ...       central differences   \r\n",
      "... ...       displacement 0.0010 Angstrom   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    -0.1314  -0.0000  -0.0000\r\n",
      "... ...    1    +0.1314  +0.0000  +0.0000A\r\n",
      "     0.30157   -6.074e-14  4.02387e-11 -2.02997e-11  4.69993e-14    -0.051948  5.69795e-13  5.67099e-13  -1.8968e-13 -3.27701e-05    0.0176765 -7.69963e-14  0.000120923    0.0390252 -3.69919e-14    0.0423787 -1.36732e-12  1.26446e-12 -8.37335e-14 -8.33745e-14   1.7466e-05    -0.107191 -1.70519e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-6.07469e-14      0.30157  5.36876e-13 -5.39504e-13    -0.051948  4.70233e-14  -2.4786e-10 -2.67799e-10  9.53369e-11    0.0176765  3.27701e-05  3.87787e-11    0.0390252 -0.000120923    0.0423787 -3.70068e-14 -1.94845e-13  1.95202e-13   3.8803e-11  3.89059e-11    -0.107191  -1.7466e-05 -5.15328e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.02387e-11  5.36876e-13     0.310829    0.0100807  2.87455e-13 -2.44311e-11 -0.000429202 -0.000429202  0.000168021  1.88622e-13  1.10804e-11  7.54728e-05 -4.71833e-14 -4.61617e-12 -4.26713e-14  5.02983e-11    0.0492365  -0.00195729  0.000219191   7.2692e-05 -2.07837e-12 -5.29244e-11   -0.0248115          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.02997e-11 -5.39504e-13    0.0100807     0.310829  -2.8442e-13  -4.2056e-13  0.000429202  0.000429202 -0.000168021 -2.08617e-13 -1.09697e-12 -7.54728e-05  4.16959e-14  2.75509e-12  3.57624e-14  4.09753e-13  -0.00195729    0.0492365  -7.2692e-05 -0.000219191  2.09013e-12  1.21974e-11    0.0248115          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.69888e-14    -0.051948  2.87455e-13  -2.8442e-13     0.487116 -8.21124e-15 -1.79508e-10 -1.54656e-10  8.36868e-11   -0.0136235 -2.52562e-05   4.0134e-11   0.00828371 -2.56678e-05    0.0302057  1.31335e-13 -1.35858e-13  1.27909e-13   2.8284e-11   2.5846e-11    0.0548637  8.93964e-06 -1.35951e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   -0.051948  4.70053e-14 -2.44311e-11  -4.2056e-13 -8.20651e-15     0.487116  3.07564e-13  3.10669e-13 -1.66006e-13  2.52562e-05   -0.0136235  -7.9915e-14  2.56678e-05   0.00828371  1.31368e-13    0.0302057  2.31166e-12  1.26274e-13 -4.43177e-14 -5.22693e-14 -8.93964e-06    0.0548637  5.55811e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.69795e-13  -2.4786e-10 -0.000429202  0.000429202 -1.79508e-10  3.07564e-13     0.542343     0.221434   -0.0906322  -1.0174e-10  3.53334e-14   -0.0407107  1.29283e-11 -7.36625e-14  7.33086e-11 -4.50198e-14  2.54222e-05 -0.000171921     0.013298   -0.0339812  1.06724e-09 -2.00864e-12  7.48849e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.67099e-13 -2.67799e-10 -0.000429202  0.000429202 -1.54656e-10  3.10669e-13     0.221434     0.542343   -0.0906322 -1.11724e-10  1.53463e-14   -0.0407107  1.47894e-11 -7.91125e-14  2.26005e-11 -5.19679e-14  0.000171921 -2.54222e-05   -0.0339812     0.013298  1.10725e-09  -1.9967e-12  7.48849e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -1.8968e-13  9.53369e-11  0.000168021 -0.000168021  8.36868e-11 -1.66006e-13   -0.0906322   -0.0906322     0.660145  6.15267e-11 -8.17608e-15  -0.00527337   3.1207e-12 -1.58343e-14 -3.30995e-11  6.54146e-14 -2.33877e-05  2.33877e-05   0.00472241   0.00472241 -3.60908e-10  6.42514e-13 -4.77174e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.27701e-05    0.0176765  1.88622e-13 -2.08617e-13   -0.0136235  2.52562e-05  -1.0174e-10 -1.11724e-10  6.15267e-11     0.669023  1.20821e-15  8.25924e-12 -9.83186e-06  4.86922e-08   0.00903066 -1.67417e-05 -2.23259e-14  5.20326e-14  4.78348e-12  1.05562e-11   -0.0409884  6.93088e-05 -1.26776e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0176765  3.27701e-05  1.10804e-11 -1.09697e-12 -2.52562e-05   -0.0136235  3.53334e-14  1.53464e-14 -8.17617e-15  1.24122e-15     0.669023 -1.13826e-15 -4.86922e-08 -9.83186e-06  1.67417e-05   0.00903066  1.87604e-12 -7.64875e-12    7.843e-15  3.75594e-14 -6.93088e-05   -0.0409884 -7.91665e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-7.69963e-14  3.87787e-11  7.54728e-05 -7.54728e-05   4.0134e-11 -7.99149e-14   -0.0407107   -0.0407107  -0.00527337  8.25924e-12 -1.13826e-15     0.793384 -1.18503e-11  6.00041e-14   3.8509e-12 -7.73244e-15 -7.55127e-05  7.55127e-05    0.0152474    0.0152474 -1.38599e-10  2.45716e-13 -2.03394e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 0.000120923    0.0390252 -4.71833e-14  4.16959e-14   0.00828371  2.56678e-05  1.29283e-11  1.47894e-11   3.1207e-12 -9.83186e-06 -4.86922e-08 -1.18503e-11     0.954425  3.68256e-14   -0.0128944 -3.99545e-05 -2.53767e-14  2.34659e-14  1.11241e-11  -3.3259e-12    0.0199053  6.49215e-05  1.53888e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0390252 -0.000120923 -4.61617e-12  2.75509e-12 -2.56678e-05   0.00828371 -7.36625e-14 -7.91125e-14 -1.58343e-14  4.86922e-08 -9.83186e-06  6.00041e-14  3.68416e-14     0.954425  3.99545e-05   -0.0128944   6.2185e-12  8.23146e-12  -2.4278e-14 -2.61803e-14 -6.49215e-05    0.0199053  6.00231e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.69911e-14    0.0423787 -4.26713e-14  3.57625e-14    0.0302057  1.31395e-13  7.33086e-11  2.26005e-11 -3.30995e-11   0.00903066  1.67417e-05   3.8509e-12   -0.0128944  3.99545e-05     0.974684  7.47367e-14  5.24555e-14  6.79669e-15 -1.51508e-11  3.20139e-12   -0.0229107 -3.73313e-06  4.07074e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0423787 -3.70049e-14  5.02983e-11  4.09753e-13  1.31333e-13    0.0302057 -4.50198e-14 -5.19678e-14  6.54146e-14 -1.67417e-05   0.00903066 -7.73244e-15 -3.99545e-05   -0.0128944  7.47307e-14     0.974684 -1.25443e-11 -5.80795e-12 -3.44833e-14  2.47883e-14  3.73313e-06   -0.0229107  5.53219e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.36732e-12 -1.94845e-13    0.0492365  -0.00195729 -1.35858e-13  2.31166e-12  2.54222e-05  0.000171921 -2.33877e-05 -2.23259e-14  1.87604e-12 -7.55127e-05 -2.53767e-14   6.2185e-12  5.24555e-14 -1.25443e-11      1.02179  -0.00208517 -0.000211786 -0.000211786  7.61025e-13  8.34156e-12  -0.00474207          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.26446e-12  1.95202e-13  -0.00195729    0.0492365  1.27909e-13  1.26274e-13 -0.000171921 -2.54222e-05  2.33877e-05  5.20326e-14 -7.64875e-12  7.55127e-05  2.34658e-14  8.23146e-12   6.7967e-15 -5.80795e-12  -0.00208517      1.02179  0.000211786  0.000211786 -7.79992e-13  -2.7154e-12   0.00474207          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-8.37334e-14   3.8803e-11  0.000219191  -7.2692e-05   2.8284e-11 -4.43177e-14     0.013298   -0.0339812   0.00472241  4.78348e-12  7.84301e-15    0.0152474  1.11241e-11 -2.42781e-14 -1.51508e-11 -3.44833e-14 -0.000211786  0.000211786      1.06455    0.0448476 -1.50634e-10  3.09152e-13 -3.89744e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-8.33745e-14  3.89059e-11   7.2692e-05 -0.000219191   2.5846e-11 -5.22693e-14   -0.0339812     0.013298   0.00472241  1.05562e-11  3.75594e-14    0.0152474  -3.3259e-12 -2.61804e-14  3.20139e-12  2.47883e-14 -0.000211786  0.000211786    0.0448476      1.06455 -1.56188e-10  2.90173e-13 -3.89744e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.21615e-05    0.0746367  1.24799e-12 -1.25394e-12   -0.0699591  1.13993e-05 -6.27389e-10 -6.46471e-10   2.6582e-10     0.030442  5.14755e-05   1.1874e-10  -0.00918481  2.99565e-05    0.0362981 -5.91451e-06 -5.70712e-13  5.57444e-13  1.15491e-10  1.11589e-10    -0.195037  3.97001e-13 -1.04116e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0746367  1.21615e-05  4.46806e-11 -2.50218e-11 -1.13993e-05   -0.0699591  1.18188e-12  1.17657e-12 -4.66691e-13 -5.14755e-05     0.030442 -2.08544e-13 -2.99565e-05  -0.00918481  5.91451e-06    0.0362981  1.67482e-12  2.11255e-12 -1.95385e-13 -2.08264e-13  3.96942e-13    -0.195037 -4.35659e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  3.9622e-11  1.00884e-13   -0.0141051    0.0141051   1.2393e-13 -1.12402e-11   -0.0001232   -0.0001232  3.83282e-05  1.16933e-14  1.93483e-11  1.60504e-05 -2.70352e-14 -6.23467e-12  3.84649e-14  4.44162e-11  -0.00610205   0.00610205 -1.15796e-05 -1.15796e-05 -1.15838e-12 -4.38804e-10     0.942221          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0906271 -2.66268e-14    2.379e-11 -9.47641e-12  2.86737e-14   -0.0326354  2.39021e-13  2.37086e-13 -1.19131e-13 -2.75615e-05    0.0148669 -5.07387e-14  0.000149115    0.0481236  -4.2264e-14    0.0477892 -8.41376e-13  3.24595e-13 -6.23527e-14 -6.06351e-14  3.98809e-06   -0.0244755  2.72448e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.66363e-14    0.0906271  2.25448e-13 -2.27348e-13   -0.0326354  2.86848e-14 -9.71214e-11 -1.11435e-10  5.98688e-11    0.0148669  2.75615e-05  2.55576e-11    0.0481236 -0.000149115    0.0477892 -4.22731e-14 -1.46868e-13  1.48583e-13  2.93419e-11  2.98587e-11   -0.0244755 -3.98809e-06  6.04027e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   2.379e-11  2.25448e-13    0.0997343     0.005538  1.70392e-13 -1.60475e-11 -0.000210061 -0.000210061  0.000120911  1.34045e-13  1.04385e-11  5.87514e-05 -2.52536e-14 -4.99365e-12  -5.2302e-14  6.16289e-11    0.0659136  -0.00225719  0.000262624  6.53787e-05 -2.67825e-13 -7.29593e-12   -0.0408447         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-9.47641e-12 -2.27348e-13     0.005538    0.0997343 -1.68403e-13 -3.49656e-13  0.000210061  0.000210061 -0.000120911 -1.54011e-13 -4.61961e-13 -5.87514e-05  1.79235e-14  2.50865e-12  4.37451e-14  1.10454e-12  -0.00225719    0.0659136 -6.53787e-05 -0.000262624  2.73575e-13 -1.40923e-11    0.0408447         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.86666e-14   -0.0326354  1.70392e-13 -1.68403e-13     0.236919  -3.3528e-15 -1.07962e-10 -9.15646e-11  7.17826e-11    -0.014389 -2.66754e-05  3.85677e-11   0.00947398 -2.93559e-05    0.0425853  1.80167e-13 -1.36378e-13   1.2652e-13  2.85488e-11  2.55356e-11  -0.00365057 -5.94833e-07 -2.77604e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0326354  2.86694e-14 -1.60475e-11 -3.49656e-13 -3.34552e-15     0.236919   1.8235e-13  1.84387e-13 -1.42436e-13  2.66754e-05    -0.014389  -7.6878e-14  2.93559e-05   0.00947398  1.80205e-13    0.0425853  2.76407e-12  2.49068e-13 -4.25265e-14 -5.23874e-14  5.94833e-07  -0.00365057 -3.19335e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.39021e-13 -9.71214e-11 -0.000210061  0.000210061 -1.07962e-10   1.8235e-13     0.213043     0.107771   -0.0652205 -7.23408e-11  3.02067e-14   -0.0316911  1.11131e-13 -9.21828e-15  8.97858e-11 -5.51421e-14 -4.82723e-05 -0.000148972    0.0344212   -0.0292352  1.37231e-10 -2.72364e-13 -5.30646e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.37086e-13 -1.11435e-10 -0.000210061  0.000210061 -9.15646e-11  1.84387e-13     0.107771     0.213043   -0.0652205 -8.23173e-11  1.02473e-14   -0.0316911  2.59616e-12 -1.65012e-14  2.70524e-11 -6.37487e-14  0.000148972  4.82723e-05   -0.0292352    0.0344212  1.58425e-10 -2.65483e-13 -5.30646e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.19131e-13  5.98688e-11  0.000120911 -0.000120911  7.17826e-11 -1.42436e-13   -0.0652205   -0.0652205     0.424482  6.67829e-11 -8.85688e-15   -0.0113321  1.12918e-11 -5.72931e-14 -4.48472e-11  8.86417e-14 -2.97903e-06  2.97903e-06  0.000601522  0.000601522 -8.46642e-11  1.53127e-13 -1.90144e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.75615e-05    0.0148669  1.34045e-13 -1.54011e-13    -0.014389  2.66754e-05 -7.23408e-11 -8.23173e-11  6.67829e-11     0.448028  1.59501e-15  5.53461e-12  0.000495536 -2.45414e-06     0.010767 -1.99607e-05  1.19765e-14  4.05093e-14 -1.93995e-12  8.26646e-12   -0.0177615  3.00336e-05 -6.35653e-15         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0148669  2.75615e-05  1.04385e-11 -4.61961e-13 -2.66754e-05    -0.014389  3.02068e-14  1.02475e-14 -8.85701e-15  1.63875e-15     0.448028 -7.95057e-16  2.45414e-06  0.000495536  1.99607e-05     0.010767  3.28144e-12 -1.34878e-11  1.50825e-14   6.7586e-14 -3.00336e-05   -0.0177615  1.47306e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-5.07388e-14  2.55576e-11  5.87514e-05 -5.87514e-05  3.85677e-11 -7.68779e-14   -0.0316911   -0.0316911   -0.0113321  5.53461e-12 -7.95051e-16     0.627711 -1.66125e-11  8.41013e-14   8.8033e-12 -1.76071e-14 -0.000108253  0.000108253    0.0218583    0.0218583 -1.37204e-11  2.38058e-14 -9.96846e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 0.000149115    0.0481236 -2.52536e-14  1.79235e-14   0.00947398  2.93559e-05  1.11131e-13  2.59616e-12  1.12918e-11  0.000495536  2.45414e-06 -1.66125e-11     0.913264  6.32783e-14   -0.0216063 -6.69491e-05 -6.87967e-14  6.49359e-14   2.6269e-11 -2.88273e-12    0.0227534  7.42109e-05 -3.91676e-15         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481236 -0.000149115 -4.99365e-12  2.50865e-12 -2.93559e-05   0.00947398 -9.21829e-15 -1.65011e-14 -5.72931e-14 -2.45414e-06  0.000495536  8.41013e-14  6.33127e-14     0.913264  6.69491e-05   -0.0216063  1.28126e-11  1.63391e-11 -6.69999e-14 -7.08441e-14 -7.42109e-05    0.0227534  4.45721e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-4.22635e-14    0.0477892 -5.23019e-14  4.37451e-14    0.0425853  1.80243e-13  8.97858e-11  2.70524e-11 -4.48472e-11     0.010767  1.99607e-05   8.8033e-12   -0.0216063  6.69491e-05     0.954146  1.41947e-13  8.93438e-14   1.7572e-14 -2.56711e-11  7.44514e-12   0.00328347  5.35017e-07   1.1052e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0477892 -4.22721e-14  6.16289e-11  1.10454e-12  1.80165e-13    0.0425853  -5.5142e-14 -6.37486e-14  8.86417e-14 -1.99607e-05     0.010767 -1.76071e-14 -6.69491e-05   -0.0216063   1.4194e-13     0.954146  -2.1152e-11 -1.19643e-11 -5.81461e-14  4.88071e-14 -5.35016e-07   0.00328347  5.04446e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-8.41376e-13 -1.46868e-13    0.0659136  -0.00225719 -1.36378e-13  2.76407e-12 -4.82723e-05  0.000148972 -2.97903e-06  1.19765e-14  3.28144e-12 -0.000108253 -6.87967e-14  1.28126e-11  8.93438e-14  -2.1152e-11      1.04646  -0.00440181 -0.000393207 -0.000393207  2.78576e-13  1.69239e-11   -0.0159302         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.24595e-13  1.48583e-13  -0.00225719    0.0659136   1.2652e-13  2.49068e-13 -0.000148972  4.82723e-05  2.97903e-06  4.05093e-14 -1.34878e-11  0.000108253  6.49357e-14  1.63391e-11   1.7572e-14 -1.19643e-11  -0.00440181      1.04646  0.000393207  0.000393207 -3.26135e-13 -2.99395e-12    0.0159302         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.23527e-14  2.93419e-11  0.000262624 -6.53787e-05  2.85488e-11 -4.25265e-14    0.0344212   -0.0292352  0.000601522 -1.93995e-12  1.50825e-14    0.0218583   2.6269e-11 -6.69999e-14 -2.56711e-11  -5.8146e-14 -0.000393207  0.000393207      1.12585    0.0837957  -5.0561e-11  1.73217e-13 -8.10352e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.06351e-14  2.98587e-11  6.53787e-05 -0.000262624  2.55356e-11 -5.23874e-14   -0.0292352    0.0344212  0.000601522  8.26646e-12   6.7586e-14    0.0218583 -2.88273e-12 -7.08443e-14  7.44514e-12  4.88071e-14 -0.000393207  0.000393207    0.0837957      1.12585 -6.45042e-11  1.26016e-13 -8.10352e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 9.13746e-06   -0.0560778 -1.11468e-12  1.12266e-12  -0.00265972  4.33382e-07   5.8295e-10  6.11055e-10 -9.01046e-11   -0.0109729 -1.85545e-05 -1.84701e-11    0.0178433 -5.81965e-05      0.01806 -2.94275e-06 -1.24049e-13  5.19001e-14   3.1115e-11  9.89666e-12     0.585022  4.20308e-13 -6.86726e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0560778 -9.13746e-06 -1.91357e-11 -9.07497e-12 -4.33382e-07  -0.00265972 -1.10873e-12 -1.10005e-12  1.70549e-13  1.85545e-05   -0.0109729  3.69361e-14  5.81965e-05    0.0178433  2.94275e-06      0.01806  1.87679e-11  2.33624e-12  4.02214e-14 -3.12067e-14  4.20276e-13     0.585022 -4.37627e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.04364e-11  4.69259e-14   -0.0412954    0.0412954 -3.28603e-14 -1.34017e-11 -5.54934e-05 -5.54934e-05 -2.12002e-07  9.86506e-15  1.74155e-12  7.89576e-07  7.05177e-15  4.62965e-12  7.60171e-14  4.93373e-11    -0.016839     0.016839 -7.14864e-05 -7.14864e-05 -8.47549e-13   -4.322e-10      1.94795         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.9.7"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
