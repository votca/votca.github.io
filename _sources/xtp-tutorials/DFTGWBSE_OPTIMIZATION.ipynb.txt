{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-12-16T06:06:46.691043Z",
     "iopub.status.busy": "2022-12-16T06:06:46.690804Z",
     "iopub.status.idle": "2022-12-16T06:06:53.267352Z",
     "shell.execute_reply": "2022-12-16T06:06:53.266679Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2023-dev gitid: 9140004 (compiled Dec 16 2022, 05:58:29)\r\n",
      "votca_csg, version 2023-dev gitid: 9140004 (compiled Dec 16 2022, 05:43:34)\r\n",
      "votca_tools, version 2023-dev gitid: 9140004 (compiled Dec 16 2022, 05:40:54)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 BohrA\r\n",
      "    0.307557  1.81706e-15  6.85458e-15  7.40637e-15   -0.0515784 -3.15104e-16  4.78256e-11 -2.37476e-11  6.05477e-12    0.0182326  4.66132e-06  1.29807e-11    0.0389702 -0.000292267   -0.0420794 -1.78554e-16  1.15335e-13 -3.86838e-14 -1.51515e-11 -4.96678e-12    -0.108498  6.29038e-06 -7.65787e-16          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.81652e-15     0.307557 -3.93711e-12  2.01409e-11  -1.2692e-16   -0.0515784  9.99471e-15 -1.05882e-14  1.63997e-15  4.66132e-06   -0.0182326  3.83188e-15 -0.000292267   -0.0389702 -2.23896e-16   -0.0420794  8.72446e-12  1.46032e-12  6.32684e-14 -1.33955e-14  6.29038e-06     0.108498  1.40771e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 6.85462e-15 -3.93711e-12     0.320545   -0.0100423  5.81701e-14 -4.69825e-12  5.89066e-05 -5.89066e-05 -2.18463e-05 -5.51291e-16  9.17878e-12 -9.26477e-06 -1.19117e-15 -2.23158e-13 -1.22799e-14 -2.31612e-15  -0.00205842     0.049553 -2.49361e-05 -0.000381134  1.38474e-14 -3.08162e-12   -0.0253868          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 7.40637e-15  2.01409e-11   -0.0100423     0.320545  5.58146e-14 -5.36653e-11  5.89066e-05 -5.89066e-05 -2.18463e-05  3.53559e-15 -4.45561e-12 -9.26477e-06  1.68401e-14  2.18052e-12  -1.0298e-14  3.03454e-11    -0.049553   0.00205842 -0.000381134 -2.49361e-05  1.49923e-14  3.04627e-11   -0.0253868          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0515784 -1.28588e-16  5.81701e-14  5.58146e-14     0.491199  8.24264e-16  1.63508e-10 -2.12475e-10 -9.28085e-11     -0.01345 -3.43861e-06 -4.06119e-11   0.00797182 -5.97867e-05   -0.0310586  1.98151e-15  1.98137e-13 -2.36398e-13 -2.52718e-11 -3.03584e-11    0.0529951 -3.07249e-06  1.87447e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.18111e-16   -0.0515784 -4.69825e-12 -5.36653e-11  8.19475e-16     0.491199  6.83665e-14  -6.6026e-14 -2.95728e-14 -3.43861e-06      0.01345 -1.29094e-14 -5.97867e-05  -0.00797182  2.14493e-15   -0.0310586 -7.63555e-12  2.54893e-12 -6.75023e-14 -2.92921e-14 -3.07249e-06   -0.0529951  5.00626e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.78256e-11  9.99471e-15  5.89066e-05  5.89066e-05  1.63508e-10  6.83665e-14     0.550957    -0.220369   -0.0854511  1.15143e-11  1.38491e-15   -0.0362389 -1.28509e-13  3.68921e-16 -9.80193e-12 -1.36068e-14 -8.35146e-05 -0.000272683    0.0124021   -0.0350924  2.10434e-11  -6.2115e-15  1.88882e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.37476e-11 -1.05881e-14 -5.89066e-05 -5.89066e-05 -2.12475e-10  -6.6026e-14    -0.220369     0.550957    0.0854511  2.12019e-12  2.70368e-15    0.0362389 -2.27518e-12  1.76417e-14  4.01496e-11  1.16773e-14 -0.000272683 -8.35146e-05    0.0350924   -0.0124021 -5.37889e-11  6.89257e-15 -1.88882e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 6.05477e-12  1.64016e-15 -2.18463e-05 -2.18463e-05 -9.28085e-11 -2.95728e-14   -0.0854511    0.0854511     0.663153  9.49883e-12 -1.70149e-16  -0.00639727 -7.94657e-12    6.215e-14   5.9038e-12  1.95075e-15 -3.13881e-05  3.13881e-05   0.00404725   0.00404725 -4.36222e-11  1.33897e-14 -4.76242e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0182326  4.66132e-06  -5.5128e-16  3.53581e-15     -0.01345 -3.43861e-06  1.15143e-11  2.12019e-12  9.49883e-12     0.681816  2.78428e-16 -9.47435e-12   9.1396e-05 -7.08815e-07  -0.00860647 -2.20031e-06 -6.05815e-15 -6.32791e-15  7.42674e-13 -8.06259e-13   -0.0410286   1.2868e-05  3.03553e-15          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.66132e-06   -0.0182326  9.17878e-12 -4.45561e-12 -3.43861e-06      0.01345  1.38492e-15  2.70382e-15 -1.70093e-16  3.58404e-16     0.681816  4.25454e-16  7.08815e-07   9.1396e-05 -2.20031e-06   0.00860647 -2.24224e-13  1.77314e-12 -1.84468e-15 -1.42387e-14  -1.2868e-05   -0.0410286 -1.08986e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.29807e-11  3.83188e-15 -9.26477e-06 -9.26477e-06 -4.06119e-11 -1.29092e-14   -0.0362389    0.0362389  -0.00639727 -9.47435e-12  4.25472e-16      0.79863  6.72015e-12 -5.27116e-14  1.02099e-11  3.59436e-15 -0.000111782  0.000111782    0.0144134    0.0144134 -4.27028e-11  1.41311e-14 -2.01438e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0389702 -0.000292267 -1.19117e-15  1.68401e-14   0.00797182 -5.97867e-05 -1.28509e-13 -2.27518e-12 -7.94657e-12   9.1396e-05  7.08815e-07  6.72015e-12     0.956559 -1.56263e-14    0.0131601 -9.86978e-05 -7.78728e-14  7.82733e-14  7.32758e-12   9.3749e-12    0.0200319  0.000149073  2.09485e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-0.000292267   -0.0389702 -2.23158e-13  2.18052e-12 -5.97867e-05  -0.00797182   3.6892e-16  1.76417e-14  6.21501e-14 -7.08815e-07   9.1396e-05 -5.27116e-14 -1.56522e-14     0.956559 -9.86978e-05   -0.0131601 -2.70659e-12  6.59258e-13  -7.8771e-14 -7.83512e-14 -0.000149073    0.0200319  2.45887e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0420794 -2.33128e-16 -1.22799e-14  -1.0298e-14   -0.0310586  2.13509e-15 -9.80193e-12  4.01496e-11   5.9038e-12  -0.00860647 -2.20031e-06  1.02099e-11    0.0131601 -9.86978e-05     0.989636  9.26885e-17  -1.3075e-13   1.0404e-13  1.69077e-11  1.33627e-11    0.0223203 -1.29406e-06  4.94479e-15          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.81487e-16   -0.0420794 -2.31614e-15  3.03454e-11  1.98192e-15   -0.0310586 -1.36069e-14  1.16772e-14  1.95076e-15 -2.20031e-06   0.00860647  3.59436e-15 -9.86978e-05   -0.0131601  9.38562e-17     0.989636  -1.8906e-12 -1.65437e-12 -9.19878e-15  1.75144e-14 -1.29406e-06   -0.0223203 -2.04149e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.15335e-13  8.72446e-12  -0.00205842    -0.049553  1.98137e-13 -7.63555e-12 -8.35146e-05 -0.000272683 -3.13881e-05 -6.05815e-15 -2.24224e-13 -0.000111782 -7.78728e-14 -2.70659e-12  -1.3075e-13  -1.8906e-12      1.02923   -0.0020693 -0.000337752 -0.000337752 -4.10027e-14  1.80676e-11   0.00469334          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.86838e-14  1.46032e-12     0.049553   0.00205842 -2.36398e-13  2.54893e-12 -0.000272683 -8.35146e-05  3.13881e-05 -6.32791e-15  1.77314e-12  0.000111782  7.82734e-14  6.59258e-13   1.0404e-13 -1.65437e-12   -0.0020693      1.02923  0.000337752  0.000337752  -1.2001e-13  3.60512e-12  -0.00469334          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.51515e-11  6.32684e-14 -2.49361e-05 -0.000381134 -2.52718e-11 -6.75023e-14    0.0124021    0.0350924   0.00404725  7.42674e-13 -1.84467e-15    0.0144134  7.32758e-12  -7.8771e-14  1.69077e-11 -9.19879e-15 -0.000337752  0.000337752      1.07278    0.0456171  5.96661e-12  1.36555e-13  4.30894e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-4.96678e-12 -1.33955e-14 -0.000381134 -2.49361e-05 -3.03584e-11 -2.92921e-14   -0.0350924   -0.0124021   0.00404725 -8.06259e-13 -1.42387e-14    0.0144134   9.3749e-12 -7.83512e-14  1.33627e-11  1.75144e-14 -0.000337752  0.000337752    0.0456171      1.07278 -1.55519e-11 -2.55921e-14  4.30894e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "    0.075296 -4.36542e-06 -9.03908e-15 -9.70268e-15   -0.0689447  3.99719e-06 -7.70537e-12  3.73676e-11  3.99084e-11    0.0309921  9.72019e-06  2.69243e-11  -0.00898896  6.68938e-05   -0.0364163   2.1113e-06  9.09254e-14 -1.97195e-14 -1.20397e-11 -2.49024e-12     -0.19441  2.85986e-14 -7.28762e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-4.36542e-06    -0.075296  3.44393e-12 -2.71674e-11  3.99719e-06    0.0689447  4.79012e-15 -5.76893e-15 -1.29132e-14 -9.72019e-06    0.0309921 -8.50107e-15 -6.68938e-05  -0.00898896   2.1113e-06    0.0364163 -7.91931e-12 -1.73899e-12 -5.60991e-14  1.61657e-14  2.85656e-14     -0.19441 -7.98695e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 9.72889e-15 -6.01937e-12   -0.0144102   -0.0144102  6.48952e-14 -5.60636e-11  4.96323e-05 -4.96323e-05 -1.67492e-05  5.06312e-15  1.65278e-11 -7.14536e-06 -2.58958e-14 -3.44694e-12 -2.12524e-14  4.11865e-11   0.00614382  -0.00614382  4.85063e-05  4.85063e-05 -6.43263e-14 -9.63329e-11     0.957553          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "    0.094057  8.83728e-16   3.1889e-15  3.48935e-15   -0.0329085 -2.53038e-16   2.3918e-11 -1.07039e-11  5.66254e-12    0.0156091  3.99059e-06  1.35053e-11    0.0483421 -0.000362554   -0.0481685 -2.77475e-16  1.28583e-13 -3.76044e-14 -1.69243e-11 -4.83693e-12   -0.0251553  1.45842e-06  7.91202e-15         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 8.79782e-16     0.094057 -2.23079e-12  1.09834e-11 -1.35293e-16   -0.0329085  4.61036e-15 -4.93414e-15  1.61098e-15  3.99059e-06   -0.0156091  4.08518e-15 -0.000362554   -0.0483421 -3.36529e-16   -0.0481685  1.06188e-11  1.46868e-12  7.75476e-14 -1.34466e-14  1.45842e-06    0.0251553  -1.7346e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.18893e-15 -2.23079e-12     0.105938  -0.00570609  3.53777e-14 -2.77352e-12    2.992e-05   -2.992e-05 -1.60912e-05  2.53475e-16  9.47567e-12 -7.26753e-06 -3.38872e-16 -1.31581e-13 -1.47783e-14 -2.47856e-14  -0.00242542    0.0671898 -2.67709e-05 -0.000512488  6.35698e-16 -4.28752e-13   -0.0420449         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.48934e-15  1.09834e-11  -0.00570609     0.105938  3.34844e-14 -4.13368e-11    2.992e-05   -2.992e-05 -1.60912e-05  4.80003e-15 -5.52153e-12 -7.26753e-06  1.89781e-14  2.44464e-12 -1.21819e-14  3.98866e-11   -0.0671898   0.00242542 -0.000512488 -2.67709e-05  1.09199e-15  4.23106e-12   -0.0420449         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0329085 -1.36757e-16  3.53777e-14  3.34844e-14     0.241204  7.41047e-16  8.89813e-11 -1.27545e-10 -7.79352e-11   -0.0144728 -3.70009e-06 -3.67569e-11   0.00911822 -6.83844e-05   -0.0442994  2.71987e-15  1.86078e-13 -2.19151e-13 -2.36953e-11 -2.81052e-11  -0.00443755  2.57275e-07  8.17711e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.53562e-16   -0.0329085 -2.77352e-12 -4.13368e-11  7.29206e-16     0.241204   4.1007e-14 -3.91244e-14 -2.48346e-14 -3.70009e-06    0.0144728 -1.16987e-14 -6.83844e-05  -0.00911822  2.94114e-15   -0.0442994 -7.97803e-12  3.56804e-12 -6.95984e-14 -3.65954e-14  2.57275e-07   0.00443755 -4.12297e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  2.3918e-11  4.61034e-15    2.992e-05    2.992e-05  8.89813e-11   4.1007e-14      0.22297    -0.111325   -0.0629404    1.639e-11  1.29418e-15   -0.0284268  2.16132e-13 -2.46717e-15 -7.62978e-12 -1.60359e-14 -0.000243623 -0.000242094    0.0336283   -0.0311361 -4.13973e-12  1.77199e-15  6.72703e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.07039e-11 -4.93408e-15   -2.992e-05   -2.992e-05 -1.27545e-10 -3.91244e-14    -0.111325      0.22297    0.0629404 -1.39278e-12  3.25396e-15    0.0284268 -2.79237e-12  2.17595e-14  4.75411e-11  1.35091e-14 -0.000242094 -0.000243623    0.0311361   -0.0336283 -6.57842e-13 -2.06951e-15 -6.72703e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 5.66254e-12  1.61116e-15 -1.60912e-05 -1.60912e-05 -7.79352e-11 -2.48346e-14   -0.0629404    0.0629404      0.42963  9.32894e-12  1.97858e-17   -0.0122085 -1.22463e-11  9.58029e-14  7.87009e-12  2.58837e-15  5.11186e-07 -5.11186e-07 -6.59134e-05 -6.59134e-05 -6.82935e-12  1.79379e-15 -2.15711e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0156091  3.99059e-06  2.53481e-16  4.80026e-15   -0.0144728 -3.70009e-06    1.639e-11 -1.39278e-12  9.32894e-12     0.465176  3.31892e-16 -1.57169e-11  0.000658378 -5.10601e-06   -0.0103444 -2.64463e-06 -1.75087e-14 -9.45968e-15  2.18996e-12 -1.20121e-12   -0.0177317  5.56127e-06  1.06066e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.99059e-06   -0.0156091  9.47567e-12 -5.52153e-12 -3.70009e-06    0.0144728  1.29415e-15  3.25414e-15  1.98753e-17  4.42968e-16     0.465176  7.51455e-16  5.10601e-06  0.000658378 -2.64463e-06    0.0103444  1.49197e-13  3.24194e-12  9.92132e-16 -2.59866e-14 -5.56127e-06   -0.0177317  1.06285e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.35053e-11  4.08517e-15 -7.26753e-06 -7.26753e-06 -3.67569e-11 -1.16984e-14   -0.0284268    0.0284268   -0.0122085 -1.57169e-11  7.51481e-16     0.636701  1.15994e-11 -9.09444e-14  1.83937e-11  6.37844e-15 -0.000161724  0.000161724    0.0208531    0.0208531 -2.55629e-11  9.31734e-15 -9.48826e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0483421 -0.000362554 -3.38874e-16  1.89781e-14   0.00911822 -6.83844e-05  2.16132e-13 -2.79237e-12 -1.22463e-11  0.000658378  5.10601e-06  1.15994e-11     0.917337   -2.834e-14    0.0223423 -0.000167562 -1.50178e-13  1.50982e-13  1.36995e-11  1.81378e-11    0.0232844  0.000173278 -8.00584e-15         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-0.000362554   -0.0483421 -1.31581e-13  2.44464e-12 -6.83844e-05  -0.00911822 -2.46717e-15  2.17595e-14  9.58029e-14 -5.10601e-06  0.000658378 -9.09444e-14 -2.83861e-14     0.917337 -0.000167562   -0.0223423 -5.65194e-12   1.2136e-12 -1.51886e-13 -1.51043e-13 -0.000173278    0.0232844 -1.49303e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0481685 -3.48136e-16 -1.47783e-14  -1.2182e-14   -0.0442994   2.9246e-15 -7.62978e-12  4.75411e-11  7.87009e-12   -0.0103444 -2.64463e-06  1.83937e-11    0.0223423 -0.000167562     0.983661  2.24406e-16 -2.49022e-13  1.86472e-13  3.22667e-11  2.39692e-11  -0.00432401  2.50692e-07 -1.48899e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " -2.8277e-16   -0.0481685 -2.47856e-14  3.98866e-11  2.72288e-15   -0.0442994  -1.6036e-14   1.3509e-14  2.58837e-15 -2.64463e-06    0.0103444  6.37844e-15 -0.000167562   -0.0223423  2.19542e-16     0.983661 -5.47465e-12 -2.82285e-12 -3.21723e-14  3.03833e-14  2.50692e-07   0.00432401  1.26243e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.28583e-13  1.06188e-11  -0.00242542   -0.0671898  1.86078e-13 -7.97803e-12 -0.000243623 -0.000242094  5.11186e-07 -1.75087e-14  1.49197e-13 -0.000161724 -1.50178e-13 -5.65194e-12 -2.49022e-13 -5.47465e-12      1.06175  -0.00440928 -0.000631446 -0.000631446 -5.13808e-14   2.1392e-11    0.0159966         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.76044e-14  1.46868e-12    0.0671898   0.00242542 -2.19151e-13  3.56804e-12 -0.000242094 -0.000243623 -5.11186e-07 -9.45967e-15  3.24194e-12  0.000161724  1.50982e-13   1.2136e-12  1.86472e-13 -2.82285e-12  -0.00440928      1.06175  0.000631446  0.000631446 -1.31978e-13  3.21477e-12   -0.0159966         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.69243e-11  7.75476e-14 -2.67709e-05 -0.000512488 -2.36953e-11 -6.95984e-14    0.0336283    0.0311361 -6.59134e-05  2.18996e-12  9.92136e-16    0.0208531  1.36995e-11 -1.51886e-13  3.22667e-11 -3.21723e-14 -0.000631446  0.000631446      1.14317    0.0858243  7.42042e-12  1.63064e-13  0.000136957         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-4.83693e-12 -1.34466e-14 -0.000512488 -2.67709e-05 -2.81052e-11 -3.65954e-14   -0.0311361   -0.0336283 -6.59134e-05 -1.20121e-12 -2.59866e-14    0.0208531  1.81378e-11 -1.51043e-13  2.39692e-11  3.03833e-14 -0.000631446  0.000631446    0.0858243      1.14317 -1.70533e-11 -2.08615e-14  0.000136957         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0574548  3.33104e-06  2.93959e-15   3.7542e-15  -0.00354178  2.05341e-07  4.68791e-12 -9.68625e-12  2.23426e-12   -0.0101472 -3.18253e-06 -1.18412e-11    0.0187027 -0.000139181    -0.019244   1.1157e-06   6.3375e-14 -1.48897e-13 -7.84536e-12 -1.92409e-11     0.601743  2.74532e-16 -4.16606e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.33104e-06    0.0574548  3.79717e-13  5.19085e-12  2.05341e-07   0.00354178  2.41791e-15 -2.53669e-15 -1.57414e-15  3.18253e-06   -0.0101472  4.19628e-15  0.000139181    0.0187027   1.1157e-06     0.019244  9.65441e-12  1.74381e-12  7.76417e-14 -7.54532e-15  2.07904e-16     0.601743   5.2606e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.96767e-15  5.13858e-12   -0.0425254   -0.0425254  6.96555e-14 -1.05694e-11  6.20798e-05 -6.20798e-05  -2.2638e-05  8.91188e-15 -2.14386e-11 -1.00975e-05  5.89669e-15  2.74104e-13 -1.28121e-14 -1.75332e-12    0.0169494   -0.0169494  0.000142174  0.000142174 -2.33569e-14  4.41386e-11       1.9854         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
