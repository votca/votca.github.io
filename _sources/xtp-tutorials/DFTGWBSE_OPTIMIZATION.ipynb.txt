{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-13T05:12:37.711422Z",
     "iopub.status.busy": "2022-01-13T05:12:37.710693Z",
     "iopub.status.idle": "2022-01-13T05:13:02.502850Z",
     "shell.execute_reply": "2022-01-13T05:13:02.503257Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2022-dev gitid: 66f9b18 (compiled Jan 13 2022, 05:04:39)\r\n",
      "votca_csg, version 2022-dev gitid: 66f9b18 (compiled Jan 13 2022, 04:50:15)\r\n",
      "votca_tools, version 2022-dev gitid: 66f9b18 (compiled Jan 13 2022, 04:48:06)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 BohrA\r\n",
      "    0.306708 -4.51804e-14  1.22458e-10   3.9043e-10 -3.30113e-14    0.0516336  1.95442e-13 -1.92014e-13 -4.97158e-14  -1.4491e-06   -0.0181563  2.92368e-14 -1.04534e-05    0.0389795  -2.8295e-14    0.0421241  1.94746e-11  -2.6157e-11  3.96094e-14  3.76395e-14  2.63515e-07    -0.108303   1.6043e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-4.52067e-14     0.306708  1.75402e-13  1.71911e-13    0.0516336 -3.28656e-14 -1.74359e-09  2.01157e-09  5.34415e-10    0.0181563  -1.4491e-06 -3.16684e-10   -0.0389795 -1.04534e-05    0.0421241 -2.82781e-14  1.18895e-13 -1.16896e-13  -3.2947e-10 -3.36152e-10    -0.108303 -2.63515e-07  2.30668e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.22458e-10  1.75402e-13     0.319156   -0.0100481 -1.01745e-13   -4.198e-11 -1.84023e-05  1.84023e-05  6.87734e-06  6.39776e-14 -4.28649e-11 -2.94313e-06  5.32664e-14 -2.56197e-11 -3.40518e-14 -1.63903e-11   -0.0495092   0.00204416 -3.49959e-06 -1.62286e-05 -5.91473e-13  -1.5833e-11    0.0252874          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  3.9043e-10  1.71911e-13   -0.0100481     0.319156 -1.06627e-13  3.67901e-10 -1.84023e-05  1.84023e-05  6.87734e-06  5.75678e-14 -1.10116e-10 -2.94313e-06  5.51558e-14 -3.30933e-11 -3.81918e-14  3.13124e-10  -0.00204416    0.0495092 -1.62286e-05 -3.49959e-06 -5.83962e-13 -5.25147e-10    0.0252874          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.30176e-14    0.0516336 -1.01745e-13 -1.06627e-13     0.490609 -5.38752e-15  1.69885e-09 -1.28897e-09  -7.5566e-10    0.0134761 -1.07556e-06  2.05863e-10    0.0080157  2.14962e-06   -0.0309388 -9.53799e-14  -6.2635e-14  6.39063e-14  1.87759e-10  1.83891e-10    -0.053272 -1.29618e-07 -3.29352e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0516336 -3.28532e-14   -4.198e-11  3.67901e-10  -5.3786e-15     0.490609 -1.21154e-13  1.26065e-13  6.91598e-14 -1.07556e-06   -0.0134761 -1.90441e-14  2.14962e-06   -0.0080157  -9.5324e-14   -0.0309388  1.41584e-11 -1.80257e-11 -1.07679e-14 -1.20326e-14  1.29618e-07    -0.053272  9.98375e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.95442e-13 -1.74359e-09 -1.84023e-05 -1.84023e-05  1.69885e-09 -1.21154e-13     0.549726    -0.220522   -0.0861688 -7.16777e-10 -1.82526e-14    0.0368756 -5.42593e-10 -1.96381e-13  7.89528e-10 -4.30719e-14 -1.23201e-05 -4.08867e-07   -0.0125301     0.034935  6.78358e-09 -6.48565e-13 -2.45503e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.92014e-13  2.01157e-09  1.84023e-05  1.84023e-05 -1.28897e-09  1.26065e-13    -0.220522     0.549726    0.0861688  7.84029e-10   1.1841e-14   -0.0368756  5.50067e-10  1.98266e-13 -4.60014e-10  4.71688e-14 -4.08867e-07 -1.23201e-05    -0.034935    0.0125301 -7.28253e-09  6.41213e-13  2.45503e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-4.97158e-14  5.34415e-10  6.87734e-06  6.87734e-06  -7.5566e-10  6.91598e-14   -0.0861688    0.0861688     0.662739  4.24852e-10  5.32661e-15   0.00625217  6.14588e-11  2.20455e-14 -4.50125e-10  4.11191e-14  1.44108e-06 -1.44108e-06  -0.00414117  -0.00414117 -1.82084e-09  1.60702e-13  1.68373e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -1.4491e-06    0.0181563  6.39777e-14  5.75679e-14    0.0134761 -1.07556e-06 -7.16777e-10  7.84029e-10  4.24852e-10     0.680027 -2.08974e-15 -3.11521e-11  -7.6988e-05 -2.67909e-08   0.00866729 -6.91757e-07  3.06459e-14 -3.17059e-14 -9.37655e-11  -8.8745e-11   -0.0410255  3.17453e-06  4.49032e-15          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0181563  -1.4491e-06 -4.28649e-11 -1.10116e-10 -1.07556e-06   -0.0134761 -1.82525e-14  1.18409e-14  5.32646e-15 -1.94645e-15     0.680027 -3.77744e-16  2.67909e-08  -7.6988e-05 -6.91757e-07  -0.00866729  1.45174e-11  -1.9538e-11  5.75151e-15  4.68321e-15  3.17453e-06    0.0410255 -1.18009e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.92368e-14 -3.16684e-10 -2.94313e-06 -2.94313e-06  2.05863e-10 -1.90441e-14    0.0368756   -0.0368756   0.00625217 -3.11521e-11 -3.77765e-16     0.797893 -2.21528e-10 -7.94718e-14 -6.39474e-11  5.91196e-15 -5.05814e-06  5.05814e-06    0.0145354    0.0145354  9.57151e-10 -8.44934e-14 -6.74442e-07          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.04534e-05   -0.0389795  5.32664e-14  5.51558e-14    0.0080157  2.14962e-06 -5.42593e-10  5.50067e-10  6.14588e-11  -7.6988e-05  2.67909e-08 -2.21528e-10     0.956279 -5.06993e-14    0.0131238   3.5195e-06  1.05236e-13 -1.03778e-13 -2.31212e-10 -3.46022e-10   -0.0200194 -5.41743e-06  2.33293e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0389795 -1.04534e-05 -2.56197e-11 -3.30933e-11  2.14962e-06   -0.0080157 -1.96381e-13  1.98266e-13  2.20455e-14 -2.67909e-08  -7.6988e-05 -7.94718e-14 -5.07548e-14     0.956279   3.5195e-06   -0.0131238  4.62596e-11  6.85497e-11 -1.07798e-13 -1.06361e-13 -5.41743e-06    0.0200194 -4.89095e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.82767e-14    0.0421241 -3.40519e-14 -3.81918e-14   -0.0309388 -9.53576e-14  7.89528e-10 -4.60014e-10 -4.50125e-10   0.00866729 -6.91757e-07 -6.39474e-11    0.0131238   3.5195e-06     0.987501  5.23935e-14  1.12971e-14  3.85515e-14   1.3445e-10 -4.39278e-11   -0.0224113 -5.45296e-08 -2.59827e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0421241 -2.82559e-14 -1.63903e-11  3.13124e-10 -9.53969e-14   -0.0309388 -4.30718e-14  4.71686e-14  4.11191e-14 -6.91757e-07  -0.00866729  5.91196e-15   3.5195e-06   -0.0131238  5.24263e-14     0.987501 -6.74218e-11 -1.10956e-10  2.83822e-14 -2.14526e-14  5.45296e-08   -0.0224113 -1.30106e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.94746e-11  1.18895e-13   -0.0495092  -0.00204416  -6.2635e-14  1.41584e-11 -1.23201e-05 -4.08867e-07  1.44108e-06  3.06459e-14  1.45174e-11 -5.05814e-06  1.05236e-13  4.62596e-11  1.12971e-14 -6.74218e-11      1.02819   -0.0020693 -1.51161e-05 -1.51161e-05 -4.35753e-13  1.80132e-12  -0.00469072          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -2.6157e-11 -1.16896e-13   0.00204416    0.0495092  6.39063e-14 -1.80257e-11 -4.08867e-07 -1.23201e-05 -1.44108e-06 -3.17059e-14  -1.9538e-11  5.05814e-06 -1.03778e-13  6.85497e-11  3.85515e-14 -1.10956e-10   -0.0020693      1.02819  1.51161e-05  1.51161e-05  4.10137e-13  8.99704e-11   0.00469072          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.96094e-14  -3.2947e-10 -3.49959e-06 -1.62286e-05  1.87759e-10 -1.07679e-14   -0.0125301    -0.034935  -0.00414117 -9.37655e-11  5.75152e-15    0.0145354 -2.31212e-10 -1.07798e-13   1.3445e-10  2.83822e-14 -1.51161e-05  1.51161e-05      1.07163    0.0455077  1.15778e-09 -1.35109e-13 -2.39169e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.76395e-14 -3.36152e-10 -1.62286e-05 -3.49959e-06  1.83891e-10 -1.20326e-14     0.034935    0.0125301  -0.00414117  -8.8745e-11  4.68317e-15    0.0145354 -3.46022e-10 -1.06362e-13 -4.39278e-11 -2.14526e-14 -1.51161e-05  1.51161e-05    0.0455077      1.07163   1.2482e-09 -1.09245e-13 -2.39169e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.83075e-07    0.0752424  3.23654e-13  3.18621e-13    0.0690969 -1.68122e-07 -3.52652e-09   3.8526e-09  1.17254e-09    0.0309264 -2.39306e-06 -8.30841e-10   0.00901647  2.43994e-06    0.0363998 -8.85655e-08  2.48195e-13 -2.47801e-13 -7.12841e-10 -7.14106e-10    -0.194835   3.4301e-13  3.10665e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0752424  1.83074e-07  1.03398e-10  4.38778e-10  1.68122e-07    0.0690969  3.45119e-13 -3.40414e-13 -1.02004e-13 -2.39306e-06   -0.0309264  7.31427e-14  2.43994e-06  -0.00901647  8.85655e-08    0.0363998 -7.75986e-12  4.82537e-12  6.07298e-14  5.99435e-14  3.42976e-13    -0.194835  2.30345e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.58821e-10 -3.40876e-14    0.0143253    0.0143253  3.12382e-14 -1.71047e-10  5.83491e-06 -5.83491e-06 -1.76498e-06 -7.57167e-15 -4.79007e-11  7.09429e-07 -5.75903e-15  -8.1851e-12 -1.59216e-15 -2.22422e-10  -0.00613235   0.00613235 -1.40294e-06 -1.40294e-06  3.79914e-13  2.19098e-09     0.954926          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0935659 -2.01492e-14  6.09655e-11  2.33642e-10 -2.03124e-14    0.0328713  8.47958e-14 -8.25835e-14 -3.07602e-14 -1.23751e-06   -0.0155052  2.01421e-14 -1.29566e-05    0.0483139 -3.28941e-14    0.0481173   1.9872e-11 -2.29724e-11  3.37137e-14  3.27018e-14  6.09416e-08   -0.0250466 -5.23673e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.01726e-14    0.0935659  7.70221e-14  7.47806e-14    0.0328713 -2.02267e-14 -6.93484e-10  8.66161e-10  3.29987e-10    0.0155052 -1.23751e-06 -2.18245e-10   -0.0483139 -1.29566e-05    0.0481173 -3.28813e-14  9.97615e-14  -9.8718e-14 -2.78098e-10 -2.81198e-10   -0.0250466 -6.09417e-08 -1.66543e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.09655e-11  7.70221e-14      0.10504  -0.00568231 -5.98142e-14 -2.62123e-11 -9.29833e-06  9.29833e-06  5.04907e-06  4.91416e-14  -4.1169e-11 -2.30661e-06  4.92742e-14  -2.6251e-11 -3.84308e-14 -2.15886e-11   -0.0670098   0.00240141 -3.29901e-06 -2.06254e-05 -1.02426e-13  9.09167e-11    0.0419176         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.33642e-10  7.47806e-14  -0.00568231      0.10504 -6.32618e-14  2.63301e-10 -9.29833e-06  9.29833e-06  5.04907e-06  4.27076e-14 -1.08726e-10 -2.30661e-06  5.11286e-14 -3.35764e-11 -4.35475e-14  3.84219e-10  -0.00240141    0.0670098 -2.06254e-05 -3.29901e-06  -9.9961e-14 -8.33994e-11    0.0419176         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.03196e-14    0.0328713 -5.98143e-14 -6.32618e-14     0.240584 -2.20029e-15  1.05286e-09 -7.63349e-10 -6.49827e-10    0.0144632 -1.15434e-06  1.73493e-10   0.00916843  2.45876e-06   -0.0440553 -1.32274e-13 -5.47855e-14  5.16364e-14  1.51136e-10  1.63432e-10   0.00432456  1.05222e-08 -2.54668e-15         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0328713  -2.0216e-14 -2.62123e-11  2.63301e-10 -2.18972e-15     0.240584  -7.1861e-14   7.5332e-14  5.94842e-14 -1.15434e-06   -0.0144632 -1.61442e-14  2.45876e-06  -0.00916843 -1.32201e-13   -0.0440553  2.41342e-11 -1.18383e-11 -9.73972e-15 -6.58093e-15 -1.05222e-08   0.00432456 -2.19109e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 8.47959e-14 -6.93484e-10 -9.29833e-06 -9.29833e-06  1.05286e-09  -7.1861e-14     0.221542     -0.11082   -0.0632617 -5.30872e-10 -1.58563e-14    0.0289004 -4.89916e-10  -1.7734e-13  9.26879e-10 -4.91237e-14 -1.09321e-05 -6.39438e-06   -0.0337442    0.0308642  1.18894e-09 -1.15526e-13  3.56895e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-8.25837e-14  8.66161e-10  9.29833e-06  9.29833e-06 -7.63349e-10   7.5332e-14     -0.11082     0.221542    0.0632617  5.98429e-10  9.41569e-15   -0.0289004  4.97242e-10  1.79185e-13 -5.21071e-10  5.41894e-14 -6.39438e-06 -1.09321e-05   -0.0308642    0.0337442 -1.36166e-09  1.12801e-13 -3.56895e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.07602e-14  3.29987e-10  5.04907e-06  5.04907e-06 -6.49827e-10  5.94842e-14   -0.0632617    0.0632617     0.428924  4.79328e-10   6.0236e-15     0.012098  1.75705e-11  6.33532e-15 -6.21667e-10  5.68004e-14  9.53497e-09 -9.53494e-09 -2.74002e-05 -2.74002e-05 -4.95217e-10   4.3725e-14  2.72652e-07         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.23751e-06    0.0155052  4.91416e-14  4.27077e-14    0.0144632 -1.15434e-06 -5.30872e-10  5.98429e-10  4.79328e-10     0.462759 -2.75574e-15  2.96473e-13 -0.000635208 -2.21045e-07    0.0104064 -8.30558e-07  2.87659e-14 -2.94883e-14 -8.94167e-11 -8.39328e-11   -0.0177344  1.37228e-06 -1.97035e-15         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0155052 -1.23751e-06  -4.1169e-11 -1.08726e-10 -1.15434e-06   -0.0144632 -1.58562e-14  9.41559e-15  6.02338e-15 -2.55432e-15     0.462759  4.98316e-18  2.21045e-07 -0.000635208 -8.30558e-07   -0.0104064  3.07983e-11 -3.62823e-11  1.16653e-14  1.09298e-14  1.37228e-06    0.0177344 -1.14127e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.01421e-14 -2.18245e-10 -2.30661e-06 -2.30661e-06  1.73493e-10 -1.61442e-14    0.0289004   -0.0289004     0.012098  2.96473e-13  4.94698e-18     0.635437    -3.22e-10 -1.15537e-13 -1.32652e-10  1.22235e-14 -7.30881e-06  7.30881e-06     0.021003     0.021003  1.07108e-10 -8.91303e-15 -1.49448e-07         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.29566e-05   -0.0483139  4.92742e-14  5.11286e-14   0.00916843  2.45876e-06 -4.89916e-10  4.97242e-10  1.75705e-11 -0.000635208  2.21045e-07    -3.22e-10     0.916802 -8.90667e-14    0.0222399  5.96422e-06  1.80238e-13  -1.7729e-13 -3.71311e-10 -6.02973e-10   -0.0232165 -6.28259e-06  3.60769e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0483139 -1.29566e-05  -2.6251e-11 -3.35764e-11  2.45876e-06  -0.00916843  -1.7734e-13  1.79185e-13  6.33528e-15 -2.21045e-07 -0.000635208 -1.15537e-13 -8.91765e-14     0.916802  5.96422e-06   -0.0222399  9.04566e-11  1.41205e-10 -1.84426e-13 -1.81519e-13 -6.28259e-06    0.0232165  -1.0423e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.28749e-14    0.0481173 -3.84309e-14 -4.35475e-14   -0.0440553 -1.32251e-13  9.26879e-10 -5.21071e-10 -6.21667e-10    0.0104064 -8.30558e-07 -1.32652e-10    0.0222399  5.96422e-06      0.97942   1.0076e-13  3.12071e-14  6.03765e-14  2.15076e-10  -1.1263e-10   0.00417248  1.01522e-08 -4.26326e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481173 -3.28549e-14 -2.15886e-11  3.84219e-10   -1.323e-13   -0.0440553 -4.91236e-14  5.41891e-14  5.68004e-14 -8.30558e-07   -0.0104064  1.22236e-14  5.96422e-06   -0.0222399  1.00829e-13      0.97942 -1.31024e-10 -1.96683e-10  5.25381e-14 -3.90199e-14 -1.01522e-08   0.00417248 -4.31217e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  1.9872e-11  9.97615e-14   -0.0670098  -0.00240141 -5.47855e-14  2.41342e-11 -1.09321e-05 -6.39438e-06  9.53497e-09  2.87659e-14  3.07983e-11 -7.30881e-06  1.80238e-13  9.04566e-11  3.12071e-14 -1.31024e-10       1.0596  -0.00440413  -2.8233e-05  -2.8233e-05 -2.48642e-13 -2.35524e-11   -0.0159918         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.29724e-11  -9.8718e-14   0.00240141    0.0670098  5.16364e-14 -1.18383e-11 -6.39438e-06 -1.09321e-05 -9.53494e-09 -2.94883e-14 -3.62823e-11  7.30881e-06  -1.7729e-13  1.41205e-10  6.03765e-14 -1.96683e-10  -0.00440413       1.0596   2.8233e-05   2.8233e-05  2.08738e-13  1.64385e-10    0.0159918         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.37137e-14 -2.78098e-10 -3.29901e-06 -2.06254e-05  1.51136e-10 -9.73973e-15   -0.0337442   -0.0308642 -2.74002e-05 -8.94167e-11  1.16653e-14     0.021003 -3.71311e-10 -1.84426e-13  2.15076e-10  5.25381e-14  -2.8233e-05   2.8233e-05      1.14073     0.085536  5.62041e-10 -1.08896e-13 -5.91796e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.27018e-14 -2.81198e-10 -2.06254e-05 -3.29901e-06  1.63432e-10 -6.58093e-15    0.0308642    0.0337442 -2.74002e-05 -8.39328e-11  1.09297e-14     0.021003 -6.02973e-10 -1.81519e-13  -1.1263e-10 -3.90199e-14  -2.8233e-05   2.8233e-05     0.085536      1.14073  7.02584e-10 -6.90304e-14 -5.91796e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.39304e-07   -0.0572532  -3.4602e-13 -3.42206e-13   0.00341529 -8.30982e-09   4.1284e-09 -4.38905e-09 -6.37935e-10   -0.0102623   7.9409e-07  1.16523e-10   -0.0185867 -5.02974e-06    0.0190696 -4.63989e-08 -5.28742e-14 -3.85532e-15 -5.04661e-11  1.50414e-10     0.599386  3.30193e-13  2.66811e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0572532 -1.39304e-07  8.19174e-11 -1.79426e-10  8.30984e-09   0.00341529 -3.91425e-13  3.87494e-13  5.89108e-14   7.9409e-07    0.0102623 -1.11183e-14 -5.02974e-06    0.0185867  4.63988e-08    0.0190696  2.12095e-11  1.78422e-10  -6.1138e-14 -4.81979e-15  3.30196e-13     0.599386  2.61312e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.18676e-11 -8.36984e-15    0.0423952    0.0423952  8.83339e-15  5.25864e-11  3.56411e-06 -3.56411e-06 -4.39986e-07 -7.45578e-15 -8.87905e-11  2.24464e-07  3.22473e-14 -1.15882e-10 -3.31935e-14 -4.93167e-10    -0.016942     0.016942 -5.63132e-06 -5.63132e-06  3.40785e-13  2.39357e-09       1.9863         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.1"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
