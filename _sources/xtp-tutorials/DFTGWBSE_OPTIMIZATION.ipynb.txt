{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2023-03-24T05:17:56.815057Z",
     "iopub.status.busy": "2023-03-24T05:17:56.814761Z",
     "iopub.status.idle": "2023-03-24T05:18:48.238636Z",
     "shell.execute_reply": "2023-03-24T05:18:48.237822Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/votca/issues\r\n",
      "\r\n",
      "xtp_tools, version 2024-dev gitid: f763d12 (compiled Mar 24 2023, 05:15:13)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 Bohr\r\n",
      "... ... \r\n",
      "... ... =========== OPTIMIZATION SUMMARY ================================= \r\n",
      "... ... At iteration  0\r\n",
      "... ...  ---- POSITIONS (Angstrom)   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    +0.0000  +0.0000  +0.0000\r\n",
      "... ...    1    +1.2000  +0.0000  +0.0000\r\n",
      "... ...    Total energy:     -112.26831841 Hartree \r\n",
      "... ...    Trust radius:       0.01889726 Bohr     \r\n",
      "... ...  ---- FORCES (Hartree/Bohr)   \r\n",
      "... ...       central differences   \r\n",
      "... ...       displacement 0.0010 Angstrom   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    -0.1314  -0.0000  -0.0000\r\n",
      "... ...    1    +0.1314  +0.0000  +0.0000A\r\n",
      "    0.301149 -1.39334e-12   7.7138e-10 -8.91837e-10  -1.2146e-09 -1.05651e-09   -0.0519724  1.02459e-12  -5.9644e-10    -0.014201    0.0104572 -2.27605e-10    0.0390246  -0.00057161    0.0423984 -8.09113e-13 -1.52379e-10 -3.07378e-10  1.94122e-10 -4.07369e-10    -0.107077  -0.00210332  6.29166e-11 -1.14731e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.39334e-12     0.301149 -1.58944e-10  3.17034e-10  -2.1071e-10 -9.02534e-11   1.0246e-12   -0.0519724  7.82882e-12   -0.0104572    -0.014201  3.46025e-12  -0.00057161   -0.0390246 -8.09119e-13    0.0423984 -2.09696e-10  3.55157e-12  -1.6167e-10  6.67179e-12  -0.00210332     0.107077   6.0049e-11  1.55715e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  7.7138e-10 -1.58944e-10     0.391575    -0.071342    -0.110578    -0.110578 -1.73598e-10  9.06402e-11   -0.0539632 -3.35676e-11  1.20307e-10   -0.0243252  1.88469e-09 -6.35886e-11  1.17509e-10 -2.98121e-11    0.0363541   -0.0109051    0.0169614   -0.0176536 -7.96151e-09 -4.17953e-10   -0.0242999       0.0221          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-8.91837e-10  3.17034e-10    -0.071342     0.391575     0.110578     0.110578  2.17196e-10 -1.45677e-10    0.0539632  3.41507e-11 -1.25606e-10    0.0243252 -1.90437e-09  3.80645e-11 -2.11826e-10  1.52666e-10    0.0109051   -0.0363541   -0.0176536    0.0169614  8.04991e-09   5.3648e-10    0.0242999       0.0221          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -1.2146e-09  -2.1071e-10    -0.110578     0.110578     0.460316     0.140083  2.96355e-10  1.10164e-10    0.0732829  1.45093e-10 -3.89662e-11    0.0330341 -2.58583e-09 -1.90669e-12 -2.88249e-10 -1.12998e-10    0.0167371    0.0174294   -0.0210447   -0.0262145  1.09362e-08  1.63121e-10  -0.00962705 -0.000245882          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.05651e-09 -9.02534e-11    -0.110578     0.110578     0.140083     0.460316  2.41318e-10  6.65664e-11    0.0732829  1.39793e-10 -3.95494e-11    0.0330341 -2.56031e-09 -2.15818e-11 -1.65395e-10 -1.86812e-11    0.0174294    0.0167371    0.0262145    0.0210447  1.08167e-08  2.52332e-10  -0.00962705  0.000245881          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0519724   1.0246e-12 -1.73598e-10  2.17196e-10  2.96355e-10  2.41318e-10     0.486835 -2.42449e-13  1.72843e-10    0.0109793  -0.00808478  3.80703e-11   0.00830517 -0.000121649    0.0301449  2.92604e-12 -9.03759e-11  1.00394e-10   1.2713e-10   1.3518e-10    0.0549834   0.00108004 -4.14906e-11  8.66695e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.02459e-12   -0.0519724  9.06402e-11 -1.45677e-10  1.10164e-10  6.65664e-11 -2.42445e-13     0.486835  6.64981e-13   0.00808478    0.0109793  3.72944e-13 -0.000121649  -0.00830517  2.92603e-12    0.0301449  2.69757e-10  7.44696e-12  2.00315e-10 -9.54527e-12   0.00108004   -0.0549834  2.31678e-10 -1.18409e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -5.9644e-10  7.82882e-12   -0.0539632    0.0539632    0.0732829    0.0732829  1.72843e-10  6.64981e-13     0.659928   2.6995e-10 -2.04821e-10  -0.00518518  -7.7755e-10   4.2585e-12 -1.32472e-10  3.21135e-13   0.00288501   0.00288501  -0.00380005   0.00380005  5.24706e-09  1.72521e-10    0.0026302 -3.65855e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   -0.014201   -0.0104572 -3.35676e-11  3.41507e-11  1.45093e-10  1.39793e-10    0.0109793   0.00808478   2.6995e-10     0.668107  7.26317e-13 -7.88122e-11  1.34717e-05 -1.02278e-05  -0.00729555  -0.00537221  -2.5823e-11 -3.26052e-11  1.08822e-09   -4.368e-11    0.0334724   -0.0236485  7.98769e-10  -6.2919e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0104572    -0.014201  1.20307e-10 -1.25606e-10 -3.89662e-11 -3.95494e-11  -0.00808478    0.0109793 -2.04821e-10  7.26413e-13     0.668107  5.91293e-11 -1.02278e-05 -1.34717e-05   0.00537221  -0.00729555  1.07309e-09  2.85591e-11 -2.51774e-11  1.83952e-11   -0.0236485   -0.0334724  1.12884e-09 -1.27518e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.27605e-10  3.46025e-12   -0.0243252    0.0243252    0.0330341    0.0330341  3.80703e-11  3.72944e-13  -0.00518518 -7.88122e-11  5.91293e-11     0.793012 -5.00994e-10   3.6687e-12 -7.51911e-11  9.00966e-13   0.00925417   0.00925417   -0.0121893    0.0121893  1.99954e-09  6.76241e-11    0.0010745 -1.88808e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0390246  -0.00057161  1.88469e-09 -1.90437e-09 -2.58583e-09 -2.56031e-09   0.00830517 -0.000121649  -7.7755e-10  1.34717e-05 -1.02278e-05 -5.00994e-10     0.954263  -3.9935e-13   -0.0128737  0.000188566 -1.21905e-09 -1.11217e-09   1.6062e-09 -1.46467e-09    0.0198846  0.000682048 -1.23028e-10  2.94452e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -0.00057161   -0.0390246 -6.35886e-11  3.80645e-11 -1.90669e-12 -2.15818e-11 -0.000121649  -0.00830517   4.2585e-12 -1.02278e-05 -1.34717e-05   3.6687e-12 -3.99351e-13     0.954263  0.000188566    0.0128737 -5.56093e-11  8.59254e-11 -5.67806e-11  -5.0106e-11 -0.000682048    0.0198846  3.53198e-11  3.81447e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0423984 -8.09119e-13  1.17509e-10 -2.11826e-10 -2.88249e-10 -1.65395e-10    0.0301449  2.92603e-12 -1.32472e-10  -0.00729555   0.00537221 -7.51911e-11   -0.0128737  0.000188566     0.973645  1.58444e-12 -1.18158e-10 -3.30824e-11  1.60117e-10 -4.18062e-11   -0.0229461 -0.000450731   1.7863e-11  9.52729e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-8.09113e-13    0.0423984 -2.98121e-11  1.52666e-10 -1.12998e-10 -1.86812e-11  2.92604e-12    0.0301449  3.21135e-13  -0.00537221  -0.00729555  9.00966e-13  0.000188566    0.0128737  1.58445e-12     0.973645   1.2622e-10  7.90872e-12  9.23644e-11  -7.2883e-12 -0.000450731    0.0229461   5.3761e-10 -1.30435e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.52379e-10 -2.09696e-10    0.0363541    0.0109051    0.0167371    0.0174294 -9.03759e-11  2.69757e-10   0.00288501  -2.5823e-11  1.07309e-09   0.00925417 -1.21905e-09 -5.56093e-11 -1.18158e-10   1.2622e-10      1.03687     0.017702   -0.0205698    0.0205698  1.52393e-09 -1.52232e-11  -0.00299217  0.000229474          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.07378e-10  3.55157e-12   -0.0109051   -0.0363541    0.0174294    0.0167371  1.00394e-10  7.44696e-12   0.00288501 -3.26052e-11  2.85591e-11   0.00925417 -1.11217e-09  8.59254e-11 -3.30824e-11  7.90872e-12     0.017702      1.03687   -0.0205698    0.0205698  1.57371e-09  5.54788e-11  -0.00299217 -0.000229474          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.94122e-10  -1.6167e-10    0.0169614   -0.0176536   -0.0210447    0.0262145   1.2713e-10  2.00315e-10  -0.00380005  1.08822e-09 -2.51774e-11   -0.0121893   1.6062e-09 -5.67806e-11  1.60117e-10  9.23644e-11   -0.0205698   -0.0205698      1.04835   -0.0291792 -2.00102e-09 -1.12642e-10  -0.00433986 -8.60254e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-4.07369e-10  6.67179e-12   -0.0176536    0.0169614   -0.0262145    0.0210447   1.3518e-10 -9.54527e-12   0.00380005   -4.368e-11  1.83952e-11    0.0121893 -1.46467e-09  -5.0106e-11 -4.18062e-11  -7.2883e-12    0.0205698    0.0205698   -0.0291792      1.04835  2.07171e-09   6.2893e-11   0.00433986 -8.60258e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0745717   0.00146481  5.43983e-09 -5.45913e-09 -7.41423e-09 -7.39026e-09   -0.0700159  -0.00137532 -4.10983e-09   -0.0248284    0.0175414  -1.7477e-09  -0.00919307  0.000315325    0.0362818  0.000712684  -1.2338e-09 -1.26189e-09   1.6189e-09 -1.65972e-09    -0.195058 -8.52658e-12 -3.79771e-10  1.12236e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  0.00146481   -0.0745717  4.35337e-10 -4.59058e-10  -3.8154e-11  -5.7517e-11  -0.00137532    0.0700159 -1.33712e-10    0.0175414    0.0248284 -5.77611e-11 -0.000315325  -0.00919307  0.000712684   -0.0362818  4.18443e-11  1.23606e-12  1.14714e-10 -8.64335e-11 -8.52653e-12    -0.195058 -6.16291e-09  1.60286e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.20683e-11 -8.01437e-10    -0.005556     0.005556   -0.0182806   -0.0182806  5.85036e-11  6.99644e-10  -0.00451784   1.1378e-09  1.47925e-09  -0.00194045  1.47305e-10  -1.2022e-10 -1.88585e-11 -3.41309e-11  -0.00564853  -0.00564853  -0.00301321   0.00301321 -8.44332e-10 -6.32064e-09      1.05378  2.07548e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.02497e-10  2.77665e-10   -0.0064656   -0.0064656  0.000108094 -0.000108094  2.37123e-10 -3.27775e-10  1.99296e-11 -6.90466e-12 -1.21843e-09  1.25933e-11  9.00118e-11  1.18674e-10  1.37952e-10 -1.88497e-10   0.00459643  -0.00459643 -1.95497e-05 -1.95497e-05  1.23353e-09  1.75947e-09  1.56584e-11       0.1004          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0903883   -6.215e-13   2.8367e-10 -3.60093e-10  -4.9072e-10   -3.904e-10   -0.0326152   6.2841e-13 -3.69431e-10   -0.0119287    0.0087839 -1.51548e-10    0.0481023 -0.000704575    0.0477611 -9.28706e-13  -1.0105e-10 -3.10158e-10  1.23921e-10 -4.11673e-10   -0.0244238 -0.000479757   4.4054e-11 -2.82076e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.21495e-13    0.0903883 -7.75179e-11  1.77838e-10 -1.22519e-10 -4.60963e-11  6.28414e-13   -0.0326152  4.84878e-12   -0.0087839   -0.0119287  2.34709e-12 -0.000704575   -0.0481023 -9.28705e-13    0.0477611 -2.97089e-10 -9.33682e-12  -2.2606e-10  1.69515e-11 -0.000479757    0.0244238 -7.66108e-10  3.85689e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  2.8367e-10 -7.75179e-11     0.139054   -0.0342199   -0.0539763   -0.0539763  -8.3707e-11  6.19515e-11   -0.0387685 -2.41596e-11  1.01972e-10   -0.0189236  2.03098e-09 -7.09748e-11  9.90439e-11 -3.06403e-11    0.0545774  -0.00899466    0.0148382   -0.0157694 -4.06009e-10  8.61892e-11   -0.0315712    0.0156922         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.60093e-10  1.77838e-10   -0.0342199     0.139054    0.0539763    0.0539763  1.18472e-10 -1.06142e-10    0.0387685  2.47317e-11 -1.08449e-10    0.0189236 -2.06009e-09  3.32634e-11 -2.19989e-10  1.88353e-10   0.00899466   -0.0545774   -0.0157694    0.0148382  4.76656e-10  1.07229e-11    0.0315712    0.0156922         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " -4.9072e-10 -1.22519e-10   -0.0539763    0.0539763     0.172608    0.0677743  1.61851e-10  8.06078e-11    0.0526483  1.22797e-10 -2.83029e-11    0.0256986   -2.797e-09  3.11402e-12 -2.99341e-10 -1.40362e-10    0.0143004    0.0152316   -0.0178603   -0.0457117  6.51376e-10  3.63059e-11   -0.0289225 -0.000136557         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -3.904e-10 -4.60963e-11   -0.0539763    0.0539763    0.0677743     0.172608  1.17661e-10  4.58428e-11    0.0526483   1.1632e-10 -2.88751e-11    0.0256986 -2.75929e-09 -2.59977e-11 -1.41628e-10 -1.94161e-11    0.0152316    0.0143004    0.0457117    0.0178603  5.53796e-10   1.0765e-10   -0.0289225  0.000136557         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0326152  6.28413e-13  -8.3707e-11  1.18472e-10  1.61851e-10  1.17661e-10     0.236624  -1.3571e-13  1.31185e-10    0.0115807  -0.00852767  2.26182e-11   0.00949837 -0.000139126    0.0424653  4.01607e-12 -1.62115e-10  1.22389e-10  2.25731e-10  1.65608e-10  -0.00359495 -7.06158e-05  5.93034e-12  2.66187e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.28409e-13   -0.0326152  6.19515e-11 -1.06142e-10  8.06078e-11  4.58428e-11 -1.35704e-13     0.236624  8.18161e-13   0.00852767    0.0115807  4.87184e-13 -0.000139126  -0.00949837  4.01605e-12    0.0424653  4.04538e-10  1.31998e-11  3.00234e-10 -1.57298e-11 -7.06158e-05   0.00359495  8.19683e-10 -3.66919e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.69431e-10  4.84878e-12   -0.0387685    0.0387685    0.0526483    0.0526483  1.31185e-10  8.18161e-13     0.424108  3.30466e-10 -2.50446e-10   -0.0112617 -9.33328e-10  4.63345e-12 -1.79934e-10  4.24893e-13  0.000392582  0.000392582 -0.000517097  0.000517097  1.09633e-09  3.98158e-11   -0.0012388 -8.57745e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0119287   -0.0087839 -2.41596e-11  2.47317e-11  1.22797e-10   1.1632e-10    0.0115807   0.00852767  3.30466e-10     0.446812  9.55823e-13 -1.12238e-10 -0.000385611  0.000292757  -0.00869299  -0.00640124 -4.66763e-11 -5.79714e-11  1.82505e-09 -7.95954e-11    0.0145074   -0.0102496  1.76654e-09 -1.18347e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0087839   -0.0119287  1.01972e-10 -1.08449e-10 -2.83029e-11 -2.88751e-11  -0.00852767    0.0115807 -2.50446e-10  9.55963e-13     0.446812  8.44406e-11  0.000292757  0.000385611   0.00640124  -0.00869299  1.79799e-09  5.25355e-11 -4.58189e-11  3.45238e-11   -0.0102496   -0.0145074  2.39058e-09  -2.2551e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.51548e-10  2.34709e-12   -0.0189236    0.0189236    0.0256986    0.0256986  2.26182e-11  4.87183e-13   -0.0112617 -1.12238e-10  8.44406e-11     0.627074 -6.51483e-10  4.81596e-12 -1.03755e-10  1.34053e-12    0.0132577    0.0132577   -0.0174626    0.0174626  2.10663e-10  1.02395e-11 -0.000510323 -2.87958e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481023 -0.000704575  2.03098e-09 -2.06009e-09   -2.797e-09 -2.75929e-09   0.00949837 -0.000139126 -9.33328e-10 -0.000385611  0.000292757 -6.51483e-10     0.912954 -7.12368e-13   -0.0215514  0.000315673 -2.18995e-09 -1.97326e-09  2.88547e-09 -2.59852e-09    0.0227028  0.000778712 -5.54993e-11  1.51128e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-0.000704575   -0.0481023 -7.09748e-11  3.32634e-11  3.11402e-12 -2.59977e-11 -0.000139126  -0.00949837  4.63345e-12  0.000292757  0.000385611  4.81596e-12 -7.12367e-13     0.912954  0.000315673    0.0215514 -1.19376e-10  1.67576e-10 -1.16285e-10 -1.00402e-10 -0.000778712    0.0227028  -1.0659e-10  1.98577e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0477611 -9.28706e-13  9.90439e-11 -2.19989e-10 -2.99341e-10 -1.41628e-10    0.0424653  4.01605e-12 -1.79934e-10  -0.00869299   0.00640124 -1.03755e-10   -0.0215514  0.000315673     0.952112  3.01032e-12 -1.94333e-10 -5.06561e-11  2.63481e-10 -6.35546e-11   0.00321143  6.30823e-05  2.45688e-12  1.72421e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-9.28703e-13    0.0477611 -3.06403e-11  1.88353e-10 -1.40362e-10 -1.94161e-11  4.01607e-12    0.0424653  4.24893e-13  -0.00640124  -0.00869299  1.34053e-12  0.000315673    0.0215514  3.01033e-12     0.952112  2.09127e-10  9.20049e-12  1.52974e-10 -9.29664e-12  6.30823e-05  -0.00321143  4.75838e-10  -2.3513e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " -1.0105e-10 -2.97089e-10    0.0545774   0.00899466    0.0143004    0.0152316 -1.62115e-10  4.04538e-10  0.000392582 -4.66763e-11  1.79799e-09    0.0132577 -2.18995e-09 -1.19376e-10 -1.94333e-10  2.09127e-10      1.07435    0.0333793   -0.0381715    0.0381715  4.69084e-10 -1.00753e-10   -0.0123302    0.0065844         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.10158e-10 -9.33682e-12  -0.00899466   -0.0545774    0.0152316    0.0143004  1.22389e-10  1.31998e-11  0.000392582 -5.79714e-11  5.25355e-11    0.0132577 -1.97326e-09  1.67576e-10 -5.06561e-11  9.20049e-12    0.0333793      1.07435   -0.0381715    0.0381715  5.91261e-10   7.3125e-11   -0.0123302   -0.0065844         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.23921e-10  -2.2606e-10    0.0148382   -0.0157694   -0.0178603    0.0457117  2.25731e-10  3.00234e-10 -0.000517097  1.82505e-09 -4.58189e-11   -0.0174626  2.88547e-09 -1.16285e-10  2.63481e-10  1.52974e-10   -0.0381715   -0.0381715      1.09565   -0.0546777 -6.06814e-10 -1.05924e-10   -0.0113192 -4.10669e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-4.11673e-10  1.69515e-11   -0.0157694    0.0148382   -0.0457117    0.0178603  1.65608e-10 -1.57298e-11  0.000517097 -7.95954e-11  3.45238e-11    0.0174626 -2.59852e-09 -1.00402e-10 -6.35546e-11 -9.29664e-12    0.0381715    0.0381715   -0.0546777      1.09565  7.80384e-10 -1.59095e-11    0.0113192  -4.1067e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0559707  -0.00109943 -3.90485e-09  3.97241e-09  5.40203e-09  5.30918e-09   -0.0025978 -5.10287e-05  1.12623e-09   0.00900982  -0.00636549  2.80039e-10    0.0177726 -0.000609604    0.0179746  0.000353076    -5.49e-11 -7.74163e-11  6.30894e-11 -9.78875e-11     0.583856 -9.31415e-12 -2.85027e-10  1.05021e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " -0.00109943    0.0559707 -8.62177e-11  1.78217e-10  1.35622e-10  2.04076e-10 -5.10287e-05    0.0025978  3.56319e-11  -0.00636549  -0.00900982  9.05586e-12  0.000609604    0.0177726  0.000353076   -0.0179746  1.41447e-10  1.06981e-10  1.14166e-10  -9.1305e-11 -9.31409e-12     0.583856 -4.58276e-09  1.49161e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.87469e-11 -4.39477e-10   -0.0321873    0.0321873    -0.028886    -0.028886  3.55224e-12   8.7908e-10  -0.00262506  1.62857e-09  2.20117e-09  -0.00134265  9.53383e-11 -7.03168e-11   4.7879e-12  6.04724e-10   -0.0137379   -0.0137379   -0.0109279    0.0109279 -7.84314e-10 -5.08603e-09      2.11622  1.67473e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " -2.6235e-10  3.57873e-10    0.0178889    0.0178889 -0.000159396  0.000159396  2.44946e-10 -3.37481e-10 -2.13365e-11 -1.19581e-11 -2.24856e-09 -8.85663e-12  1.63655e-10  2.15023e-10  1.87929e-10 -2.56284e-10   0.00774796  -0.00774796 -4.25419e-05  -4.2542e-05  1.31292e-09  1.86565e-09  1.19629e-11     0.776653         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.2"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
