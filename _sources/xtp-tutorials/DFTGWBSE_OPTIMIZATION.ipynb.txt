{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-08-31T19:34:37.553448Z",
     "iopub.status.busy": "2022-08-31T19:34:37.552886Z",
     "iopub.status.idle": "2022-08-31T19:35:23.551746Z",
     "shell.execute_reply": "2022-08-31T19:35:23.551156Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2023-dev gitid: 3134d80 (compiled Aug 31 2022, 19:23:48)\r\n",
      "votca_csg, version 2023-dev gitid: 3134d80 (compiled Aug 31 2022, 19:03:10)\r\n",
      "votca_tools, version 2023-dev gitid: 3134d80 (compiled Aug 31 2022, 18:59:22)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 BohrA\r\n",
      "    0.307132   3.0687e-11   1.7972e-10 -5.19957e-10 -2.32715e-11   -0.0516061  1.11704e-09  1.03728e-09  3.87738e-10   -0.0181646  -0.00104304    1.105e-10    0.0103713   -0.0375702  2.00729e-11    0.0421019 -2.08439e-10  9.08793e-11  3.57889e-10  1.59147e-10  0.000478779    -0.108408 -1.82926e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  3.0687e-11     0.307132 -3.89317e-10  3.09555e-10   -0.0516061 -2.32714e-11  2.45174e-09  2.79198e-09  8.22054e-10   0.00104304   -0.0181646  3.85155e-10   -0.0375702   -0.0103713    0.0421019  2.00729e-11  -1.9164e-10  -7.1013e-12  5.01606e-10  6.19167e-10     0.108408  0.000478778  1.68556e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  1.7972e-10 -3.89317e-10     0.320607   0.00928772  1.39203e-11 -3.03637e-11   -0.0131917   -0.0131917  -0.00491922 -1.46108e-10  1.02617e-10  -0.00209574   1.2147e-11  2.07429e-10 -1.19208e-10 -7.53622e-12   -0.0470641   0.00129548  -0.00255833   -0.0151928 -9.89644e-10  3.14726e-10   -0.0254864          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-5.19957e-10  3.09555e-10   0.00928772     0.320607 -2.22691e-11  4.35088e-10    0.0131917    0.0131917   0.00491922  1.66385e-10 -1.48524e-10   0.00209574  7.90583e-12 -1.82544e-10   1.2763e-11 -4.05394e-10   0.00129548   -0.0470641    0.0151928   0.00255833  9.65684e-10   2.0543e-10    0.0254864          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.32715e-11   -0.0516061  1.39203e-11 -2.22691e-11     0.490902  2.84617e-12  1.49002e-09   1.0853e-09  6.28858e-10 -0.000771803     0.013441  1.85912e-10  -0.00770565  -0.00212715    0.0309987 -6.62826e-11 -4.61371e-11  3.03154e-10   2.0812e-10  6.15288e-11   -0.0531267 -0.000234632  2.09579e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0516061 -2.32714e-11 -3.03637e-11  4.35088e-10  2.84619e-12     0.490902 -9.27909e-11  -1.0114e-10 -6.24851e-11     0.013441  0.000771803  5.26008e-12   0.00212715  -0.00770565 -6.62826e-11    0.0309987  1.53745e-10 -7.15378e-12 -8.26876e-11  1.74329e-10 -0.000234632    0.0531267 -4.45453e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.11704e-09  2.45174e-09   -0.0131917    0.0131917  1.49002e-09 -9.27909e-11     0.549583     0.219688    0.0856684 -1.43579e-11 -7.24888e-10    0.0364974 -8.33818e-10 -2.62293e-09 -6.31722e-10  2.54378e-10   -0.0113297  -0.00130479   -0.0126988    0.0330699  1.34027e-08 -8.27132e-09   0.00155061          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.03728e-09  2.79198e-09   -0.0131917    0.0131917   1.0853e-09  -1.0114e-10     0.219688     0.549583    0.0856684 -6.02644e-11 -7.45165e-10    0.0364974 -8.58703e-10 -2.60288e-09 -2.18791e-10  1.47933e-10   0.00130479    0.0113297    0.0330699   -0.0126988  1.39164e-08 -8.24381e-09   0.00155061          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.87738e-10  8.22054e-10  -0.00491922   0.00491922  6.28858e-10 -6.24851e-11    0.0856684    0.0856684     0.662947 -1.80031e-10 -5.81845e-10  -0.00632525 -2.93153e-10 -7.01775e-10  -3.3678e-10  9.71267e-11  -0.00131392   0.00131392   0.00387765   0.00387765  4.33946e-09 -3.05396e-09   0.00112861          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0181646   0.00104304 -1.46108e-10  1.66385e-10 -0.000771803     0.013441 -1.43579e-11 -6.02644e-11 -1.80031e-10     0.680922 -1.60348e-12  8.83669e-11 -2.70176e-05  7.97348e-05  0.000495131  -0.00862272  3.87102e-10  1.65555e-13  8.09521e-11  8.90493e-10   0.00217108    0.0409701 -6.68834e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -0.00104304   -0.0181646  1.02617e-10 -1.48524e-10     0.013441  0.000771803 -7.24888e-10 -7.45165e-10 -5.81845e-10 -1.60335e-12     0.680922   6.2047e-11  7.97347e-05  2.70176e-05  -0.00862272 -0.000495131 -4.19562e-12  8.13736e-10  3.77869e-10  -9.3992e-12   -0.0409701   0.00217108  8.09485e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   1.105e-10  3.85155e-10  -0.00209574   0.00209574  1.85912e-10  5.26008e-12    0.0364974    0.0364974  -0.00632525  8.83669e-11   6.2047e-11      0.79826  1.19983e-11 -3.26483e-10   1.1019e-10  5.77105e-11  -0.00464525   0.00464525    0.0137091    0.0137091  1.73217e-09 -9.75906e-10  0.000447441          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0103713   -0.0375702   1.2147e-11  7.90583e-12  -0.00770565   0.00212715 -8.33818e-10 -8.58703e-10 -2.93153e-10 -2.70176e-05  7.97347e-05  1.19983e-11     0.956418 -4.28366e-11    0.0126684  -0.00349712   1.2381e-10  -2.3745e-10 -6.54374e-10 -4.32007e-10    0.0192771    0.0054132  6.70936e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0375702   -0.0103713  2.07429e-10 -1.82544e-10  -0.00212715  -0.00770565 -2.62293e-09 -2.60288e-09 -7.01775e-10  7.97348e-05  2.70176e-05 -3.26483e-10 -4.28366e-11     0.956418   0.00349712    0.0126684   4.2353e-10 -6.45897e-10  -1.4916e-09 -1.60524e-09    0.0054132   -0.0192771 -8.93692e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  2.0073e-11    0.0421019 -1.19208e-10   1.2763e-11    0.0309987 -6.62826e-11 -6.31722e-10 -2.18791e-10  -3.3678e-10  0.000495131  -0.00862272   1.1019e-10    0.0126684   0.00349712     0.988566 -3.74783e-11 -2.91927e-11  1.10965e-10  -3.5849e-11  6.16839e-11    0.0223628  9.87645e-05  3.29946e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0421019  2.00729e-11 -7.53622e-12 -4.05394e-10 -6.62826e-11    0.0309987  2.54378e-10  1.47933e-10  9.71267e-11  -0.00862272 -0.000495131  5.77105e-11  -0.00349712    0.0126684 -3.74783e-11     0.988566 -7.03975e-12 -9.04932e-11  6.75178e-11   1.4929e-10  9.87646e-05   -0.0223628 -1.73187e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.08439e-10  -1.9164e-10   -0.0470641   0.00129548 -4.61371e-11  1.53745e-10   -0.0113297   0.00130479  -0.00131392  3.87102e-10 -4.19562e-12  -0.00464525   1.2381e-10   4.2353e-10 -2.91927e-11 -7.03975e-12      1.03319  -0.00654762   -0.0132203   -0.0132203 -8.24298e-10  5.52711e-10   0.00427664          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 9.08793e-11  -7.1013e-12   0.00129548   -0.0470641  3.03154e-10 -7.15378e-12  -0.00130479    0.0113297   0.00131392  1.65555e-13  8.13736e-10   0.00464525  -2.3745e-10 -6.45897e-10  1.10965e-10 -9.04932e-11  -0.00654762      1.03319    0.0132203    0.0132203  7.77636e-10 -4.50801e-10  -0.00427664          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.57889e-10  5.01606e-10  -0.00255833    0.0151928   2.0812e-10 -8.26876e-11   -0.0126988    0.0330699   0.00387765  8.09521e-11  3.77869e-10    0.0137091 -6.54374e-10  -1.4916e-09  -3.5849e-11  6.75178e-11   -0.0132203    0.0132203      1.06772    0.0410839  2.36723e-09  -1.5876e-09    0.0020404          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.59147e-10  6.19167e-10   -0.0151928   0.00255833  6.15288e-11  1.74329e-10    0.0330699   -0.0126988   0.00387765  8.90493e-10  -9.3992e-12    0.0137091 -4.32007e-10 -1.60524e-09  6.16839e-11   1.4929e-10   -0.0132203    0.0132203    0.0410839      1.06772  2.46824e-09 -1.54038e-09    0.0020404          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-0.000332323   -0.0752465  6.88076e-10 -7.32992e-10    0.0690159  0.000304806 -8.05737e-09 -8.33497e-09 -3.16307e-09  -0.00163806    0.0309115 -1.54296e-09  -0.00866808  -0.00243408   -0.0364086 -0.000160797  5.57591e-10 -5.57029e-10 -1.77549e-09   -1.779e-09    -0.194424  2.22187e-10 -4.21887e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0752465 -0.000332323  6.07632e-13 -2.84929e-10  0.000304806   -0.0690159   5.4915e-09  5.53406e-09   2.3844e-09   -0.0309115  -0.00163806  8.87265e-10  -0.00243408   0.00866808 -0.000160797    0.0364086 -4.80937e-10  4.76692e-10  1.28132e-09  1.27987e-09  2.22187e-10    -0.194424 -5.54322e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.99101e-10 -5.29807e-10    -0.014189     0.014189  3.68886e-10 -5.51687e-10  -0.00432734  -0.00432734  -0.00131298 -1.02976e-09  1.08959e-09 -0.000526393 -8.35358e-11   8.1847e-11 -4.06967e-11   2.5167e-10   0.00597681  -0.00597681   0.00150202   0.00150202 -4.42906e-09 -5.45722e-09     0.958316          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "    0.093811  1.36392e-11   9.6106e-11 -3.20804e-10 -1.43117e-11   -0.0328898   4.6842e-10  4.11449e-10  2.38593e-10   -0.0155316 -0.000891851  6.35707e-11    0.0128602   -0.0465862  2.33215e-11    0.0481429 -2.59245e-10  1.01406e-10  3.59628e-10  8.42157e-11  0.000110888   -0.0251078  4.90441e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.36392e-11     0.093811 -2.01359e-10  1.44387e-10   -0.0328898 -1.43116e-11  9.67667e-10  1.19237e-09  5.07285e-10  0.000891851   -0.0155316  2.54834e-10   -0.0465862   -0.0128602    0.0481429  2.33214e-11 -1.64458e-10 -1.10954e-10  4.29754e-10  5.87593e-10    0.0251078  0.000110888  -5.3854e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  9.6106e-11 -2.01359e-10     0.105872   0.00531044  1.86031e-11 -2.58706e-11  -0.00668289  -0.00668289  -0.00361741 -1.36134e-10  8.76171e-11  -0.00164323  2.42597e-11  2.30222e-10 -1.50953e-10 -1.30878e-11   -0.0640666   0.00171171  -0.00245642   -0.0196696 -8.00366e-11  1.94571e-10   -0.0418871         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.20804e-10  1.44387e-10   0.00531044     0.105872  -2.2154e-11  3.15384e-10   0.00668289   0.00668289   0.00361741   1.6033e-10  -1.3019e-10   0.00164323  2.61835e-12 -1.93375e-10  9.14809e-12 -5.05871e-10   0.00171171   -0.0640666    0.0196696   0.00245642   5.4432e-12    4.785e-11    0.0418871         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.43117e-11   -0.0328898  1.86031e-11  -2.2154e-11     0.240891  6.71486e-13  9.44034e-10  6.54521e-10  5.49402e-10 -0.000829413    0.0144443   1.6093e-10  -0.00881376  -0.00243305    0.0441772 -9.21385e-11 -4.10557e-11  4.24961e-10  2.15307e-10  1.15176e-11   0.00438142  1.93504e-05  5.21247e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0328898 -1.43116e-11 -2.58706e-11  3.15384e-10  6.71505e-13     0.240891 -4.36613e-11 -4.72123e-11 -4.46325e-11    0.0144443  0.000829413  1.06172e-11   0.00243305  -0.00881376 -9.21384e-11    0.0441772  2.23061e-10 -1.92716e-11 -1.02554e-10  2.81352e-10  1.93503e-05  -0.00438142 -4.88371e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  4.6842e-10  9.67667e-10  -0.00668289   0.00668289  9.44034e-10 -4.36613e-11      0.22187     0.110688    0.0629973 -1.79375e-11 -5.48428e-10    0.0286169 -1.00055e-09 -2.90132e-09 -7.94502e-10  2.58549e-10   -0.0100633   -0.0071498    -0.033087    0.0292679  1.48717e-09 -5.30584e-10  -0.00289411         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.11449e-10  1.19237e-09  -0.00668289   0.00668289  6.54521e-10 -4.72123e-11     0.110688      0.22187    0.0629973 -6.05105e-11 -5.72624e-10    0.0286169  -1.0374e-09 -2.87445e-09 -2.75542e-10  1.16744e-10    0.0071498    0.0100633    0.0292679    -0.033087  1.72922e-09 -4.54818e-10  -0.00289411         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.38593e-10  5.07285e-10  -0.00361741   0.00361741  5.49402e-10 -4.46325e-11    0.0629973    0.0629973     0.429278 -2.31006e-10 -6.84377e-10   -0.0121538 -4.21877e-10 -8.97599e-10 -4.70458e-10  1.29858e-10  6.19446e-06 -6.19448e-06 -1.82812e-05 -1.82812e-05   1.0134e-09 -6.37943e-10  5.83916e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0155316  0.000891851 -1.36134e-10   1.6033e-10 -0.000829413    0.0144443 -1.79375e-11 -6.05105e-11 -2.31006e-10     0.463967 -2.14137e-12   1.1787e-10  -0.00020757  0.000612582  0.000594797   -0.0103584  6.64061e-10 -5.16782e-12  1.34042e-10  1.50655e-09  0.000938485      0.01771 -1.63362e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-0.000891851   -0.0155316  8.76171e-11  -1.3019e-10    0.0144443  0.000829413 -5.48428e-10 -5.72624e-10 -6.84377e-10 -2.14119e-12     0.463967  1.23371e-10  0.000612582   0.00020757   -0.0103584 -0.000594797 -2.66206e-11  1.39913e-09  6.97879e-10  3.89867e-11     -0.01771  0.000938485  1.78282e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.35707e-11  2.54834e-10  -0.00164323   0.00164323   1.6093e-10  1.06172e-11    0.0286169    0.0286169   -0.0121538   1.1787e-10  1.23371e-10     0.636067   4.9386e-11 -4.09117e-10  1.95659e-10  8.28272e-11  -0.00671644   0.00671644    0.0198216    0.0198216  9.92502e-11 -2.32663e-12  4.51407e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0128602   -0.0465862  2.42597e-11  2.61835e-12  -0.00881376   0.00243305 -1.00055e-09  -1.0374e-09 -4.21877e-10  -0.00020757  0.000612582   4.9386e-11     0.917068 -7.51011e-11    0.0214877  -0.00593171  2.20493e-10 -4.53213e-10 -1.22801e-09 -7.75859e-10    0.0223805   0.00628466 -1.02202e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0465862   -0.0128602  2.30222e-10 -1.93375e-10  -0.00243305  -0.00881376 -2.90132e-09 -2.87445e-09 -8.97599e-10  0.000612582   0.00020757 -4.09117e-10  -7.5101e-11     0.917068   0.00593171    0.0214877  7.39776e-10 -1.19193e-09 -2.67333e-09 -2.90605e-09   0.00628466   -0.0223805 -6.28238e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.33215e-11    0.0481429 -1.50953e-10  9.14809e-12    0.0441772 -9.21384e-11 -7.94502e-10 -2.75542e-10 -4.70458e-10  0.000594797   -0.0103584  1.95659e-10    0.0214877   0.00593171     0.981535 -7.22432e-11 -5.41918e-11  1.86624e-10 -5.44966e-11  1.35541e-10  -0.00424838 -1.87628e-05  2.61161e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481429  2.33214e-11 -1.30878e-11 -5.05871e-10 -9.21385e-11    0.0441772  2.58549e-10  1.16744e-10  1.29858e-10   -0.0103584 -0.000594797  8.28272e-11  -0.00593171    0.0214877 -7.22432e-11     0.981535 -2.93603e-11 -1.60678e-10  1.09417e-10  2.41849e-10 -1.87628e-05   0.00424838  1.75292e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.59245e-10 -1.64458e-10   -0.0640666   0.00171171 -4.10557e-11  2.23061e-10   -0.0100633    0.0071498  6.19446e-06  6.64061e-10 -2.66206e-11  -0.00671644  2.20493e-10  7.39776e-10 -5.41918e-11 -2.93603e-11      1.06904   -0.0127751   -0.0247041   -0.0247041 -3.94103e-10  2.10684e-10    0.0150551         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.01406e-10 -1.10954e-10   0.00171171   -0.0640666  4.24961e-10 -1.92716e-11   -0.0071498    0.0100633 -6.19448e-06 -5.16782e-12  1.39913e-09   0.00671644 -4.53213e-10 -1.19193e-09  1.86624e-10 -1.60678e-10   -0.0127751      1.06904    0.0247041    0.0247041  2.18756e-10  1.33051e-12   -0.0150551         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.59628e-10  4.29754e-10  -0.00245642    0.0196696  2.15307e-10 -1.02554e-10    -0.033087    0.0292679 -1.82812e-05  1.34042e-10  6.97879e-10    0.0198216 -1.22801e-09 -2.67333e-09 -5.44966e-11  1.09417e-10   -0.0247041    0.0247041      1.13358    0.0773113  8.79461e-10 -5.99968e-10   0.00544026         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 8.42157e-11  5.87593e-10   -0.0196696   0.00245642  1.15176e-11  2.81352e-10    0.0292679    -0.033087 -1.82812e-05  1.50655e-09  3.89867e-11    0.0198216 -7.75859e-10 -2.90605e-09  1.35541e-10  2.41849e-10   -0.0247041    0.0247041    0.0773113      1.13358   1.0907e-09 -4.24797e-10   0.00544026         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 0.000253314    0.0573567 -4.73696e-10  4.21734e-10   0.00347861  1.53631e-05  7.51676e-09  7.82041e-09  1.20405e-09  0.000540051   -0.0101912  2.34281e-10    0.0179469   0.00503967   -0.0191591 -8.46156e-05 -9.06785e-11  7.13347e-11 -1.66032e-10  5.17703e-12     0.600541  2.22569e-10  -3.1926e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0573567  0.000253314  3.45568e-10 -4.27594e-11  1.53632e-05  -0.00347861 -4.34664e-09 -4.29327e-09 -7.17477e-10    0.0101912  0.000540051 -1.52108e-10   0.00503967   -0.0179469 -8.46156e-05    0.0191591 -1.00889e-10  2.71802e-10  3.23324e-11  5.08646e-11  2.22569e-10     0.600541 -5.04344e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  1.9815e-10 -3.36942e-10   -0.0423679    0.0423679  5.91242e-10 -4.72914e-10  -0.00286367  -0.00286367 -0.000437087 -1.50206e-09  1.61585e-09  -0.00021393 -5.06068e-11 -4.23202e-11  3.64362e-10  1.53315e-10     0.016095    -0.016095   0.00532763   0.00532763 -3.64917e-09 -5.04776e-09      1.98483         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
