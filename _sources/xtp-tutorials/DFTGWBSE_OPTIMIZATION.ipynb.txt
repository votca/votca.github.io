{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-02-23T21:58:59.711730Z",
     "iopub.status.busy": "2022-02-23T21:58:59.711190Z",
     "iopub.status.idle": "2022-02-23T21:59:48.988321Z",
     "shell.execute_reply": "2022-02-23T21:59:48.987410Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2023-dev gitid: bac0582 (compiled Feb 23 2022, 21:51:34)\r\n",
      "votca_csg, version 2023-dev gitid: bac0582 (compiled Feb 23 2022, 21:38:33)\r\n",
      "votca_tools, version 2023-dev gitid: bac0582 (compiled Feb 23 2022, 21:36:02)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 Bohr\r\n",
      "... ... \r\n",
      "... ... =========== OPTIMIZATION SUMMARY ================================= \r\n",
      "... ... At iteration  0\r\n",
      "... ...  ---- POSITIONS (Angstrom)   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    +0.0000  +0.0000  +0.0000\r\n",
      "... ...    1    +1.2000  +0.0000  +0.0000\r\n",
      "... ...    Total energy:     -112.26831841 Hartree \r\n",
      "... ...    Trust radius:       0.01889726 Bohr     \r\n",
      "... ...  ---- FORCES (Hartree/Bohr)   \r\n",
      "... ...       central differences   \r\n",
      "... ...       displacement 0.0010 Angstrom   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    -0.1314  -0.0000  -0.0000\r\n",
      "... ...    1    +0.1314  +0.0000  +0.0000A\r\n",
      "    0.301149 -1.39178e-12   7.7046e-10 -8.87507e-10 -1.19938e-09 -1.04209e-09   -0.0519724  1.01976e-12  5.92028e-10    0.0141678   -0.0105021  2.25008e-10   -0.0390252  0.000529165    0.0423984 -8.04606e-13  1.50798e-10  3.07358e-10 -1.92041e-10  4.04847e-10     0.107078   0.00206169  6.02758e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.39178e-12     0.301149   -1.486e-10  3.05889e-10 -2.20161e-10 -1.03114e-10  1.01981e-12   -0.0519724  -2.9673e-12    0.0105021    0.0141678 -6.50326e-13  0.000529165    0.0390252 -8.04601e-13    0.0423984  2.10856e-10 -1.95009e-12  1.60656e-10 -4.09613e-12   0.00206169    -0.107078  5.83662e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  7.7046e-10   -1.486e-10     0.392277   -0.0720438    -0.110794    -0.110794 -1.83319e-10  9.48275e-11    0.0541952  3.42734e-11 -1.16461e-10    0.0244298 -1.89744e-09  5.74879e-11  1.23741e-10 -3.05468e-11   -0.0362642    0.0109957   -0.0170052     0.017646  7.97389e-09  3.77744e-10   -0.0242023          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-8.87507e-10  3.05889e-10   -0.0720438     0.392277     0.110794     0.110794  2.22078e-10 -1.49174e-10   -0.0541952 -3.37635e-11  1.20746e-10   -0.0244298  1.91734e-09 -3.19782e-11 -2.13644e-10  1.52431e-10   -0.0109957    0.0362642     0.017646   -0.0170052  -8.0558e-09 -4.95006e-10    0.0242023          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.19938e-09 -2.20161e-10    -0.110794     0.110794     0.459614     0.139381  3.01685e-10  1.00439e-10   -0.0731115 -1.43196e-10  3.35353e-11   -0.0329568  2.58643e-09  9.82157e-12 -2.88715e-10 -1.07565e-10   -0.0167976   -0.0174384    0.0209546    0.0263053 -1.08716e-08 -1.12716e-10  -0.00979515          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.04209e-09 -1.03114e-10    -0.110794     0.110794     0.139381     0.459614  2.47338e-10  6.16802e-11   -0.0731115  -1.3891e-10  3.30254e-11   -0.0329568  2.56092e-09  2.97198e-11 -1.66832e-10 -1.76627e-11   -0.0174384   -0.0167976   -0.0263053   -0.0209546 -1.07534e-08 -1.95455e-10  -0.00979515          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0519724  1.01981e-12 -1.83319e-10  2.22078e-10  3.01685e-10  2.47338e-10     0.486835  -2.4485e-13 -1.77663e-10   -0.0109536   0.00811954 -3.96545e-11   -0.0083053  0.000112616    0.0301449  2.91501e-12  9.07309e-11  -1.0169e-10 -1.26373e-10 -1.35339e-10   -0.0549838  -0.00105866 -4.04408e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.01976e-12   -0.0519724  9.48275e-11 -1.49174e-10  1.00439e-10  6.16802e-11 -2.44844e-13     0.486835  4.01073e-12  -0.00811954   -0.0109536    1.153e-12  0.000112616    0.0083053    2.915e-12    0.0301449 -2.68972e-10 -7.25915e-12 -2.02026e-10  9.60476e-12  -0.00105866    0.0549838  2.31524e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.92028e-10  -2.9673e-12    0.0541952   -0.0541952   -0.0731115   -0.0731115 -1.77663e-10  4.01073e-12     0.659928  2.68833e-10 -2.00841e-10  -0.00518518 -7.77965e-10  3.37658e-12  1.34331e-10 -2.18003e-12   0.00289292   0.00289292  -0.00379403   0.00379403  5.23458e-09  1.52314e-10  -0.00258554          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0141678    0.0105021  3.42734e-11 -3.37635e-11 -1.43196e-10  -1.3891e-10   -0.0109536  -0.00811954  2.68833e-10     0.668107   7.2451e-13 -7.86931e-11  1.34504e-05 -1.02558e-05   0.00727848   0.00539531 -2.63079e-11 -2.98262e-11  1.09067e-09 -4.34359e-11    0.0333881   -0.0237674 -8.09782e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0105021    0.0141678 -1.16461e-10  1.20746e-10  3.35353e-11  3.30254e-11   0.00811954   -0.0109536 -2.00841e-10  7.24462e-13     0.668107  5.95212e-11 -1.02558e-05 -1.34504e-05  -0.00539531   0.00727848  1.07661e-09   2.9382e-11 -2.62646e-11  2.27463e-11   -0.0237674   -0.0333881 -1.12815e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.25008e-10 -6.50326e-13    0.0244298   -0.0244298   -0.0329568   -0.0329568 -3.96545e-11    1.153e-12  -0.00518518 -7.86931e-11  5.95212e-11     0.793012 -5.03133e-10  1.25452e-12  7.47809e-11  -4.8161e-13   0.00927953   0.00927953     -0.01217      0.01217  1.99241e-09  5.72199e-11  -0.00105641          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0390252  0.000529165 -1.89744e-09  1.91734e-09  2.58643e-09  2.56092e-09   -0.0083053  0.000112616 -7.77965e-10  1.34504e-05 -1.02558e-05 -5.03133e-10     0.954263 -4.00085e-13    0.0128739 -0.000174564 -1.22398e-09 -1.11806e-09  1.60634e-09 -1.46528e-09    0.0198856  0.000652688  1.20598e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 0.000529165    0.0390252  5.74879e-11 -3.19782e-11  9.82157e-12  2.97198e-11  0.000112616    0.0083053  3.37658e-12 -1.02558e-05 -1.34504e-05  1.25452e-12 -4.00083e-13     0.954263 -0.000174564   -0.0128739  -5.8152e-11  8.29083e-11  -5.2517e-11 -5.34061e-11 -0.000652688    0.0198856 -3.45625e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0423984 -8.04601e-13  1.23741e-10 -2.13644e-10 -2.88715e-10 -1.66832e-10    0.0301449    2.915e-12  1.34331e-10   0.00727848  -0.00539531  7.47809e-11    0.0128739 -0.000174564     0.973645  1.57429e-12  1.20317e-10  3.22913e-11 -1.60427e-10  4.20596e-11    0.0229463  0.000441809  1.84444e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-8.04606e-13    0.0423984 -3.05468e-11  1.52431e-10 -1.07565e-10 -1.76627e-11  2.91501e-12    0.0301449 -2.18003e-12   0.00539531   0.00727848  -4.8161e-13 -0.000174564   -0.0128739   1.5743e-12     0.973645 -1.26458e-10 -8.09089e-12 -9.34608e-11  5.43486e-12  0.000441809   -0.0229463  5.39176e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.50798e-10  2.10856e-10   -0.0362642   -0.0109957   -0.0167976   -0.0174384  9.07309e-11 -2.68972e-10   0.00289292 -2.63079e-11  1.07661e-09   0.00927953 -1.22398e-09  -5.8152e-11  1.20317e-10 -1.26458e-10      1.03696    0.0177877   -0.0205936    0.0205936  1.52414e-09 -2.13063e-11   0.00300139          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.07358e-10 -1.95009e-12    0.0109957    0.0362642   -0.0174384   -0.0167976  -1.0169e-10 -7.25915e-12   0.00289292 -2.98262e-11   2.9382e-11   0.00927953 -1.11806e-09  8.29083e-11  3.22913e-11 -8.09089e-12    0.0177877      1.03696   -0.0205936    0.0205936  1.57341e-09  4.90969e-11   0.00300139          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.92041e-10  1.60656e-10   -0.0170052     0.017646    0.0209546   -0.0263053 -1.26373e-10 -2.02026e-10  -0.00379403  1.09067e-09 -2.62646e-11     -0.01217  1.60634e-09  -5.2517e-11 -1.60427e-10 -9.34608e-11   -0.0205936   -0.0205936      1.04826   -0.0290935 -1.99232e-09 -1.04003e-10   0.00432189          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.04847e-10 -4.09613e-12     0.017646   -0.0170052    0.0263053   -0.0209546 -1.35339e-10  9.60476e-12   0.00379403 -4.34359e-11  2.27463e-11      0.01217 -1.46528e-09 -5.34061e-11  4.20596e-11  5.43486e-12    0.0205936    0.0205936   -0.0290935      1.04826  2.06272e-09  5.47576e-11  -0.00432189          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0745723  -0.00143582 -5.45468e-09  5.46923e-09   7.3777e-09  7.35447e-09    0.0700164    0.0013481 -4.10186e-09   -0.0247658    0.0176296 -1.74239e-09  -0.00919352  0.000301751    -0.036282 -0.000698577 -1.23409e-09 -1.26298e-09  1.61342e-09 -1.65426e-09    -0.195058 -8.52582e-12  3.88466e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -0.00143582    0.0745723 -4.12674e-10  4.35651e-10  1.15889e-11  2.62465e-11    0.0013481   -0.0700164 -1.19673e-10    0.0176296    0.0247658 -4.97202e-11 -0.000301751  -0.00919352 -0.000698577     0.036282  4.54631e-11  4.83671e-12  1.09556e-10 -8.04685e-11  -8.5259e-12    -0.195058  6.14512e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.15564e-11 -8.00674e-10   -0.0056244    0.0056244    -0.018128    -0.018128  5.65569e-11  7.00599e-10   0.00443405 -1.14749e-09 -1.47787e-09   0.00190441 -1.45026e-10  1.19829e-10 -1.52441e-11  -3.1136e-11   0.00563206   0.00563206   0.00303885  -0.00303885  8.40873e-10  6.30091e-09       1.0538          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0903883  -6.2074e-13  2.83953e-10 -3.58237e-10 -4.84323e-10 -3.84514e-10   -0.0326152  6.25412e-13  3.66711e-10    0.0119008  -0.00882167  1.49744e-10   -0.0481031  0.000652256    0.0477611  -9.2352e-13  9.92965e-11  3.10606e-10 -1.22298e-10  4.09466e-10    0.0244239   0.00047026  4.25866e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.20735e-13    0.0903883 -7.31049e-11  1.72914e-10 -1.25803e-10 -5.15191e-11  6.25434e-13   -0.0326152 -1.83686e-12   0.00882167    0.0119008 -3.89461e-13  0.000652256    0.0481031 -9.23508e-13    0.0477611  2.97835e-10  1.06674e-11  2.25809e-10    -1.45e-11   0.00047026   -0.0244239 -7.66548e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.83953e-10 -7.31049e-11     0.139396   -0.0345624   -0.0540816   -0.0540816 -8.99906e-11  6.45684e-11    0.0389352  2.49878e-11 -9.95147e-11     0.019005 -2.04398e-09  6.51639e-11  1.06526e-10 -3.16636e-11   -0.0544991   0.00907389   -0.0148759    0.0157379  4.03061e-10 -9.26448e-11   -0.0315363         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.58237e-10  1.72914e-10   -0.0345624     0.139396    0.0540816    0.0540816   1.2141e-10 -1.08275e-10   -0.0389352 -2.45107e-11  1.05023e-10    -0.019005  2.07333e-09 -2.74827e-11 -2.22107e-10  1.88172e-10  -0.00907389    0.0544991    0.0157379   -0.0148759 -4.71934e-10 -3.73823e-12    0.0315363         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-4.84323e-10 -1.25803e-10   -0.0540816    0.0540816     0.172266    0.0674317  1.65216e-10  7.42402e-11   -0.0525252 -1.21243e-10  2.48224e-11   -0.0256384  2.79659e-09  4.40141e-12 -3.00162e-10 -1.33617e-10    -0.014378     -0.01524    0.0177815    0.0457915  -6.4172e-10 -2.79519e-11   -0.0289467         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.84514e-10 -5.15191e-11   -0.0540816    0.0540816    0.0674317     0.172266  1.21509e-10  4.28205e-11   -0.0525252 -1.15735e-10  2.43453e-11   -0.0256384   2.7589e-09  3.37531e-11 -1.43654e-10 -1.80368e-11     -0.01524    -0.014378   -0.0457915   -0.0177815 -5.44685e-10 -9.75057e-11   -0.0289467         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0326152  6.25437e-13 -8.99906e-11   1.2141e-10  1.65216e-10  1.21509e-10     0.236624 -1.38044e-13 -1.35483e-10   -0.0115536   0.00856434 -2.41288e-11  -0.00949851  0.000128796    0.0424653  4.00013e-12  1.63251e-10 -1.23945e-10 -2.25062e-10 -1.65413e-10   0.00359498   6.9218e-05  5.46627e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  6.2541e-13   -0.0326152  6.45684e-11 -1.08275e-10  7.42402e-11  4.28205e-11 -1.38039e-13     0.236624  3.37463e-12  -0.00856434   -0.0115536  9.80759e-13  0.000128796   0.00949851  4.00012e-12    0.0424653 -4.03738e-10 -1.32627e-11 -3.02399e-10  1.52033e-11   6.9218e-05  -0.00359498  8.20437e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.66711e-10 -1.83686e-12    0.0389352   -0.0389352   -0.0525252   -0.0525252 -1.35483e-10  3.37463e-12     0.424108  3.29179e-10 -2.46236e-10   -0.0112617  -9.3286e-10  4.52982e-12  1.82485e-10 -2.97145e-12  0.000393658  0.000393658 -0.000516279  0.000516279  1.09313e-09  3.47457e-11   0.00121104         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0119008   0.00882167  2.49878e-11 -2.45107e-11 -1.21243e-10 -1.15735e-10   -0.0115536  -0.00856434  3.29179e-10     0.446812  9.53195e-13 -1.12006e-10 -0.000385001   0.00029356   0.00867266   0.00642876 -4.74402e-11 -5.33581e-11  1.82895e-09 -7.90773e-11    0.0144709   -0.0103011 -1.78566e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " -0.00882167    0.0119008 -9.95147e-11  1.05023e-10  2.48224e-11  2.43453e-11   0.00856434   -0.0115536 -2.46236e-10  9.53128e-13     0.446812  8.44714e-11   0.00029356  0.000385001  -0.00642876   0.00867266  1.80333e-09  5.34514e-11 -4.70211e-11  4.11032e-11   -0.0103011   -0.0144709 -2.38865e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.49744e-10 -3.89461e-13     0.019005    -0.019005   -0.0256384   -0.0256384 -2.41288e-11  9.80759e-13   -0.0112617 -1.12006e-10  8.44714e-11     0.627074 -6.54357e-10  1.58545e-12  1.02977e-10 -5.61314e-13     0.013294     0.013294    -0.017435     0.017435  2.09106e-10  7.96471e-12  0.000498534         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0481031  0.000652256 -2.04398e-09  2.07333e-09  2.79659e-09   2.7589e-09  -0.00949851  0.000128796  -9.3286e-10 -0.000385001   0.00029356 -6.54357e-10     0.912954 -7.13481e-13    0.0215518 -0.000292232 -2.19836e-09 -1.98358e-09  2.88534e-09 -2.59934e-09    0.0227039  0.000745191  5.35397e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 0.000652256    0.0481031  6.51639e-11 -2.74827e-11  4.40141e-12  3.37531e-11  0.000128796   0.00949851  4.52982e-12   0.00029356  0.000385001  1.58545e-12 -7.13476e-13     0.912954 -0.000292232   -0.0215518 -1.23628e-10  1.62367e-10 -1.08957e-10 -1.05817e-10 -0.000745191    0.0227039  1.07612e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0477611 -9.23508e-13  1.06526e-10 -2.22107e-10 -3.00162e-10 -1.43654e-10    0.0424653  4.00012e-12  1.82485e-10   0.00867266  -0.00642876  1.02977e-10    0.0215518 -0.000292232     0.952112  2.99038e-12  1.98011e-10  4.91534e-11 -2.64047e-10  6.40005e-11  -0.00321146 -6.18336e-05   6.9849e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-9.23518e-13    0.0477611 -3.16636e-11  1.88172e-10 -1.33617e-10 -1.80368e-11  4.00013e-12    0.0424653 -2.97145e-12   0.00642876   0.00867266 -5.61314e-13 -0.000292232   -0.0215518  2.99039e-12     0.952112 -2.09586e-10 -9.53956e-12 -1.54954e-10  6.09598e-12 -6.18336e-05   0.00321146  4.80819e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 9.92965e-11  2.97835e-10   -0.0544991  -0.00907389    -0.014378     -0.01524  1.63251e-10 -4.03738e-10  0.000393658 -4.74402e-11  1.80333e-09     0.013294 -2.19836e-09 -1.23628e-10  1.98011e-10 -2.09586e-10      1.07451    0.0335383   -0.0382155    0.0382155  4.69078e-10 -1.03886e-10    0.0123255         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.10606e-10  1.06674e-11   0.00907389    0.0544991     -0.01524    -0.014378 -1.23945e-10 -1.32627e-11  0.000393658 -5.33581e-11  5.34514e-11     0.013294 -1.98358e-09  1.62367e-10  4.91534e-11 -9.53956e-12    0.0335383      1.07451   -0.0382155    0.0382155  5.90584e-10  6.92954e-11    0.0123255         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.22298e-10  2.25809e-10   -0.0148759    0.0157379    0.0177815   -0.0457915 -2.25062e-10 -3.02399e-10 -0.000516279  1.82895e-09 -4.70211e-11    -0.017435  2.88534e-09 -1.08957e-10 -2.64047e-10 -1.54954e-10   -0.0382155   -0.0382155      1.09549   -0.0545186 -6.02666e-10 -1.02065e-10    0.0113206         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.09466e-10    -1.45e-11    0.0157379   -0.0148759    0.0457915   -0.0177815 -1.65413e-10  1.52033e-11  0.000516279 -7.90773e-11  4.11032e-11     0.017435 -2.59934e-09 -1.05817e-10  6.40005e-11  6.09598e-12    0.0382155    0.0382155   -0.0545186      1.09549  7.75546e-10 -1.91115e-11   -0.0113206         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0559711   0.00107767  3.90652e-09  -3.9712e-09 -5.36553e-09 -5.27338e-09   0.00259782  5.00185e-05  1.12199e-09   0.00898711  -0.00639751  2.78488e-10    0.0177734 -0.000583363   -0.0179748 -0.000346087 -5.26043e-11 -7.87246e-11  6.30674e-11 -9.83429e-11     0.583856 -9.31946e-12  2.99588e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  0.00107767   -0.0559711  6.42041e-11 -1.55518e-10  -1.0647e-10 -1.72014e-10  5.00185e-05  -0.00259782  3.01001e-11  -0.00639751  -0.00898711  7.16003e-12  0.000583363    0.0177734 -0.000346087    0.0179748  1.41361e-10  1.06411e-10  1.15373e-10 -8.89136e-11  -9.3196e-12     0.583856  4.55845e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  6.6205e-11 -4.40267e-10   -0.0321477    0.0321477   -0.0289188   -0.0289188  2.49013e-12  8.79321e-10   0.00257273 -1.64768e-09 -2.19954e-09   0.00131603 -9.47634e-11  7.08685e-11  9.51359e-12  6.09853e-10    0.0137213    0.0137213    0.0109488   -0.0109488  7.84856e-10  5.06105e-09      2.11623         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.2"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
