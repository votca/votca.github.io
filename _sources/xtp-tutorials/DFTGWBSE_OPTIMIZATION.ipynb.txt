{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-05-29T14:44:10.671180Z",
     "iopub.status.busy": "2022-05-29T14:44:10.670655Z",
     "iopub.status.idle": "2022-05-29T14:44:36.211987Z",
     "shell.execute_reply": "2022-05-29T14:44:36.211422Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2023-dev gitid: 0287a5c (compiled May 29 2022, 14:35:58)\r\n",
      "votca_csg, version 2023-dev gitid: 0287a5c (compiled May 29 2022, 14:19:54)\r\n",
      "votca_tools, version 2023-dev gitid: 0287a5c (compiled May 29 2022, 14:17:34)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 BohrA\r\n",
      "    0.306708  4.99905e-16  1.22458e-10  3.90429e-10  1.62917e-15   -0.0516336  1.13494e-14 -8.81584e-15 -3.34196e-15   3.3874e-08   -0.0181563 -1.92617e-15 -5.66729e-06    0.0389795 -1.57873e-15    0.0421241 -1.94745e-11 -2.61568e-11  1.77991e-15 -9.88526e-16 -5.40857e-07    -0.108303  -1.6043e-10  1.27889e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.81635e-16     0.306708 -4.74096e-16 -2.98032e-15   -0.0516336  1.44224e-15 -1.74359e-09  2.01157e-09  5.34415e-10    0.0181563   3.3874e-08  3.16684e-10    0.0389795  5.66729e-06    0.0421241 -1.48789e-15  4.91459e-14  4.83275e-14   3.2947e-10 -3.36152e-10     0.108303 -5.40857e-07 -3.22951e-15 -6.37163e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.22458e-10 -4.74115e-16     0.319156   -0.0100481  -5.8162e-15    4.198e-11  4.30171e-07 -4.30171e-07 -1.60764e-07 -5.05865e-16 -4.28648e-11 -6.87983e-08  4.45704e-15 -2.56197e-11  2.99818e-15 -1.63904e-11    0.0495092   0.00204416 -3.66195e-07  7.26721e-06 -8.83513e-15 -1.58331e-11   -0.0252874   -0.0205524          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.90429e-10 -2.98033e-15   -0.0100481     0.319156  -2.3111e-15 -3.67899e-10  4.30171e-07 -4.30171e-07 -1.60764e-07   -1.134e-15 -1.10116e-10 -6.87983e-08  5.65433e-15 -3.30932e-11  8.26733e-16  3.13124e-10   0.00204416    0.0495092 -7.26721e-06  3.66195e-07 -1.56101e-14 -5.25146e-10   -0.0252874    0.0205524          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  1.6211e-15   -0.0516336  -5.8162e-15 -2.31109e-15     0.490609  1.76335e-15 -1.69885e-09  1.28897e-09  7.55661e-10   -0.0134761 -2.51421e-08  2.05863e-10    0.0080157  1.16541e-06    0.0309388  3.01103e-15  2.73054e-14  2.78078e-14  1.87759e-10 -1.83891e-10    -0.053272  2.66037e-07 -1.94871e-15  6.27545e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0516336  1.41267e-15    4.198e-11 -3.67899e-10  1.77063e-15     0.490609  4.74636e-15 -8.21516e-15 -3.14203e-15 -2.51421e-08    0.0134761 -8.51667e-16 -1.16541e-06    0.0080157  2.98511e-15    0.0309388  1.41584e-11  1.80255e-11 -3.28883e-15  2.79367e-15  2.66037e-07     0.053272  9.98373e-11 -3.84167e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.13494e-14 -1.74359e-09  4.30171e-07  4.30171e-07 -1.69885e-09  4.74635e-15     0.549726    -0.220522   -0.0861688 -7.16778e-10 -5.40314e-15   -0.0368756  5.42593e-10  7.53072e-14  7.89529e-10 -1.90513e-15 -5.14824e-06  1.75277e-06    0.0125301     0.034935 -6.78358e-09 -1.30426e-14  3.87594e-07  -0.00774117          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-8.81585e-15  2.01157e-09 -4.30171e-07 -4.30171e-07  1.28897e-09 -8.21515e-15    -0.220522     0.549726    0.0861688  7.84029e-10  4.74622e-15    0.0368756 -5.50067e-10 -7.65387e-14 -4.60014e-10  4.14167e-15 -1.75277e-06  5.14824e-06     0.034935    0.0125301  7.28253e-09  6.36498e-15 -3.87594e-07  -0.00774115          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.34174e-15  5.34415e-10 -1.60764e-07 -1.60764e-07  7.55661e-10 -3.14203e-15   -0.0861688    0.0861688     0.662739  4.24852e-10  3.44114e-15  -0.00625217 -6.14589e-11 -8.37901e-15 -4.50125e-10   2.2074e-15  6.09817e-07  6.09817e-07   0.00414117  -0.00414117  1.82084e-09  3.44403e-15 -1.31249e-07  3.28068e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  3.3874e-08    0.0181563 -5.05883e-16 -1.13379e-15   -0.0134761 -2.51421e-08 -7.16778e-10  7.84029e-10  4.24852e-10     0.680027 -9.77046e-16  3.11524e-11   7.6988e-05   1.1337e-08   0.00866729  1.61704e-08  1.31569e-14  1.37578e-14  9.37658e-11 -8.87452e-11    0.0410255 -2.81419e-07 -2.23835e-15 -3.94512e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0181563   3.3874e-08 -4.28648e-11 -1.10116e-10 -2.51421e-08    0.0134761 -5.40316e-15  4.74644e-15  3.44112e-15 -1.12134e-15     0.680027  -1.1275e-17   1.1337e-08  -7.6988e-05  1.61704e-08  -0.00866729 -1.45176e-11 -1.95381e-11  3.29248e-15 -2.69753e-15  2.81419e-07    0.0410255  1.18008e-10 -9.08913e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.92617e-15  3.16684e-10 -6.87983e-08 -6.87983e-08  2.05863e-10 -8.51452e-16   -0.0368756    0.0368756  -0.00625217  3.11524e-11 -1.12818e-17     0.797893 -2.21528e-10 -3.08803e-14  6.39471e-11 -4.49133e-16  2.14043e-06  2.14043e-06    0.0145354   -0.0145354   9.5715e-10  1.75511e-15 -5.39541e-08  1.35918e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-5.66729e-06    0.0389795  4.45703e-15  5.65433e-15    0.0080157 -1.16541e-06  5.42593e-10 -5.50067e-10 -6.14589e-11   7.6988e-05   1.1337e-08 -2.21528e-10     0.956279 -2.08441e-14   -0.0131238  1.90809e-06 -4.35041e-14 -4.44231e-14 -2.31212e-10  3.46022e-10   -0.0200194 -2.81067e-06 -6.80033e-15  3.63254e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0389795  5.66729e-06 -2.56197e-11 -3.30932e-11  1.16541e-06    0.0080157  7.53072e-14 -7.65387e-14 -8.37897e-15   1.1337e-08  -7.6988e-05 -3.08803e-14  -2.0843e-14     0.956279 -1.90809e-06   -0.0131238 -4.62595e-11  6.85496e-11 -4.08303e-14  4.17572e-14 -2.81067e-06    0.0200194  4.89095e-11 -6.88165e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.57041e-15    0.0421241  2.99811e-15  8.26691e-16    0.0309388  3.01687e-15  7.89529e-10 -4.60014e-10 -4.50125e-10   0.00866729  1.61704e-08  6.39471e-11   -0.0131238 -1.90809e-06     0.987501  3.99015e-15  5.49106e-15 -1.91275e-14  -1.3445e-10 -4.39277e-11    0.0224113  -1.1192e-07  2.44707e-15  3.09282e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0421241 -1.47124e-15 -1.63904e-11  3.13124e-10  3.01365e-15    0.0309388 -1.90517e-15  4.14161e-15   2.2074e-15  1.61704e-08  -0.00866729 -4.49132e-16  1.90809e-06   -0.0131238  4.01164e-15     0.987501  6.74219e-11 -1.10956e-10  1.57484e-14  8.89028e-15 -1.11921e-07   -0.0224113  1.30106e-10 -6.73703e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.94745e-11  4.91459e-14    0.0495092   0.00204416  2.73054e-14  1.41584e-11 -5.14824e-06 -1.75277e-06  6.09817e-07  1.31569e-14 -1.45176e-11  2.14043e-06 -4.35041e-14 -4.62595e-11  5.49106e-15  6.74219e-11      1.02819    0.0020693  6.39661e-06 -6.39661e-06  1.82938e-13 -1.80133e-12  -0.00469072 -9.98853e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.61568e-11  4.83275e-14   0.00204416    0.0495092  2.78078e-14  1.80255e-11  1.75277e-06  5.14824e-06  6.09817e-07  1.37579e-14 -1.95381e-11  2.14043e-06 -4.44231e-14  6.85496e-11 -1.91275e-14 -1.10956e-10    0.0020693      1.02819  6.39661e-06 -6.39661e-06   1.7112e-13    8.997e-11  -0.00469072  9.98856e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.77991e-15   3.2947e-10 -3.66195e-07 -7.26721e-06  1.87759e-10 -3.28883e-15    0.0125301     0.034935   0.00414117  9.37658e-11  3.29248e-15    0.0145354 -2.31212e-10 -4.08303e-14  -1.3445e-10  1.57484e-14  6.39661e-06  6.39661e-06      1.07163   -0.0455077  1.15778e-09 -1.01048e-14  7.83384e-07 -0.000200754          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-9.88524e-16 -3.36152e-10  7.26721e-06  3.66195e-07 -1.83891e-10  2.79367e-15     0.034935    0.0125301  -0.00414117 -8.87452e-11 -2.69749e-15   -0.0145354  3.46022e-10  4.17572e-14 -4.39277e-11  8.89028e-15 -6.39661e-06 -6.39661e-06   -0.0455077      1.07163  -1.2482e-09  -1.9443e-15 -7.83384e-07 -0.000200757          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.75755e-07   -0.0752424  4.46027e-15  9.14501e-15    0.0690969 -3.45065e-07  3.52652e-09  -3.8526e-09 -1.17254e-09   -0.0309264 -2.12143e-07 -8.30841e-10   0.00901647  1.26589e-06   -0.0363998  1.81778e-07 -1.04869e-13 -1.04828e-13 -7.12842e-10  7.14106e-10    -0.194835 -2.10838e-15 -3.70207e-14 -4.77421e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0752424  3.75755e-07  1.03398e-10  4.38777e-10 -3.45065e-07   -0.0690969  5.49324e-15 -9.92976e-16 -1.90451e-15  2.12143e-07   -0.0309264 -1.02005e-15  1.26589e-06  -0.00901647  1.81778e-07    0.0363998  7.75988e-12   4.8256e-12 -1.48667e-15    1.777e-15 -2.11723e-15    -0.194835 -2.30344e-09 -9.28482e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.58821e-10 -6.44354e-15   -0.0143253   -0.0143253 -3.72572e-15 -1.71047e-10  6.60267e-07 -6.60267e-07 -2.31268e-07 -3.56525e-15  4.79005e-11  -1.0215e-07  6.67109e-17  8.18503e-12  2.74876e-15  2.22422e-10  -0.00613235  -0.00613235  9.36791e-07 -9.36791e-07 -7.14837e-14 -2.19098e-09     0.954926 -1.21442e-08          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 7.76549e-11 -3.73769e-11   0.00586123  -0.00586123 -1.56132e-10  3.52131e-10    0.0015229   0.00152289 -1.84407e-09  1.24365e-12   1.1283e-11 -9.64002e-10  5.35502e-11 -1.18394e-10  1.49068e-11 -2.37977e-11  -0.00435109   0.00435109  -0.00168394  -0.00168394 -5.71605e-10 -1.11749e-09 -1.23512e-08    0.0969985          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0935659   4.5558e-16  6.09655e-11  2.33641e-10  8.67823e-16   -0.0328713  4.86724e-15 -3.27993e-15 -2.11689e-15  2.89279e-08   -0.0155052 -1.34044e-15 -7.02442e-06    0.0483139 -1.70215e-15    0.0481173 -1.98719e-11 -2.29721e-11   1.6115e-15 -1.32326e-15 -1.25081e-07   -0.0250466  5.23673e-11  1.46299e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.40346e-16    0.0935659  3.34749e-16  -1.2385e-15   -0.0328713  7.60548e-16 -6.93485e-10  8.66161e-10  3.29987e-10    0.0155052  2.89279e-08  2.18244e-10    0.0483139  7.02442e-06    0.0481173  -1.6114e-15  4.10515e-14  4.07323e-14  2.78098e-10 -2.81198e-10    0.0250466 -1.25081e-07 -8.95303e-15 -7.28411e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.09655e-11   3.3474e-16      0.10504  -0.00568231 -3.89205e-15  2.62123e-11  2.17357e-07 -2.17357e-07 -1.18027e-07 -1.77688e-16 -4.11689e-11  -5.3919e-08  4.44614e-15  -2.6251e-11   3.5775e-15 -2.15887e-11    0.0670098   0.00240141 -4.11207e-07  9.80471e-06 -4.40565e-16  9.09166e-11   -0.0419176   -0.0149482         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.33641e-10  -1.2385e-15  -0.00568231      0.10504 -1.36959e-15 -2.63301e-10  2.17357e-07 -2.17357e-07 -1.18027e-07 -8.02076e-16 -1.08726e-10  -5.3919e-08  5.61722e-15 -3.35763e-11  9.14724e-16  3.84219e-10   0.00240141    0.0670098 -9.80471e-06  4.11207e-07 -2.57309e-15 -8.33993e-11   -0.0419176    0.0149482         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 8.59902e-16   -0.0328713 -3.89205e-15 -1.36959e-15     0.240584  1.78323e-15 -1.05286e-09   7.6335e-10  6.49827e-10   -0.0144632 -2.69837e-08  1.73493e-10   0.00916843  1.33301e-06    0.0440553  4.23188e-15  2.42531e-14  2.25308e-14  1.51136e-10 -1.63432e-10   0.00432456 -2.15965e-08 -5.56269e-15 -1.45941e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0328713  7.36875e-16  2.62123e-11 -2.63301e-10  1.79042e-15     0.240584   2.8301e-15 -5.32272e-15 -2.72595e-15 -2.69837e-08    0.0144632 -7.54251e-16 -1.33301e-06   0.00916843   4.1958e-15    0.0440553  2.41341e-11  1.18381e-11  -2.3078e-15  4.04228e-15 -2.15965e-08  -0.00432456 -2.19106e-11  3.05143e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.86723e-15 -6.93485e-10  2.17357e-07  2.17357e-07 -1.05286e-09   2.8301e-15     0.221542     -0.11082   -0.0632617 -5.30873e-10 -4.10235e-15   -0.0289004  4.89916e-10  6.78847e-14  9.26879e-10 -2.21955e-15 -4.54945e-06  4.84405e-06    0.0337442    0.0308642 -1.18894e-09 -4.40207e-15  1.02431e-06  -0.00631355         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.27992e-15  8.66161e-10 -2.17357e-07 -2.17357e-07   7.6335e-10 -5.32271e-15     -0.11082     0.221542    0.0632617   5.9843e-10   3.4503e-15    0.0289004 -4.97242e-10 -6.90972e-14 -5.21072e-10  4.96818e-15 -4.84405e-06  4.54945e-06    0.0308642    0.0337442  1.36166e-09  2.14719e-15 -1.02431e-06  -0.00631355         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.11669e-15  3.29987e-10 -1.18027e-07 -1.18027e-07  6.49827e-10 -2.72597e-15   -0.0632617    0.0632617     0.428924  4.79328e-10  3.94476e-15    -0.012098 -1.75706e-11 -2.16656e-15 -6.21667e-10  3.06025e-15  4.03487e-09  4.03487e-09  2.74002e-05 -2.74002e-05  4.95217e-10  1.42428e-15 -3.74955e-07  8.12546e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.89279e-08    0.0155052 -1.77711e-16 -8.01869e-16   -0.0144632 -2.69837e-08 -5.30873e-10   5.9843e-10  4.79328e-10     0.462759 -1.31307e-15 -2.96019e-13  0.000635208  9.35388e-08    0.0104064   1.9415e-08  1.25443e-14  1.31227e-14   8.9417e-11 -8.39331e-11    0.0177344 -1.21651e-07 -5.44198e-15 -7.22625e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0155052  2.89279e-08 -4.11689e-11 -1.08726e-10 -2.69837e-08    0.0144632 -4.10242e-15  3.45057e-15  3.94475e-15 -1.51526e-15     0.462759 -3.47114e-16  9.35388e-08 -0.000635208   1.9415e-08   -0.0104064 -3.07985e-11 -3.62823e-11  5.58975e-15 -5.02236e-15  1.21651e-07    0.0177344  1.14126e-10 -1.55794e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.34046e-15  2.18244e-10  -5.3919e-08  -5.3919e-08  1.73493e-10 -7.53982e-16   -0.0289004    0.0289004    -0.012098 -2.96019e-13 -3.47131e-16     0.635437    -3.22e-10 -4.49181e-14  1.32652e-10 -8.31988e-16  3.09284e-06  3.09284e-06     0.021003    -0.021003  1.07108e-10  6.65855e-16 -1.67945e-07  1.60072e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-7.02442e-06    0.0483139  4.44614e-15  5.61722e-15   0.00916843 -1.33301e-06  4.89916e-10 -4.97242e-10 -1.75706e-11  0.000635208  9.35388e-08    -3.22e-10     0.916802 -3.67116e-14   -0.0222399  3.23349e-06 -7.41781e-14 -7.60242e-14 -3.71311e-10  6.02972e-10   -0.0232165 -3.25953e-06 -1.35729e-14  1.03489e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0483139  7.02442e-06  -2.6251e-11 -3.35763e-11  1.33301e-06   0.00916843  6.78847e-14 -6.90972e-14 -2.16649e-15  9.35388e-08 -0.000635208 -4.49181e-14 -3.67063e-14     0.916802 -3.23349e-06   -0.0222399 -9.04565e-11  1.41205e-10 -6.96212e-14  7.14791e-14 -3.25953e-06    0.0232165   1.0423e-10 -2.10257e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.69196e-15    0.0481173  3.57741e-15  9.14675e-16    0.0440553   4.2423e-15  9.26879e-10 -5.21072e-10 -6.21667e-10    0.0104064   1.9415e-08  1.32652e-10   -0.0222399 -3.23349e-06      0.97942  7.73043e-15  1.48028e-14 -3.04058e-14 -2.15076e-10  -1.1263e-10  -0.00417248  2.08371e-08  6.60218e-15  7.33508e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481173 -1.59285e-15 -2.15887e-11  3.84219e-10  4.23965e-15    0.0440553 -2.21964e-15  4.96813e-15  3.06025e-15   1.9415e-08   -0.0104064 -8.31994e-16  3.23349e-06   -0.0222399  7.77668e-15      0.97942  1.31024e-10 -1.96682e-10    2.775e-14  1.75027e-14  2.08371e-08   0.00417248  4.31217e-10 -1.50454e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.98719e-11  4.10515e-14    0.0670098   0.00240141  2.42531e-14  2.41341e-11 -4.54945e-06 -4.84405e-06  4.03487e-09  1.25443e-14 -3.07985e-11  3.09284e-06 -7.41782e-14 -9.04565e-11  1.48028e-14  1.31024e-10       1.0596   0.00440412  1.19472e-05 -1.19472e-05  1.02407e-13  2.35524e-11   -0.0159918   -0.0060407         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.29721e-11  4.07323e-14   0.00240141    0.0670098  2.25308e-14  1.18381e-11  4.84405e-06  4.54945e-06  4.03487e-09  1.31228e-14 -3.62823e-11  3.09284e-06 -7.60242e-14  1.41205e-10 -3.04058e-14 -1.96682e-10   0.00440412       1.0596  1.19472e-05 -1.19472e-05  8.39715e-14  1.64384e-10   -0.0159918    0.0060407         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  1.6115e-15  2.78098e-10 -4.11207e-07 -9.80471e-06  1.51136e-10 -2.30779e-15    0.0337442    0.0308642  2.74002e-05   8.9417e-11  5.58974e-15     0.021003 -3.71311e-10 -6.96212e-14 -2.15076e-10    2.775e-14  1.19472e-05  1.19472e-05      1.14073    -0.085536  5.62041e-10 -2.13383e-14  2.56164e-06  -0.00262418         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.32326e-15 -2.81198e-10  9.80471e-06  4.11207e-07 -1.63432e-10  4.04228e-15    0.0308642    0.0337442 -2.74002e-05 -8.39331e-11  -5.0223e-15    -0.021003  6.02972e-10  7.14791e-14  -1.1263e-10  1.75027e-14 -1.19472e-05 -1.19472e-05    -0.085536      1.14073 -7.02584e-10  2.82332e-15 -2.56164e-06  -0.00262418         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.85919e-07    0.0572532 -5.33396e-15 -8.62923e-15   0.00341529 -1.70557e-08  -4.1284e-09  4.38905e-09  6.37935e-10    0.0102623  7.03955e-08  1.16523e-10   -0.0185867 -2.60953e-06   -0.0190696  9.52324e-08  2.07956e-14 -5.79835e-15 -5.04659e-11 -1.50414e-10     0.599386  1.03416e-14 -6.25438e-14 -1.04914e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0572532 -2.85919e-07  8.19173e-11 -1.79426e-10 -1.70557e-08  -0.00341529 -8.17614e-15  4.83277e-15  1.26999e-15 -7.03955e-08    0.0102623   6.0776e-16 -2.60953e-06    0.0185867  9.52324e-08    0.0190696 -2.12094e-11  1.78422e-10 -2.35789e-14 -2.90419e-15  1.01908e-14     0.599386 -2.61312e-09  -2.0938e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.18673e-11 -8.32881e-15   -0.0423952   -0.0423952 -4.78613e-15  5.25864e-11  9.34927e-07 -9.34927e-07 -3.71662e-07 -5.40001e-15  8.87903e-11 -1.66766e-07 -1.49476e-14  1.15882e-10  6.74837e-15  4.93167e-10    -0.016942    -0.016942  2.68376e-06 -2.68376e-06 -9.46816e-14 -2.39357e-09       1.9863 -1.51495e-08         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.22713e-10 -1.13122e-10   -0.0168749    0.0168749 -1.18303e-10  2.57879e-10  -0.00715605  -0.00715603   1.8581e-09 -5.74484e-11 -1.14659e-10  5.82578e-10  1.22353e-10   -2.532e-10  6.63918e-11 -1.36225e-10  -0.00726858   0.00726858  -0.00301143  -0.00301143 -1.11373e-09 -2.20842e-09 -1.53474e-08     0.786042         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
