{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2023-05-19T06:08:02.810651Z",
     "iopub.status.busy": "2023-05-19T06:08:02.810090Z",
     "iopub.status.idle": "2023-05-19T06:08:35.623624Z",
     "shell.execute_reply": "2023-05-19T06:08:35.622962Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/votca/issues\r\n",
      "\r\n",
      "xtp_tools, version 2024-dev gitid: df28d64 (compiled May 19 2023, 05:41:48)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 BohrA\r\n",
      "    0.307132 -3.10659e-11  4.46663e-11 -2.30825e-10  2.35408e-11   -0.0516061  8.55508e-10  7.78971e-10   -3.226e-10    0.0181637  -0.00105883  -7.1512e-11    0.0103674    0.0375713 -2.03033e-11    0.0421019 -2.33163e-10  1.30847e-10 -3.01322e-10 -1.07058e-10  0.000482256    -0.108408 -1.28154e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.10659e-11     0.307132 -1.47189e-10   7.0653e-11   -0.0516061  2.35409e-11  9.00339e-10   1.0865e-09 -1.97437e-10   0.00105883    0.0181637 -2.25166e-10    0.0375713   -0.0103674    0.0421019 -2.03032e-11 -1.94034e-11  2.13667e-10 -9.72952e-11  5.02009e-12    -0.108408 -0.000482256 -1.34929e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.46663e-11 -1.47189e-10      0.32063   0.00926462  1.56599e-10  1.02955e-10    0.0133906    0.0133906  -0.00499365 -5.81958e-11 -1.46179e-11  -0.00212745 -8.94804e-11  1.83562e-10 -1.71729e-10 -2.08896e-11    0.0470536  -0.00128365  -0.00258805   -0.0152178  1.82108e-10 -3.05987e-10   -0.0254906          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.30825e-10   7.0653e-11   0.00926462      0.32063  -1.6992e-10  3.23987e-10   -0.0133906   -0.0133906   0.00499365 -5.01121e-11  6.87335e-11   0.00212745  7.31081e-11 -1.45107e-10   6.9095e-11 -1.85885e-10  -0.00128365    0.0470536    0.0152178   0.00258805 -1.68627e-10  7.90328e-10    0.0254906          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.35408e-11   -0.0516061  1.56599e-10  -1.6992e-10     0.490902 -2.89505e-12  1.80082e-09  1.37388e-09 -8.20718e-10 -0.000783481   -0.0134403  -1.9845e-10   0.00770587  -0.00212636    0.0309987  6.70636e-11 -6.53262e-11  -1.8955e-10 -1.33943e-10  -2.7375e-10    0.0531267  0.000236336  1.67515e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0516061  2.35409e-11  1.02955e-10  3.23987e-10 -2.89505e-12     0.490902 -2.54676e-10 -2.67998e-10  1.55068e-10   -0.0134403  0.000783481  1.92905e-11   0.00212636   0.00770587  6.70638e-11    0.0309987  1.90948e-10  -5.1141e-11  9.18223e-11 -1.63054e-10 -0.000236336    0.0531267  2.48339e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 8.55508e-10  9.00339e-10    0.0133906   -0.0133906  1.80082e-09 -2.54676e-10      0.54956     0.219665   -0.0856641 -7.11854e-12  6.43996e-10   -0.0364956 -1.85323e-09  2.97905e-09 -9.22293e-10  3.15912e-10   -0.0113561  -0.00127363     0.012711   -0.0330589  5.12483e-10  -7.4601e-09  -0.00157313          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 7.78971e-10   1.0865e-09    0.0133906   -0.0133906  1.37388e-09 -2.67998e-10     0.219665      0.54956   -0.0856641  4.69971e-11  7.52303e-10   -0.0364956 -1.89168e-09  2.96268e-09 -7.15518e-10  2.13277e-10   0.00127363    0.0113561   -0.0330589     0.012711  4.19461e-11 -7.44288e-09  -0.00157313          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -3.226e-10 -1.97437e-10  -0.00499365   0.00499365 -8.20718e-10  1.55068e-10   -0.0856641   -0.0856641     0.662947 -1.74993e-10 -2.31591e-10  -0.00632525  4.08122e-10 -7.41446e-10  5.58311e-10 -1.54291e-10   0.00131689  -0.00131689   0.00387665   0.00387665 -9.19642e-10  2.85839e-09   0.00114547          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0181637   0.00105883 -5.81958e-11 -5.01121e-11 -0.000783481   -0.0134403 -7.11854e-12  4.69971e-11 -1.74993e-10     0.680922   1.5861e-12  8.85885e-11  2.70787e-05  7.97141e-05  0.000502623   0.00862229  -3.6529e-10  -3.6589e-11  6.95858e-11  8.84065e-10  -0.00220536   -0.0409682 -8.96058e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -0.00105883    0.0181637 -1.46179e-11  6.87335e-11   -0.0134403  0.000783481  6.43996e-10  7.52303e-10 -2.31591e-10  1.58614e-12     0.680922 -1.12767e-10   7.9714e-05 -2.70787e-05   0.00862229 -0.000502623 -5.79067e-11  8.72386e-10 -5.51342e-10 -1.49463e-10   -0.0409682   0.00220536 -8.14805e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -7.1512e-11 -2.25166e-10  -0.00212745   0.00212745  -1.9845e-10  1.92905e-11   -0.0364956   -0.0364956  -0.00632525  8.85885e-11 -1.12767e-10      0.79826  3.98332e-10 -4.68386e-10  -1.5794e-11 -4.96598e-11   0.00465575  -0.00465575    0.0137056    0.0137056  8.87423e-11  8.70736e-10  0.000454021          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0103674    0.0375713 -8.94804e-11  7.31081e-11   0.00770587   0.00212636 -1.85323e-09 -1.89168e-09  4.08122e-10  2.70787e-05   7.9714e-05  3.98332e-10     0.956418  4.28728e-11   -0.0126687  -0.00349581  3.04012e-10 -4.16217e-10  1.05002e-09   1.0494e-09    0.0192775   0.00541183  3.06168e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0375713   -0.0103674  1.83562e-10 -1.45107e-10  -0.00212636   0.00770587  2.97905e-09  2.96268e-09 -7.41446e-10  7.97141e-05 -2.70787e-05 -4.68386e-10  4.28728e-11     0.956418   0.00349581   -0.0126687 -5.77268e-10  5.77888e-10 -1.67381e-09 -1.78602e-09  -0.00541183    0.0192775 -7.94244e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.03033e-11    0.0421019 -1.71729e-10   6.9095e-11    0.0309987  6.70638e-11 -9.22293e-10 -7.15518e-10  5.58311e-10  0.000502623   0.00862229  -1.5794e-11   -0.0126687   0.00349581     0.988566  3.78984e-11  8.54142e-12 -1.86412e-10  2.23283e-10 -1.98123e-11   -0.0223628 -9.94819e-05  3.66073e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0421019 -2.03032e-11 -2.08896e-11 -1.85885e-10  6.70636e-11    0.0309987  3.15912e-10  2.13277e-10 -1.54291e-10   0.00862229 -0.000502623 -4.96598e-11  -0.00349581   -0.0126687  3.78984e-11     0.988566   1.2202e-10  1.21075e-10 -1.17793e-11  -1.8965e-10   9.9482e-05   -0.0223628  4.45752e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.33163e-10 -1.94034e-11    0.0470536  -0.00128365 -6.53262e-11  1.90948e-10   -0.0113561   0.00127363   0.00131689  -3.6529e-10 -5.79067e-11   0.00465575  3.04012e-10 -5.77268e-10  8.54142e-12   1.2202e-10      1.03321  -0.00656788    0.0132467    0.0132467 -5.77623e-11   5.0651e-10  -0.00427267          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.30847e-10  2.13667e-10  -0.00128365    0.0470536  -1.8955e-10  -5.1141e-11  -0.00127363    0.0113561  -0.00131689  -3.6589e-11  8.72386e-10  -0.00465575 -4.16217e-10  5.77888e-10 -1.86412e-10  1.21075e-10  -0.00656788      1.03321   -0.0132467   -0.0132467  6.23996e-11 -5.85559e-10   0.00427267          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.01322e-10 -9.72952e-11  -0.00258805    0.0152178 -1.33943e-10  9.18223e-11     0.012711   -0.0330589   0.00387665  6.95858e-11 -5.51342e-10    0.0137056  1.05002e-09 -1.67381e-09  2.23283e-10 -1.17793e-11    0.0132467   -0.0132467       1.0677    0.0410637 -2.87522e-10  1.40587e-09   0.00205122          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.07058e-10  5.02009e-12   -0.0152178   0.00258805  -2.7375e-10 -1.63054e-10   -0.0330589     0.012711   0.00387665  8.84065e-10 -1.49463e-10    0.0137056   1.0494e-09 -1.78602e-09 -1.98123e-11  -1.8965e-10    0.0132467   -0.0132467    0.0410637       1.0677 -2.10147e-10  1.41061e-09   0.00205122          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-0.000334737    0.0752465 -2.48685e-10  3.00541e-10   -0.0690159   0.00030702 -1.37635e-09 -1.00834e-09  9.70966e-10   0.00166392    0.0309101 -4.51846e-11  -0.00866825   0.00243347    0.0364086 -0.000161965  1.19983e-10 -1.21254e-10  4.87827e-10  4.85038e-10    -0.194424  2.24755e-10  3.79921e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0752465  0.000334737  1.79045e-10 -5.58523e-10  -0.00030702   -0.0690159  5.06017e-09  5.10935e-09  -2.2613e-09    0.0309101  -0.00166392 -7.95701e-10  -0.00243347  -0.00866825  0.000161965    0.0364086 -4.43987e-10  4.49216e-10 -1.20869e-09 -1.20994e-09  2.24755e-10    -0.194424  1.19856e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.04796e-10 -4.79422e-10   -0.0141828    0.0141828  4.11058e-10  1.86435e-10   0.00439129   0.00439129   -0.0013324 -1.14246e-09 -1.07746e-09 -0.000534069  7.68933e-11  1.04393e-10 -4.14768e-11  1.63497e-10  -0.00597801   0.00597801   0.00149997   0.00149997  3.89359e-09  1.34921e-09     0.958371          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "    0.093811  -1.3809e-11  1.68318e-11 -1.31243e-10  1.44779e-11   -0.0328898  3.54489e-10  2.99601e-10 -1.98316e-10    0.0155308 -0.000905345 -3.66397e-11    0.0128554    0.0465875 -2.35898e-11    0.0481429 -2.87543e-10  1.38778e-10 -3.10589e-10 -3.79805e-11  0.000111693   -0.0251078 -4.01061e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.38091e-11     0.093811  -9.5006e-11  4.01176e-11   -0.0328898  1.44779e-11  3.69164e-10  4.83574e-10 -1.23114e-10  0.000905345    0.0155308 -1.66765e-10    0.0465875   -0.0128554    0.0481429 -2.35898e-11 -1.28355e-11  2.85444e-10 -7.55185e-11  7.32465e-11   -0.0251078 -0.000111693 -5.11082e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.68318e-11  -9.5006e-11     0.105883   0.00529874  1.02788e-10  7.14913e-11   0.00678366   0.00678366  -0.00367214 -5.18399e-11 -2.02211e-11  -0.00166809 -9.66434e-11  2.03599e-10 -2.10714e-10 -2.54215e-11    0.0640577  -0.00170107  -0.00248315   -0.0196899 -6.25163e-11 -1.11724e-11   -0.0418852         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.31243e-10  4.01176e-11   0.00529874     0.105883 -1.09869e-10  2.29104e-10  -0.00678366  -0.00678366   0.00367214 -5.46513e-11  7.11377e-11   0.00166809  7.34178e-11 -1.53317e-10  7.36113e-11 -2.18487e-10  -0.00170107    0.0640577    0.0196899   0.00248315  1.33585e-10  1.11423e-10    0.0418852         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.44779e-11   -0.0328898  1.02788e-10 -1.09869e-10     0.240891 -6.93774e-13  1.10442e-09  8.03829e-10 -6.98455e-10 -0.000841963   -0.0144435 -1.60497e-10   0.00881402  -0.00243214    0.0441772  9.32229e-11 -5.67482e-11 -3.34146e-10 -5.76275e-11 -2.87363e-10  -0.00438142 -1.94909e-05  5.20829e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0328898  1.44779e-11  7.14913e-11  2.29104e-10 -6.93779e-13     0.240891 -1.39821e-10 -1.46902e-10  1.24332e-10   -0.0144435  0.000841963  9.91391e-12   0.00243214   0.00881402  9.32231e-11    0.0441772  2.79745e-10 -5.00096e-11  1.11385e-10 -2.79509e-10  1.94909e-05  -0.00438142  4.31901e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.54489e-10  3.69164e-10   0.00678366  -0.00678366  1.10442e-09 -1.39821e-10     0.221859     0.110677   -0.0629941 -1.32154e-12  4.62572e-10   -0.0286155 -1.92615e-09    3.225e-09  -1.0314e-09  3.28917e-10   -0.0100872  -0.00711948    0.0330986   -0.0292581 -8.01295e-10 -3.84296e-10   0.00293721         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.99601e-10  4.83574e-10   0.00678366  -0.00678366  8.03829e-10 -1.46902e-10     0.110677     0.221859   -0.0629941  4.95951e-11  5.69064e-10   -0.0286155 -1.97643e-09  3.20177e-09 -7.87487e-10  1.91814e-10   0.00711948    0.0100872   -0.0292581    0.0330986 -8.98735e-10 -3.12249e-10   0.00293721         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.98316e-10 -1.23114e-10  -0.00367214   0.00367214 -6.98455e-10  1.24332e-10   -0.0629941   -0.0629941     0.429278 -2.25292e-10 -2.34109e-10   -0.0121538  4.56061e-10 -9.09295e-10  7.69086e-10  -2.0902e-10 -6.20845e-06  6.20847e-06 -1.82765e-05 -1.82764e-05 -7.44857e-11  5.84287e-10  5.94484e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0155308  0.000905345 -5.18399e-11 -5.46513e-11 -0.000841963   -0.0144435 -1.32154e-12  4.95951e-11 -2.25292e-10     0.463967  2.11823e-12  1.17676e-10  0.000208039  0.000612423  0.000603797    0.0103579 -6.15482e-10 -6.26193e-11  1.11927e-10  1.49089e-09 -0.000953304   -0.0177092  -1.8678e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-0.000905345    0.0155308 -2.02211e-11  7.11377e-11   -0.0144435  0.000841963  4.62572e-10  5.69064e-10 -2.34109e-10  2.11829e-12     0.463967 -1.09259e-10  0.000612423 -0.000208039    0.0103579 -0.000603797 -7.68909e-11  1.45585e-09 -8.66328e-10 -1.88226e-10   -0.0177092  0.000953304  -1.7777e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.66397e-11 -1.66765e-10  -0.00166809   0.00166809 -1.60497e-10  9.91391e-12   -0.0286155   -0.0286155   -0.0121538  1.17676e-10 -1.09259e-10     0.636067  5.47407e-10 -6.15514e-10 -6.46751e-11 -6.61936e-11   0.00673161  -0.00673161    0.0198165    0.0198165  1.03282e-10 -8.59937e-12  4.59314e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0128554    0.0465875 -9.66434e-11  7.34178e-11   0.00881402   0.00243214 -1.92615e-09 -1.97643e-09  4.56061e-10  0.000208039  0.000612423  5.47407e-10     0.917068  7.51605e-11   -0.0214883  -0.00592949  5.28848e-10 -7.58671e-10  1.85796e-09  1.85342e-09    0.0223809   0.00628307  1.65353e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0465875   -0.0128554  2.03599e-10 -1.53317e-10  -0.00243214   0.00881402    3.225e-09  3.20177e-09 -9.09295e-10  0.000612423 -0.000208039 -6.15514e-10  7.51606e-11     0.917068   0.00592949   -0.0214883 -1.02496e-09   1.0295e-09 -2.98488e-09  -3.2147e-09  -0.00628307    0.0223809  1.26249e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.35898e-11    0.0481429 -2.10714e-10  7.36113e-11    0.0441772  9.32231e-11  -1.0314e-09 -7.87487e-10  7.69086e-10  0.000603797    0.0103579 -6.46751e-11   -0.0214883   0.00592949     0.981535  7.30519e-11 -3.50353e-12 -3.06102e-10  3.62734e-10 -7.51734e-11   0.00424838  1.88991e-05  3.17162e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481429 -2.35898e-11 -2.54215e-11 -2.18487e-10  9.32229e-11    0.0441772  3.28917e-10  1.91814e-10  -2.0902e-10    0.0103579 -0.000603797 -6.61936e-11  -0.00592949   -0.0214883  7.30519e-11     0.981535  2.22736e-10  2.15171e-10  -7.1682e-12 -3.16773e-10 -1.88991e-05   0.00424838  6.75791e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.87543e-10 -1.28355e-11    0.0640577  -0.00170107 -5.67482e-11  2.79745e-10   -0.0100872   0.00711948 -6.20845e-06 -6.15482e-10 -7.68909e-11   0.00673161  5.28848e-10 -1.02496e-09 -3.50353e-12  2.22736e-10      1.06908    -0.012813    0.0247535    0.0247535  4.20709e-11  2.29777e-10   -0.0150497         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.38778e-10  2.85444e-10  -0.00170107    0.0640577 -3.34146e-10 -5.00096e-11  -0.00711948    0.0100872  6.20847e-06 -6.26193e-11  1.45585e-09  -0.00673161 -7.58671e-10   1.0295e-09 -3.06102e-10  2.15171e-10    -0.012813      1.06908   -0.0247535   -0.0247535 -1.38966e-10 -2.90922e-10    0.0150497         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.10589e-10 -7.55185e-11  -0.00248315    0.0196899 -5.76275e-11  1.11385e-10    0.0330986   -0.0292581 -1.82765e-05  1.11927e-10 -8.66328e-10    0.0198165  1.85796e-09 -2.98488e-09  3.62734e-10  -7.1682e-12    0.0247535   -0.0247535      1.13354    0.0772734  1.18968e-10  4.33527e-10   0.00545634         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.79805e-11  7.32465e-11   -0.0196899   0.00248315 -2.87363e-10 -2.79509e-10   -0.0292581    0.0330986 -1.82764e-05  1.49089e-09 -1.88226e-10    0.0198165  1.85342e-09  -3.2147e-09 -7.51734e-11 -3.16773e-10    0.0247535   -0.0247535    0.0772734      1.13354  1.80328e-10  3.36902e-10   0.00545634         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 0.000255154   -0.0573567  5.38704e-13  4.61113e-11  -0.00347861  1.54747e-05 -3.28441e-10 -5.33051e-10 -3.92973e-12 -0.000548578   -0.0101908 -2.33028e-11    0.0179473  -0.00503839    0.0191591 -8.52302e-05  3.92829e-14  9.07442e-11  5.05222e-11  2.62754e-10     0.600541  2.25276e-10  2.81262e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0573567 -0.000255154 -1.64528e-10   3.7136e-10 -1.54747e-05  -0.00347861  -3.8576e-09 -3.80962e-09  6.45022e-10   -0.0101908  0.000548578  1.38947e-10   0.00503839    0.0179473  8.52302e-05    0.0191591 -1.49323e-10 -6.08399e-11 -1.42181e-10 -5.12954e-11  2.25276e-10     0.600541  7.04008e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.28132e-10 -3.21303e-10    -0.042366     0.042366  6.07681e-10  5.83162e-10   0.00290661   0.00290661 -0.000443402 -1.66951e-09  -1.6031e-09 -0.000217065  1.09868e-10  1.72893e-10  4.07646e-10  8.27843e-10   -0.0160919    0.0160919   0.00533829   0.00533829   3.1489e-09  5.25148e-10      1.98492         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
