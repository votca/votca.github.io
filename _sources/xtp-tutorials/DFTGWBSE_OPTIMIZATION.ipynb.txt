{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-01T06:27:19.246159Z",
     "iopub.status.busy": "2022-07-01T06:27:19.244349Z",
     "iopub.status.idle": "2022-07-01T06:28:14.999638Z",
     "shell.execute_reply": "2022-07-01T06:28:14.998724Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2023-dev gitid: 231177b (compiled Jul  1 2022, 06:17:46)\r\n",
      "votca_csg, version 2023-dev gitid: 231177b (compiled Jul  1 2022, 05:59:55)\r\n",
      "votca_tools, version 2023-dev gitid: 231177b (compiled Jul  1 2022, 05:56:44)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 Bohr\r\n",
      "... ... \r\n",
      "... ... =========== OPTIMIZATION SUMMARY ================================= \r\n",
      "... ... At iteration  0\r\n",
      "... ...  ---- POSITIONS (Angstrom)   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    +0.0000  +0.0000  +0.0000\r\n",
      "... ...    1    +1.2000  +0.0000  +0.0000\r\n",
      "... ...    Total energy:     -112.26831841 Hartree \r\n",
      "... ...    Trust radius:       0.01889726 Bohr     \r\n",
      "... ...  ---- FORCES (Hartree/Bohr)   \r\n",
      "... ...       central differences   \r\n",
      "... ...       displacement 0.0010 Angstrom   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    -0.1314  -0.0000  -0.0000\r\n",
      "... ...    1    +0.1314  +0.0000  +0.0000A\r\n",
      "     0.30157 -1.73865e-13  4.02285e-11  2.02901e-11  -1.3915e-13     0.051948  1.70517e-12 -1.71781e-12  5.59982e-13  0.000115266    0.0176762 -2.27735e-13 -0.000535415   -0.0390217 -1.09835e-13    0.0423787  1.36902e-12  -1.2665e-12 -2.17877e-13 -2.19129e-13  8.57281e-05    -0.107191  1.70518e-11 -9.55771e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.73873e-13      0.30157  1.86547e-12  1.85286e-12     0.051948 -1.39269e-13 -2.47854e-10  2.67792e-10 -9.53367e-11   -0.0176762  0.000115266  3.87781e-11    0.0390217 -0.000535415    0.0423787 -1.09759e-13  -2.7135e-13  2.72586e-13  3.88027e-11  3.89052e-11    -0.107191 -8.57281e-05  1.31408e-13 -1.47443e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.02285e-11  1.86547e-12     0.310838   -0.0100716 -1.01096e-12   2.4436e-11  -0.00150965   0.00150965 -0.000591001 -6.62694e-13  1.10807e-11   0.00026547 -4.92349e-14  4.61674e-12  -1.4977e-13  5.02999e-11   -0.0492341   0.00195913 -0.000441167  0.000207491 -7.27897e-12 -5.28916e-11    0.0248134   -0.0141854          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.02901e-11  1.85286e-12   -0.0100716     0.310838  -1.0268e-12 -4.15015e-13  -0.00150965   0.00150965 -0.000591001  -7.2144e-13  1.09767e-12   0.00026547 -7.36828e-14  2.75591e-12 -1.82658e-13  -4.0898e-13  -0.00195913    0.0492341  0.000207491 -0.000441167 -7.28536e-12 -1.21655e-11    0.0248134    0.0141854          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.39148e-13     0.051948 -1.01096e-12  -1.0268e-12     0.487116 -2.08264e-14  1.79504e-10 -1.54653e-10  8.36862e-11   -0.0136232  8.88368e-05 -4.01341e-11  -0.00828297   0.00011365   -0.0302057 -3.83875e-13  2.18616e-13 -1.83881e-13 -2.82835e-11 -2.58459e-11   -0.0548637 -4.38782e-05 -4.32203e-13  1.50866e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "    0.051948 -1.39279e-13   2.4436e-11 -4.15015e-13 -2.08061e-14     0.487116 -9.10362e-13  8.94511e-13 -4.91215e-13  8.88368e-05    0.0136232  2.35673e-13   0.00011365   0.00828297 -3.83996e-13   -0.0302057  2.30994e-12  1.27701e-13  1.84165e-13  1.49433e-13  4.38782e-05   -0.0548637  5.56042e-12  9.42106e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.70517e-12 -2.47854e-10  -0.00150965  -0.00150965  1.79504e-10 -9.10362e-13     0.542334    -0.221425    0.0906304   1.0174e-10 -2.63864e-16   -0.0407099  1.29262e-11 -7.44159e-14  7.33086e-11 -1.34999e-13  -0.00041679 -0.000231868    0.0132948   -0.0339802  1.06723e-09 -5.57378e-12 -0.000215685    -0.017099          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.71781e-12  2.67792e-10   0.00150965   0.00150965 -1.54653e-10  8.94511e-13    -0.221425     0.542334   -0.0906304 -1.11723e-10  5.90153e-14    0.0407099  -1.4787e-11  9.88573e-14 -2.25997e-11  1.02115e-13 -0.000231868  -0.00041679    0.0339802   -0.0132948 -1.10724e-09  5.56708e-12  0.000215685    -0.017099          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.59982e-13 -9.53367e-11 -0.000591001 -0.000591001  8.36862e-11 -4.91215e-13    0.0906304   -0.0906304     0.660145  6.15273e-11 -3.97806e-14   0.00527337 -3.12105e-12  2.42748e-14  3.30989e-11 -1.94221e-13  3.39977e-05 -3.39977e-05  -0.00472234  -0.00472234  3.60913e-10 -1.76868e-12 -0.000149345 -1.20862e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 0.000115266   -0.0176762 -6.62694e-13  -7.2144e-13   -0.0136232  8.88368e-05   1.0174e-10 -1.11723e-10  6.15273e-11     0.669023  7.69584e-15 -8.25927e-12  9.83173e-06 -7.07818e-08  -0.00903048  5.88878e-05  3.02162e-14 -7.47355e-14 -4.78303e-12 -1.05561e-11    0.0409878   -0.0002345 -1.83414e-14  2.06044e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0176762  0.000115266  1.10807e-11  1.09767e-12  8.88368e-05    0.0136232 -2.63829e-16  5.90153e-14 -3.97806e-14  7.82577e-15     0.669023  5.48196e-15  7.07818e-08  9.83173e-06  5.88878e-05   0.00903048 -1.87616e-12  7.64921e-12 -6.57939e-15 -5.10891e-14   -0.0002345   -0.0409878  7.91646e-12  -1.4825e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.27735e-13  3.87781e-11   0.00026547   0.00026547 -4.01341e-11  2.35673e-13   -0.0407099    0.0407099   0.00527337 -8.25927e-12  5.48188e-15     0.793384 -1.18496e-11  9.33116e-14  3.85062e-12 -2.26927e-14  -0.00010977   0.00010977    0.0152472    0.0152472   -1.386e-10  6.76928e-13  6.22577e-05  5.29252e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-0.000535415    0.0390217 -4.92349e-14 -7.36828e-14  -0.00828297   0.00011365  1.29262e-11  -1.4787e-11 -3.12105e-12  9.83173e-06  7.07818e-08 -1.18496e-11     0.954425  5.90897e-14   -0.0128933  0.000176908 -4.06685e-14  3.13622e-14  1.11247e-11  -3.3251e-12    0.0199037 -0.000257177  9.69021e-14    1.645e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0390217 -0.000535415  4.61674e-12  2.75591e-12   0.00011365   0.00828297 -7.44159e-14  9.88573e-14  2.42748e-14 -7.07818e-08  9.83173e-06  9.33116e-14  5.90475e-14     0.954425  0.000176908    0.0128933  6.21849e-12  8.23135e-12 -3.23317e-14 -4.16485e-14 -0.000257177   -0.0199037  6.00192e-12 -1.11163e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.09819e-13    0.0423787  -1.4977e-13 -1.82658e-13   -0.0302057 -3.83968e-13  7.33086e-11 -2.25997e-11  3.30989e-11  -0.00903048  5.88878e-05  3.85062e-12   -0.0128933  0.000176908     0.974684  2.23345e-13  1.94808e-13  6.90027e-14 -1.51496e-11  3.20072e-12   -0.0229107 -1.83232e-05 -1.26355e-13 -2.23973e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0423787 -1.09743e-13  5.02999e-11  -4.0898e-13 -3.83863e-13   -0.0302057 -1.34999e-13  1.02115e-13 -1.94221e-13  5.88878e-05   0.00903048 -2.26927e-14  0.000176908    0.0128933  2.23361e-13     0.974684   1.2543e-11  5.80727e-12  1.91099e-13 -7.27459e-14  1.83232e-05   -0.0229107 -5.52348e-13 -2.35228e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.36902e-12 -2.71349e-13   -0.0492341  -0.00195913  2.18616e-13  2.30994e-12  -0.00041679 -0.000231868  3.39977e-05  3.02162e-14 -1.87616e-12  -0.00010977 -4.06685e-14  6.21849e-12  1.94808e-13   1.2543e-11      1.02179  -0.00208634  -0.00030786  -0.00030786  1.03614e-12 -8.34762e-12  -0.00474256  2.72336e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -1.2665e-12  2.72586e-13   0.00195913    0.0492341 -1.83881e-13  1.27701e-13 -0.000231868  -0.00041679 -3.39977e-05 -7.47355e-14  7.64921e-12   0.00010977  3.13622e-14  8.23135e-12  6.90027e-14  5.80727e-12  -0.00208634      1.02179   0.00030786   0.00030786  -1.1111e-12  2.72261e-12   0.00474256  2.72336e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.17877e-13  3.88027e-11 -0.000441167  0.000207491 -2.82835e-11  1.84165e-13    0.0132948    0.0339802  -0.00472234 -4.78303e-12 -6.57937e-15    0.0152472  1.11247e-11 -3.23317e-14 -1.51496e-11  1.91099e-13  -0.00030786   0.00030786      1.06455    0.0448465 -1.50634e-10  6.76283e-13  2.37212e-05 -0.000388666          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.19129e-13  3.89052e-11  0.000207491 -0.000441167 -2.58459e-11  1.49433e-13   -0.0339802   -0.0132948  -0.00472234 -1.05561e-11 -5.10891e-14    0.0152472  -3.3251e-12 -4.16485e-14  3.20072e-12 -7.27459e-14  -0.00030786   0.00030786    0.0448465      1.06455 -1.56187e-10  7.52639e-13  2.37212e-05  0.000388667          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-5.96919e-05    0.0746367  4.35686e-12  4.36076e-12     0.069959 -5.59509e-05 -6.27389e-10  6.46471e-10 -2.65826e-10   -0.0304415  0.000174162  1.18742e-10  -0.00918409  0.000118668    0.0362981   -2.903e-05 -8.40531e-13   7.8749e-13  1.15492e-10   1.1159e-10    -0.195037  1.03214e-12  3.56348e-12    1.766e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0746367  5.96919e-05   4.4661e-11  2.50032e-11  5.59509e-05     0.069959  3.30354e-12 -3.30093e-12   1.2868e-12  0.000174162    0.0304415 -5.76658e-13  0.000118668   0.00918409    2.903e-05    0.0362981 -1.66998e-12 -2.11755e-12 -5.76244e-13 -5.24692e-13  1.03214e-12    -0.195037  4.35656e-10  1.13119e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.96215e-11 -3.99502e-13    0.0141027    0.0141027  4.62134e-13 -1.12431e-11  0.000482672 -0.000482672  0.000154551    5.973e-14 -1.93494e-11  -6.4636e-05 -5.94683e-14 -6.23469e-12 -8.60539e-14 -4.44174e-11  -0.00610152   0.00610152 -0.000100044 -0.000100044  4.46497e-12  4.38796e-10     0.942245  7.30829e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.42893e-11 -2.19402e-11   0.00465361  -0.00465361  8.55936e-12  6.15594e-12   0.00407335   0.00407335  7.44797e-10  8.29525e-12 -4.78381e-12 -3.66276e-10   1.3517e-11 -9.15452e-12  1.82081e-11  1.26737e-11    0.0029656    0.0029656   -0.0035856    0.0035856  2.06487e-10  1.31927e-10  7.27393e-10     0.125444          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0906271 -7.60205e-14  2.37857e-11   9.4724e-12 -8.49476e-14    0.0326354  7.16248e-13  -7.2538e-13  3.51675e-13  9.69455e-05    0.0148667 -1.50076e-13 -0.000660243   -0.0481193 -1.25407e-13    0.0477892  8.42542e-13 -3.26149e-13 -1.65814e-13 -1.72943e-13  1.95746e-05   -0.0244754 -2.72445e-11 -1.91391e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-7.60269e-14    0.0906271  7.82293e-13  7.73177e-13    0.0326354 -8.50341e-14 -9.71187e-11  1.11432e-10 -5.98687e-11   -0.0148667  9.69455e-05  2.55572e-11    0.0481193 -0.000660243    0.0477892 -1.25315e-13 -2.06102e-13  2.13213e-13  2.93417e-11  2.98581e-11   -0.0244754 -1.95747e-05 -2.95081e-13 -2.96294e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.37857e-11  7.82293e-13    0.0997387  -0.00553357 -5.99134e-13  1.60503e-11 -0.000738859  0.000738859 -0.000425295 -4.71384e-13  1.04387e-11  0.000206653  3.69052e-14  4.99343e-12 -1.82878e-13  6.16308e-11   -0.0659095   0.00225876 -0.000698965  0.000174385 -9.44016e-13 -7.29171e-12    0.0408442  -0.00958201         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  9.4724e-12  7.73177e-13  -0.00553357    0.0997387 -6.09561e-13 -3.46364e-13 -0.000738859  0.000738859 -0.000425295 -5.30088e-13  4.62523e-13  0.000206653  4.28518e-15  2.50873e-12 -2.23575e-13 -1.10362e-12  -0.00225876    0.0659095  0.000174385 -0.000698965 -9.46217e-13  1.40966e-11    0.0408442   0.00958201         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-8.49509e-14    0.0326354 -5.99134e-13 -6.09561e-13     0.236919 -6.73663e-15   1.0796e-10 -9.15628e-11  7.17822e-11   -0.0143887  9.38287e-05 -3.85678e-11  -0.00947314  0.000129981   -0.0425853 -5.27034e-13  2.23469e-13 -1.80599e-13 -2.85484e-11 -2.55355e-11   0.00365057   2.9196e-06 -2.40234e-14  2.54615e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0326354 -8.50424e-14  1.60503e-11 -3.46364e-13  -6.7134e-15     0.236919 -5.39638e-13  5.29199e-13 -4.21349e-13  9.38287e-05    0.0143887  2.26524e-13  0.000129981   0.00947314 -5.27201e-13   -0.0425853  2.76229e-12  2.50545e-13  1.89329e-13  1.46464e-13  -2.9196e-06   0.00365057  -3.1936e-12  1.69214e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 7.16248e-13 -9.71187e-11 -0.000738859 -0.000738859   1.0796e-10 -5.39638e-13     0.213038    -0.107766    0.0652192  7.23404e-11  1.46667e-14   -0.0316904  1.09325e-13  2.81246e-14   8.9786e-11 -1.65623e-13 -0.000677603 -0.000195747    0.0344163   -0.0292344  1.37227e-10 -7.27022e-13  0.000278759   -0.0130649         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " -7.2538e-13  1.11432e-10  0.000738859  0.000738859 -9.15628e-11  5.29199e-13    -0.107766     0.213038   -0.0652192 -8.23165e-11  4.40421e-14    0.0316904 -2.59402e-12  4.48748e-15 -2.70515e-11  1.24935e-13 -0.000195747 -0.000677603    0.0292344   -0.0344163 -1.58422e-10  7.22592e-13 -0.000278759   -0.0130649         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.51675e-13 -5.98687e-11 -0.000425295 -0.000425295  7.17822e-11 -4.21349e-13    0.0652192   -0.0652192     0.424482  6.67835e-11 -4.31403e-14    0.0113321 -1.12921e-11  8.84528e-14  4.48464e-11 -2.63156e-13  4.33049e-06 -4.33049e-06 -0.000601514 -0.000601514  8.46655e-11 -4.15257e-13 -2.66009e-05 -3.03086e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 9.69455e-05   -0.0148667 -4.71383e-13 -5.30088e-13   -0.0143887  9.38287e-05  7.23404e-11 -8.23165e-11  6.67835e-11     0.448028  1.01258e-14 -5.53461e-12 -0.000495529  3.56747e-06   -0.0107668  7.02103e-05 -2.14743e-14 -5.73138e-14   1.9407e-12 -8.26634e-12    0.0177612 -0.000101616  2.18997e-14  3.15856e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0148667  9.69455e-05  1.04387e-11  4.62523e-13  9.38287e-05    0.0143887  1.46668e-14  4.40421e-14 -4.31403e-14  1.03089e-14     0.448028  3.76118e-15 -3.56747e-06 -0.000495529  7.02103e-05    0.0107668 -3.28157e-12  1.34886e-11 -1.81422e-14  -9.6916e-14 -0.000101616   -0.0177612 -1.47317e-11 -2.16583e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.50076e-13  2.55572e-11  0.000206653  0.000206653 -3.85678e-11  2.26524e-13   -0.0316904    0.0316904    0.0113321 -5.53461e-12  3.76106e-15     0.627711 -1.66117e-11  1.30782e-13  8.80282e-12 -5.18066e-14 -0.000157363  0.000157363     0.021858     0.021858 -1.37205e-11  6.11651e-14  1.61812e-05  9.83807e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-0.000660243    0.0481193  3.69052e-14  4.28518e-15  -0.00947314  0.000129981  1.09325e-13 -2.59402e-12 -1.12921e-11 -0.000495529 -3.56747e-06 -1.66117e-11     0.913264  1.01879e-13   -0.0216044  0.000296434 -1.07492e-13  8.87137e-14  2.62699e-11  -2.8815e-12    0.0227516 -0.000293975  1.25694e-13  3.60429e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0481193 -0.000660243  4.99343e-12  2.50873e-12  0.000129981   0.00947314  2.81246e-14  4.48749e-15  8.84528e-14  3.56747e-06 -0.000495529  1.30782e-13  1.01801e-13     0.913264  0.000296434    0.0216044  1.28127e-11  1.63388e-11 -9.35789e-14 -1.12376e-13 -0.000293975   -0.0227516  4.45625e-12  -2.4369e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.25387e-13    0.0477892 -1.82878e-13 -2.23575e-13   -0.0425853 -5.27157e-13   8.9786e-11 -2.70515e-11  4.48464e-11   -0.0107668  7.02103e-05  8.80282e-12   -0.0216044  0.000296434     0.954146  4.24606e-13  3.30799e-13  1.45228e-13  -2.5669e-11  7.44378e-12   0.00328347  2.62601e-06 -3.07583e-13  1.68093e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0477892 -1.25293e-13  6.16308e-11 -1.10362e-12 -5.27019e-13   -0.0425853 -1.65623e-13  1.24935e-13 -2.63156e-13  7.02103e-05    0.0107668 -5.18066e-14  0.000296434    0.0216044  4.24642e-13     0.954146  2.11498e-11   1.1963e-11  3.24363e-13 -1.51733e-13 -2.62601e-06   0.00328347 -5.04447e-11  1.03563e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 8.42542e-13 -2.06102e-13   -0.0659095  -0.00225876  2.23469e-13  2.76229e-12 -0.000677603 -0.000195747  4.33049e-06 -2.14743e-14 -3.28157e-12 -0.000157363 -1.07492e-13  1.28127e-11  3.30799e-13  2.11498e-11      1.04646  -0.00440398 -0.000571581 -0.000571581  2.67087e-13 -1.69253e-11   -0.0159304   0.00403752         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.26149e-13  2.13213e-13   0.00225876    0.0659095 -1.80599e-13  2.50545e-13 -0.000195747 -0.000677603 -4.33049e-06 -5.73138e-14  1.34886e-11  0.000157363  8.87137e-14  1.63388e-11  1.45228e-13   1.1963e-11  -0.00440398      1.04646  0.000571581  0.000571581 -4.55665e-13  2.99701e-12    0.0159304   0.00403752         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.65814e-13  2.93417e-11 -0.000698965  0.000174385 -2.85484e-11  1.89329e-13    0.0344163    0.0292344 -0.000601514   1.9407e-12 -1.81421e-14     0.021858  2.62699e-11 -9.35789e-14  -2.5669e-11  3.24363e-13 -0.000571581  0.000571581      1.12585    0.0837935 -5.05617e-11  1.15326e-13 -8.71016e-05  -0.00550457         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.72943e-13  2.98581e-11  0.000174385 -0.000698965 -2.55355e-11  1.46464e-13   -0.0292344   -0.0344163 -0.000601514 -8.26634e-12  -9.6916e-14     0.021858  -2.8815e-12 -1.12376e-13  7.44378e-12 -1.51733e-13 -0.000571581  0.000571581    0.0837935      1.12585 -6.45032e-11  3.04366e-13 -8.71016e-05   0.00550457         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.48491e-05   -0.0560778 -3.91507e-12 -3.91893e-12   0.00265972 -2.12716e-06  5.82935e-10  -6.1104e-10   9.0103e-11    0.0109728 -6.27775e-05 -1.84691e-11    0.0178419 -0.000230537      0.01806 -1.44438e-05 -3.32288e-13  4.47293e-14   3.1115e-11  9.89848e-12     0.585022  1.16823e-12  2.70417e-12  3.53656e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0560778 -4.48491e-05 -1.91178e-11  9.09277e-12  2.12716e-06   0.00265972 -3.06498e-12  3.05993e-12 -4.70476e-13 -6.27775e-05   -0.0109728  1.01223e-13 -0.000230537   -0.0178419  1.44438e-05      0.01806  -1.8766e-11 -2.33619e-12 -2.96189e-13 -9.38787e-15   1.1682e-12     0.585022  4.37625e-10  2.30012e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.04356e-11 -2.49382e-13    0.0412949    0.0412949 -3.31784e-14 -1.34027e-11  0.000281113 -0.000281113  3.72618e-05  9.29947e-14 -1.74213e-12 -2.12709e-05  9.26999e-14  4.62901e-12 -1.92867e-13 -4.93376e-11   -0.0168387    0.0168387 -0.000143397 -0.000143397  3.73822e-12  4.32193e-10      1.94799  1.05767e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.60564e-11 -4.04687e-11   -0.0109028    0.0109028  2.98443e-11  2.00678e-11   -0.0149285   -0.0149285  -5.5483e-10  4.12225e-11 -2.76352e-11  2.00484e-10  3.94143e-11 -2.63722e-11  1.00374e-11   7.0534e-12   0.00485495   0.00485495  -0.00630399   0.00630399  3.81201e-10  2.46568e-10  1.05472e-09     0.821047         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
