{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-11-29T12:44:22.306649Z",
     "iopub.status.busy": "2022-11-29T12:44:22.306400Z",
     "iopub.status.idle": "2022-11-29T12:44:45.615748Z",
     "shell.execute_reply": "2022-11-29T12:44:45.614603Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2023-dev gitid: 9140004 (compiled Nov 29 2022, 12:35:22)\r\n",
      "votca_csg, version 2023-dev gitid: 9140004 (compiled Nov 29 2022, 12:18:31)\r\n",
      "votca_tools, version 2023-dev gitid: 9140004 (compiled Nov 29 2022, 12:16:16)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 BohrA\r\n",
      "    0.307132  3.06866e-11  1.79703e-10 -5.19945e-10 -2.32716e-11   -0.0516061  1.11702e-09  1.03727e-09  3.87731e-10   -0.0181646  -0.00104336  1.10497e-10    0.0103977   -0.0375629  2.00731e-11    0.0421019 -2.08557e-10  9.11315e-11  3.57816e-10  1.58995e-10  0.000478853    -0.108408 -1.82932e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.06866e-11     0.307132 -3.89355e-10  3.09601e-10   -0.0516061 -2.32716e-11  2.45175e-09  2.79199e-09  8.22059e-10   0.00104336   -0.0181646  3.85157e-10   -0.0375629   -0.0103977    0.0421019  2.00731e-11 -1.92085e-10 -6.73608e-12   5.0161e-10  6.19036e-10     0.108408  0.000478853  1.68289e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.79703e-10 -3.89355e-10     0.320607   0.00928726  1.38911e-11 -3.03623e-11   -0.0131956   -0.0131956   -0.0049207  -1.4611e-10  1.02626e-10  -0.00209637  1.20171e-11  2.07483e-10 -1.19194e-10 -7.54038e-12   -0.0470532   0.00129344  -0.00255983   -0.0152265 -9.89872e-10  3.14857e-10   -0.0254862          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-5.19945e-10  3.09601e-10   0.00928726     0.320607 -2.22501e-11  4.35088e-10    0.0131956    0.0131956    0.0049207  1.66388e-10 -1.48533e-10   0.00209637  8.01775e-12 -1.82584e-10  1.27593e-11 -4.05393e-10   0.00129344   -0.0470532    0.0152265   0.00255983  9.65925e-10  2.05302e-10    0.0254862          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.32716e-11   -0.0516061  1.38911e-11 -2.22501e-11     0.490902    2.846e-12  1.49002e-09   1.0853e-09  6.28858e-10 -0.000772035     0.013441  1.85912e-10  -0.00770415  -0.00213257    0.0309987 -6.62825e-11 -4.61837e-11    3.033e-10  2.07908e-10  6.14902e-11   -0.0531267 -0.000234669  2.09554e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0516061 -2.32716e-11 -3.03623e-11  4.35088e-10  2.84603e-12     0.490902 -9.28005e-11  -1.0116e-10 -6.24903e-11     0.013441  0.000772035  5.25821e-12   0.00213257  -0.00770415 -6.62826e-11    0.0309987  1.53627e-10 -7.20893e-12 -8.26804e-11  1.74436e-10 -0.000234669    0.0531267 -4.45493e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.11702e-09  2.45175e-09   -0.0131956    0.0131956  1.49002e-09 -9.28005e-11     0.549582     0.219688    0.0856683  -1.4342e-11 -7.24888e-10    0.0364974 -8.31995e-10 -2.62351e-09 -6.31723e-10  2.54379e-10   -0.0113535  -0.00131313   -0.0126981    0.0330616  1.34028e-08 -8.27117e-09   0.00154686          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.03727e-09  2.79199e-09   -0.0131956    0.0131956   1.0853e-09  -1.0116e-10     0.219688     0.549582    0.0856683 -6.02487e-11 -7.45166e-10    0.0364974 -8.56894e-10 -2.60347e-09 -2.18789e-10  1.47944e-10   0.00131313    0.0113535    0.0330616   -0.0126981  1.39165e-08 -8.24368e-09   0.00154686          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.87731e-10  8.22059e-10   -0.0049207    0.0049207  6.28858e-10 -6.24903e-11    0.0856683    0.0856683     0.662947 -1.80016e-10 -5.81851e-10  -0.00632525 -2.92666e-10 -7.01978e-10  -3.3678e-10  9.71291e-11  -0.00131671   0.00131671   0.00387671   0.00387671  4.33951e-09 -3.05391e-09   0.00112736          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0181646   0.00104336  -1.4611e-10  1.66388e-10 -0.000772035     0.013441  -1.4342e-11 -6.02487e-11 -1.80016e-10     0.680922 -1.59974e-12  8.83652e-11 -2.70751e-05  7.97153e-05   0.00049528  -0.00862271  3.86482e-10  2.23734e-13  8.09522e-11  8.90761e-10   0.00217175      0.04097 -6.68859e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -0.00104336   -0.0181646  1.02626e-10 -1.48533e-10     0.013441  0.000772035 -7.24888e-10 -7.45166e-10 -5.81851e-10 -1.59963e-12     0.680922  6.20495e-11  7.97153e-05   2.7075e-05  -0.00862271  -0.00049528 -4.18881e-12  8.13998e-10  3.77306e-10 -9.40031e-12     -0.04097   0.00217175  8.09476e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.10497e-10  3.85157e-10  -0.00209637   0.00209637  1.85912e-10  5.25821e-12    0.0364974    0.0364974  -0.00632525  8.83652e-11  6.20495e-11      0.79826  1.22254e-11 -3.26474e-10  1.10191e-10  5.77095e-11  -0.00465512   0.00465512    0.0137058    0.0137058  1.73219e-09 -9.75889e-10  0.000446895          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0103977   -0.0375629  1.20171e-11  8.01775e-12  -0.00770415   0.00213257 -8.31995e-10 -8.56894e-10 -2.92666e-10 -2.70751e-05  7.97153e-05  1.22254e-11     0.956418 -4.29162e-11    0.0126659  -0.00350602  1.23832e-10 -2.37465e-10 -6.53169e-10 -4.30799e-10    0.0192733   0.00542676  6.77847e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0375629   -0.0103977  2.07483e-10 -1.82584e-10  -0.00213257  -0.00770415 -2.62351e-09 -2.60347e-09 -7.01978e-10  7.97153e-05   2.7075e-05 -3.26474e-10 -4.29162e-11     0.956418   0.00350602    0.0126659  4.24769e-10 -6.47139e-10 -1.49159e-09 -1.60522e-09   0.00542676   -0.0192733 -8.93487e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.00731e-11    0.0421019 -1.19194e-10  1.27593e-11    0.0309987 -6.62826e-11 -6.31723e-10 -2.18789e-10  -3.3678e-10   0.00049528  -0.00862271  1.10191e-10    0.0126659   0.00350602     0.988566 -3.74786e-11 -2.92347e-11  1.10941e-10 -3.59264e-11  6.16623e-11    0.0223628    9.878e-05  3.29959e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0421019  2.00731e-11 -7.54038e-12 -4.05393e-10 -6.62826e-11    0.0309987  2.54379e-10  1.47944e-10  9.71291e-11  -0.00862271  -0.00049528  5.77095e-11  -0.00350602    0.0126659 -3.74785e-11     0.988566 -7.14491e-12 -9.04437e-11  6.75808e-11  1.49287e-10    9.878e-05   -0.0223628 -1.73193e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.08557e-10 -1.92085e-10   -0.0470532   0.00129344 -4.61837e-11  1.53627e-10   -0.0113535   0.00131313  -0.00131671  3.86482e-10 -4.18881e-12  -0.00465512  1.23832e-10  4.24769e-10 -2.92347e-11 -7.14491e-12      1.03321  -0.00656668   -0.0132452   -0.0132452 -8.26082e-10  5.53815e-10   0.00427494          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 9.11315e-11 -6.73608e-12   0.00129344   -0.0470532    3.033e-10 -7.20893e-12  -0.00131313    0.0113535   0.00131671  2.23734e-13  8.13998e-10   0.00465512 -2.37465e-10 -6.47139e-10  1.10941e-10 -9.04437e-11  -0.00656668      1.03321    0.0132452    0.0132452  7.79351e-10 -4.51937e-10  -0.00427494          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.57816e-10   5.0161e-10  -0.00255983    0.0152265  2.07908e-10 -8.26804e-11   -0.0126981    0.0330616   0.00387671  8.09522e-11  3.77306e-10    0.0137058 -6.53169e-10 -1.49159e-09 -3.59264e-11  6.75808e-11   -0.0132452    0.0132452       1.0677    0.0410649  2.36669e-09 -1.58725e-09   0.00204416          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.58995e-10  6.19036e-10   -0.0152265   0.00255983  6.14902e-11  1.74436e-10    0.0330616   -0.0126981   0.00387671  8.90761e-10 -9.40031e-12    0.0137058 -4.30799e-10 -1.60522e-09  6.16623e-11  1.49287e-10   -0.0132452    0.0132452    0.0410649       1.0677  2.46767e-09 -1.53997e-09   0.00204416          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-0.000332375   -0.0752465   6.8822e-10 -7.33143e-10    0.0690159  0.000304854 -8.05743e-09 -8.33503e-09  -3.1631e-09  -0.00163857    0.0309115 -1.54297e-09  -0.00866637  -0.00244018   -0.0364086 -0.000160822  5.58878e-10 -5.58313e-10 -1.77511e-09 -1.77862e-09    -0.194424  2.22067e-10 -4.21935e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0752465 -0.000332375  5.15783e-13 -2.84838e-10  0.000304854   -0.0690159  5.49144e-09  5.53401e-09  2.38437e-09   -0.0309115  -0.00163857  8.87254e-10  -0.00244018   0.00866637 -0.000160822    0.0364086 -4.81853e-10  4.77609e-10  1.28096e-09  1.27951e-09  2.22068e-10    -0.194424 -5.54303e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.99079e-10  -5.2989e-10   -0.0141885    0.0141885  3.68868e-10 -5.51685e-10  -0.00433337  -0.00433337   -0.0013151 -1.02979e-09   1.0896e-09 -0.000527291  -8.3582e-11  8.18271e-11 -4.06887e-11  2.51661e-10   0.00597557  -0.00597557   0.00150675   0.00150675 -4.43014e-09 -5.45669e-09     0.958313          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "    0.093811   1.3639e-11  9.60993e-11   -3.208e-10 -1.43118e-11   -0.0328898  4.68412e-10  4.11446e-10  2.38589e-10   -0.0155316 -0.000892119  6.35687e-11    0.0128929   -0.0465771  2.33217e-11    0.0481429 -2.59311e-10  1.01658e-10  3.59547e-10   8.4028e-11  0.000110905   -0.0251078  4.90416e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  1.3639e-11     0.093811 -2.01373e-10  1.44407e-10   -0.0328898 -1.43118e-11  9.67669e-10  1.19237e-09  5.07288e-10  0.000892119   -0.0155316  2.54835e-10   -0.0465771   -0.0128929    0.0481429  2.33216e-11 -1.64879e-10  -1.1064e-10   4.2983e-10  5.87482e-10    0.0251078  0.000110905 -5.38645e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 9.60993e-11 -2.01373e-10     0.105872   0.00531021  1.85843e-11 -2.58701e-11  -0.00668488  -0.00668488   -0.0036185 -1.36136e-10  8.76229e-11  -0.00164372  2.41167e-11  2.30289e-10 -1.50934e-10 -1.30921e-11   -0.0640526   0.00170977  -0.00245816   -0.0197151 -8.00512e-11  1.94573e-10   -0.0418865         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -3.208e-10  1.44407e-10   0.00531021     0.105872 -2.21424e-11  3.15385e-10   0.00668488   0.00668488    0.0036185  1.60333e-10 -1.30196e-10   0.00164372  2.73461e-12 -1.93423e-10  9.14346e-12 -5.05871e-10   0.00170977   -0.0640526    0.0197151   0.00245816  5.46364e-12  4.78507e-11    0.0418865         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.43118e-11   -0.0328898  1.85843e-11 -2.21424e-11     0.240891  6.71266e-13  9.44035e-10   6.5452e-10  5.49402e-10 -0.000829662    0.0144442   1.6093e-10  -0.00881205  -0.00243924    0.0441772 -9.21385e-11 -4.10672e-11   4.2511e-10   2.1501e-10  1.14803e-11   0.00438142  1.93534e-05  5.21205e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0328898 -1.43118e-11 -2.58701e-11  3.15385e-10    6.713e-13     0.240891 -4.36673e-11 -4.72255e-11  -4.4637e-11    0.0144442  0.000829662  1.06155e-11   0.00243924  -0.00881205 -9.21386e-11    0.0441772  2.22869e-10 -1.93388e-11 -1.02536e-10  2.81507e-10  1.93534e-05  -0.00438142 -4.88373e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.68412e-10  9.67669e-10  -0.00668488   0.00668488  9.44035e-10 -4.36673e-11      0.22187     0.110688    0.0629972 -1.79259e-11 -5.48428e-10    0.0286169 -9.98537e-10 -2.90201e-09 -7.94504e-10   2.5855e-10   -0.0100844  -0.00717252   -0.0330822    0.0292606  1.48719e-09 -5.30542e-10  -0.00290359         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.11446e-10  1.19237e-09  -0.00668488   0.00668488   6.5452e-10 -4.72255e-11     0.110688      0.22187    0.0629972 -6.04991e-11 -5.72625e-10    0.0286169  -1.0354e-09 -2.87516e-09  -2.7554e-10  1.16759e-10   0.00717252    0.0100844    0.0292606   -0.0330822  1.72925e-09 -4.54782e-10  -0.00290359         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.38589e-10  5.07288e-10   -0.0036185    0.0036185  5.49402e-10  -4.4637e-11    0.0629972    0.0629972     0.429278 -2.30988e-10 -6.84385e-10   -0.0121538 -4.21253e-10 -8.97891e-10 -4.70457e-10  1.29861e-10  6.20762e-06 -6.20764e-06 -1.82767e-05 -1.82767e-05  1.01342e-09 -6.37925e-10  5.49073e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0155316  0.000892119 -1.36136e-10  1.60333e-10 -0.000829662    0.0144442 -1.79259e-11 -6.04991e-11 -2.30988e-10     0.463967 -2.13633e-12  1.17867e-10 -0.000208011  0.000612432  0.000594976   -0.0103584  6.63012e-10   -5.072e-12  1.34044e-10  1.50701e-09  0.000938778      0.01771 -1.63367e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-0.000892119   -0.0155316  8.76229e-11 -1.30196e-10    0.0144442  0.000829662 -5.48428e-10 -5.72625e-10 -6.84385e-10 -2.13618e-12     0.463967  1.23374e-10  0.000612432  0.000208011   -0.0103584 -0.000594976 -2.66485e-11  1.39962e-09  6.96911e-10  3.89708e-11     -0.01771  0.000938778  1.78282e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.35687e-11  2.54835e-10  -0.00164372   0.00164372   1.6093e-10  1.06155e-11    0.0286169    0.0286169   -0.0121538  1.17867e-10  1.23374e-10     0.636067  4.96706e-11 -4.09082e-10  1.95661e-10  8.28255e-11  -0.00673071   0.00673071    0.0198168    0.0198168   9.9254e-11 -2.32174e-12  4.36011e-05         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0128929   -0.0465771  2.41167e-11  2.73461e-12  -0.00881205   0.00243924 -9.98537e-10  -1.0354e-09 -4.21253e-10 -0.000208011  0.000612432  4.96706e-11     0.917068 -7.52411e-11    0.0214835  -0.00594681  2.20547e-10 -4.53256e-10 -1.22583e-09 -7.73674e-10     0.022376    0.0063004 -1.02136e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0465771   -0.0128929  2.30289e-10 -1.93423e-10  -0.00243924  -0.00881205 -2.90201e-09 -2.87516e-09 -8.97891e-10  0.000612432  0.000208011 -4.09082e-10 -7.52411e-11     0.917068   0.00594681    0.0214835  7.42015e-10 -1.19417e-09 -2.67333e-09 -2.90604e-09    0.0063004    -0.022376 -6.28369e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.33216e-11    0.0481429 -1.50934e-10  9.14346e-12    0.0441772 -9.21386e-11 -7.94504e-10  -2.7554e-10 -4.70457e-10  0.000594976   -0.0103584  1.95661e-10    0.0214835   0.00594681     0.981535 -7.22438e-11  -5.4285e-11  1.86588e-10 -5.46269e-11  1.35501e-10  -0.00424838 -1.87658e-05  2.61191e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481429  2.33216e-11 -1.30921e-11 -5.05871e-10 -9.21385e-11    0.0441772   2.5855e-10  1.16759e-10  1.29861e-10   -0.0103584 -0.000594976  8.28255e-11  -0.00594681    0.0214835 -7.22437e-11     0.981535 -2.95306e-11 -1.60598e-10  1.09529e-10  2.41832e-10 -1.87657e-05   0.00424838  1.75277e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.59311e-10 -1.64879e-10   -0.0640526   0.00170977 -4.10672e-11  2.22869e-10   -0.0100844   0.00717252  6.20762e-06  6.63012e-10 -2.66485e-11  -0.00673071  2.20547e-10  7.42015e-10  -5.4285e-11 -2.95306e-11      1.06908   -0.0128107   -0.0247505   -0.0247505  -3.9489e-10  2.10994e-10    0.0150505         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.01658e-10  -1.1064e-10   0.00170977   -0.0640526   4.2511e-10 -1.93388e-11  -0.00717252    0.0100844 -6.20764e-06   -5.072e-12  1.39962e-09   0.00673071 -4.53256e-10 -1.19417e-09  1.86588e-10 -1.60598e-10   -0.0128107      1.06908    0.0247505    0.0247505    2.194e-10  9.02537e-13   -0.0150505         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.59547e-10   4.2983e-10  -0.00245816    0.0197151   2.1501e-10 -1.02536e-10   -0.0330822    0.0292606 -1.82767e-05  1.34044e-10  6.96911e-10    0.0198168 -1.22583e-09 -2.67333e-09 -5.46269e-11  1.09529e-10   -0.0247505    0.0247505      1.13354    0.0772756  8.79303e-10 -5.99958e-10   0.00545292         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  8.4028e-11  5.87482e-10   -0.0197151   0.00245816  1.14803e-11  2.81507e-10    0.0292606   -0.0330822 -1.82767e-05  1.50701e-09  3.89708e-11    0.0198168 -7.73674e-10 -2.90604e-09  1.35501e-10  2.41832e-10   -0.0247505    0.0247505    0.0772756      1.13354  1.09043e-09 -4.24643e-10   0.00545292         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 0.000253353    0.0573567 -4.73817e-10  4.21863e-10   0.00347861  1.53655e-05  7.51683e-09  7.82048e-09  1.20407e-09  0.000540219   -0.0101912  2.34286e-10    0.0179434    0.0050523   -0.0191591 -8.46288e-05   -9.068e-11    7.122e-11 -1.66089e-10  5.10857e-12     0.600541  2.22583e-10 -3.19345e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0573567  0.000253353  3.45633e-10 -4.28214e-11  1.53656e-05  -0.00347861 -4.34655e-09 -4.29318e-09 -7.17458e-10    0.0101912  0.000540219 -1.52103e-10    0.0050523   -0.0179434 -8.46288e-05    0.0191591 -1.00923e-10  2.71824e-10  3.21365e-11  5.07847e-11  2.22583e-10     0.600541 -5.04306e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.98127e-10 -3.37032e-10   -0.0423674    0.0423674  5.91201e-10 -4.72917e-10  -0.00287241  -0.00287241 -0.000440531 -1.50211e-09  1.61585e-09 -0.000215479 -5.05521e-11 -4.22872e-11   3.6439e-10  1.53297e-10    0.0160906   -0.0160906   0.00534089   0.00534089 -3.65058e-09 -5.04705e-09      1.98483         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
