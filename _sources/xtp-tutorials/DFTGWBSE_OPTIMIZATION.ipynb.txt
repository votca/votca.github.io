{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2021-08-14T13:23:51.684140Z",
     "iopub.status.busy": "2021-08-14T13:23:51.682886Z",
     "iopub.status.idle": "2021-08-14T13:24:01.036204Z",
     "shell.execute_reply": "2021-08-14T13:24:01.036672Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2022-dev gitid: 4eb18a9 (compiled Aug 14 2021, 13:14:45)\r\n",
      "votca_csg, version 2022-dev gitid: 4eb18a9 (compiled Aug 14 2021, 12:58:54)\r\n",
      "votca_tools, version 2022-dev gitid: 4eb18a9 (compiled Aug 14 2021, 12:56:04)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 BohrA\r\n",
      "    0.306708  1.72563e-14 -1.22458e-10  3.90429e-10  1.00812e-14    0.0516336 -5.57899e-14 -5.52018e-14  1.43222e-14  4.40878e-07    0.0181563  -8.3482e-15  -1.5473e-05    0.0389795 -8.47565e-15   -0.0421241  1.94745e-11 -2.61567e-11  1.95549e-14  1.67675e-14  7.24359e-07    -0.108303  -1.6043e-10 -1.06102e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.72909e-14     0.306708  5.27273e-14 -5.20698e-14    0.0516336  1.01902e-14 -1.74359e-09 -2.01156e-09  5.34414e-10    0.0181563 -4.40878e-07 -3.16684e-10    0.0389795   1.5473e-05   -0.0421241  -8.4621e-15 -1.42204e-13  1.39406e-13  3.29469e-10  3.36152e-10    -0.108303 -7.24359e-07 -5.29006e-16  1.16759e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.22458e-10  5.27273e-14     0.319156    0.0100481 -3.15033e-14  4.19802e-11 -5.59877e-06 -5.59877e-06  2.09238e-06  1.92516e-14 -4.28644e-11 -8.95424e-07 -2.42816e-14  2.56197e-11  1.10716e-14 -1.63905e-11    0.0495092  -0.00204416  1.70937e-06  2.05508e-05 -1.78079e-13  1.58327e-11    0.0252874   -0.0170511          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.90429e-10 -5.20698e-14    0.0100481     0.319156  3.23064e-14    3.679e-10  5.59877e-06  5.59877e-06 -2.09238e-06  -1.7367e-14  1.10116e-10  8.95424e-07  2.71405e-14 -3.30931e-11 -1.15762e-14 -3.13124e-10  -0.00204416    0.0495092 -2.05508e-05 -1.70937e-06  1.80418e-13 -5.25146e-10   -0.0252874   -0.0170511          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.00776e-14    0.0516336 -3.15032e-14  3.23064e-14     0.490609  3.93999e-15  1.69885e-09  1.28897e-09 -7.55661e-10    0.0134761  -3.2723e-07  2.05863e-10   -0.0080157 -3.18185e-06    0.0309388 -3.10706e-14  7.70242e-14 -7.85652e-14 -1.87759e-10 -1.83891e-10    -0.053272 -3.56298e-07  1.18847e-15  1.14997e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0516336   1.0184e-14  4.19802e-11    3.679e-10  3.91752e-15     0.490609  3.34585e-14  3.42084e-14 -1.91546e-14   3.2723e-07    0.0134761   5.2463e-15  3.18185e-06   -0.0080157 -3.11877e-14    0.0309388  1.41584e-11 -1.80255e-11  2.85463e-15  1.32101e-15  3.56297e-07    -0.053272 -9.98371e-11 -3.18725e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-5.57899e-14 -1.74359e-09 -5.59877e-06  5.59877e-06  1.69885e-09  3.34584e-14     0.549726     0.220522   -0.0861688 -7.16778e-10 -4.31996e-15    0.0368756  5.42594e-10  2.30899e-13 -7.89529e-10 -1.22142e-14  1.47655e-05   4.0759e-06    0.0125301    -0.034935  6.78356e-09  2.32744e-13  6.24937e-07    0.0141858          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-5.52018e-14 -2.01156e-09 -5.59877e-06  5.59877e-06  1.28897e-09  3.42082e-14     0.220522     0.549726   -0.0861688 -7.84029e-10 -2.38651e-15    0.0368756  5.50067e-10  2.33826e-13 -4.60015e-10 -1.27958e-14  -4.0759e-06 -1.47655e-05    -0.034935    0.0125301  7.28251e-09  2.35149e-13  6.24937e-07   -0.0141858          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.43221e-14  5.34414e-10  2.09238e-06 -2.09238e-06 -7.55661e-10 -1.91546e-14   -0.0861688   -0.0861688     0.662739  4.24852e-10  9.50079e-16   0.00625217 -6.14594e-11  -2.6042e-14  4.50126e-10  1.15902e-14 -1.74441e-06  1.74441e-06   0.00414117   0.00414117 -1.82084e-09 -5.88164e-14 -1.12381e-08 -6.01184e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.40878e-07    0.0181563  1.92517e-14 -1.73671e-14    0.0134761   3.2723e-07 -7.16778e-10 -7.84029e-10  4.24852e-10     0.680027  -2.2152e-16 -3.11524e-11   7.6988e-05    3.243e-08  -0.00866729 -2.10462e-07 -3.73737e-14   3.9834e-14  9.37657e-11  8.87454e-11   -0.0410255 -1.27058e-06 -1.04408e-15  7.22928e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0181563 -4.40878e-07 -4.28644e-11  1.10116e-10  -3.2723e-07    0.0134761 -4.31994e-15 -2.38667e-15  9.50087e-16 -1.62535e-16     0.680027 -2.76321e-17   -3.243e-08   7.6988e-05  2.10462e-07  -0.00866729 -1.45177e-11  1.95381e-11 -8.02245e-15 -5.56223e-15  1.27058e-06   -0.0410255 -1.18008e-10 -7.54084e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -8.3482e-15 -3.16684e-10 -8.95424e-07  8.95424e-07  2.05863e-10  5.24617e-15    0.0368756    0.0368756   0.00625217 -3.11524e-11 -2.75116e-17     0.797893  2.21528e-10  9.36398e-14  6.39471e-11  1.61993e-15   6.1228e-06  -6.1228e-06   -0.0145354   -0.0145354  9.57149e-10  3.07679e-14  1.22751e-08  2.49068e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -1.5473e-05    0.0389795 -2.42816e-14  2.71405e-14   -0.0080157  3.18185e-06  5.42594e-10  5.50067e-10 -6.14594e-11   7.6988e-05   -3.243e-08  2.21528e-10     0.956279 -6.28945e-14    0.0131238 -5.20954e-06  1.26418e-13 -1.26104e-13 -2.31213e-10 -3.46022e-10    0.0200194 -7.81284e-06 -2.20319e-14 -6.65701e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0389795   1.5473e-05  2.56197e-11 -3.30931e-11 -3.18185e-06   -0.0080157  2.30899e-13  2.33826e-13  -2.6042e-14    3.243e-08   7.6988e-05  9.36398e-14 -6.28453e-14     0.956279  5.20954e-06    0.0131238  4.62595e-11  6.85493e-11 -1.26781e-13  -1.2646e-13  7.81284e-06    0.0200194  4.89094e-11  5.70712e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-8.45802e-15   -0.0421241  1.10716e-14 -1.15762e-14    0.0309388 -3.11544e-14 -7.89529e-10 -4.60015e-10  4.50126e-10  -0.00866729  2.10462e-07  6.39471e-11    0.0131238  5.20954e-06     0.987501 -1.39352e-14   1.7043e-14  5.41983e-14   1.3445e-10 -4.39277e-11    0.0224113  1.49893e-07  9.51262e-16  5.66763e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0421241 -8.45576e-15 -1.63905e-11 -3.13124e-10 -3.10477e-14    0.0309388 -1.22142e-14 -1.27959e-14  1.15902e-14 -2.10462e-07  -0.00866729  1.61993e-15 -5.20954e-06    0.0131238 -1.39593e-14     0.987501  6.74219e-11  1.10956e-10 -4.34964e-14  2.77661e-14 -1.49893e-07    0.0224113 -1.30106e-10 -5.58935e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.94745e-11 -1.42204e-13    0.0495092  -0.00204416  7.70242e-14  1.41584e-11  1.47655e-05  -4.0759e-06 -1.74441e-06 -3.73737e-14 -1.45177e-11   6.1228e-06  1.26418e-13  4.62595e-11   1.7043e-14  6.74219e-11      1.02819   -0.0020693 -1.82978e-05 -1.82978e-05  5.26399e-13   1.8015e-12   0.00469072 -8.27292e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.61567e-11  1.39406e-13  -0.00204416    0.0495092 -7.85652e-14 -1.80255e-11   4.0759e-06 -1.47655e-05  1.74441e-06  3.98339e-14  1.95381e-11  -6.1228e-06 -1.26104e-13  6.85493e-11  5.41983e-14  1.10956e-10   -0.0020693      1.02819  1.82978e-05  1.82978e-05 -4.90732e-13    8.997e-11  -0.00469072 -8.27293e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.95549e-14  3.29469e-10  1.70937e-06 -2.05508e-05 -1.87759e-10  2.85463e-15    0.0125301    -0.034935   0.00414117  9.37657e-11 -8.02246e-15   -0.0145354 -2.31213e-10 -1.26781e-13   1.3445e-10 -4.34964e-14 -1.82978e-05  1.82978e-05      1.07163    0.0455077 -1.15777e-09 -7.57007e-14  2.42377e-06  0.000367888          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.67675e-14  3.36152e-10  2.05508e-05 -1.70937e-06 -1.83891e-10  1.32101e-15    -0.034935    0.0125301   0.00414117  8.87454e-11 -5.56228e-15   -0.0145354 -3.46022e-10  -1.2646e-13 -4.39277e-11  2.77661e-14 -1.82978e-05  1.82978e-05    0.0455077      1.07163  -1.2482e-09 -3.93911e-14  2.42377e-06 -0.000367893          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-5.03241e-07    0.0752424  9.97418e-14 -1.01378e-13    0.0690969 -4.62138e-07 -3.52651e-09 -3.85259e-09  1.17253e-09    0.0309264 -9.57809e-07  -8.3084e-10  -0.00901647  -3.5188e-06   -0.0363998  2.43452e-07  -3.0037e-13  2.99736e-13   7.1284e-10  7.14105e-10    -0.194835 -9.18068e-14    2.248e-13 -8.74868e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0752424  5.03241e-07 -1.03398e-10  4.38777e-10  4.62138e-07    0.0690969 -1.27101e-13 -1.28558e-13  3.91789e-14  9.57809e-07    0.0309264 -2.72087e-14   3.5188e-06  -0.00901647 -2.43452e-07   -0.0363998 -7.75999e-12  4.82562e-12  2.05159e-14  1.91931e-14 -9.17414e-14    -0.194835 -2.30344e-09  7.70305e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  1.5882e-10 -3.16776e-14    0.0143253   -0.0143253  1.37782e-14  1.71047e-10  3.37036e-06  3.37036e-06 -1.11783e-06 -1.00736e-14 -4.79012e-11  4.73914e-07   2.1332e-15  8.18517e-12 -3.38528e-15 -2.22421e-10   0.00613234  -0.00613234  2.52896e-06  2.52896e-06  3.44663e-13 -2.19097e-09     0.954926  1.00755e-08          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-6.44255e-11   6.8493e-11   0.00486277   0.00486277  -2.8611e-10  2.92144e-10  -0.00279075   0.00279074  3.37926e-09 -2.27755e-12  9.36151e-12 -1.76652e-09 -9.81373e-11  9.81925e-11  2.73167e-11 -1.97432e-11   -0.0036088   -0.0036088   0.00308612  -0.00308612 -1.04746e-09  9.27112e-10   1.0247e-08     0.135958          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0935659   7.9186e-15 -6.09653e-11  2.33641e-10  6.30945e-15    0.0328713 -2.42123e-14 -2.38398e-14  8.86335e-15  3.76503e-07    0.0155052 -5.77512e-15 -1.91783e-05    0.0483139 -9.98768e-15   -0.0481173  1.98719e-11 -2.29721e-11  1.68179e-14  1.54453e-14  1.67518e-07   -0.0250466  5.23665e-11 -1.21375e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 7.94214e-15    0.0935659  2.30382e-14 -2.26319e-14    0.0328713  6.38059e-15 -6.93484e-10  -8.6616e-10  3.29987e-10    0.0155052 -3.76503e-07 -2.18244e-10    0.0483139  1.91783e-05   -0.0481173 -9.95905e-15 -1.19073e-13  1.17689e-13  2.78097e-10  2.81198e-10   -0.0250466 -1.67518e-07 -3.28746e-14   1.3348e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.09653e-11  2.30382e-14      0.10504   0.00568231 -1.85777e-14  2.62124e-11 -2.82894e-06 -2.82894e-06  1.53614e-06  1.47383e-14 -4.11686e-11 -7.01767e-07 -2.32754e-14   2.6251e-11  1.25764e-14 -2.15887e-11    0.0670098  -0.00240141  1.76101e-06  2.74075e-05  -2.7789e-14 -9.09164e-11    0.0419176   -0.0124016         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.33641e-10 -2.26319e-14   0.00568231      0.10504  1.91715e-14  2.63301e-10  2.82894e-06  2.82894e-06 -1.53614e-06 -1.28535e-14  1.08726e-10  7.01767e-07  2.60587e-14 -3.35762e-11 -1.31924e-14 -3.84218e-10  -0.00240141    0.0670098 -2.74075e-05 -1.76101e-06  2.84248e-14 -8.33993e-11   -0.0419176   -0.0124016         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.30859e-15    0.0328713 -1.85776e-14  1.91715e-14     0.240584  2.81346e-15  1.05286e-09  7.63349e-10 -6.49827e-10    0.0144632 -3.51199e-07  1.73493e-10  -0.00916843 -3.63943e-06    0.0440553 -4.29068e-14  6.81539e-14 -6.32402e-14 -1.51136e-10 -1.63432e-10   0.00432456  2.89238e-08  1.54051e-14 -2.67435e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0328713  6.37877e-15  2.62124e-11  2.63301e-10  2.79071e-15     0.240584  1.98674e-14  2.04209e-14 -1.65029e-14  3.51199e-07    0.0144632  4.45075e-15  3.63943e-06  -0.00916843 -4.30653e-14    0.0440553  2.41342e-11 -1.18381e-11  1.13967e-15  6.06361e-15 -2.89238e-08   0.00432456  2.19105e-11   2.5316e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.42123e-14 -6.93484e-10 -2.82894e-06  2.82894e-06  1.05286e-09  1.98673e-14     0.221542      0.11082   -0.0632617 -5.30873e-10  -3.9157e-15    0.0289004  4.89917e-10  2.08608e-13  -9.2688e-10  -1.3898e-14  1.30594e-05  1.25871e-05    0.0337442   -0.0308642  1.18894e-09  3.67838e-14  3.96317e-06    0.0115697         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.38398e-14  -8.6616e-10 -2.82894e-06  2.82894e-06  7.63349e-10  2.04208e-14      0.11082     0.221542   -0.0632617  -5.9843e-10  -1.9883e-15    0.0289004  4.97242e-10  2.11472e-13 -5.21073e-10 -1.46066e-14 -1.25871e-05 -1.30594e-05   -0.0308642    0.0337442  1.36166e-09  3.77874e-14  3.96317e-06   -0.0115697         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 8.86322e-15  3.29987e-10  1.53614e-06 -1.53614e-06 -6.49827e-10 -1.65029e-14   -0.0632617   -0.0632617     0.428924  4.79327e-10  1.07228e-15     0.012098 -1.75714e-11 -7.41446e-15  6.21668e-10  1.59838e-14 -1.15419e-08  1.15419e-08  2.74002e-05  2.74002e-05 -4.95216e-10 -1.41207e-14 -1.08508e-06   -1.489e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.76503e-07    0.0155052  1.47384e-14 -1.28536e-14    0.0144632  3.51199e-07 -5.30873e-10  -5.9843e-10  4.79327e-10     0.462759 -3.11645e-16  2.96023e-13  0.000635208  2.67572e-07   -0.0104064 -2.52691e-07 -3.53341e-14  3.82387e-14  8.94169e-11  8.39333e-11   -0.0177344 -5.49245e-07 -1.11478e-14  1.32419e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0155052 -3.76503e-07 -4.11686e-11  1.08726e-10 -3.51199e-07    0.0144632  -3.9157e-15 -1.98849e-15   1.0723e-15 -2.30075e-16     0.462759  5.88739e-17 -2.67572e-07  0.000635208  2.52691e-07   -0.0104064 -3.07988e-11  3.62824e-11 -1.50712e-14 -1.21609e-14  5.49245e-07   -0.0177344 -1.14127e-10 -1.29255e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-5.77513e-15 -2.18244e-10 -7.01767e-07  7.01767e-07  1.73493e-10  4.45056e-15    0.0289004    0.0289004     0.012098  2.96023e-13  5.90527e-17     0.635437     3.22e-10  1.36061e-13  1.32651e-10   3.3728e-15   8.8472e-06  -8.8472e-06    -0.021003    -0.021003  1.07108e-10  2.62507e-15  4.78501e-07  2.93341e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.91783e-05    0.0483139 -2.32754e-14  2.60587e-14  -0.00916843  3.63943e-06  4.89917e-10  4.97242e-10 -1.75714e-11  0.000635208 -2.67572e-07     3.22e-10     0.916802  -1.1101e-13    0.0222399  -8.8282e-06  2.16182e-13 -2.15569e-13 -3.71312e-10 -6.02973e-10    0.0232165 -9.06056e-06 -4.10957e-14 -1.89654e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0483139  1.91783e-05   2.6251e-11 -3.35762e-11 -3.63943e-06  -0.00916843  2.08608e-13  2.11472e-13 -7.41452e-15  2.67572e-07  0.000635208  1.36061e-13 -1.10922e-13     0.916802   8.8282e-06    0.0222399  9.04564e-11  1.41204e-10 -2.16709e-13 -2.16079e-13  9.06056e-06    0.0232165   1.0423e-10  1.74376e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-9.96098e-15   -0.0481173  1.25764e-14 -1.31925e-14    0.0440553 -4.30125e-14  -9.2688e-10 -5.21073e-10  6.21668e-10   -0.0104064  2.52691e-07  1.32651e-10    0.0222399   8.8282e-06      0.97942 -2.65995e-14   4.4581e-14  8.63128e-14  2.15076e-10  -1.1263e-10  -0.00417248 -2.79067e-08 -1.93398e-15  1.34416e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0481173 -9.94735e-15 -2.15887e-11 -3.84218e-10 -4.28732e-14    0.0440553 -1.38981e-14 -1.46067e-14  1.59838e-14 -2.52691e-07   -0.0104064  3.37281e-15  -8.8282e-06    0.0222399 -2.66539e-14      0.97942  1.31024e-10  1.96682e-10 -7.77135e-14  5.32155e-14  2.79067e-08  -0.00417248 -4.31217e-10 -1.24824e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.98719e-11 -1.19073e-13    0.0670098  -0.00240141  6.81538e-14  2.41342e-11  1.30594e-05 -1.25871e-05 -1.15419e-08 -3.53341e-14 -3.07988e-11   8.8472e-06  2.16182e-13  9.04564e-11   4.4581e-14  1.31024e-10       1.0596  -0.00440413 -3.41755e-05 -3.41755e-05  2.98204e-13 -2.35523e-11    0.0159918  -0.00500996         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.29721e-11  1.17689e-13  -0.00240141    0.0670098 -6.32402e-14 -1.18381e-11  1.25871e-05 -1.30594e-05  1.15419e-08  3.82386e-14  3.62824e-11  -8.8472e-06 -2.15569e-13  1.41204e-10  8.63128e-14  1.96682e-10  -0.00440413       1.0596  3.41755e-05  3.41755e-05  -2.4292e-13  1.64384e-10   -0.0159918  -0.00500996         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.68179e-14  2.78097e-10  1.76101e-06 -2.74075e-05 -1.51136e-10  1.13967e-15    0.0337442   -0.0308642  2.74002e-05  8.94169e-11 -1.50712e-14    -0.021003 -3.71312e-10 -2.16709e-13  2.15076e-10 -7.77135e-14 -3.41755e-05  3.41755e-05      1.14073     0.085536 -5.62039e-10 -8.84641e-14  7.45154e-06   0.00480923         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.54453e-14  2.81198e-10  2.74075e-05 -1.76101e-06 -1.63432e-10  6.06361e-15   -0.0308642    0.0337442  2.74002e-05  8.39333e-11  -1.2161e-14    -0.021003 -6.02973e-10 -2.16079e-13  -1.1263e-10  5.32155e-14 -3.41755e-05  3.41755e-05     0.085536      1.14073 -7.02582e-10 -3.29503e-14  7.45154e-06  -0.00480923         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.82925e-07   -0.0572532 -1.01931e-13  1.03067e-13   0.00341529 -2.28423e-08  4.12839e-09  4.38904e-09 -6.37934e-10   -0.0102623   3.1783e-07  1.16523e-10    0.0185867  7.25374e-06   -0.0190696  1.27543e-07  6.39231e-14  1.49014e-14  5.04666e-11 -1.50414e-10     0.599386 -1.36368e-13   2.9757e-13 -1.92254e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0572532 -3.82925e-07 -8.19172e-11 -1.79426e-10  2.28423e-08   0.00341529  1.37989e-13  1.39291e-13 -1.96764e-14  -3.1783e-07   -0.0102623  3.43693e-15 -7.25374e-06    0.0185867 -1.27543e-07   -0.0190696  2.12095e-11  1.78422e-10 -7.48754e-14  3.59844e-15 -1.36296e-13     0.599386 -2.61311e-09   1.7371e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.18677e-11 -2.58972e-14    0.0423952   -0.0423952  1.78247e-14 -5.25867e-11  3.69631e-06  3.69631e-06 -1.24027e-06 -1.26936e-14 -8.87902e-11  5.63965e-07 -4.34964e-14  1.15882e-10 -3.43956e-15 -4.93167e-10     0.016942    -0.016942  7.65366e-06  7.65366e-06  4.09754e-13 -2.39356e-09       1.9863  1.25693e-08         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.84772e-10  2.07295e-10       -0.014       -0.014 -2.16788e-10  2.13947e-10    0.0131136   -0.0131135 -3.40493e-09  1.05273e-10 -9.51275e-11  1.06757e-09 -2.24226e-10  2.09992e-10  1.21663e-10 -1.13018e-10  -0.00602843  -0.00602843   0.00551895  -0.00551895 -2.04089e-09  1.83219e-09  1.27332e-08     0.851466         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.9.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
