{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2023-03-17T05:20:00.234502Z",
     "iopub.status.busy": "2023-03-17T05:20:00.231951Z",
     "iopub.status.idle": "2023-03-17T05:20:34.130582Z",
     "shell.execute_reply": "2023-03-17T05:20:34.129334Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/votca/issues\r\n",
      "\r\n",
      "xtp_tools, version 2024-dev gitid: f763d12 (compiled Mar 17 2023, 05:15:52)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 BohrA\r\n",
      "    0.306708  4.48411e-15  1.22458e-10 -3.90429e-10 -1.22493e-15   -0.0516336  5.64011e-15  8.06442e-15 -9.43097e-16  1.65086e-07    0.0181563  -6.0411e-16  8.10316e-06    0.0389795  7.97989e-16    0.0421241  1.94746e-11  2.61567e-11  6.26754e-15 -5.09388e-15  5.45613e-07    -0.108303   1.6043e-10 -1.29721e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.47544e-15     0.306708 -1.61211e-14  1.85043e-14   -0.0516336 -1.29222e-15   1.7436e-09  2.01157e-09 -5.34415e-10    0.0181563 -1.65086e-07 -3.16684e-10   -0.0389795  8.10316e-06    0.0421241  8.58915e-16 -7.27173e-14 -7.15227e-14   3.2947e-10 -3.36152e-10    -0.108303 -5.45613e-07  1.37704e-15  5.63318e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.22458e-10 -1.61211e-14     0.319156    0.0100481 -1.52959e-14    4.198e-11 -2.09646e-06 -2.09646e-06  7.83489e-07 -6.20776e-15  4.28648e-11  3.35291e-07  -1.0236e-14 -2.56197e-11   6.1318e-15 -1.63904e-11   -0.0495092  -0.00204416 -7.61178e-07  1.06283e-05   6.2092e-14 -1.58331e-11    0.0252874    0.0208469          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.90429e-10  1.85043e-14    0.0100481     0.319156   1.1934e-14  3.67899e-10  2.09646e-06  2.09646e-06 -7.83489e-07  6.32474e-15 -1.10116e-10 -3.35291e-07  1.19087e-14  3.30932e-11 -4.26968e-15 -3.13125e-10   0.00204416    0.0495092  1.06283e-05 -7.61178e-07 -6.86468e-14  5.25146e-10   -0.0252874    0.0208469          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.23702e-15   -0.0516336 -1.52959e-14   1.1934e-14     0.490609  2.29629e-15  1.69885e-09  1.28897e-09 -7.55661e-10   -0.0134761  1.22531e-07 -2.05863e-10   -0.0080157  1.66632e-06    0.0309388 -5.38669e-15 -4.00551e-14 -4.07219e-14  1.87759e-10 -1.83892e-10     0.053272  2.68376e-07 -8.37879e-16 -5.54809e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0516336 -1.29717e-15    4.198e-11  3.67899e-10   2.2924e-15     0.490609  6.06885e-15  2.77097e-15  -2.9414e-15 -1.22531e-07   -0.0134761 -9.10536e-16  1.66632e-06    0.0080157 -5.39167e-15    0.0309388 -1.41584e-11 -1.80255e-11 -3.00805e-15  2.32691e-15 -2.68376e-07     0.053272 -9.98373e-11  3.89671e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.64009e-15   1.7436e-09 -2.09646e-06  2.09646e-06  1.69885e-09  6.06885e-15     0.549726     0.220522   -0.0861688  7.16778e-10 -3.91228e-15   -0.0368756  5.42594e-10 -1.14085e-13 -7.89529e-10 -1.79115e-15 -7.59861e-06  2.26855e-06   -0.0125301    -0.034935 -6.78358e-09 -4.35042e-14  1.87479e-07  -0.00684398          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 8.06446e-15  2.01157e-09 -2.09646e-06  2.09646e-06  1.28897e-09  2.77099e-15     0.220522     0.549726   -0.0861688  7.84029e-10 -3.84935e-15   -0.0368756  5.50067e-10 -1.15785e-13 -4.60014e-10  7.14474e-17  2.26855e-06 -7.59861e-06     0.034935    0.0125301 -7.28252e-09 -4.99479e-14  1.87479e-07   0.00684396          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-9.43061e-16 -5.34415e-10  7.83489e-07 -7.83489e-07 -7.55661e-10  -2.9414e-15   -0.0861688   -0.0861688     0.662739 -4.24852e-10  3.13392e-15  -0.00625217  -6.1459e-11  1.26923e-14  4.50125e-10  1.42101e-15  8.98531e-07  8.98531e-07  -0.00414117   0.00414117  1.82084e-09  1.03927e-14  1.20224e-08  2.90053e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.65086e-07    0.0181563  -6.2077e-15  6.32487e-15   -0.0134761 -1.22531e-07  7.16778e-10  7.84029e-10 -4.24852e-10     0.680027  8.40338e-16 -3.11524e-11  -7.6988e-05  1.67045e-08   0.00866729  7.88072e-08 -1.93258e-14  -2.0449e-14  9.37659e-11 -8.87452e-11   -0.0410255 -5.79705e-07  1.63605e-15  3.48783e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0181563 -1.65086e-07  4.28648e-11 -1.10116e-10  1.22531e-07   -0.0134761 -3.91222e-15 -3.84941e-15  3.13394e-15  7.52581e-16     0.680027 -7.82384e-17  1.67045e-08   7.6988e-05 -7.88072e-08   0.00866729 -1.45174e-11 -1.95381e-11 -4.56987e-15  3.45494e-15  5.79705e-07   -0.0410255  1.18008e-10 -9.21936e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-6.04111e-16 -3.16684e-10  3.35291e-07 -3.35291e-07 -2.05863e-10 -9.10501e-16   -0.0368756   -0.0368756  -0.00625217 -3.11524e-11 -7.82482e-17     0.797893 -2.21528e-10  4.65103e-14 -6.39471e-11   -7.359e-17  3.15381e-06  3.15381e-06   -0.0145354    0.0145354   9.5715e-10  5.59365e-15  4.33515e-09  1.20168e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 8.10316e-06   -0.0389795  -1.0236e-14  1.19087e-14   -0.0080157  1.66632e-06  5.42594e-10  5.50067e-10  -6.1459e-11  -7.6988e-05  1.67045e-08 -2.21528e-10     0.956279  3.14241e-14    0.0131238 -2.72822e-06 -6.44335e-14  -6.5281e-14  2.31213e-10 -3.46022e-10   -0.0200194  4.06082e-06 -1.07613e-14   3.2121e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0389795  8.10316e-06 -2.56197e-11  3.30932e-11  1.66632e-06    0.0080157 -1.14085e-13 -1.15785e-13  1.26923e-14  1.67045e-08   7.6988e-05  4.65103e-14  3.14077e-14     0.956279 -2.72822e-06   -0.0131238  4.62595e-11 -6.85495e-11 -6.21218e-14  6.29732e-14  4.06082e-06    0.0200194 -4.89096e-11  6.98013e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 8.01252e-16    0.0421241  6.13178e-15 -4.26968e-15    0.0309388 -5.40171e-15 -7.89529e-10 -4.60014e-10  4.50125e-10   0.00866729 -7.88072e-08 -6.39471e-11    0.0131238 -2.72822e-06     0.987501 -1.41787e-16 -8.16708e-15   2.7771e-14  -1.3445e-10 -4.39277e-11   -0.0224113 -1.12905e-07 -1.73519e-16 -2.73437e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0421241  8.44491e-16 -1.63904e-11 -3.13125e-10 -5.38828e-15    0.0309388 -1.79116e-15   7.1436e-17  1.42101e-15  7.88072e-08   0.00866729  -7.3591e-17 -2.72822e-06   -0.0131238 -1.24887e-16     0.987501 -6.74219e-11  1.10956e-10  2.25562e-14  1.34118e-14  1.12905e-07   -0.0224113 -1.30106e-10  6.83356e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.94746e-11 -7.27173e-14   -0.0495092   0.00204416 -4.00551e-14 -1.41584e-11 -7.59861e-06  2.26855e-06  8.98531e-07 -1.93258e-14 -1.45174e-11  3.15381e-06 -6.44334e-14  4.62595e-11 -8.16709e-15 -6.74219e-11      1.02819    0.0020693 -9.42504e-06  9.42504e-06  2.70006e-13  1.80131e-12  -0.00469072  -0.00010131          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.61567e-11 -7.15227e-14  -0.00204416    0.0495092 -4.07219e-14 -1.80255e-11  2.26855e-06 -7.59861e-06  8.98531e-07  -2.0449e-14 -1.95381e-11  3.15381e-06 -6.52809e-14 -6.85495e-11   2.7771e-14  1.10956e-10    0.0020693      1.02819 -9.42504e-06  9.42504e-06  2.52536e-13   -8.997e-11  -0.00469072   0.00010131          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 6.26754e-15   3.2947e-10 -7.61178e-07  1.06283e-05  1.87759e-10 -3.00805e-15   -0.0125301     0.034935  -0.00414117  9.37659e-11 -4.56987e-15   -0.0145354  2.31213e-10 -6.21218e-14  -1.3445e-10  2.25562e-14 -9.42504e-06 -9.42504e-06      1.07163   -0.0455077 -1.15778e-09 -2.55067e-14 -1.18677e-06  0.000177495          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-5.09388e-15 -3.36152e-10  1.06283e-05 -7.61178e-07 -1.83892e-10  2.32691e-15    -0.034935    0.0125301   0.00414117 -8.87452e-11  3.45492e-15    0.0145354 -3.46022e-10  6.29732e-14 -4.39277e-11  1.34118e-14  9.42504e-06  9.42504e-06   -0.0455077      1.07163   1.2482e-09  7.70192e-15  1.18677e-06  0.000177497          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.79059e-07    0.0752424  -3.3555e-14  3.80885e-14   -0.0690969  3.48099e-07  3.52652e-09   3.8526e-09 -1.17254e-09    0.0309264 -4.37001e-07 -8.30841e-10   0.00901647 -1.82894e-06    0.0363998 -1.83377e-07 -1.54601e-13 -1.54513e-13  7.12841e-10 -7.14106e-10    -0.194835 -3.06502e-14 -6.60511e-14  -4.2209e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0752424  3.79059e-07  1.03398e-10 -4.38777e-10 -3.48099e-07   -0.0690969  2.44364e-14  2.88132e-14 -6.83068e-15  4.37001e-07    0.0309264 -5.31462e-15 -1.82894e-06  -0.00901647  1.83377e-07    0.0363998 -7.75987e-12 -4.82562e-12  3.58973e-15 -3.13279e-15 -3.05935e-14    -0.194835  2.30344e-09  9.41787e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.58821e-10  9.78437e-15    0.0143253   -0.0143253  6.90828e-15  1.71046e-10  1.22021e-06  1.22021e-06 -4.01916e-07  4.09774e-15  4.79008e-11 -1.72228e-07  3.34496e-16 -8.18501e-12 -2.67303e-15 -2.22422e-10  -0.00613235  -0.00613235 -1.29751e-06  1.29751e-06 -1.08706e-13  2.19098e-09     0.954926 -1.23184e-08          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-7.87676e-11   3.3045e-11  -0.00594521  -0.00594521  1.38037e-10 -3.57177e-10    0.0013464  -0.00134639 -1.63039e-09 -1.09952e-12   1.1445e-11 -8.52295e-10  4.73536e-11  1.20088e-10 -1.31792e-11  2.41387e-11  -0.00441337   0.00441337   0.00148913   0.00148913 -5.05358e-10   1.1335e-09 -1.25284e-08    0.0933906          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0935659  2.20198e-15  6.09655e-11 -2.33641e-10  -8.7896e-16   -0.0328713  2.51916e-15  4.02235e-15  -5.3327e-16  1.40981e-07    0.0155052 -4.06834e-16  1.00436e-05    0.0483139  1.07384e-15    0.0481173   1.9872e-11   2.2972e-11  5.47365e-15 -5.04013e-15  1.26181e-07   -0.0250466 -5.23672e-11 -1.48395e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  2.2047e-15    0.0935659 -6.50342e-15  7.98864e-15   -0.0328713 -9.13117e-16  6.93485e-10  8.66161e-10 -3.29987e-10    0.0155052 -1.40981e-07 -2.18244e-10   -0.0483139  1.00436e-05    0.0481173  1.13402e-15  -6.0789e-14 -6.03338e-14  2.78098e-10 -2.81198e-10   -0.0250466 -1.26181e-07  1.09186e-14  6.43991e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.09655e-11 -6.50341e-15      0.10504   0.00568231 -9.50516e-15  2.62123e-11  -1.0593e-06  -1.0593e-06  5.75207e-07  -4.5421e-15   4.1169e-11  2.62776e-07 -9.88922e-15  -2.6251e-11  7.11037e-15 -2.15887e-11   -0.0670098  -0.00240141 -8.01678e-07  1.42326e-05  9.63319e-15  9.09166e-11    0.0419176    0.0151624         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.33641e-10  7.98862e-15   0.00568231      0.10504  7.07859e-15    2.633e-10   1.0593e-06   1.0593e-06 -5.75207e-07  4.64479e-15 -1.08726e-10 -2.62776e-07  1.15279e-14  3.35763e-11 -4.84299e-15 -3.84219e-10   0.00240141    0.0670098  1.42326e-05 -8.01678e-07  -1.1676e-14  8.33993e-11   -0.0419176    0.0151624         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-8.87687e-16   -0.0328713 -9.50516e-15  7.07859e-15     0.240584  2.02718e-15  1.05286e-09   7.6335e-10 -6.49827e-10   -0.0144632  1.31506e-07 -1.73493e-10  -0.00916843  1.90596e-06    0.0440553 -7.39719e-15 -3.55231e-14 -3.29116e-14  1.51136e-10 -1.63432e-10  -0.00432456 -2.17864e-08  5.79613e-15  1.29027e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0328713 -9.17929e-16  2.62123e-11    2.633e-10  2.01826e-15     0.240584   3.5969e-15  1.21609e-15 -2.50129e-15 -1.31506e-07   -0.0144632 -7.63751e-16  1.90596e-06   0.00916843  -7.3995e-15    0.0440553 -2.41342e-11  -1.1838e-11 -1.87827e-15  4.47204e-15  2.17864e-08  -0.00432456  2.19104e-11 -3.09516e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.51914e-15  6.93485e-10  -1.0593e-06   1.0593e-06  1.05286e-09  3.59688e-15     0.221542      0.11082   -0.0632617  5.30873e-10 -2.80347e-15   -0.0289004  4.89917e-10 -1.02966e-13 -9.26879e-10 -2.02749e-15 -6.71859e-06  6.71236e-06   -0.0337442   -0.0308642 -1.18894e-09 -5.84166e-15   1.4008e-06  -0.00558182         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.02237e-15  8.66161e-10  -1.0593e-06   1.0593e-06   7.6335e-10  1.21609e-15      0.11082     0.221542   -0.0632617   5.9843e-10 -2.74629e-15   -0.0289004  4.97242e-10 -1.04637e-13 -5.21071e-10  2.51461e-16  6.71236e-06 -6.71859e-06    0.0308642    0.0337442 -1.36166e-09 -7.97196e-15   1.4008e-06   0.00558182         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-5.33236e-16 -3.29987e-10  5.75207e-07 -5.75207e-07 -6.49827e-10 -2.50129e-15   -0.0632617   -0.0632617     0.428924 -4.79328e-10  3.61158e-15    -0.012098 -1.75707e-11  3.35005e-15  6.21667e-10  1.97194e-15  5.94516e-09  5.94516e-09 -2.74002e-05  2.74002e-05  4.95217e-10  2.37767e-15 -3.71365e-07  7.18394e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.40981e-07    0.0155052 -4.54204e-15  4.64493e-15   -0.0144632 -1.31506e-07  5.30873e-10   5.9843e-10 -4.79328e-10     0.462759  1.12936e-15  2.95974e-13 -0.000635208  1.37824e-07    0.0104064  9.46199e-08 -1.83671e-14 -1.96107e-14  8.94173e-11 -8.39331e-11   -0.0177344 -2.50593e-07   5.2869e-15  6.38862e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0155052 -1.40981e-07   4.1169e-11 -1.08726e-10  1.31506e-07   -0.0144632 -2.80341e-15 -2.74635e-15  3.61161e-15  1.00146e-15     0.462759 -4.05385e-16  1.37824e-07  0.000635208 -9.46199e-08    0.0104064 -3.07982e-11 -3.62824e-11  -8.0331e-15  6.79916e-15  2.50593e-07   -0.0177344  1.14127e-10 -1.58026e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-4.06837e-16 -2.18244e-10  2.62776e-07 -2.62776e-07 -1.73493e-10 -7.63702e-16   -0.0289004   -0.0289004    -0.012098  2.95974e-13 -4.05399e-16     0.635437    -3.22e-10  6.76279e-14 -1.32652e-10 -2.47759e-16  4.55713e-06  4.55713e-06    -0.021003     0.021003  1.07108e-10  1.34267e-16 -1.64217e-07  1.41526e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.00436e-05   -0.0483139 -9.88922e-15  1.15279e-14  -0.00916843  1.90596e-06  4.89917e-10  4.97242e-10 -1.75707e-11 -0.000635208  1.37824e-07    -3.22e-10     0.916802  5.53965e-14    0.0222399 -4.62329e-06 -1.09976e-13 -1.11677e-13  3.71312e-10 -6.02973e-10   -0.0232165  4.70934e-06 -2.07353e-14  9.15119e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0483139  1.00436e-05  -2.6251e-11  3.35763e-11  1.90596e-06   0.00916843 -1.02966e-13 -1.04637e-13  3.35005e-15  1.37824e-07  0.000635208  6.76279e-14    5.537e-14     0.916802 -4.62329e-06   -0.0222399  9.04565e-11 -1.41205e-10 -1.06045e-13  1.07749e-13  4.70934e-06    0.0232165  -1.0423e-10  2.13267e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.07464e-15    0.0481173  7.11034e-15   -4.843e-15    0.0440553 -7.41318e-15 -9.26879e-10 -5.21071e-10  6.21667e-10    0.0104064 -9.46199e-08 -1.32652e-10    0.0222399 -4.62329e-06      0.97942 -1.96347e-16 -2.18859e-14  4.41143e-14 -2.15076e-10  -1.1263e-10   0.00417248  2.10203e-08 -2.98024e-15 -6.48496e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481173  1.11902e-15 -2.15887e-11 -3.84219e-10 -7.39857e-15    0.0440553 -2.02749e-15   2.5145e-16  1.97193e-15  9.46199e-08    0.0104064 -2.47763e-16 -4.62329e-06   -0.0222399  -1.7055e-16      0.97942 -1.31024e-10  1.96682e-10  4.00034e-14  2.60564e-14 -2.10203e-08   0.00417248 -4.31217e-10   1.5261e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  1.9872e-11  -6.0789e-14   -0.0670098   0.00240141 -3.55231e-14 -2.41342e-11 -6.71859e-06  6.71236e-06  5.94516e-09 -1.83671e-14 -3.07982e-11  4.55713e-06 -1.09976e-13  9.04565e-11 -2.18859e-14 -1.31024e-10       1.0596   0.00440412 -1.76036e-05  1.76036e-05   1.5166e-13 -2.35524e-11   -0.0159918  -0.00612716         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  2.2972e-11 -6.03338e-14  -0.00240141    0.0670098 -3.29116e-14  -1.1838e-11  6.71236e-06 -6.71859e-06  5.94516e-09 -1.96107e-14 -3.62824e-11  4.55713e-06 -1.11677e-13 -1.41205e-10  4.41143e-14  1.96682e-10   0.00440412       1.0596 -1.76036e-05  1.76036e-05  1.24423e-13 -1.64384e-10   -0.0159918   0.00612716         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 5.47365e-15  2.78098e-10 -8.01678e-07  1.42326e-05  1.51136e-10 -1.87827e-15   -0.0337442    0.0308642 -2.74002e-05  8.94173e-11 -8.03309e-15    -0.021003  3.71312e-10 -1.06045e-13 -2.15076e-10  4.00034e-14 -1.76036e-05 -1.76036e-05      1.14073    -0.085536 -5.62041e-10 -3.74165e-14 -3.71954e-06   0.00232054         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-5.04013e-15 -2.81198e-10  1.42326e-05 -8.01678e-07 -1.63432e-10  4.47204e-15   -0.0308642    0.0337442  2.74002e-05 -8.39331e-11  6.79913e-15     0.021003 -6.02973e-10  1.07749e-13  -1.1263e-10  2.60564e-14  1.76036e-05  1.76036e-05    -0.085536      1.14073  7.02584e-10  1.00623e-14  3.71954e-06   0.00232054         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.88433e-07   -0.0572532  3.65225e-14 -3.97182e-14  -0.00341529  1.72057e-08 -4.12839e-09 -4.38905e-09  6.37935e-10   -0.0102623   1.4501e-07  1.16523e-10   -0.0185867  3.77022e-06    0.0190696 -9.60698e-08  3.12419e-14 -8.04673e-15  5.04657e-11  1.50414e-10     0.599386 -4.19687e-14 -8.88113e-14 -9.27553e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0572532 -2.88433e-07  8.19172e-11  1.79426e-10 -1.72057e-08  -0.00341529 -2.59644e-14 -2.91593e-14  3.79408e-15  -1.4501e-07   -0.0102623  3.65403e-16  3.77022e-06    0.0185867  9.60698e-08    0.0190696  2.12094e-11 -1.78422e-10 -3.59874e-14 -3.11765e-15 -4.18373e-14     0.599386  2.61312e-09   2.1238e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.18674e-11  9.52892e-15    0.0423952   -0.0423952  5.93675e-15 -5.25865e-11  1.30383e-06  1.30383e-06 -4.31635e-07  5.68978e-15  8.87909e-11 -1.95771e-07 -2.22004e-14 -1.15882e-10 -4.01854e-15 -4.93167e-10    -0.016942    -0.016942 -3.85183e-06  3.85183e-06 -1.29343e-13  2.39357e-09       1.9863 -1.53669e-08         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.25904e-10  1.00012e-10    0.0171167    0.0171167  1.04592e-10 -2.61574e-10  -0.00632667   0.00632666  1.64277e-09  5.07893e-11 -1.16302e-10  5.15067e-10  1.08194e-10  2.56824e-10 -5.86971e-11  1.38177e-10  -0.00737263   0.00737263   0.00266301   0.00266301 -9.84658e-10  2.24006e-09 -1.55676e-08     0.779984         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.2"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
