{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-06-15T08:12:44.101515Z",
     "iopub.status.busy": "2022-06-15T08:12:44.100960Z",
     "iopub.status.idle": "2022-06-15T08:12:59.676891Z",
     "shell.execute_reply": "2022-06-15T08:12:59.676223Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2023-dev gitid: 231177b (compiled Jun 15 2022, 08:03:10)\r\n",
      "votca_csg, version 2023-dev gitid: 231177b (compiled Jun 15 2022, 07:45:15)\r\n",
      "votca_tools, version 2023-dev gitid: 231177b (compiled Jun 15 2022, 07:41:58)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 BohrA\r\n",
      "    0.307132  -3.1017e-11   4.4564e-11 -2.30723e-10  2.35015e-11   -0.0516061  8.55621e-10  7.79087e-10  -3.2262e-10    0.0181638   -0.0010568 -7.15344e-11    0.0103329    0.0375808 -2.02696e-11    0.0421019 -2.33051e-10   1.3056e-10 -3.01468e-10 -1.07297e-10  0.000480899    -0.108408 -1.28183e-10 -1.14828e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.10169e-11     0.307132 -1.47313e-10  7.07788e-11   -0.0516061  2.35015e-11  9.00247e-10  1.08641e-09 -1.97406e-10    0.0010568    0.0181638 -2.25159e-10    0.0375808   -0.0103329    0.0421019 -2.02696e-11 -1.93845e-11  2.13555e-10 -9.74832e-11  5.00788e-12    -0.108408 -0.000480899 -1.34473e-11  5.07868e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  4.4564e-11 -1.47313e-10     0.320627   0.00926761  1.56429e-10     1.03e-10     0.013365     0.013365  -0.00498409 -5.82003e-11 -1.47012e-11  -0.00212338 -8.94559e-11   1.8314e-10 -1.71645e-10 -2.09316e-11    0.0470691  -0.00128758  -0.00258303   -0.0151707  1.82121e-10 -3.05135e-10   -0.0254901   0.00365966          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.30723e-10  7.07788e-11   0.00926761     0.320627 -1.69757e-10  3.23941e-10    -0.013365    -0.013365   0.00498409  -5.0113e-11   6.8806e-11   0.00212338  7.30477e-11   -1.447e-10   6.9013e-11 -1.85845e-10  -0.00128758    0.0470691    0.0151707   0.00258303 -1.68641e-10  7.89476e-10    0.0254901   0.00365966          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.35015e-11   -0.0516061  1.56429e-10 -1.69757e-10     0.490902 -2.89172e-12  1.80086e-09  1.37392e-09 -8.20733e-10  -0.00078198   -0.0134404 -1.98452e-10   0.00770782  -0.00211927    0.0309987  6.69545e-11 -6.50644e-11 -1.89685e-10  -1.3376e-10 -2.73798e-10    0.0531267  0.000235671  1.67523e-10  5.00535e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0516061  2.35015e-11     1.03e-10  3.23941e-10 -2.89176e-12     0.490902 -2.54528e-10 -2.67855e-10  1.54987e-10   -0.0134404   0.00078198  1.92705e-11   0.00211927   0.00770782  6.69545e-11    0.0309987  1.91106e-10 -5.10681e-11  9.18634e-11 -1.62886e-10 -0.000235671    0.0531267  2.48372e-10  7.03458e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 8.55621e-10  9.00247e-10     0.013365    -0.013365  1.80086e-09 -2.54528e-10     0.549563     0.219668   -0.0856646 -7.12198e-12  6.43989e-10   -0.0364958 -1.85626e-09  2.97718e-09 -9.22333e-10  3.15839e-10   -0.0113219  -0.00126578    0.0127106   -0.0330709  5.13111e-10 -7.46011e-09  -0.00157038   -0.0223527          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 7.79087e-10  1.08641e-09     0.013365    -0.013365  1.37392e-09 -2.67855e-10     0.219668     0.549563   -0.0856646  4.69828e-11  7.52302e-10   -0.0364958  -1.8947e-09  2.96077e-09 -7.15556e-10  2.13207e-10   0.00126578    0.0113219   -0.0330709    0.0127106  4.25746e-11 -7.44289e-09  -0.00157038    0.0223527          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -3.2262e-10 -1.97406e-10  -0.00498409   0.00498409 -8.20733e-10  1.54987e-10   -0.0856646   -0.0856646     0.662947  -1.7499e-10 -2.31594e-10  -0.00632525  4.08876e-10  -7.4103e-10  5.58326e-10 -1.54236e-10   0.00131289  -0.00131289     0.003878     0.003878 -9.19876e-10   2.8583e-09   0.00114336  7.14246e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0181638    0.0010568 -5.82003e-11  -5.0113e-11  -0.00078198   -0.0134404 -7.12198e-12  4.69828e-11  -1.7499e-10     0.680922  1.58681e-12  8.85897e-11  2.69965e-05  7.97419e-05   0.00050166   0.00862234 -3.66189e-10 -3.65179e-11  6.96252e-11  8.83694e-10   -0.0022013   -0.0409685 -8.96061e-10 -8.80919e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0010568    0.0181638 -1.47012e-11   6.8806e-11   -0.0134404   0.00078198  6.43989e-10  7.52302e-10 -2.31594e-10  1.58669e-12     0.680922 -1.12766e-10  7.97419e-05 -2.69965e-05   0.00862234  -0.00050166 -5.77522e-11  8.71821e-10 -5.52228e-10 -1.49522e-10   -0.0409685    0.0022013 -8.14791e-10 -9.03925e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-7.15344e-11 -2.25159e-10  -0.00212338   0.00212338 -1.98452e-10  1.92705e-11   -0.0364958   -0.0364958  -0.00632525  8.85897e-11 -1.12766e-10      0.79826  3.98807e-10  -4.6798e-10  -1.5789e-11 -4.96613e-11   0.00464161  -0.00464161    0.0137104    0.0137104  8.86721e-11  8.70737e-10  0.000453193  2.97388e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0103329    0.0375808 -8.94559e-11  7.30477e-11   0.00770782   0.00211927 -1.85626e-09  -1.8947e-09  4.08876e-10  2.69965e-05  7.97419e-05  3.98807e-10     0.956418  4.27591e-11   -0.0126719  -0.00348416  3.03515e-10  -4.1572e-10  1.05215e-09  1.05153e-09    0.0192825   0.00539386  3.05776e-11  -2.6984e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0375808   -0.0103329   1.8314e-10   -1.447e-10  -0.00211927   0.00770782  2.97718e-09  2.96077e-09  -7.4103e-10  7.97419e-05 -2.69965e-05  -4.6798e-10  4.27592e-11     0.956418   0.00348416   -0.0126719 -5.75118e-10  5.75737e-10 -1.67334e-09 -1.78554e-09  -0.00539386    0.0192825 -7.82703e-12  6.49989e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.02696e-11    0.0421019 -1.71645e-10   6.9013e-11    0.0309987  6.69545e-11 -9.22333e-10 -7.15556e-10  5.58326e-10   0.00050166   0.00862234  -1.5789e-11   -0.0126719   0.00348416     0.988566  3.78342e-11   8.5466e-12 -1.86197e-10  2.23473e-10 -1.97824e-11   -0.0223628  -9.9202e-05  3.66015e-10  4.45678e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0421019 -2.02696e-11 -2.09316e-11 -1.85845e-10  6.69545e-11    0.0309987  3.15839e-10  2.13207e-10 -1.54236e-10   0.00862234  -0.00050166 -4.96613e-11  -0.00348416   -0.0126719  3.78342e-11     0.988566  1.22214e-10  1.21042e-10 -1.18788e-11 -1.89529e-10   9.9202e-05   -0.0223628  4.45783e-10  1.32589e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.33051e-10 -1.93845e-11    0.0470691  -0.00128758 -6.50644e-11  1.91106e-10   -0.0113219   0.00126578   0.00131289 -3.66189e-10 -5.77522e-11   0.00464161  3.03515e-10 -5.75118e-10   8.5466e-12  1.22214e-10      1.03318   -0.0065406    0.0132111    0.0132111 -5.75855e-11  5.05047e-10  -0.00427509  0.000169407          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  1.3056e-10  2.13555e-10  -0.00128758    0.0470691 -1.89685e-10 -5.10681e-11  -0.00126578    0.0113219  -0.00131289 -3.65179e-11  8.71821e-10  -0.00464161  -4.1572e-10  5.75737e-10 -1.86197e-10  1.21042e-10   -0.0065406      1.03318   -0.0132111   -0.0132111  6.21517e-11 -5.84101e-10   0.00427509  0.000169405          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.01468e-10 -9.74832e-11  -0.00258303    0.0151707  -1.3376e-10  9.18634e-11    0.0127106   -0.0330709     0.003878  6.96252e-11 -5.52228e-10    0.0137104  1.05215e-09 -1.67334e-09  2.23473e-10 -1.18788e-11    0.0132111   -0.0132111      1.06773    0.0410909   -2.877e-10  1.40644e-09   0.00204579 -0.000568441          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.07297e-10  5.00788e-12   -0.0151707   0.00258303 -2.73798e-10 -1.62886e-10   -0.0330709    0.0127106     0.003878  8.83694e-10 -1.49522e-10    0.0137104  1.05153e-09 -1.78554e-09 -1.97824e-11 -1.89529e-10    0.0132111   -0.0132111    0.0410909      1.06773 -2.10322e-10  1.41111e-09   0.00204579  0.000568446          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-0.000333795    0.0752465 -2.48581e-10  3.00438e-10   -0.0690159  0.000306156 -1.37679e-09 -1.00878e-09  9.71149e-10   0.00166086    0.0309103 -4.51209e-11  -0.00867052   0.00242539    0.0364086 -0.000161509  1.19518e-10 -1.20787e-10  4.88048e-10  4.85258e-10    -0.194424  2.24404e-10  3.79909e-09  5.82147e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0752465  0.000333795  1.78447e-10 -5.57926e-10 -0.000306156   -0.0690159  5.06007e-09  5.10926e-09  -2.2612e-09    0.0309103  -0.00166086 -7.95698e-10  -0.00242539  -0.00867052  0.000161509    0.0364086 -4.42725e-10  4.47955e-10  -1.2091e-09 -1.21034e-09  2.24404e-10    -0.194424  1.19907e-09  1.69255e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.04832e-10 -4.79429e-10   -0.0141836    0.0141836  4.10999e-10  1.86451e-10   0.00438288   0.00438288  -0.00132983 -1.14242e-09  -1.0775e-09 -0.000533046  7.68396e-11  1.04383e-10 -4.14747e-11  1.63499e-10  -0.00597926   0.00597926   0.00149466   0.00149466  3.89348e-09  1.34984e-09     0.958364    1.573e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.92064e-10  -2.4833e-10  -0.00106385  -0.00106385  8.88612e-10  2.63889e-10   0.00429137  -0.00429135 -3.87085e-09 -8.78807e-10 -1.00055e-09 -2.12843e-09  1.40575e-11  1.24797e-10  1.78179e-10  1.49399e-10   0.00203657   0.00203657  -0.00449232   0.00449231  4.73785e-10  1.85101e-09  1.86963e-09     0.221503          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "    0.093811 -1.37874e-11  1.67884e-11   -1.312e-10  1.44537e-11   -0.0328898  3.54539e-10  2.99652e-10 -1.98328e-10    0.0155309 -0.000903611 -3.66562e-11    0.0128125    0.0465993 -2.35508e-11    0.0481429 -2.87501e-10  1.38489e-10 -3.10742e-10 -3.82684e-11  0.000111379   -0.0251078 -4.01125e-10 -3.69694e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.37874e-11     0.093811 -9.50601e-11  4.01733e-11   -0.0328898  1.44537e-11  3.69124e-10  4.83535e-10 -1.23095e-10  0.000903611    0.0155309 -1.66761e-10    0.0465993   -0.0128125    0.0481429 -2.35508e-11  -1.2881e-11  2.85355e-10 -7.57785e-11  7.32332e-11   -0.0251078 -0.000111379 -5.11049e-10 -2.41034e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.67884e-11 -9.50601e-11     0.105882   0.00530025  1.02687e-10  7.15177e-11   0.00677071   0.00677071  -0.00366511 -5.18447e-11 -2.02839e-11   -0.0016649   -9.663e-11  2.03143e-10 -2.10621e-10 -2.54654e-11    0.0640772  -0.00170475  -0.00247813   -0.0196275 -6.24167e-11 -1.11426e-11   -0.0418854   0.00263448         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -1.312e-10  4.01733e-11   0.00530025     0.105882 -1.09772e-10  2.29077e-10  -0.00677071  -0.00677071   0.00366511 -5.46517e-11  7.11899e-11    0.0016649  7.33574e-11 -1.52883e-10  7.35208e-11 -2.18445e-10  -0.00170475    0.0640772    0.0196275   0.00247813  1.33486e-10  1.11393e-10    0.0418854   0.00263448         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.44537e-11   -0.0328898  1.02687e-10 -1.09772e-10     0.240891 -6.93972e-13  1.10445e-09  8.03855e-10 -6.98467e-10  -0.00084035   -0.0144436 -1.60498e-10   0.00881625  -0.00242404    0.0441772   9.3071e-11 -5.64822e-11 -3.34203e-10 -5.72993e-11 -2.87388e-10  -0.00438142 -1.94361e-05  5.20781e-10  8.32219e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0328898  1.44537e-11  7.15177e-11  2.29077e-10 -6.93998e-13     0.240891 -1.39733e-10 -1.46819e-10  1.24263e-10   -0.0144436   0.00084035   9.8977e-12   0.00242404   0.00881625  9.30711e-11    0.0441772  2.80022e-10 -4.99326e-11  1.11434e-10 -2.79251e-10  1.94361e-05  -0.00438142  4.31949e-10  2.64565e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.54539e-10  3.69124e-10   0.00677071  -0.00677071  1.10445e-09 -1.39733e-10      0.22186     0.110678   -0.0629945 -1.32233e-12  4.62565e-10   -0.0286157 -1.92944e-09  3.22305e-09 -1.03144e-09  3.28837e-10   -0.0100569   -0.0070925    0.0331038   -0.0292687 -8.01276e-10 -3.84378e-10   0.00293133   -0.0183039         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.99652e-10  4.83535e-10   0.00677071  -0.00677071  8.03855e-10 -1.46819e-10     0.110678      0.22186   -0.0629945  4.95837e-11  5.69062e-10   -0.0286157  -1.9797e-09  3.19978e-09 -7.87527e-10  1.91736e-10    0.0070925    0.0100569   -0.0292687    0.0331038 -8.98716e-10  -3.1233e-10   0.00293133    0.0183039         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.98328e-10 -1.23095e-10  -0.00366511   0.00366511 -6.98467e-10  1.24263e-10   -0.0629945   -0.0629945     0.429278 -2.25289e-10 -2.34112e-10   -0.0121538  4.56986e-10  -9.0883e-10  7.69106e-10 -2.08944e-10  -6.1896e-06  6.18963e-06 -1.82829e-05 -1.82828e-05 -7.45332e-11  5.84278e-10  5.94447e-05  1.73752e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0155309  0.000903611 -5.18447e-11 -5.46517e-11  -0.00084035   -0.0144436 -1.32233e-12  4.95837e-11 -2.25289e-10     0.463967  2.11923e-12  1.17677e-10  0.000207407  0.000612637   0.00060264     0.010358 -6.16998e-10 -6.25048e-11  1.11994e-10  1.49026e-09 -0.000951548   -0.0177093 -1.86777e-09 -1.63428e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-0.000903611    0.0155309 -2.02839e-11  7.11899e-11   -0.0144436   0.00084035  4.62565e-10  5.69062e-10 -2.34112e-10  2.11907e-12     0.463967 -1.09257e-10  0.000612637 -0.000207407     0.010358  -0.00060264 -7.66961e-11  1.45496e-09 -8.67807e-10 -1.88304e-10   -0.0177093  0.000951548 -1.77771e-09 -1.64812e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.66562e-11 -1.66761e-10   -0.0016649    0.0016649 -1.60498e-10   9.8977e-12   -0.0286157   -0.0286157   -0.0121538  1.17677e-10 -1.09257e-10     0.636067  5.48032e-10 -6.14956e-10 -6.46683e-11 -6.61998e-11   0.00671118  -0.00671118    0.0198234    0.0198234  1.03283e-10 -8.59173e-12  4.58909e-05  2.89557e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0128125    0.0465993   -9.663e-11  7.33574e-11   0.00881625   0.00242404 -1.92944e-09  -1.9797e-09  4.56986e-10  0.000207407  0.000612637  5.48032e-10     0.917068  7.49607e-11   -0.0214938  -0.00590973  5.27975e-10 -7.57798e-10  1.86177e-09  1.85723e-09    0.0223868   0.00626221  1.65203e-10  8.11693e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0465993   -0.0128125  2.03143e-10 -1.52883e-10  -0.00242404   0.00881625  3.22305e-09  3.19978e-09  -9.0883e-10  0.000612637 -0.000207407 -6.14956e-10  7.49609e-11     0.917068   0.00590973   -0.0214938 -1.02111e-09  1.02565e-09 -2.98404e-09 -3.21386e-09  -0.00626221    0.0223868  1.26464e-10  2.26916e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.35508e-11    0.0481429 -2.10621e-10  7.35208e-11    0.0441772  9.30711e-11 -1.03144e-09 -7.87527e-10  7.69106e-10   0.00060264     0.010358 -6.46683e-11   -0.0214938   0.00590973     0.981535  7.29281e-11 -3.45377e-12 -3.05754e-10  3.63045e-10 -7.51416e-11   0.00424838  1.88459e-05   3.1709e-10  4.83649e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481429 -2.35508e-11 -2.54654e-11 -2.18445e-10  9.30711e-11    0.0441772  3.28837e-10  1.91736e-10 -2.08944e-10     0.010358  -0.00060264 -6.61998e-11  -0.00590973   -0.0214938   7.2928e-11     0.981535  2.23058e-10  2.15129e-10 -7.34847e-12 -3.16556e-10 -1.88459e-05   0.00424838  6.75823e-10    2.241e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.87501e-10  -1.2881e-11    0.0640772  -0.00170475 -5.64822e-11  2.80022e-10   -0.0100569    0.0070925  -6.1896e-06 -6.16998e-10 -7.66961e-11   0.00671118  5.27975e-10 -1.02111e-09 -3.45377e-12  2.23058e-10      1.06903    -0.012762     0.024687     0.024687  4.18663e-11  2.29431e-10   -0.0150555   0.00303644         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.38489e-10  2.85355e-10  -0.00170475    0.0640772 -3.34203e-10 -4.99326e-11   -0.0070925    0.0100569  6.18963e-06 -6.25048e-11  1.45496e-09  -0.00671118 -7.57798e-10  1.02565e-09 -3.05754e-10  2.15129e-10    -0.012762      1.06903    -0.024687    -0.024687 -1.38817e-10 -2.90487e-10    0.0150555   0.00303644         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.10742e-10 -7.57785e-11  -0.00247813    0.0196275 -5.72993e-11  1.11434e-10    0.0331038   -0.0292687 -1.82829e-05  1.11994e-10 -8.67807e-10    0.0198234  1.86177e-09 -2.98404e-09  3.63045e-10 -7.34847e-12     0.024687    -0.024687      1.13359    0.0773244  1.19073e-10  4.33835e-10   0.00544017  -0.00704165         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.82684e-11  7.32332e-11   -0.0196275   0.00247813 -2.87388e-10 -2.79251e-10   -0.0292687    0.0331038 -1.82828e-05  1.49026e-09 -1.88304e-10    0.0198234  1.85723e-09 -3.21386e-09 -7.51416e-11 -3.16556e-10     0.024687    -0.024687    0.0773244      1.13359  1.80345e-10  3.37154e-10   0.00544017   0.00704165         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 0.000254435   -0.0573567  6.08876e-13  4.60408e-11  -0.00347861  1.54312e-05 -3.28119e-10 -5.32729e-10 -3.98608e-12 -0.000547568   -0.0101908 -2.33153e-11     0.017952  -0.00502167    0.0191591 -8.49904e-05 -2.17078e-13  9.08054e-11  5.04397e-11  2.62755e-10     0.600541  2.24927e-10  2.81261e-09  -1.2042e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0573567 -0.000254435 -1.64103e-10  3.70935e-10 -1.54312e-05  -0.00347861 -3.85767e-09 -3.80969e-09  6.45024e-10   -0.0101908  0.000547568  1.38946e-10   0.00502167     0.017952  8.49903e-05    0.0191591 -1.49268e-10 -6.09784e-11 -1.42114e-10 -5.14215e-11  2.24927e-10     0.600541   7.0758e-11  1.66142e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.28189e-10  -3.2127e-10   -0.0423663    0.0423663  6.07612e-10  5.83219e-10   0.00290081   0.00290081 -0.000442465 -1.66949e-09 -1.60312e-09 -0.000216608  1.09726e-10  1.72957e-10   4.0758e-10   8.2788e-10   -0.0160973    0.0160973   0.00532185   0.00532185  3.14887e-09  5.25663e-10      1.98491  2.41611e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.35354e-10 -7.50727e-11   0.00297522   0.00297522  6.91906e-10  2.39676e-10   -0.0207278    0.0207277  4.38566e-09 -1.61925e-09 -1.70044e-09  1.34997e-09 -2.89543e-11  2.51932e-10  9.06717e-11  2.44981e-10   0.00354898   0.00354898  -0.00806608   0.00806608 -9.90994e-10  1.98822e-09  2.74048e-09     0.992043         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
