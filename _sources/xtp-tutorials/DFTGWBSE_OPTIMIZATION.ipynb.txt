{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-02T06:57:39.699792Z",
     "iopub.status.busy": "2022-09-02T06:57:39.699208Z",
     "iopub.status.idle": "2022-09-02T06:58:34.306187Z",
     "shell.execute_reply": "2022-09-02T06:58:34.306596Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2023-dev gitid: 3134d80 (compiled Sep  2 2022, 06:47:45)\r\n",
      "votca_csg, version 2023-dev gitid: 3134d80 (compiled Sep  2 2022, 06:33:31)\r\n",
      "votca_tools, version 2023-dev gitid: 3134d80 (compiled Sep  2 2022, 06:30:40)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 Bohr\r\n",
      "... ... \r\n",
      "... ... =========== OPTIMIZATION SUMMARY ================================= \r\n",
      "... ... At iteration  0\r\n",
      "... ...  ---- POSITIONS (Angstrom)   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    +0.0000  +0.0000  +0.0000\r\n",
      "... ...    1    +1.2000  +0.0000  +0.0000\r\n",
      "... ...    Total energy:     -112.26831841 Hartree \r\n",
      "... ...    Trust radius:       0.01889726 Bohr     \r\n",
      "... ...  ---- FORCES (Hartree/Bohr)   \r\n",
      "... ...       central differences   \r\n",
      "... ...       displacement 0.0010 Angstrom   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    -0.1314  -0.0000  -0.0000\r\n",
      "... ...    1    +0.1314  +0.0000  +0.0000A\r\n",
      "    0.301149 -1.39366e-12  7.71059e-10 -8.91454e-10 -1.21489e-09 -1.05675e-09   -0.0519724  1.02466e-12  -5.9644e-10   -0.0142044    0.0104525 -2.27606e-10    0.0390247 -0.000570445    0.0423984 -8.09055e-13 -1.52304e-10 -3.07225e-10  1.94181e-10 -4.07485e-10     0.107077   0.00210166 -6.30286e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.39365e-12     0.301149 -1.58908e-10  3.17046e-10 -2.10685e-10 -9.02904e-11  1.02472e-12   -0.0519724  7.78516e-12   -0.0104525   -0.0142044  3.44372e-12 -0.000570445   -0.0390247 -8.09066e-13    0.0423984 -2.09771e-10  3.53367e-12 -1.61573e-10  6.65217e-12   0.00210166    -0.107077  -6.0046e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 7.71059e-10 -1.58908e-10     0.391503   -0.0712702    -0.110556    -0.110556  -1.7353e-10  9.06479e-11   -0.0539394 -3.35699e-11  1.20279e-10   -0.0243145  1.88386e-09 -6.36726e-11  1.17467e-10 -2.98037e-11    0.0363658   -0.0108934    0.0169584   -0.0176492  7.95785e-09  4.17198e-10     0.024313          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-8.91454e-10  3.17046e-10   -0.0712702     0.391503     0.110556     0.110556  2.17107e-10 -1.45703e-10    0.0539394  3.41524e-11 -1.25579e-10    0.0243145 -1.90353e-09  3.81402e-11 -2.11735e-10  1.52695e-10    0.0108934   -0.0363658   -0.0176492    0.0169584 -8.04621e-09 -5.35759e-10    -0.024313          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.21489e-09 -2.10685e-10    -0.110556     0.110556     0.460388     0.140155  2.96421e-10  1.10133e-10    0.0733005  1.45119e-10 -3.89478e-11     0.033042 -2.58645e-09 -1.79248e-12 -2.88318e-10 -1.12959e-10    0.0167346    0.0174254   -0.0210564   -0.0262028 -1.09385e-08 -1.62384e-10   0.00960501          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.05675e-09 -9.02904e-11    -0.110556     0.110556     0.140155     0.460388  2.41367e-10  6.65559e-11    0.0733005   1.3982e-10 -3.95303e-11     0.033042 -2.56092e-09 -2.14565e-11 -1.65426e-10 -1.86913e-11    0.0174254    0.0167346    0.0262028    0.0210564  -1.0819e-08  -2.5155e-10   0.00960501          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0519724  1.02472e-12  -1.7353e-10  2.17107e-10  2.96421e-10  2.41367e-10     0.486835 -2.42669e-13  1.72843e-10    0.0109819  -0.00808121  3.80708e-11   0.00830518 -0.000121401    0.0301449   2.9265e-12 -9.03393e-11  1.00335e-10  1.27155e-10  1.35224e-10   -0.0549834  -0.00107919  4.15953e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.02466e-12   -0.0519724  9.06479e-11 -1.45703e-10  1.10133e-10  6.65559e-11 -2.42666e-13     0.486835  6.76032e-13   0.00808121    0.0109819  3.74961e-13 -0.000121401  -0.00830518  2.92651e-12    0.0301449  2.69829e-10  7.44933e-12  2.00218e-10  -9.5438e-12  -0.00107919    0.0549834 -2.31672e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -5.9644e-10  7.78516e-12   -0.0539394    0.0539394    0.0733005    0.0733005  1.72843e-10  6.76032e-13     0.659928  2.70031e-10 -2.04714e-10  -0.00518518  -7.7755e-10  4.29004e-12 -1.32472e-10  3.12303e-13   0.00288366   0.00288366  -0.00380107   0.00380107 -5.24694e-09 -1.72081e-10  -0.00263707          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0142044   -0.0104525 -3.35699e-11  3.41524e-11  1.45119e-10   1.3982e-10    0.0109819   0.00808121  2.70031e-10     0.668107  7.28083e-13 -7.88358e-11  1.34754e-05  -1.0223e-05   -0.0072973  -0.00536984  -2.5819e-11  -3.2643e-11  1.08824e-09 -4.36993e-11   -0.0334798    0.0236381 -7.98248e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0104525   -0.0142044  1.20279e-10 -1.25579e-10 -3.89478e-11 -3.95303e-11  -0.00808121    0.0109819 -2.04714e-10  7.28121e-13     0.668107  5.90986e-11  -1.0223e-05 -1.34754e-05   0.00536984   -0.0072973  1.07308e-09  2.85402e-11 -2.51707e-11  1.83467e-11    0.0236381    0.0334798 -1.12918e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.27606e-10  3.44372e-12   -0.0243145    0.0243145     0.033042     0.033042  3.80708e-11  3.74961e-13  -0.00518518 -7.88358e-11  5.90986e-11     0.793012 -5.00994e-10  3.68878e-12 -7.51918e-11  8.95919e-13   0.00924984   0.00924984   -0.0121926    0.0121926 -1.99949e-09 -6.74576e-11  -0.00107741          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0390247 -0.000570445  1.88386e-09 -1.90353e-09 -2.58645e-09 -2.56092e-09   0.00830518 -0.000121401  -7.7755e-10  1.34754e-05  -1.0223e-05 -5.00994e-10     0.954263 -3.99674e-13   -0.0128737  0.000188182 -1.21848e-09 -1.11165e-09  1.60664e-09 -1.46506e-09   -0.0198846 -0.000681145  1.23299e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-0.000570445   -0.0390247 -6.36726e-11  3.81402e-11 -1.79248e-12 -2.14565e-11 -0.000121401  -0.00830518  4.29004e-12  -1.0223e-05 -1.34754e-05  3.68878e-12 -3.99673e-13     0.954263  0.000188182    0.0128737 -5.55845e-11  8.59927e-11   -5.682e-11 -5.00106e-11  0.000681145   -0.0198846 -3.53238e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0423984 -8.09066e-13  1.17467e-10 -2.11735e-10 -2.88318e-10 -1.65426e-10    0.0301449  2.92651e-12 -1.32472e-10   -0.0072973   0.00536984 -7.51918e-11   -0.0128737  0.000188182     0.973645  1.58435e-12 -1.18106e-10 -3.30729e-11  1.60156e-10 -4.18143e-11    0.0229461  0.000450374 -1.78468e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-8.09056e-13    0.0423984 -2.98037e-11  1.52695e-10 -1.12959e-10 -1.86913e-11   2.9265e-12    0.0301449  3.12303e-13  -0.00536984   -0.0072973  8.95919e-13  0.000188182    0.0128737  1.58435e-12     0.973645  1.26248e-10  7.90591e-12  9.23261e-11 -7.29292e-12  0.000450374   -0.0229461 -5.37602e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.52304e-10 -2.09771e-10    0.0363658    0.0108934    0.0167346    0.0174254 -9.03393e-11  2.69829e-10   0.00288366  -2.5819e-11  1.07308e-09   0.00924984 -1.21848e-09 -5.55845e-11 -1.18106e-10  1.26248e-10      1.03686    0.0176874   -0.0205658    0.0205658 -1.52319e-09  1.53933e-11   0.00299208          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.07225e-10  3.53367e-12   -0.0108934   -0.0363658    0.0174254    0.0167346  1.00335e-10  7.44933e-12   0.00288366  -3.2643e-11  2.85402e-11   0.00924984 -1.11165e-09  8.59927e-11 -3.30729e-11  7.90591e-12    0.0176874      1.03686   -0.0205658    0.0205658 -1.57295e-09 -5.53263e-11   0.00299208          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.94181e-10 -1.61573e-10    0.0169584   -0.0176492   -0.0210564    0.0262028  1.27155e-10  2.00218e-10  -0.00380107  1.08824e-09 -2.51707e-11   -0.0121926  1.60664e-09   -5.682e-11  1.60156e-10  9.23261e-11   -0.0205658   -0.0205658      1.04836   -0.0291938  2.00152e-09  1.12465e-10   0.00434065          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-4.07485e-10  6.65217e-12   -0.0176492    0.0169584   -0.0262028    0.0210564  1.35224e-10  -9.5438e-12   0.00380107 -4.36993e-11  1.83467e-11    0.0121926 -1.46506e-09 -5.00106e-11 -4.18143e-11 -7.29292e-12    0.0205658    0.0205658   -0.0291938      1.04836 -2.07224e-09 -6.27403e-11  -0.00434065          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0745717  -0.00146365 -5.43727e-09  5.45656e-09  7.41571e-09  7.39173e-09    0.0700159   0.00137423   4.1097e-09    0.0248338   -0.0175337  1.74764e-09   0.00919308 -0.000314908   -0.0362818  -0.00071212   1.2332e-09  1.26127e-09  -1.6193e-09  1.66013e-09    -0.195058 -8.52567e-12 -3.81053e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -0.00146365    0.0745717 -4.34871e-10    4.586e-10  3.76936e-11  5.70488e-11   0.00137423   -0.0700159  1.33371e-10   -0.0175337   -0.0248338  5.76167e-11  0.000314908   0.00919308  -0.00071212    0.0362818  -4.1989e-11 -1.37098e-12 -1.14561e-10  8.62952e-11 -8.52567e-12    -0.195058 -6.16279e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.20662e-11  8.01422e-10    0.0055518   -0.0055518    0.0182913    0.0182913 -5.85766e-11  -6.9963e-10    0.0045242 -1.13724e-09 -1.47963e-09   0.00194313  -1.4754e-10  1.20225e-10  1.89069e-11  3.41303e-11   0.00565108   0.00565108   0.00300903  -0.00300903 -8.45891e-10 -6.32049e-09       1.0537          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0903883 -6.21673e-13  2.83555e-10 -3.59939e-10 -4.90834e-10 -3.90483e-10   -0.0326152  6.28436e-13 -3.69431e-10   -0.0119315   0.00878003 -1.51549e-10    0.0481024 -0.000703138    0.0477611 -9.28619e-13 -1.00996e-10     -3.1e-10  1.23964e-10 -4.11793e-10    0.0244238  0.000479377 -4.41611e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.21665e-13    0.0903883 -7.75065e-11  1.77857e-10 -1.22491e-10  -4.6107e-11  6.28469e-13   -0.0326152  4.82168e-12  -0.00878003   -0.0119315   2.3361e-12 -0.000703138   -0.0481024 -9.28624e-13    0.0477611 -2.97185e-10 -9.35628e-12 -2.25934e-10  1.69301e-11  0.000479377   -0.0244238  7.66096e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.83555e-10 -7.75065e-11     0.139019   -0.0341848   -0.0539654   -0.0539654 -8.36762e-11  6.19589e-11   -0.0387514 -2.41624e-11  1.01952e-10   -0.0189152  2.03008e-09 -7.10668e-11  9.90126e-11 -3.06317e-11    0.0545876  -0.00898445    0.0148356   -0.0157649  4.05832e-10 -8.62659e-11    0.0315804         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.59939e-10  1.77857e-10   -0.0341848     0.139019    0.0539654    0.0539654  1.18424e-10 -1.06164e-10    0.0387514  2.47339e-11 -1.08429e-10    0.0189152 -2.05918e-09  3.33433e-11 -2.19895e-10  1.88393e-10   0.00898445   -0.0545876   -0.0157649    0.0148356 -4.76442e-10  -1.0673e-11   -0.0315804         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-4.90834e-10 -1.22491e-10   -0.0539654    0.0539654     0.172643    0.0678093  1.61887e-10  8.05808e-11    0.0526609  1.22816e-10 -2.82885e-11    0.0257047 -2.79767e-09  3.23447e-12 -2.99412e-10 -1.40309e-10    0.0142989    0.0152282   -0.0178705   -0.0457015 -6.51543e-10  -3.6257e-11    0.0289106         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.90483e-10  -4.6107e-11   -0.0539654    0.0539654    0.0678093     0.172643  1.17682e-10  4.58329e-11    0.0526609  1.16339e-10 -2.88599e-11    0.0257047 -2.75995e-09  -2.5861e-11  -1.4165e-10 -1.94267e-11    0.0152282    0.0142989    0.0457015    0.0178705 -5.53935e-10 -1.07563e-10    0.0289106         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0326152  6.28467e-13 -8.36762e-11  1.18424e-10  1.61887e-10  1.17682e-10     0.236624 -1.35922e-13  1.31185e-10    0.0115835  -0.00852391  2.26188e-11   0.00949837 -0.000138843    0.0424653  4.01669e-12 -1.62048e-10  1.22314e-10  2.25779e-10  1.65664e-10   0.00359495  7.05599e-05 -5.88472e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.28435e-13   -0.0326152  6.19589e-11 -1.06164e-10  8.05808e-11  4.58329e-11 -1.35918e-13     0.236624  8.26426e-13   0.00852391    0.0115835  4.88104e-13 -0.000138843  -0.00949837   4.0167e-12    0.0424653  4.04644e-10   1.3202e-11  3.00091e-10 -1.57293e-11  7.05599e-05  -0.00359495 -8.19665e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.69431e-10  4.82168e-12   -0.0387514    0.0387514    0.0526609    0.0526609  1.31185e-10  8.26426e-13     0.424108  3.30565e-10 -2.50314e-10   -0.0112617 -9.33328e-10  4.67152e-12 -1.79934e-10   4.1285e-13  0.000392399  0.000392399 -0.000517236  0.000517236  -1.0963e-09 -3.97231e-11   0.00123687         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0119315  -0.00878003 -2.41624e-11  2.47339e-11  1.22816e-10  1.16339e-10    0.0115835   0.00852391  3.30565e-10     0.446812  9.58182e-13 -1.12272e-10 -0.000385715   0.00029262  -0.00869507  -0.00639841 -4.66693e-11 -5.80341e-11  1.82508e-09 -7.96303e-11   -0.0145106    0.0102451 -1.76554e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  0.00878003   -0.0119315  1.01952e-10 -1.08429e-10 -2.82885e-11 -2.88599e-11  -0.00852391    0.0115835 -2.50314e-10  9.58226e-13     0.446812  8.43967e-11   0.00029262  0.000385715   0.00639841  -0.00869507  1.79795e-09   5.2501e-11 -4.58065e-11  3.44416e-11    0.0102451    0.0145106 -2.39126e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.51549e-10   2.3361e-12   -0.0189152    0.0189152    0.0257047    0.0257047  2.26188e-11  4.88104e-13   -0.0112617 -1.12272e-10  8.43967e-11     0.627074 -6.51482e-10   4.8421e-12 -1.03756e-10  1.33356e-12    0.0132515    0.0132515   -0.0174673    0.0174673 -2.10648e-10 -1.02229e-11  0.000509252         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481024 -0.000703138  2.03008e-09 -2.05918e-09 -2.79767e-09 -2.75995e-09   0.00949837 -0.000138843 -9.33328e-10 -0.000385715   0.00029262 -6.51482e-10     0.912954 -7.12958e-13   -0.0215515  0.000315029 -2.18892e-09 -1.97235e-09  2.88625e-09 -2.59921e-09   -0.0227028 -0.000777681   5.5701e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-0.000703138   -0.0481024 -7.10668e-11  3.33433e-11  3.23447e-12  -2.5861e-11 -0.000138843  -0.00949837  4.67152e-12   0.00029262  0.000385715   4.8421e-12 -7.12954e-13     0.912954  0.000315029    0.0215515 -1.19337e-10    1.677e-10 -1.16347e-10 -1.00226e-10  0.000777681   -0.0227028  1.06588e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0477611 -9.28627e-13  9.90126e-11 -2.19895e-10 -2.99412e-10  -1.4165e-10    0.0424653   4.0167e-12 -1.79934e-10  -0.00869507   0.00639841 -1.03756e-10   -0.0215515  0.000315029     0.952112   3.0101e-12 -1.94247e-10 -5.06422e-11  2.63545e-10 -6.35667e-11  -0.00321143 -6.30323e-05 -2.39974e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-9.28623e-13    0.0477611 -3.06317e-11  1.88393e-10 -1.40309e-10 -1.94267e-11  4.01669e-12    0.0424653   4.1285e-13  -0.00639841  -0.00869507  1.33356e-12  0.000315029    0.0215515  3.01009e-12     0.952112  2.09174e-10  9.19508e-12   1.5291e-10  -9.3054e-12 -6.30323e-05   0.00321143 -4.75832e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.00996e-10 -2.97185e-10    0.0545876   0.00898445    0.0142989    0.0152282 -1.62048e-10  4.04644e-10  0.000392399 -4.66693e-11  1.79795e-09    0.0132515 -2.18892e-09 -1.19337e-10 -1.94247e-10  2.09174e-10      1.07432    0.0333522    -0.038164     0.038164 -4.68853e-10  1.00834e-10    0.0123334         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "    -3.1e-10 -9.35628e-12  -0.00898445   -0.0545876    0.0152282    0.0142989  1.22314e-10   1.3202e-11  0.000392399 -5.80341e-11   5.2501e-11    0.0132515 -1.97235e-09    1.677e-10 -5.06422e-11  9.19508e-12    0.0333522      1.07432    -0.038164     0.038164 -5.90969e-10 -7.30865e-11    0.0123334         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.23964e-10 -2.25934e-10    0.0148356   -0.0157649   -0.0178705    0.0457015  2.25779e-10  3.00091e-10 -0.000517236  1.82508e-09 -4.58065e-11   -0.0174673  2.88625e-09 -1.16347e-10  2.63545e-10   1.5291e-10    -0.038164    -0.038164      1.09567   -0.0547048  6.06965e-10  1.05831e-10    0.0113152         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-4.11793e-10  1.69301e-11   -0.0157649    0.0148356   -0.0457015    0.0178705  1.65664e-10 -1.57293e-11  0.000517236 -7.96303e-11  3.44416e-11    0.0174673 -2.59921e-09 -1.00226e-10 -6.35667e-11  -9.3054e-12     0.038164     0.038164   -0.0547048      1.09567 -7.80577e-10  1.59423e-11   -0.0113152         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0559707   0.00109856  3.90315e-09 -3.97067e-09 -5.40335e-09 -5.31047e-09    0.0025978  5.09882e-05 -1.12627e-09  -0.00901179    0.0063627 -2.80059e-10   -0.0177726  0.000608797   -0.0179746 -0.000352797  5.48547e-11  7.73593e-11 -6.31002e-11  9.79061e-11     0.583856 -9.31305e-12 -2.85627e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  0.00109856   -0.0559707  8.58066e-11 -1.77831e-10 -1.35215e-10 -2.03633e-10  5.09882e-05   -0.0025978 -3.55301e-11    0.0063627   0.00901179 -9.02922e-12 -0.000608797   -0.0177726 -0.000352797    0.0179746 -1.41491e-10 -1.07018e-10 -1.14111e-10  9.12617e-11  -9.3131e-12     0.583856 -4.58266e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.88827e-11  4.39473e-10    0.0321964   -0.0321964     0.028874     0.028874 -3.49503e-12 -8.79063e-10   0.00262596 -1.62765e-09 -2.20179e-09   0.00134323 -9.54253e-11  7.03236e-11 -4.72144e-12 -6.04713e-10    0.0137422    0.0137422    0.0109217   -0.0109217  -7.8531e-10  -5.0859e-09      2.11611         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
