{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-12-24T16:08:00.653320Z",
     "iopub.status.busy": "2022-12-24T16:08:00.652819Z",
     "iopub.status.idle": "2022-12-24T16:09:05.089107Z",
     "shell.execute_reply": "2022-12-24T16:09:05.088411Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2023-dev gitid: b7a2614 (compiled Dec 24 2022, 15:59:54)\r\n",
      "votca_csg, version 2023-dev gitid: b7a2614 (compiled Dec 24 2022, 15:45:27)\r\n",
      "votca_tools, version 2023-dev gitid: b7a2614 (compiled Dec 24 2022, 15:42:49)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 Bohr\r\n",
      "... ... \r\n",
      "... ... =========== OPTIMIZATION SUMMARY ================================= \r\n",
      "... ... At iteration  0\r\n",
      "... ...  ---- POSITIONS (Angstrom)   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    +0.0000  +0.0000  +0.0000\r\n",
      "... ...    1    +1.2000  +0.0000  +0.0000\r\n",
      "... ...    Total energy:     -112.26831841 Hartree \r\n",
      "... ...    Trust radius:       0.01889726 Bohr     \r\n",
      "... ...  ---- FORCES (Hartree/Bohr)   \r\n",
      "... ...       central differences   \r\n",
      "... ...       displacement 0.0010 Angstrom   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    -0.1314  -0.0000  -0.0000\r\n",
      "... ...    1    +0.1314  +0.0000  +0.0000A\r\n",
      "    0.301149 -1.39146e-12  7.64923e-10 -8.81133e-10 -1.20407e-09 -1.04616e-09   -0.0519724  1.01994e-12  5.92029e-10    0.0142233   -0.0104268  2.25008e-10   -0.0390253  0.000526395    0.0423984   -8.046e-13  1.49748e-10  3.05192e-10  -1.9286e-10  4.06483e-10    -0.107077  -0.00213404 -6.21665e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.39146e-12     0.301149 -1.49143e-10   3.0705e-10 -2.18539e-10 -1.02328e-10  1.01988e-12   -0.0519724 -2.96546e-12    0.0104268    0.0142233 -6.49628e-13  0.000526395    0.0390253 -8.04586e-13    0.0423984  2.11707e-10 -1.91642e-12  1.59534e-10 -4.09074e-12  -0.00213404     0.107077 -5.83408e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 7.64923e-10 -1.49143e-10     0.391103   -0.0708702     -0.11043     -0.11043 -1.82005e-10  9.51526e-11    0.0538066  3.41528e-11 -1.16105e-10    0.0242546 -1.88383e-09  5.75194e-11  1.22855e-10 -3.06391e-11   -0.0364478    0.0108121   -0.0169521    0.0175896 -7.91308e-09 -3.82487e-10    0.0243937          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-8.81133e-10   3.0705e-10   -0.0708702     0.391103      0.11043      0.11043  2.20475e-10 -1.49704e-10   -0.0538066 -3.36432e-11   1.2039e-10   -0.0242546  1.90359e-09  -3.1903e-11  -2.1211e-10  1.52999e-10   -0.0108121    0.0364478    0.0175896   -0.0169521  7.99427e-09  5.00222e-10   -0.0243937          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.20407e-09 -2.18539e-10     -0.11043      0.11043     0.460788     0.140555  3.02858e-10  9.96474e-11    -0.073398 -1.43552e-10   3.3414e-11   -0.0330859  2.59657e-09  9.82487e-12 -2.89845e-10 -1.06757e-10   -0.0167456   -0.0173831    0.0211382    0.0261217  1.09091e-08   1.2328e-10   0.00947031          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.04616e-09 -1.02328e-10     -0.11043      0.11043     0.140555     0.460788  2.48307e-10  6.11777e-11    -0.073398 -1.39267e-10  3.29045e-11   -0.0330859  2.57095e-09  2.95855e-11 -1.67485e-10 -1.75016e-11   -0.0173831   -0.0167456   -0.0261217   -0.0211382  1.07904e-08  2.05321e-10   0.00947031          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0519724  1.01988e-12 -1.82005e-10  2.20475e-10  3.02858e-10  2.48307e-10     0.486835 -2.44534e-13 -1.77663e-10   -0.0109965   0.00806132 -3.96544e-11  -0.00830531  0.000112027    0.0301449  2.91486e-12  9.00691e-11 -1.00979e-10 -1.26846e-10 -1.35871e-10    0.0549831   0.00109581   4.1816e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.01994e-12   -0.0519724  9.51526e-11 -1.49704e-10  9.96474e-11  6.11777e-11 -2.44535e-13     0.486835  4.00985e-12  -0.00806132   -0.0109965  1.15258e-12  0.000112027   0.00830531  2.91484e-12    0.0301449 -2.70041e-10 -7.32394e-12 -2.00595e-10  9.54741e-12   0.00109581   -0.0549831 -2.31336e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.92029e-10 -2.96546e-12    0.0538066   -0.0538066    -0.073398    -0.073398 -1.77663e-10  4.00985e-12     0.659928  2.69895e-10 -1.99412e-10  -0.00518518 -7.77966e-10  3.32484e-12  1.34331e-10 -2.17937e-12   0.00287248   0.00287248  -0.00380953   0.00380953 -5.23209e-09 -1.56134e-10   0.00268094          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0142233    0.0104268  3.41528e-11 -3.36432e-11 -1.43552e-10 -1.39267e-10   -0.0109965  -0.00806132  2.69895e-10     0.668107  7.27402e-13 -7.90079e-11  1.35053e-05 -1.01834e-05     0.007307   0.00535662 -2.62288e-11 -2.96772e-11  1.09095e-09 -4.37162e-11   -0.0335296    0.0235673  8.02245e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0104268    0.0142233 -1.16105e-10   1.2039e-10   3.3414e-11  3.29045e-11   0.00806132   -0.0109965 -1.99412e-10  7.27493e-13     0.668107  5.91026e-11 -1.01834e-05 -1.35053e-05  -0.00535662     0.007307  1.07633e-09  2.91016e-11 -2.61904e-11   2.2742e-11    0.0235673    0.0335296  1.13235e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.25008e-10 -6.49628e-13    0.0242546   -0.0242546   -0.0330859   -0.0330859 -3.96544e-11  1.15258e-12  -0.00518518 -7.90079e-11  5.91026e-11     0.793012 -5.03133e-10  1.22108e-12  7.47809e-11 -4.81283e-13   0.00921397   0.00921397   -0.0122197    0.0122197 -1.99136e-09 -5.86864e-11   0.00109624          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0390253  0.000526395 -1.88383e-09  1.90359e-09  2.59657e-09  2.57095e-09  -0.00830531  0.000112027 -7.77966e-10  1.35053e-05 -1.01834e-05 -5.03133e-10     0.954263 -3.99464e-13    0.0128739 -0.000173651 -1.21534e-09 -1.11016e-09  1.61289e-09 -1.47127e-09   -0.0198852 -0.000664714 -1.24676e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 0.000526395    0.0390253  5.75194e-11  -3.1903e-11  9.82487e-12  2.95855e-11  0.000112027   0.00830531  3.32484e-12 -1.01834e-05 -1.35053e-05  1.22108e-12 -3.99454e-13     0.954263 -0.000173651   -0.0128739 -5.85073e-11  8.31133e-11 -5.21058e-11 -5.30671e-11  0.000664714   -0.0198852  3.45498e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0423984 -8.04587e-13  1.22855e-10  -2.1211e-10 -2.89845e-10 -1.67485e-10    0.0301449  2.91484e-12  1.34331e-10     0.007307  -0.00535662  7.47809e-11    0.0128739 -0.000173651     0.973645  1.57485e-12  1.19461e-10  3.20568e-11 -1.61065e-10  4.22383e-11    -0.022946 -0.000457313 -1.88117e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-8.04601e-13    0.0423984 -3.06391e-11  1.52999e-10 -1.06757e-10 -1.75016e-11  2.91486e-12    0.0301449 -2.17937e-12   0.00535662     0.007307 -4.81283e-13 -0.000173651   -0.0128739  1.57485e-12     0.973645 -1.26952e-10 -8.12558e-12 -9.27883e-11  5.38377e-12 -0.000457313     0.022946 -5.38865e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.49748e-10  2.11707e-10   -0.0364478   -0.0108121   -0.0167456   -0.0173831  9.00691e-11 -2.70041e-10   0.00287248 -2.62288e-11  1.07633e-09   0.00921397 -1.21534e-09 -5.85073e-11  1.19461e-10 -1.26952e-10      1.03674    0.0175666   -0.0205316    0.0205316 -1.51294e-09  2.07783e-11   -0.0029963          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.05192e-10 -1.91642e-12    0.0108121    0.0364478   -0.0173831   -0.0167456 -1.00979e-10 -7.32394e-12   0.00287248 -2.96772e-11  2.91016e-11   0.00921397 -1.11016e-09  8.31133e-11  3.20568e-11 -8.12558e-12    0.0175666      1.03674   -0.0205316    0.0205316 -1.56179e-09 -4.99142e-11   -0.0029963          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -1.9286e-10  1.59534e-10   -0.0169521    0.0175896    0.0211382   -0.0261217 -1.26846e-10 -2.00595e-10  -0.00380953  1.09095e-09 -2.61904e-11   -0.0122197  1.61289e-09 -5.21058e-11 -1.61065e-10 -9.27883e-11   -0.0205316   -0.0205316      1.04848   -0.0293146  1.99973e-09  1.05313e-10  -0.00434069          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.06483e-10 -4.09074e-12    0.0175896   -0.0169521    0.0261217   -0.0211382 -1.35871e-10  9.54741e-12   0.00380953 -4.37162e-11   2.2742e-11    0.0122197 -1.47127e-09 -5.30671e-11  4.22383e-11  5.38377e-12    0.0205316    0.0205316   -0.0293146      1.04848 -2.07042e-09  -5.6484e-11   0.00434069          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0745713   0.00148621  5.41217e-09 -5.42658e-09 -7.40187e-09 -7.37855e-09   -0.0700155  -0.00139541  4.09954e-09    0.0248708   -0.0174812  1.74141e-09   0.00919334 -0.000307311    0.0362816  0.000723092  1.22491e-09  1.25356e-09 -1.61925e-09  1.66025e-09    -0.195058 -8.53074e-12  3.98909e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  0.00148621   -0.0745713  4.16589e-10 -4.39645e-10 -1.93791e-11 -3.39012e-11  -0.00139541    0.0700155   1.2269e-10   -0.0174812   -0.0248708  5.09996e-11  0.000307311   0.00919334  0.000723092   -0.0362816 -4.51563e-11 -4.36282e-12 -1.10494e-10  8.16468e-11 -8.53072e-12    -0.195058  6.14409e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.20732e-11  8.00214e-10   0.00553516  -0.00553516    0.0183384    0.0183384 -5.83141e-11  -7.0016e-10  -0.00455422  1.13951e-09  1.48245e-09   -0.0019556  1.49236e-10 -1.19756e-10  1.59191e-11  3.11368e-11  -0.00566924  -0.00566924  -0.00297838   0.00297838   8.6033e-10  6.30042e-09       1.0531          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0903883 -6.20566e-13   2.8191e-10 -3.55663e-10 -4.86217e-10 -3.86015e-10   -0.0326152  6.25487e-13  3.66711e-10    0.0119474  -0.00875841  1.49744e-10   -0.0481031  0.000648842    0.0477611 -9.23465e-13  9.86172e-11  3.08419e-10 -1.22845e-10  4.11116e-10   -0.0244236 -0.000486763 -4.37916e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.20567e-13    0.0903883 -7.33761e-11  1.73578e-10 -1.24886e-10 -5.11322e-11  6.25452e-13   -0.0326152 -1.83578e-12   0.00875841    0.0119474  -3.8898e-13  0.000648842    0.0481031 -9.23448e-13    0.0477611  2.99031e-10  1.07605e-11  2.24223e-10 -1.44216e-11 -0.000486763    0.0244236  7.66092e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  2.8191e-10 -7.33761e-11     0.138824   -0.0339896   -0.0539042   -0.0539042 -8.93451e-11  6.47942e-11     0.038656  2.49008e-11 -9.92539e-11    0.0188687 -2.02932e-09  6.52069e-11  1.05763e-10 -3.17578e-11   -0.0546597   0.00891332   -0.0148295     0.015687 -4.00095e-10  9.28438e-11     0.031645         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.55663e-10  1.73578e-10   -0.0339896     0.138824    0.0539042    0.0539042  1.20532e-10 -1.08667e-10    -0.038656  -2.4424e-11  1.04762e-10   -0.0188687  2.05847e-09 -2.73684e-11 -2.20511e-10  1.88878e-10  -0.00891332    0.0546597     0.015687   -0.0148295  4.68384e-10  3.94267e-12    -0.031645         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-4.86217e-10 -1.24886e-10   -0.0539042    0.0539042     0.172839    0.0680046  1.65858e-10  7.36653e-11    -0.052731 -1.21505e-10  2.47346e-11   -0.0257389  2.80755e-09  4.44286e-12 -3.01336e-10 -1.32618e-10   -0.0143342   -0.0151917    0.0179421     0.045631  6.44109e-10  2.85162e-11    0.0288209         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.86015e-10 -5.11322e-11   -0.0539042    0.0539042    0.0680046     0.172839  1.21985e-10  4.24782e-11    -0.052731 -1.15997e-10  2.42578e-11   -0.0257389  2.76971e-09  3.35913e-11 -1.44216e-10 -1.78699e-11   -0.0151917   -0.0143342    -0.045631   -0.0179421  5.46652e-10  9.74943e-11    0.0288209         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0326152  6.25454e-13 -8.93451e-11  1.20532e-10  1.65858e-10  1.21985e-10     0.236624 -1.37749e-13 -1.35483e-10   -0.0115989   0.00850293 -2.41288e-11  -0.00949852  0.000128121    0.0424653  3.99996e-12  1.62067e-10  -1.2308e-10 -2.25916e-10 -1.66058e-10  -0.00359493 -7.16471e-05 -5.52522e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.25488e-13   -0.0326152  6.47942e-11 -1.08667e-10  7.36653e-11  4.24782e-11 -1.37748e-13     0.236624  3.37393e-12  -0.00850293   -0.0115989  9.80341e-13  0.000128121   0.00949852  3.99993e-12    0.0424653 -4.05338e-10 -1.33639e-11 -3.00251e-10  1.51048e-11 -7.16471e-05   0.00359493 -8.19893e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.66711e-10 -1.83578e-12     0.038656    -0.038656    -0.052731    -0.052731 -1.35483e-10  3.37393e-12     0.424108  3.30482e-10 -2.44486e-10   -0.0112617 -9.32861e-10  4.46775e-12  1.82485e-10 -2.97058e-12  0.000390877  0.000390877 -0.000518387  0.000518387 -1.09252e-09 -3.55885e-11  -0.00121441         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0119474   0.00875841  2.49008e-11  -2.4424e-11 -1.21505e-10 -1.15997e-10   -0.0115989  -0.00850293  3.30482e-10     0.446812  9.57028e-13 -1.12453e-10 -0.000386573  0.000291486   0.00870664   0.00638266  -4.7296e-11 -5.30972e-11  1.82946e-09  -7.9581e-11   -0.0145322    0.0102144  1.77126e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " -0.00875841    0.0119474 -9.92539e-11  1.04762e-10  2.47346e-11  2.42578e-11   0.00850293   -0.0115989 -2.44486e-10  9.57144e-13     0.446812  8.38756e-11  0.000291486  0.000386573  -0.00638266   0.00870664  1.80282e-09  5.29476e-11 -4.68861e-11  4.10848e-11    0.0102144    0.0145322  2.39677e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.49744e-10  -3.8898e-13    0.0188687   -0.0188687   -0.0257389   -0.0257389 -2.41288e-11  9.80341e-13   -0.0112617 -1.12453e-10  8.38756e-11     0.627074 -6.54358e-10  1.54193e-12  1.02977e-10 -5.60862e-13    0.0132001    0.0132001   -0.0175062    0.0175062 -2.08767e-10 -8.16321e-12 -0.000497703         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0481031  0.000648842 -2.02932e-09  2.05847e-09  2.80755e-09  2.76971e-09  -0.00949852  0.000128121 -9.32861e-10 -0.000386573  0.000291486 -6.54358e-10     0.912954  -7.1227e-13    0.0215518 -0.000290703 -2.18283e-09 -1.96957e-09  2.89711e-09 -2.60998e-09   -0.0227034 -0.000758921 -5.59515e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 0.000648842    0.0481031  6.52069e-11 -2.73684e-11  4.44286e-12  3.35913e-11  0.000128121   0.00949852  4.46775e-12  0.000291486  0.000386573  1.54193e-12 -7.12253e-13     0.912954 -0.000290703   -0.0215518 -1.24343e-10  1.62788e-10 -1.08117e-10 -1.05135e-10  0.000758921   -0.0227034 -1.07532e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0477611  -9.2345e-13  1.05763e-10 -2.20511e-10 -3.01336e-10 -1.44216e-10    0.0424653  3.99992e-12  1.82485e-10   0.00870664  -0.00638266  1.02977e-10    0.0215518 -0.000290703     0.952112  2.99143e-12  1.96603e-10  4.87952e-11 -2.65097e-10  6.42735e-11   0.00321142  6.40036e-05  -6.7801e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-9.23464e-13    0.0477611 -3.17578e-11  1.88878e-10 -1.32618e-10 -1.78699e-11  3.99996e-12    0.0424653 -2.97058e-12   0.00638266   0.00870664 -5.60862e-13 -0.000290703   -0.0215518  2.99143e-12     0.952112 -2.10405e-10 -9.58162e-12  -1.5384e-10  6.03192e-12  6.40036e-05  -0.00321142 -4.80567e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 9.86172e-11  2.99031e-10   -0.0546597  -0.00891332   -0.0143342   -0.0151917  1.62067e-10 -4.05338e-10  0.000390877  -4.7296e-11  1.80282e-09    0.0132001 -2.18283e-09 -1.24343e-10  1.96603e-10 -2.10405e-10       1.0741    0.0331281   -0.0381006    0.0381006 -4.65738e-10  1.04089e-10   -0.0123643         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.08419e-10  1.07605e-11   0.00891332    0.0546597   -0.0151917   -0.0143342  -1.2308e-10 -1.33639e-11  0.000390877 -5.30972e-11  5.29476e-11    0.0132001 -1.96957e-09  1.62788e-10  4.87952e-11 -9.58162e-12    0.0331281       1.0741   -0.0381006    0.0381006  -5.8622e-10 -6.98109e-11   -0.0123643         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.22845e-10  2.24223e-10   -0.0148295     0.015687    0.0179421    -0.045631 -2.25916e-10 -3.00251e-10 -0.000518387  1.82946e-09 -4.68861e-11   -0.0175062  2.89711e-09 -1.08117e-10 -2.65097e-10  -1.5384e-10   -0.0381006   -0.0381006       1.0959   -0.0549289  6.04861e-10  1.01933e-10   -0.0112757         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.11116e-10 -1.44216e-11     0.015687   -0.0148295     0.045631   -0.0179421 -1.66058e-10  1.51048e-11  0.000518387  -7.9581e-11  4.10848e-11    0.0175062 -2.60998e-09 -1.05135e-10  6.42735e-11  6.03192e-12    0.0381006    0.0381006   -0.0549289       1.0959 -7.78453e-10  1.82158e-11    0.0112757         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0559703  -0.00111549  -3.8781e-09  3.94222e-09  5.38605e-09   5.2935e-09  -0.00259778 -5.17739e-05 -1.12224e-09  -0.00902521   0.00634365  -2.7867e-10   -0.0177731  0.000594111    0.0179745  0.000358233  5.20804e-11  7.79898e-11 -6.29117e-11  9.83467e-11     0.583856 -9.32097e-12  3.04759e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " -0.00111549    0.0559703 -6.59238e-11  1.57614e-10  1.10995e-10  1.75994e-10 -5.17739e-05   0.00259778 -3.08314e-11   0.00634365   0.00902521 -7.33001e-12 -0.000594111   -0.0177731  0.000358233   -0.0179745 -1.41909e-10 -1.06808e-10 -1.14718e-10  8.84644e-11 -9.32095e-12     0.583856  4.55922e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.81531e-11   4.4006e-10    0.0322592   -0.0322592    0.0287853    0.0287853 -2.43923e-12 -8.78765e-10  -0.00262005  1.63449e-09    2.207e-09  -0.00134118  9.69671e-11  -7.0837e-11 -9.32567e-12 -6.09432e-10   -0.0137792   -0.0137792   -0.0108685    0.0108685  8.00185e-10  5.06228e-09      2.11521         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
