{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-07-07T21:53:58.051210Z",
     "iopub.status.busy": "2022-07-07T21:53:58.050613Z",
     "iopub.status.idle": "2022-07-07T21:54:54.161658Z",
     "shell.execute_reply": "2022-07-07T21:54:54.162142Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2023-dev gitid: 231177b (compiled Jul  7 2022, 21:44:07)\r\n",
      "votca_csg, version 2023-dev gitid: 231177b (compiled Jul  7 2022, 21:25:37)\r\n",
      "votca_tools, version 2023-dev gitid: 231177b (compiled Jul  7 2022, 21:22:13)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 Bohr\r\n",
      "... ... \r\n",
      "... ... =========== OPTIMIZATION SUMMARY ================================= \r\n",
      "... ... At iteration  0\r\n",
      "... ...  ---- POSITIONS (Angstrom)   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    +0.0000  +0.0000  +0.0000\r\n",
      "... ...    1    +1.2000  +0.0000  +0.0000\r\n",
      "... ...    Total energy:     -112.26831841 Hartree \r\n",
      "... ...    Trust radius:       0.01889726 Bohr     \r\n",
      "... ...  ---- FORCES (Hartree/Bohr)   \r\n",
      "... ...       central differences   \r\n",
      "... ...       displacement 0.0010 Angstrom   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    -0.1314  -0.0000  -0.0000\r\n",
      "... ...    1    +0.1314  +0.0000  +0.0000A\r\n",
      "    0.301149  5.18432e-14  5.02553e-13  2.46052e-12  4.02344e-14    0.0519724 -2.10147e-13  2.10727e-13  6.02356e-14   -0.0176326  0.000336938 -3.57151e-14   0.00352297    0.0388695  -3.2031e-14   -0.0423984  -2.1313e-13  1.57772e-13   4.6062e-14 -1.25602e-14 -0.000145455    -0.107098 -1.01285e-12  7.07229e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.18739e-14     0.301149 -2.11763e-13 -2.12386e-13    0.0519724  4.02633e-14 -8.65933e-12  1.06173e-11  3.19581e-12  0.000336938    0.0176326 -1.88875e-12    0.0388695  -0.00352297   -0.0423984 -3.20756e-14 -1.00201e-13 -1.33693e-13  1.82945e-12 -1.45858e-12    -0.107098  0.000145455  3.46213e-14 -8.73903e-15          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.02553e-13 -2.11763e-13     0.310234  -0.00999962  9.98179e-14 -3.29328e-13   0.00442386  -0.00442386  -0.00173873  1.84283e-14 -8.04459e-14  0.000783775  1.03257e-13 -9.25884e-14 -2.08918e-14 -2.28159e-14    0.0490627   0.00199139 -0.000507203  -0.00375914  7.04561e-13  7.94327e-14   -0.0247894   -0.0217386          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.46052e-12 -2.12386e-13  -0.00999962     0.310234  9.92959e-14  2.23915e-12   0.00442386  -0.00442386  -0.00173873 -7.45114e-13 -6.60613e-14  0.000783775  9.48605e-14 -1.86719e-13 -2.02588e-14 -2.39026e-12   0.00199139    0.0490627   0.00375914  0.000507203  7.00702e-13 -3.47266e-12   -0.0247894    0.0217386          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.02487e-14    0.0519724  9.98179e-14  9.92959e-14     0.486835  7.65079e-15  7.43269e-12 -4.86432e-12 -3.33126e-12  0.000260498    0.0136323  1.07988e-12  -0.00827215  0.000749752    0.0301449 -1.13429e-13  4.87912e-14  1.94009e-14 -2.82764e-13  6.08693e-13   -0.0549939  7.46902e-05  -4.2702e-14  1.48468e-15          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0519724  4.02818e-14 -3.29328e-13  2.23915e-12  7.61656e-15     0.486835  9.86889e-14 -9.82302e-14 -6.32093e-14   -0.0136323  0.000260498  2.04162e-14 -0.000749752  -0.00827215 -1.13439e-13    0.0301449 -2.80518e-13  4.53424e-14 -2.18744e-15  3.15641e-14 -7.46902e-05   -0.0549939 -2.16667e-14  2.05672e-15          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.10147e-13 -8.65933e-12   0.00442386   0.00442386  7.43269e-12  9.86889e-14     0.541658    -0.221425    -0.090991  1.37394e-14 -3.45809e-12    0.0410164   5.6335e-12 -3.97858e-13  -3.4477e-12 -2.07925e-14   0.00237708  -0.00188926    0.0132571    0.0338142  3.33774e-11  6.22205e-13 -0.000619964 -0.000192369          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.10727e-13  1.06173e-11  -0.00442386  -0.00442386 -4.86432e-12 -9.82302e-14    -0.221425     0.541658     0.090991  6.24283e-16  4.22161e-12   -0.0410164 -5.72764e-12  4.06258e-13  1.08023e-12  2.01324e-14   0.00188926  -0.00237708    0.0338142    0.0132571 -3.68446e-11 -6.18342e-13  0.000619964 -0.000192369          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 6.02356e-14  3.19581e-12  -0.00173873  -0.00173873 -3.33126e-12 -6.32093e-14    -0.090991     0.090991     0.659928  5.40838e-16  2.40816e-12   0.00518522 -2.95969e-13  2.09196e-14  1.34694e-12  2.57859e-14 -0.000339807 -0.000339807   0.00475899  -0.00475899 -9.73304e-12 -1.59504e-13   0.00043515  6.43339e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0176326  0.000336938  1.84282e-14 -7.45114e-13  0.000260498   -0.0136323  1.37394e-14  6.24247e-16   5.4092e-16     0.668107  5.38463e-16  1.32453e-16  1.20447e-06  1.68685e-05 -0.000173096   0.00905845  1.64767e-12  -2.2404e-13 -1.60516e-14   -1.171e-13 -0.000727353    0.0409771  3.14846e-12  1.09252e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 0.000336938    0.0176326 -8.04459e-14 -6.60613e-14    0.0136323  0.000260498 -3.45809e-12  4.22161e-12  2.40816e-12  5.91083e-16     0.668107 -8.45085e-14 -1.68685e-05  1.20447e-06  -0.00905845 -0.000173096 -4.42618e-14  -1.7743e-13   2.4916e-12 -6.19899e-13   -0.0409771 -0.000727353  6.44645e-15 -9.86313e-15          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.57151e-14 -1.88875e-12  0.000783775  0.000783775  1.07988e-12  2.04162e-14    0.0410164   -0.0410164   0.00518522  1.32491e-16 -8.45086e-14     0.793012  1.49824e-12 -1.06937e-13  2.67883e-13  4.94835e-15   0.00108999   0.00108999   -0.0152653    0.0152653  5.52976e-12  9.24734e-14 -0.000180443 -2.55805e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  0.00352297    0.0388695  1.03257e-13  9.48605e-14  -0.00827215 -0.000749752   5.6335e-12 -5.72764e-12 -2.95969e-13  1.20447e-06 -1.68685e-05  1.49824e-12     0.954263  5.80445e-14    0.0128225   0.00116218  1.74843e-13  1.74637e-13 -2.15015e-12  2.82703e-12    0.0198175   0.00176904  1.71411e-15  -4.9353e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0388695  -0.00352297 -9.25884e-14 -1.86719e-13  0.000749752  -0.00827215 -3.97858e-13  4.06258e-13  2.09196e-14  1.68685e-05  1.20447e-06 -1.06937e-13  5.80057e-14     0.954263  -0.00116218    0.0128225 -3.92633e-13   2.8423e-13  1.74387e-13 -1.74188e-13  -0.00176904    0.0198175  3.10403e-13 -6.27449e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.20454e-14   -0.0423984 -2.08918e-14 -2.02588e-14    0.0301449 -1.13417e-13  -3.4477e-12  1.08023e-12  1.34694e-12 -0.000173096  -0.00905845  2.67883e-13    0.0128225  -0.00116218     0.973646 -6.38449e-14  2.34407e-14 -9.12893e-14  1.09596e-12  1.68034e-13    0.0229505 -3.11703e-05  2.66725e-14 -6.94907e-16          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0423984 -3.20833e-14 -2.28159e-14 -2.39026e-12 -1.13429e-13    0.0301449 -2.07926e-14  2.01323e-14  2.57859e-14   0.00905845 -0.000173096  4.94835e-15   0.00116218    0.0128225 -6.38751e-14     0.973646 -5.84351e-13  6.79562e-13    6.967e-14  4.49767e-14  3.11703e-05    0.0229505 -7.39527e-13  6.72181e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -2.1313e-13 -1.00201e-13    0.0490627   0.00199139  4.87912e-14 -2.80518e-13   0.00237708   0.00188926 -0.000339807  1.64767e-12 -4.42618e-14   0.00108999  1.74843e-13 -3.92633e-13  2.34407e-14 -5.84351e-13      1.02147   0.00230192  -0.00303421   0.00303421  4.00454e-13 -1.63987e-13  -0.00474637 -2.64344e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.57772e-13 -1.33693e-13   0.00199139    0.0490627  1.94009e-14  4.53424e-14  -0.00188926  -0.00237708 -0.000339807  -2.2404e-13  -1.7743e-13   0.00108999  1.74637e-13   2.8423e-13 -9.12893e-14  6.79562e-13   0.00230192      1.02147  -0.00303421   0.00303421  3.62865e-13  2.67083e-13  -0.00474637  2.64344e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  4.6062e-14  1.82945e-12 -0.000507203   0.00375914 -2.82764e-13 -2.18744e-15    0.0132571    0.0338142   0.00475899 -1.60516e-14   2.4916e-12   -0.0152653 -2.15015e-12  1.74387e-13  1.09596e-12    6.967e-14  -0.00303421  -0.00303421      1.06375   -0.0445793 -5.14696e-12 -6.72726e-14  -0.00017288 -5.27547e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.25602e-14 -1.45858e-12  -0.00375914  0.000507203  6.08693e-13  3.15641e-14    0.0338142    0.0132571  -0.00475899   -1.171e-13 -6.19899e-13    0.0152653  2.82703e-12 -1.74188e-13  1.68034e-13  4.49767e-14   0.00303421   0.00303421   -0.0445793      1.06375  5.56695e-12  1.05941e-13   0.00017288 -5.27547e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 0.000101299     0.074586 -3.56634e-13 -3.53797e-13    0.0700293  9.51106e-05 -1.57649e-11  1.81949e-11  6.31894e-12   0.00053952    0.0303951 -4.11899e-12  -0.00916204  0.000817864   -0.0362887 -4.92857e-05 -2.07207e-13 -2.35589e-13  3.19833e-12 -2.88071e-12    -0.195058 -2.71156e-13  3.14184e-13  4.19874e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "    0.074586 -0.000101299  3.71606e-13  2.88041e-12 -9.51106e-05    0.0700293 -3.04818e-13  3.02187e-13   1.0046e-13   -0.0303951   0.00053952 -6.78617e-14 -0.000817864  -0.00916204  4.92857e-05   -0.0362887   9.1695e-14  3.96334e-13  8.05406e-14  -5.3333e-14 -2.71129e-13    -0.195058 -1.15761e-11 -3.30684e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.38666e-13 -3.57039e-14   -0.0140645   -0.0140645  4.81824e-14  5.14099e-14   0.00142457  -0.00142457 -0.000459744  2.42491e-12 -1.05907e-14  0.000191726  2.39282e-14 -1.40262e-14  2.21976e-14  -2.0394e-12  -0.00607301  -0.00607301 -0.000591408  0.000591408  4.06917e-13 -1.09077e-11     0.941414 -6.66705e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 9.72196e-14 -1.57799e-15   0.00721542  -0.00721542  2.22474e-14 -2.17076e-12  3.32043e-05  3.32043e-05 -4.27638e-13  1.83351e-12 -1.68505e-14  1.73082e-13 -5.13607e-14   -6.402e-13 -1.87179e-15  1.05166e-13  -0.00444249   0.00444249   0.00036099   0.00036099  5.57545e-14 -4.61241e-12 -6.76092e-11    0.0438928          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0903884  2.29282e-14  2.39816e-13  1.46726e-12  2.46072e-14    0.0326152 -8.91484e-14  8.94976e-14  3.72939e-14   -0.0148112  0.000283025 -2.49478e-14   0.00434246    0.0479111 -3.66778e-14   -0.0477612 -3.00794e-13  2.48236e-13  4.88009e-14  8.10198e-16 -3.31776e-05   -0.0244285 -2.37061e-13  4.27675e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  2.2948e-14    0.0903884 -8.97362e-14 -9.01077e-14    0.0326152  2.46217e-14  -3.2509e-12  4.47831e-12  1.97994e-12  0.000283025    0.0148112 -1.31842e-12    0.0479111  -0.00434246   -0.0477612 -3.67338e-14 -7.17176e-14 -1.21316e-13  1.63224e-12 -1.08326e-12   -0.0244285  3.31776e-05 -7.85789e-15 -6.37476e-15         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.39816e-13 -8.97362e-14    0.0993489   -0.0054853  6.24719e-14 -2.21149e-13   0.00215942  -0.00215942  -0.00124915  1.28325e-14 -5.61814e-14  0.000609731  9.45521e-14 -9.11973e-14 -2.75607e-14 -1.18332e-14    0.0655987   0.00227933 -0.000394701  -0.00534429  1.40233e-13  4.85752e-13   -0.0407551    -0.014586         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.46726e-12 -9.01077e-14   -0.0054853    0.0993489  6.21141e-14  1.56632e-12   0.00215942  -0.00215942  -0.00124915 -7.19656e-13 -4.23655e-14  0.000609731  8.62761e-14 -1.84205e-13 -2.67848e-14 -2.89851e-12   0.00227933    0.0655987   0.00534429  0.000394701  1.39235e-13 -5.76334e-13   -0.0407551     0.014586         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.46187e-14    0.0326152  6.24719e-14  6.21141e-14     0.236624  3.61132e-15  4.81509e-12 -3.02769e-12 -2.97919e-12  0.000274768    0.0143791  1.03398e-12   -0.0094606  0.000857468    0.0424654 -1.55802e-13  4.57894e-14 -8.76872e-15  8.55764e-14   5.1868e-13   0.00359567 -4.88347e-06  4.12897e-16  2.22829e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0326152  2.46368e-14 -2.21149e-13  1.56632e-12   3.5757e-15     0.236624  6.16982e-14 -6.13829e-14 -5.65186e-14   -0.0143791  0.000274768  1.95261e-14 -0.000857468   -0.0094606 -1.55826e-13    0.0424654 -4.59859e-13    1.443e-13  1.19198e-14  4.26153e-14  4.88347e-06   0.00359567 -5.32576e-14 -2.04596e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-8.91484e-14  -3.2509e-12   0.00215942   0.00215942  4.81509e-12  6.16983e-14     0.212314     -0.10748   -0.0653703  1.33998e-14 -2.21831e-12    0.0319083  5.17696e-12 -3.65126e-13  -4.2973e-12  -2.7261e-14   0.00202964  -0.00370935    0.0342918    0.0290276  6.76371e-12   1.2851e-13  0.000835921 -0.000159899         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 8.94976e-14  4.47831e-12  -0.00215942  -0.00215942 -3.02769e-12  -6.1383e-14     -0.10748     0.212314    0.0653703  3.98419e-16  2.95077e-12   -0.0319083 -5.26998e-12  3.73405e-13  1.41059e-12  2.64407e-14   0.00370935  -0.00202964    0.0290276    0.0342918 -7.81634e-12 -1.27208e-13 -0.000835921 -0.000159899         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.72939e-14  1.97994e-12  -0.00124915  -0.00124915 -2.97919e-12 -5.65186e-14   -0.0653703    0.0653703     0.424108  6.41492e-16  2.60829e-12    0.0112618  3.21171e-13 -2.32153e-14  1.84471e-12   3.5282e-14 -4.62386e-05 -4.62386e-05   0.00064757  -0.00064757   -2.503e-12 -4.12393e-14  6.86732e-05  1.80678e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0148112  0.000283025  1.28324e-14 -7.19656e-13  0.000274768   -0.0143791  1.33998e-14  3.98377e-16  6.41595e-16     0.446813  6.78154e-16  2.05642e-16 -3.44825e-05 -0.000482927 -0.000206253    0.0107936  2.68899e-12  -3.8414e-13 -2.75637e-14 -1.91035e-13 -0.000315245    0.0177601  5.11239e-12  2.45212e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 0.000283025    0.0148112 -5.61814e-14 -4.23655e-14    0.0143791  0.000274768 -2.21831e-12  2.95077e-12  2.60829e-12   7.4931e-16     0.446813  1.50264e-13  0.000482927 -3.44825e-05   -0.0107936 -0.000206253 -4.56218e-14 -2.64246e-13  3.71214e-12 -6.39025e-13   -0.0177601 -0.000315245 -2.26166e-15 -2.26393e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.49478e-14 -1.31842e-12  0.000609731  0.000609731  1.03398e-12  1.95261e-14    0.0319083   -0.0319083    0.0112618  2.05696e-16  1.50264e-13     0.627074  2.01285e-12 -1.43681e-13  5.10013e-13  9.49787e-15   0.00156155   0.00156155   -0.0218694    0.0218694   1.2648e-12  2.09994e-14 -4.38666e-05 -6.50299e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  0.00434246    0.0479111  9.45521e-14  8.62761e-14   -0.0094606 -0.000857468  5.17696e-12 -5.26998e-12  3.21171e-13 -3.44825e-05  0.000482927  2.01285e-12     0.912954  1.03629e-13    0.0214658   0.00194557  2.92357e-13  2.91943e-13 -3.45839e-12  4.81009e-12    0.0226262   0.00201976  3.85469e-14 -1.13014e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0479111  -0.00434246 -9.11973e-14 -1.84205e-13  0.000857468   -0.0094606 -3.65126e-13  3.73405e-13 -2.32153e-14 -0.000482927 -3.44825e-05 -1.43681e-13  1.03554e-13     0.912954  -0.00194557    0.0214658 -7.40088e-13  6.11575e-13  2.91517e-13 -2.91117e-13  -0.00201976    0.0226262  6.01316e-13 -1.42734e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.66956e-14   -0.0477612 -2.75607e-14 -2.67848e-14    0.0424654 -1.55785e-13  -4.2973e-12  1.41059e-12  1.84471e-12 -0.000206253   -0.0107936  5.10013e-13    0.0214658  -0.00194557     0.952113 -1.21406e-13  4.54811e-14  -1.5758e-13   1.8942e-12  3.42772e-13  -0.00321207  4.36249e-06  6.12119e-14  -5.8349e-15         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0477612 -3.67392e-14 -1.18332e-14 -2.89851e-12 -1.55807e-13    0.0424654 -2.72609e-14  2.64406e-14   3.5282e-14    0.0107936 -0.000206253  9.49787e-15   0.00194557    0.0214658  -1.2147e-13     0.952113 -1.07367e-12  1.16314e-12  1.19561e-13  8.33344e-14 -4.36249e-06  -0.00321207 -3.05065e-12  4.95131e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.00794e-13 -7.17176e-14    0.0655987   0.00227933  4.57894e-14 -4.59859e-13   0.00202964   0.00370935 -4.62386e-05  2.68899e-12 -4.56217e-14   0.00156155  2.92357e-13 -7.40089e-13  4.54811e-14 -1.07367e-12      1.04577   0.00480137   -0.0056306    0.0056306  2.24858e-13  1.44724e-13   -0.0158925  -0.00602284         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.48236e-13 -1.21316e-13   0.00227933    0.0655987 -8.76873e-15    1.443e-13  -0.00370935  -0.00202964 -4.62386e-05  -3.8414e-13 -2.64246e-13   0.00156155  2.91943e-13  6.11575e-13  -1.5758e-13  1.16314e-12   0.00480137      1.04577   -0.0056306    0.0056306  1.60186e-13  8.68813e-13   -0.0158925   0.00602284         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.88009e-14  1.63224e-12 -0.000394701   0.00534429  8.55764e-14  1.19198e-14    0.0342918    0.0290276   0.00064757 -2.75637e-14  3.71214e-12   -0.0218694 -3.45839e-12  2.91517e-13   1.8942e-12  1.19561e-13   -0.0056306   -0.0056306      1.12422   -0.0832557 -2.46233e-12  2.04022e-14  -0.00104902  0.000476657         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 8.10206e-16 -1.08326e-12  -0.00534429  0.000394701   5.1868e-13  4.26153e-14    0.0290276    0.0342918  -0.00064757 -1.91035e-13 -6.39025e-13    0.0218694  4.81009e-12 -2.91117e-13  3.42772e-13  8.33344e-14    0.0056306    0.0056306   -0.0832557      1.12422  3.18359e-12  4.46183e-14   0.00104902  0.000476657         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-7.60315e-05   -0.0559815  4.20161e-13  4.18496e-13   0.00259832  3.52893e-06  2.08382e-11 -2.24532e-11 -3.15755e-12 -0.000195782   -0.0110298  1.17436e-12    0.0177126  -0.00158114   -0.0179781 -2.44171e-05  6.13355e-14 -9.59438e-14  1.01506e-12  7.44292e-13     0.583856  -3.2946e-13   2.9991e-13  1.12999e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0559815  7.60315e-05  4.63873e-13 -1.15477e-12 -3.52893e-06   0.00259832  3.83634e-13 -3.81831e-13 -5.64059e-14    0.0110298 -0.000195782  2.15073e-14   0.00158114    0.0177126  2.44171e-05   -0.0179781 -4.38588e-13  1.31233e-12  1.10298e-13  4.63208e-14  -3.2944e-13     0.583856 -1.55384e-11 -1.04762e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-5.73738e-13 -4.47976e-15   -0.0412036   -0.0412036  5.60303e-17  3.20529e-13   0.00084416  -0.00084416 -0.000119015   5.3881e-12 -8.43793e-15  6.80089e-05  5.75547e-14  5.38349e-13  5.13335e-14 -3.20628e-12   -0.0167853   -0.0167853  -0.00125873   0.00125873  3.93606e-13 -1.40754e-11      1.94541  -9.7475e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 9.59931e-13 -1.26659e-14   -0.0166083    0.0166083  1.83905e-14 -1.75813e-12 -0.000181969 -0.000181969  2.16703e-13  2.62663e-12 -2.46295e-14 -7.51988e-14 -1.23604e-13 -1.56146e-12 -5.70545e-15  4.86744e-13  -0.00724935   0.00724935  0.000579774  0.000579774  1.20153e-13 -1.09016e-11 -9.84558e-11     0.682483         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
