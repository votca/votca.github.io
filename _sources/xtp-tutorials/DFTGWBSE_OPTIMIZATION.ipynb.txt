{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-10-07T06:28:36.723311Z",
     "iopub.status.busy": "2022-10-07T06:28:36.722744Z",
     "iopub.status.idle": "2022-10-07T06:29:28.058688Z",
     "shell.execute_reply": "2022-10-07T06:29:28.059046Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2023-dev gitid: 613916e (compiled Oct  7 2022, 06:20:14)\r\n",
      "votca_csg, version 2023-dev gitid: 613916e (compiled Oct  7 2022, 06:04:16)\r\n",
      "votca_tools, version 2023-dev gitid: 613916e (compiled Oct  7 2022, 06:02:13)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 Bohr\r\n",
      "... ... \r\n",
      "... ... =========== OPTIMIZATION SUMMARY ================================= \r\n",
      "... ... At iteration  0\r\n",
      "... ...  ---- POSITIONS (Angstrom)   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    +0.0000  +0.0000  +0.0000\r\n",
      "... ...    1    +1.2000  +0.0000  +0.0000\r\n",
      "... ...    Total energy:     -112.26831841 Hartree \r\n",
      "... ...    Trust radius:       0.01889726 Bohr     \r\n",
      "... ...  ---- FORCES (Hartree/Bohr)   \r\n",
      "... ...       central differences   \r\n",
      "... ...       displacement 0.0010 Angstrom   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    -0.1314  -0.0000  -0.0000\r\n",
      "... ...    1    +0.1314  +0.0000  +0.0000A\r\n",
      "    0.300728 -7.18681e-15  2.99246e-14  3.10145e-14   -0.0519964  4.21906e-15  2.62709e-11 -2.65319e-11  1.38441e-11   -0.0175948 -2.14412e-05   4.5701e-12   -0.0390315 -0.000243336   -0.0424178  3.25407e-15  2.88519e-14  2.77968e-14   3.5985e-12 -3.93622e-12     0.107004  4.69865e-06    1.671e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-7.19996e-15     0.300728 -2.04386e-12 -2.30496e-12  4.25636e-15   -0.0519964 -1.50467e-14  1.38274e-14 -9.08198e-15 -2.14412e-05    0.0175948  -3.1661e-15  0.000243336   -0.0390315  3.20973e-15   -0.0424178  5.54865e-13  2.17128e-13 -4.42518e-15  5.44229e-15  4.69865e-06    -0.107004 -1.40357e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.99245e-14 -2.04386e-12     0.309472   -0.0100865  2.18022e-16  1.27515e-12  0.000282315 -0.000282315  0.000111361 -2.28441e-14  2.20889e-12  5.03728e-05 -7.66335e-15 -3.11944e-13  1.55231e-14 -4.10509e-13   -0.0491913  -0.00194315  5.57042e-05 -0.000350266   2.0012e-13  1.97995e-12    0.0247308          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.10145e-14 -2.30496e-12   -0.0100865     0.309472  9.30121e-16  4.94194e-13  0.000282315 -0.000282315  0.000111361 -2.45909e-14 -3.59505e-14  5.03728e-05 -6.92682e-15 -3.85767e-13  7.55225e-15  3.84542e-12  -0.00194315   -0.0491913  0.000350266 -5.57042e-05  2.02149e-13  2.47873e-12    0.0247308          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0519964  4.26219e-15  2.18051e-16  9.30103e-16     0.486555 -2.00558e-15 -7.09516e-13 -7.14066e-14 -7.47123e-13     0.013646  1.66291e-05  1.84628e-12  -0.00832822 -5.19211e-05   -0.0300841 -1.36555e-14   7.9324e-15  9.35765e-15  1.40027e-12  -9.6947e-13   -0.0551239 -2.42054e-06  3.67596e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.21754e-15   -0.0519964  1.27515e-12  4.94194e-13 -2.00426e-15     0.486555   4.8334e-17 -7.46756e-16  1.04255e-15  1.66291e-05    -0.013646 -8.91075e-16  5.19211e-05  -0.00832822 -1.37133e-14   -0.0300841 -4.44018e-13 -1.32758e-14  2.05914e-16 -1.63641e-15 -2.42054e-06    0.0551239  1.09281e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.62709e-11 -1.50467e-14  0.000282315  0.000282315 -7.09516e-13  4.83516e-17     0.541142    -0.221583     0.091384  -1.6696e-11 -3.53044e-14    0.0413364 -7.57726e-12 -3.95242e-14  1.06772e-11 -3.46073e-15  0.000254468  -4.0094e-05    -0.013423   -0.0338251  1.59905e-10  1.10351e-13  0.000555365          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.65319e-11  1.38273e-14 -0.000282315 -0.000282315 -7.14067e-14 -7.46795e-16    -0.221583     0.541142    -0.091384  1.89408e-11  3.35541e-14   -0.0413364  7.50349e-12  3.87759e-14 -6.42146e-12   1.1414e-14   4.0094e-05 -0.000254468   -0.0338251    -0.013423 -1.60413e-10 -1.08504e-13 -0.000555365          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.38441e-11 -9.08187e-15  0.000111361  0.000111361 -7.47123e-13  1.04255e-15     0.091384    -0.091384     0.659711 -9.57664e-12 -1.81138e-14  -0.00509591 -3.48291e-13 -1.84818e-15  3.26904e-12 -2.10267e-15  3.59214e-05  3.59214e-05   0.00481971  -0.00481971  6.45442e-11  4.47659e-14  0.000234974          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0175948 -2.14412e-05 -2.28441e-14 -2.45908e-14     0.013646  1.66291e-05  -1.6696e-11  1.89408e-11 -9.57664e-12     0.667191 -5.91135e-15 -2.33059e-12 -2.39766e-05 -1.78698e-07   0.00908944  1.10765e-05  -2.4345e-14  -9.1568e-15 -2.14756e-13  3.16597e-12   -0.0409783  4.81372e-05 -3.45506e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.14412e-05    0.0175948  2.20889e-12 -3.59505e-14  1.66291e-05    -0.013646 -3.53043e-14  3.35542e-14 -1.81138e-14 -5.98127e-15     0.667191 -4.13708e-15 -1.78698e-07  2.39766e-05  1.10765e-05  -0.00908944  3.38697e-12  4.35747e-13 -9.20355e-15  2.44182e-14 -4.81372e-05   -0.0409783  4.69502e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  4.5701e-12  -3.1661e-15  5.03728e-05  5.03728e-05  1.84628e-12 -8.90969e-16    0.0413364   -0.0413364  -0.00509591 -2.33059e-12 -4.13704e-15     0.792641 -2.29242e-12 -1.23919e-14  3.34699e-12 -2.01099e-15  0.000114478  0.000114478      0.01536     -0.01536  2.09963e-11  1.47991e-14  0.000108069          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0390315  0.000243336 -7.66335e-15 -6.92682e-15  -0.00832822  5.19211e-05 -7.57726e-12  7.50349e-12 -3.48292e-13 -2.39766e-05 -1.78698e-07 -2.29242e-12     0.954094 -3.10148e-15   -0.0128554  8.01449e-05 -6.34263e-14 -6.15866e-14 -8.37692e-12  7.44029e-12    0.0198869  0.000124855 -1.36829e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-0.000243336   -0.0390315 -3.11944e-13 -3.85767e-13 -5.19211e-05  -0.00832822 -3.95242e-14  3.87759e-14  -1.8482e-15 -1.78698e-07  2.39766e-05 -1.23919e-14  -3.0977e-15     0.954094 -8.01449e-05   -0.0128554  1.09914e-12  1.62476e-13 -4.84669e-14  4.66542e-14  0.000124855   -0.0198869 -4.92066e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0424178  3.21936e-15   1.5523e-14  7.55225e-15   -0.0300841 -1.37314e-14  1.06772e-11 -6.42146e-12  3.26904e-12   0.00908944  1.10765e-05  3.34699e-12   -0.0128554 -8.01449e-05     0.972602  5.91467e-15  1.78491e-14   2.2367e-14  3.17512e-12 -2.15263e-12     -0.02299 -1.00951e-06  3.12322e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.25637e-15   -0.0424178 -4.10509e-13  3.84542e-12 -1.36514e-14   -0.0300841 -3.46073e-15   1.1414e-14 -2.10268e-15  1.10765e-05  -0.00908944 -2.01099e-15  8.01449e-05   -0.0128554  5.89449e-15     0.972602 -2.94332e-13  7.28225e-13  -5.4758e-15  9.21251e-16 -1.00951e-06      0.02299 -4.54031e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.88519e-14  5.54865e-13   -0.0491913  -0.00194315   7.9324e-15 -4.44018e-13  0.000254468   4.0094e-05  3.59214e-05  -2.4345e-14  3.38697e-12  0.000114478 -6.34264e-14  1.09914e-12  1.78491e-14 -2.94332e-13      1.02072   0.00208876  0.000317907 -0.000317907  1.64666e-13 -8.47354e-14  -0.00474845          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.77968e-14  2.17128e-13  -0.00194315   -0.0491913  9.35765e-15 -1.32758e-14  -4.0094e-05 -0.000254468  3.59214e-05 -9.15682e-15  4.35747e-13  0.000114478 -6.15866e-14  1.62476e-13   2.2367e-14  7.28225e-13   0.00208876      1.02072  0.000317907 -0.000317907  1.63651e-13  2.30598e-13  -0.00474845          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  3.5985e-12 -4.42518e-15  5.57042e-05  0.000350266  1.40027e-12  2.05913e-16    -0.013423   -0.0338251   0.00481971 -2.14756e-13 -9.20354e-15      0.01536 -8.37692e-12 -4.84669e-14  3.17512e-12 -5.47581e-15  0.000317907  0.000317907      1.06337   -0.0447411  2.20639e-11  1.52796e-14 -2.09257e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.93622e-12  5.44229e-15 -0.000350266 -5.57042e-05  -9.6947e-13 -1.63641e-15   -0.0338251    -0.013423  -0.00481971  3.16597e-12  2.44182e-14     -0.01536  7.44029e-12  4.66541e-14 -2.15263e-12   9.2125e-16 -0.000317907 -0.000317907   -0.0447411      1.06337 -2.23834e-11  -1.5998e-14  2.09257e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0745352  -3.2729e-06 -1.17926e-13 -1.15949e-13    0.0700995  3.07813e-06 -1.04285e-10  1.03021e-10 -5.13597e-11    0.0303573  3.56606e-05 -1.77439e-11  -0.00921182 -5.78343e-05    0.0362794  1.59306e-06 -1.34976e-13 -1.37651e-13 -1.81635e-11  1.76209e-11    -0.195077 -5.07611e-14  6.45264e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -3.2729e-06    0.0745352 -3.48872e-12 -2.20711e-12  3.07813e-06   -0.0700995 -8.47594e-14  8.58748e-14 -4.21583e-14 -3.56606e-05    0.0303573 -1.57136e-14 -5.78343e-05   0.00921182  1.59306e-06   -0.0362794 -6.42868e-14  4.79656e-13 -1.46101e-14  1.19431e-14 -5.07554e-14    -0.195077 -4.87902e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.07238e-13  5.99697e-12    0.0140627    0.0140627 -3.20099e-14 -4.10512e-12  0.000484565 -0.000484565  0.000197317 -6.71773e-14  5.97282e-12  9.10687e-05 -4.77948e-15   1.5027e-12 -4.02644e-15 -1.10905e-12  -0.00609635  -0.00609635  -4.2454e-05   4.2454e-05  1.43163e-12 -5.03329e-11     0.939659          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0901503 -3.32017e-15  1.07967e-14  1.21201e-14   -0.0325949   2.6111e-15  9.86248e-12  -1.0398e-11  8.89847e-12   -0.0147607 -1.79875e-05  3.29432e-12     -0.04809  -0.00029981   -0.0477326  3.76424e-15  2.10524e-14  1.89558e-14  2.32676e-12 -2.93176e-12    0.0243816  1.07062e-06  1.16745e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.32875e-15    0.0901503 -8.55399e-13 -1.39102e-12  2.63778e-15   -0.0325949 -5.84281e-15   4.4527e-15 -5.83328e-15 -1.79875e-05    0.0147607 -2.30898e-15   0.00029981     -0.04809  3.71878e-15   -0.0477326   9.0212e-13  2.97092e-13 -4.64105e-15  6.69982e-15  1.07062e-06   -0.0243816  5.78852e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.07966e-14 -8.55399e-13    0.0988833  -0.00551457  6.28134e-17  7.47376e-13  0.000137441 -0.000137441  7.98723e-05 -1.66781e-14  2.22661e-12  3.91613e-05 -9.80565e-15 -2.97557e-13  1.77955e-14 -4.99041e-13   -0.0657335  -0.00223389  5.19556e-05 -0.000447835  3.13413e-14  -1.6526e-12    0.0406676         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.21201e-14 -1.39102e-12  -0.00551457    0.0988833  4.45857e-16  2.51654e-13  0.000137441 -0.000137441  7.98723e-05 -1.84591e-14 -1.16095e-13  3.91613e-05 -8.39704e-15 -4.51641e-13  8.00012e-15  4.74204e-12  -0.00223389   -0.0657335  0.000447835 -5.19556e-05  3.58567e-14  2.98646e-13    0.0406676         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0325949  2.64247e-15  6.28333e-17  4.45844e-16     0.236331 -1.51853e-15 -5.39965e-13  4.42737e-14 -5.62262e-13    0.0143743  1.75167e-05  2.17682e-12  -0.00952452 -5.93792e-05   -0.0423454 -1.86681e-14  1.17287e-14  1.44954e-14  2.19372e-12  -1.4142e-12   0.00354089  1.55483e-07  1.15671e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.61048e-15   -0.0325949  7.47376e-13  2.51654e-13 -1.52206e-15     0.236331  6.93519e-17 -4.37979e-16  8.00736e-16  1.75167e-05   -0.0143743 -1.15232e-15  5.93792e-05  -0.00952452 -1.87429e-14   -0.0423454 -7.77487e-13  1.95269e-15  1.88438e-16 -2.96337e-15  1.55483e-07  -0.00354089 -3.05348e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 9.86248e-12 -5.84279e-15  0.000137441  0.000137441 -5.39965e-13  6.93712e-17     0.211669    -0.107271    0.0655439 -1.16471e-11 -2.60125e-14    0.0321361 -9.21377e-12 -4.85653e-14   1.2082e-11 -3.64587e-15  0.000218645 -0.000177234   -0.0345286   -0.0289711  1.28315e-11 -7.71157e-15  0.000990078         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " -1.0398e-11  4.45264e-15 -0.000137441 -0.000137441  4.42737e-14 -4.38012e-16    -0.107271     0.211669   -0.0655439  1.39898e-11  2.42246e-14   -0.0321361  9.05976e-12  4.71479e-14 -6.84108e-12  1.34268e-14  0.000177234 -0.000218645   -0.0289711   -0.0345286 -1.47691e-11   1.0701e-14 -0.000990078         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 8.89847e-12 -5.83318e-15  7.98723e-05  7.98723e-05 -5.62262e-13  8.00729e-16    0.0655439   -0.0655439     0.423732 -9.92651e-12 -1.88427e-14   -0.0111903 -3.58291e-13 -2.06618e-15  4.01317e-12   -2.593e-15  5.19402e-06  5.19402e-06  0.000696901 -0.000696901  1.32689e-11  1.41359e-15   0.00046062         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0147607 -1.79875e-05  -1.6678e-14  -1.8459e-14    0.0143743  1.75167e-05 -1.16471e-11  1.39898e-11 -9.92651e-12     0.445598 -7.77593e-15 -2.20194e-12   0.00047278  3.52364e-06    0.0108238    1.319e-05 -2.81263e-14  -2.6407e-15  1.33284e-12  3.61664e-12   -0.0177641  2.08674e-05 -9.97584e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.79875e-05    0.0147607  2.22661e-12 -1.16095e-13  1.75167e-05   -0.0143743 -2.60125e-14  2.42247e-14 -1.88428e-14 -7.88141e-15     0.445598 -3.79512e-15  3.52364e-06  -0.00047278    1.319e-05   -0.0108238  5.62872e-12  6.79229e-13  -1.1887e-14  3.74164e-14 -2.08674e-05   -0.0177641  8.45531e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.29432e-12 -2.30899e-15  3.91613e-05  3.91613e-05  2.17682e-12 -1.15219e-15    0.0321361   -0.0321361   -0.0111903 -2.20194e-12 -3.79507e-15     0.626438 -3.54093e-12 -1.92322e-14  5.04595e-12 -3.05102e-15  0.000163894  0.000163894    0.0219903   -0.0219903  2.74011e-12 -1.65711e-15  0.000221314         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "    -0.04809   0.00029981 -9.80566e-15 -8.39704e-15  -0.00952452  5.93792e-05 -9.21377e-12  9.05976e-12 -3.58291e-13   0.00047278  3.52364e-06 -3.54093e-12     0.912633 -5.07206e-15   -0.0215004  0.000134041 -1.18774e-13 -1.15051e-13 -1.56777e-11  1.37838e-11    0.0226784  0.000142381 -2.87978e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " -0.00029981     -0.04809 -2.97557e-13 -4.51641e-13 -5.93792e-05  -0.00952452 -4.85653e-14  4.71479e-14  -2.0662e-15  3.52364e-06  -0.00047278 -1.92322e-14 -5.06476e-15     0.912633 -0.000134041   -0.0215004  2.21006e-12  3.16034e-13 -9.11853e-14  8.75208e-14  0.000142381   -0.0226784  1.04244e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0477326  3.72942e-15  1.77954e-14  8.00012e-15   -0.0423454 -1.87714e-14   1.2082e-11 -6.84108e-12  4.01317e-12    0.0108238    1.319e-05  5.04595e-12   -0.0215004 -0.000134041     0.950071  1.11416e-14  3.07764e-14  3.90514e-14  5.57438e-12 -3.69624e-12   0.00314125  1.37935e-07  4.13814e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.76886e-15   -0.0477326 -4.99041e-13  4.74204e-12 -1.86628e-14   -0.0423454 -3.64588e-15  1.34268e-14   -2.593e-15    1.319e-05   -0.0108238 -3.05102e-15  0.000134041   -0.0215004  1.11014e-14     0.950071 -6.89914e-13  1.18836e-12 -8.80047e-15   4.6066e-16  1.37935e-07  -0.00314125 -2.13878e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.10524e-14   9.0212e-13   -0.0657335  -0.00223389  1.17287e-14 -7.77487e-13  0.000218645  0.000177234  5.19402e-06 -2.81262e-14  5.62872e-12  0.000163894 -1.18774e-13  2.21006e-12  3.07764e-14 -6.89914e-13      1.04427   0.00440313  0.000589643 -0.000589643  4.89534e-14 -4.62608e-13   -0.0159177         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.89558e-14  2.97092e-13  -0.00223389   -0.0657335  1.44954e-14  1.95269e-15 -0.000177234 -0.000218645  5.19402e-06 -2.64073e-15  6.79229e-13  0.000163894 -1.15051e-13  3.16035e-13  3.90513e-14  1.18836e-12   0.00440313      1.04427  0.000589643 -0.000589643  4.34691e-14  8.95019e-13   -0.0159177         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.32676e-12 -4.64105e-15  5.19556e-05  0.000447835  2.19372e-12  1.88442e-16   -0.0345286   -0.0289711  0.000696901  1.33284e-12  -1.1887e-14    0.0219903 -1.56777e-11 -9.11853e-14  5.57438e-12 -8.80048e-15  0.000589643  0.000589643      1.12338   -0.0835134  6.46426e-12  3.54599e-15 -0.000101793         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.93176e-12  6.69982e-15 -0.000447835 -5.19556e-05  -1.4142e-12 -2.96337e-15   -0.0289711   -0.0345286 -0.000696901  3.61664e-12  3.74164e-14   -0.0219903  1.37838e-11  8.75207e-14 -3.69624e-12   4.6066e-16 -0.000589643 -0.000589643   -0.0835134      1.12338 -7.82588e-12 -8.65043e-15  0.000101793         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0558853  2.45397e-06  1.12948e-13  1.16606e-13   0.00253709  1.11406e-07  8.10023e-11  -8.2572e-11  1.27465e-11   -0.0110902 -1.30276e-05  3.12673e-12    0.0177225  0.000111266    0.0178963  7.85841e-07 -2.72902e-14 -3.21354e-14 -3.67108e-12  2.59895e-12     0.582693 -3.53379e-14  1.20624e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.45397e-06   -0.0558853 -9.27047e-13   6.4876e-13  1.11406e-07  -0.00253709  4.90338e-14 -4.60914e-14  3.11026e-15  1.30276e-05   -0.0110902  -8.4669e-16  0.000111266   -0.0177225  7.85841e-07   -0.0178963 -5.44131e-15  1.06232e-12 -6.08913e-15  1.78393e-15 -3.53035e-14     0.582693 -5.82137e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 9.09634e-14  5.48948e-12    0.0411139    0.0411139  1.10537e-14 -3.67404e-12  0.000902363 -0.000902363  0.000423904 -9.73977e-14  9.75889e-12  0.000204751 -2.50604e-14  1.51192e-12  2.88702e-14 -3.07328e-12   -0.0168201   -0.0168201   -0.0001005    0.0001005  1.93711e-12 -6.13898e-11      1.94144         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.7"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
