{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-12-20T07:41:48.123600Z",
     "iopub.status.busy": "2022-12-20T07:41:48.122867Z",
     "iopub.status.idle": "2022-12-20T07:41:58.132061Z",
     "shell.execute_reply": "2022-12-20T07:41:58.131246Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2023-dev gitid: 900eb3a (compiled Dec 20 2022, 07:32:39)\r\n",
      "votca_csg, version 2023-dev gitid: 900eb3a (compiled Dec 20 2022, 07:15:52)\r\n",
      "votca_tools, version 2023-dev gitid: 900eb3a (compiled Dec 20 2022, 07:12:52)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 BohrA\r\n",
      "    0.306708  6.08182e-14 -1.22458e-10 -3.90429e-10 -4.40334e-14   -0.0516336  2.60176e-13 -2.61931e-13  6.49471e-14 -2.30362e-06    0.0181563  3.83977e-14  1.65278e-05   -0.0389795  3.76821e-14    0.0421241  1.94745e-11 -2.61567e-11 -3.24225e-14 -3.54121e-14  5.62613e-07    -0.108303   1.6043e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 6.08548e-14     0.306708  2.68449e-13   2.7019e-13   -0.0516336 -4.40453e-14  1.74359e-09 -2.01157e-09  5.34415e-10   -0.0181563 -2.30362e-06  3.16684e-10    0.0389795  1.65278e-05    0.0421241  3.76203e-14  9.76322e-14 -9.46624e-14  -3.2947e-10 -3.36152e-10     0.108303  5.62613e-07 -5.44353e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.22458e-10  2.68449e-13     0.319156   -0.0100481  1.71073e-13 -4.19801e-11   2.9254e-05  -2.9254e-05  1.09328e-05 -9.88382e-14 -4.28643e-11  4.67866e-06 -6.19368e-14 -2.56198e-11 -6.20892e-14  1.63903e-11    0.0495092  -0.00204416 -3.82505e-06  1.63007e-05  9.29983e-13  1.58329e-11   -0.0252874          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.90429e-10   2.7019e-13   -0.0100481     0.319156  1.68638e-13    3.679e-10   2.9254e-05  -2.9254e-05  1.09328e-05 -9.08538e-14 -1.10116e-10  4.67866e-06 -5.89008e-14 -3.30932e-11 -6.03491e-14 -3.13124e-10   0.00204416   -0.0495092  1.63007e-05 -3.82505e-06  9.30605e-13  5.25146e-10   -0.0252874          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-4.40587e-14   -0.0516336  1.71073e-13  1.68638e-13     0.490609  7.57938e-15  1.69885e-09 -1.28897e-09  7.55661e-10    0.0134761   1.7098e-06  2.05863e-10    0.0080157  3.39875e-06    0.0309388 -1.27552e-13  5.62351e-14 -5.80247e-14 -1.87759e-10 -1.83891e-10    -0.053272 -2.76738e-07 -8.86744e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0516336 -4.40588e-14 -4.19801e-11    3.679e-10  7.56262e-15     0.490609  1.63079e-13  -1.6063e-13  9.22592e-14   1.7098e-06   -0.0134761  2.52427e-14  3.39875e-06   -0.0080157 -1.27566e-13    0.0309388 -1.41582e-11  1.80255e-11 -2.82987e-14 -2.65381e-14 -2.76738e-07     0.053272 -9.98369e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.60176e-13  1.74359e-09   2.9254e-05   2.9254e-05  1.69885e-09  1.63079e-13     0.549726    -0.220522    0.0861688 -7.16779e-10  9.78266e-15    0.0368756 -5.42592e-10 -1.60205e-13 -7.89529e-10 -5.83416e-14  1.01211e-05  1.00047e-05    0.0125301    -0.034935  6.78358e-09 -8.34523e-13  -8.0655e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.61931e-13 -2.01157e-09  -2.9254e-05  -2.9254e-05 -1.28897e-09  -1.6063e-13    -0.220522     0.549726   -0.0861688   7.8403e-10 -1.79607e-15   -0.0368756  5.50066e-10  1.63251e-13  4.60014e-10  5.66317e-14  1.00047e-05  1.01211e-05     0.034935   -0.0125301 -7.28253e-09  8.34913e-13   8.0655e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  6.4947e-14  5.34415e-10  1.09328e-05  1.09328e-05  7.55661e-10  9.22592e-14    0.0861688   -0.0861688     0.662739 -4.24852e-10 -2.28146e-15  -0.00625217 -6.14593e-11 -1.87061e-14 -4.50126e-10  -5.4897e-14  1.23049e-06 -1.23049e-06  -0.00414117  -0.00414117  1.82084e-09  -2.0508e-13 -4.26279e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.30362e-06   -0.0181563 -9.88382e-14 -9.08539e-14    0.0134761   1.7098e-06 -7.16779e-10   7.8403e-10 -4.24852e-10     0.680027  2.89338e-16 -3.11526e-11  -7.6988e-05 -2.28758e-08  -0.00866729 -1.09968e-06 -2.62971e-14  2.78777e-14  9.37653e-11  8.87455e-11   -0.0410255  4.99207e-06  1.35947e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0181563 -2.30362e-06 -4.28643e-11 -1.10116e-10   1.7098e-06   -0.0134761  9.78266e-15 -1.79608e-15 -2.28155e-15  2.14821e-16     0.680027 -1.55521e-16  2.28758e-08  -7.6988e-05 -1.09968e-06   0.00866729 -1.45184e-11  1.95381e-11 -5.33091e-15 -3.74413e-15 -4.99207e-06   -0.0410255  1.18007e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.83977e-14  3.16684e-10  4.67866e-06  4.67866e-06  2.05863e-10  2.52426e-14    0.0368756   -0.0368756  -0.00625217 -3.11526e-11 -1.55565e-16     0.797893 -2.21528e-10 -6.69988e-14   6.3947e-11  7.73821e-15  4.31896e-06 -4.31896e-06   -0.0145354   -0.0145354  9.57151e-10 -1.08625e-13 -1.73441e-06          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.65278e-05    0.0389795 -6.19368e-14 -5.89008e-14    0.0080157  3.39875e-06 -5.42592e-10  5.50066e-10 -6.14593e-11  -7.6988e-05  2.28758e-08 -2.21528e-10     0.956279 -4.28337e-14   -0.0131238 -5.56466e-06  -8.9462e-14  8.88505e-14  2.31212e-10  3.46021e-10   -0.0200194  8.38445e-06 -5.01812e-15          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0389795  1.65278e-05 -2.56198e-11 -3.30932e-11  3.39875e-06   -0.0080157 -1.60205e-13  1.63251e-13 -1.87061e-14 -2.28758e-08  -7.6988e-05 -6.69988e-14 -4.27743e-14     0.956279 -5.56466e-06    0.0131238 -4.62595e-11 -6.85495e-11  9.10901e-14  9.04752e-14 -8.38445e-06   -0.0200194  4.89096e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.76649e-14    0.0421241 -6.20891e-14 -6.03491e-14    0.0309388 -1.27594e-13 -7.89529e-10  4.60014e-10 -4.50126e-10  -0.00866729 -1.09968e-06   6.3947e-11   -0.0131238 -5.56466e-06     0.987501 -6.94305e-14  2.21739e-14  5.43885e-14   1.3445e-10 -4.39278e-11    0.0224113  1.16422e-07  5.99973e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0421241   3.7604e-14  1.63903e-11 -3.13124e-10 -1.27549e-13    0.0309388 -5.83416e-14  5.66319e-14  -5.4897e-14 -1.09968e-06   0.00866729  7.73821e-15 -5.56466e-06    0.0131238  -6.9491e-14     0.987501 -6.74217e-11 -1.10956e-10  5.03024e-14 -2.62662e-14  1.16423e-07   -0.0224113 -1.30106e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.94745e-11  9.76322e-14    0.0495092   0.00204416  5.62351e-14 -1.41582e-11  1.01211e-05  1.00047e-05  1.23049e-06 -2.62971e-14 -1.45184e-11  4.31896e-06 -8.94621e-14 -4.62595e-11  2.21739e-14 -6.74217e-11      1.02819   -0.0020693 -1.29071e-05 -1.29071e-05  3.72008e-13  1.80131e-12  -0.00469072          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.61567e-11 -9.46624e-14  -0.00204416   -0.0495092 -5.80247e-14  1.80255e-11  1.00047e-05  1.01211e-05 -1.23049e-06  2.78778e-14  1.95381e-11 -4.31896e-06  8.88505e-14 -6.85495e-11  5.43885e-14 -1.10956e-10   -0.0020693      1.02819  1.29071e-05  1.29071e-05 -3.33571e-13  8.99701e-11   0.00469072          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.24225e-14  -3.2947e-10 -3.82505e-06  1.63007e-05 -1.87759e-10 -2.82987e-14    0.0125301     0.034935  -0.00414117  9.37653e-11 -5.33091e-15   -0.0145354  2.31212e-10  9.10901e-14   1.3445e-10  5.03025e-14 -1.29071e-05  1.29071e-05      1.07163    0.0455077 -1.15778e-09  1.03383e-13 -8.31417e-07          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.54121e-14 -3.36152e-10  1.63007e-05 -3.82505e-06 -1.83891e-10 -2.65381e-14    -0.034935   -0.0125301  -0.00414117  8.87455e-11 -3.74412e-15   -0.0145354  3.46021e-10  9.04751e-14 -4.39278e-11 -2.62662e-14 -1.29071e-05  1.29071e-05    0.0455077      1.07163  -1.2482e-09  1.42711e-13 -8.31417e-07          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -3.9087e-07   -0.0752424 -4.99166e-13 -4.99158e-13    0.0690969  3.58945e-07 -3.52652e-09   3.8526e-09 -1.17254e-09    0.0309264  3.76319e-06 -8.30842e-10   0.00901647  3.77625e-06   -0.0363998  -1.8909e-07 -2.11594e-13  2.10927e-13  7.12842e-10  7.14107e-10    -0.194835  5.94523e-13  7.35886e-14          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0752424  -3.9087e-07 -1.03398e-10 -4.38777e-10  3.58945e-07   -0.0690969  4.32916e-13 -4.33784e-13  1.24881e-13 -3.76319e-06    0.0309264    9.197e-14 -3.77625e-06   0.00901647  -1.8909e-07    0.0363998 -7.75988e-12  4.82563e-12 -8.19374e-14 -8.32995e-14  5.94554e-13    -0.194835  2.30344e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.58821e-10 -1.56119e-14   -0.0143253   -0.0143253  4.22962e-14  1.71047e-10  4.45414e-06 -4.45414e-06  1.04789e-06  1.36687e-14     4.79e-11   3.5004e-07 -7.84805e-15  8.18509e-12   7.6603e-15 -2.22421e-10  -0.00613234   0.00613234 -3.50547e-06 -3.50547e-06 -1.13793e-13  2.19098e-09     0.954926          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0935659  2.71345e-14 -6.09654e-11 -2.33641e-10 -2.70675e-14   -0.0328713  1.13063e-13 -1.14156e-13  4.00999e-14 -1.96726e-06    0.0155052  2.64268e-14  2.04856e-05   -0.0483139  4.37972e-14    0.0481173  1.98718e-11 -2.29721e-11 -2.71737e-14 -2.86408e-14  1.30112e-07   -0.0250466 -5.23672e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.71576e-14    0.0935659  1.16265e-13  1.17349e-13   -0.0328713 -2.70868e-14  6.93485e-10 -8.66161e-10  3.29988e-10   -0.0155052 -1.96726e-06  2.18245e-10    0.0483139  2.04856e-05    0.0481173   4.3738e-14  8.12501e-14 -7.98058e-14 -2.78098e-10 -2.81198e-10    0.0250466  1.30112e-07  -5.9621e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.09654e-11  1.16265e-13      0.10504   -0.0056823  1.01763e-13 -2.62124e-11  1.47814e-05 -1.47814e-05  8.02645e-06  -7.5306e-14 -4.11685e-11  3.66679e-06  -5.5037e-14  -2.6251e-11 -7.08623e-14  2.15885e-11    0.0670098  -0.00240141 -3.20241e-06  2.41923e-05  1.68607e-13 -9.09166e-11   -0.0419176         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.33641e-10  1.17349e-13   -0.0056823      0.10504  1.00032e-13  2.63301e-10  1.47814e-05 -1.47814e-05  8.02645e-06 -6.72643e-14 -1.08726e-10  3.66679e-06 -5.20756e-14 -3.35763e-11 -6.87278e-14 -3.84219e-10   0.00240141   -0.0670098  2.41923e-05 -3.20241e-06  1.69505e-13  8.33993e-11   -0.0419176         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.70915e-14   -0.0328713  1.01763e-13  1.00032e-13     0.240584  3.29646e-15  1.05286e-09 -7.63349e-10  6.49827e-10    0.0144632  1.83504e-06  1.73493e-10   0.00916843  3.88752e-06    0.0440553 -1.76987e-13  5.14176e-14 -4.63133e-14 -1.51136e-10 -1.63432e-10   0.00432456  2.24653e-08 -5.14928e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0328713 -2.70939e-14 -2.62124e-11  2.63301e-10  3.28586e-15     0.240584  9.67387e-14 -9.49913e-14  7.93076e-14  1.83504e-06   -0.0144632  2.12863e-14  3.88752e-06  -0.00916843 -1.76998e-13    0.0440553  -2.4134e-11   1.1838e-11 -2.18759e-14 -2.70238e-14  2.24652e-08  -0.00432456  2.19109e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.13063e-13  6.93485e-10  1.47814e-05  1.47814e-05  1.05286e-09  9.67387e-14     0.221542     -0.11082    0.0632617 -5.30873e-10  1.05676e-14    0.0289004 -4.89916e-10 -1.44234e-13  -9.2688e-10 -6.64854e-14  8.86615e-06  1.85286e-05    0.0337442   -0.0308642  1.18894e-09 -1.61722e-13 -3.03553e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.14156e-13 -8.66161e-10 -1.47814e-05 -1.47814e-05 -7.63349e-10 -9.49913e-14     -0.11082     0.221542   -0.0632617  5.98431e-10 -2.52382e-15   -0.0289004  4.97241e-10  1.47209e-13  5.21072e-10  6.43936e-14  1.85286e-05  8.86615e-06    0.0308642   -0.0337442 -1.36166e-09  1.60935e-13  3.03553e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.00999e-14  3.29988e-10  8.02645e-06  8.02645e-06  6.49827e-10  7.93076e-14    0.0632617   -0.0632617     0.428924 -4.79328e-10 -2.57541e-15    -0.012098 -1.75714e-11 -5.46445e-15 -6.21667e-10 -7.58279e-14  8.14157e-09 -8.14155e-09 -2.74002e-05 -2.74002e-05  4.95217e-10 -6.12886e-14 -3.97058e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.96726e-06   -0.0155052  -7.5306e-14 -6.72644e-14    0.0144632  1.83504e-06 -5.30873e-10  5.98431e-10 -4.79328e-10     0.462759  3.59306e-16  2.95904e-13 -0.000635208 -1.88742e-07   -0.0104064 -1.32033e-06 -2.47967e-14  2.65799e-14   8.9416e-11  8.39335e-11   -0.0177344  2.15796e-06  3.17652e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0155052 -1.96726e-06 -4.11685e-11 -1.08726e-10  1.83504e-06   -0.0144632  1.05676e-14 -2.52385e-15 -2.57552e-15  2.58221e-16     0.462759  2.24444e-17  1.88742e-07 -0.000635208 -1.32033e-06    0.0104064 -3.07999e-11  3.62824e-11 -1.03217e-14 -8.52978e-15 -2.15796e-06   -0.0177344  1.14125e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.64268e-14  2.18245e-10  3.66679e-06  3.66679e-06  1.73493e-10  2.12862e-14    0.0289004   -0.0289004    -0.012098  2.95904e-13  2.23774e-17     0.635437    -3.22e-10 -9.73678e-14  1.32651e-10  1.60909e-14  6.24073e-06 -6.24073e-06    -0.021003    -0.021003  1.07108e-10 -1.37704e-14 -1.82321e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.04856e-05    0.0483139  -5.5037e-14 -5.20756e-14   0.00916843  3.88752e-06 -4.89916e-10  4.97241e-10 -1.75714e-11 -0.000635208  1.88742e-07    -3.22e-10     0.916802 -7.54165e-14   -0.0222399    -9.43e-06 -1.53086e-13  1.51857e-13  3.71311e-10  6.02972e-10   -0.0232165  9.72346e-06 -2.72373e-14         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0483139  2.04856e-05  -2.6251e-11 -3.35763e-11  3.88752e-06  -0.00916843 -1.44234e-13  1.47209e-13 -5.46445e-15 -1.88742e-07 -0.000635208 -9.73678e-14 -7.53056e-14     0.916802    -9.43e-06    0.0222399 -9.04565e-11 -1.41204e-10  1.55812e-13  1.54577e-13 -9.72346e-06   -0.0232165   1.0423e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.37815e-14    0.0481173 -7.08621e-14 -6.87277e-14    0.0440553 -1.77037e-13  -9.2688e-10  5.21072e-10 -6.21667e-10   -0.0104064 -1.32033e-06  1.32651e-10   -0.0222399    -9.43e-06      0.97942 -1.33582e-13  5.10918e-14  8.95557e-14  2.15076e-10  -1.1263e-10  -0.00417248 -2.16753e-08  1.01826e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481173  4.37104e-14  2.15885e-11 -3.84219e-10 -1.76978e-13    0.0440553 -6.64854e-14  6.43939e-14 -7.58279e-14 -1.32033e-06    0.0104064  1.60909e-14    -9.43e-06    0.0222399   -1.337e-13      0.97942 -1.31023e-10 -1.96683e-10  8.63847e-14 -5.42797e-14 -2.16752e-08   0.00417248 -4.31217e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.98718e-11  8.12501e-14    0.0670098   0.00240141  5.14176e-14  -2.4134e-11  8.86615e-06  1.85286e-05  8.14157e-09 -2.47967e-14 -3.07999e-11  6.24073e-06 -1.53086e-13 -9.04565e-11  5.10918e-14 -1.31023e-10       1.0596  -0.00440412 -2.41071e-05 -2.41071e-05  2.09761e-13 -2.35523e-11   -0.0159918         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.29721e-11 -7.98058e-14  -0.00240141   -0.0670098 -4.63133e-14   1.1838e-11  1.85286e-05  8.86615e-06 -8.14155e-09  2.65799e-14  3.62824e-11 -6.24073e-06  1.51857e-13 -1.41204e-10  8.95557e-14 -1.96683e-10  -0.00440412       1.0596  2.41071e-05  2.41071e-05 -1.50086e-13  1.64385e-10    0.0159918         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.71737e-14 -2.78098e-10 -3.20241e-06  2.41923e-05 -1.51136e-10 -2.18759e-14    0.0337442    0.0308642 -2.74002e-05   8.9416e-11 -1.03217e-14    -0.021003  3.71311e-10  1.55812e-13  2.15076e-10  8.63847e-14 -2.41071e-05  2.41071e-05      1.14073     0.085536 -5.62041e-10  1.16267e-14 -6.03115e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.86408e-14 -2.81198e-10  2.41923e-05 -3.20241e-06 -1.63432e-10 -2.70238e-14   -0.0308642   -0.0337442 -2.74002e-05  8.39335e-11 -8.52978e-15    -0.021003  6.02972e-10  1.54577e-13  -1.1263e-10 -5.42797e-14 -2.41071e-05  2.41071e-05     0.085536      1.14073 -7.02584e-10  7.18193e-14 -6.03115e-06         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  2.9742e-07    0.0572532  5.52921e-13  5.53434e-13   0.00341529  1.77417e-08   4.1284e-09 -4.38905e-09  6.37935e-10   -0.0102623 -1.24874e-06  1.16523e-10   -0.0185867 -7.78444e-06   -0.0190696 -9.90631e-08  5.11378e-14  3.38555e-14  5.04661e-11 -1.50414e-10     0.599386  4.16996e-13 -2.54114e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0572532   2.9742e-07 -8.19173e-11  1.79426e-10  1.77418e-08  -0.00341529 -5.11672e-13  5.11475e-13 -8.04811e-14  1.24874e-06   -0.0102623 -1.65042e-14  7.78444e-06   -0.0185867 -9.90631e-08    0.0190696  2.12093e-11  1.78422e-10 -6.09581e-14  2.40988e-14  4.17127e-13     0.599386  2.61312e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.18673e-11 -5.52758e-14   -0.0423952   -0.0423952  -3.2118e-14  -5.2586e-11 -2.24716e-06  2.24716e-06 -2.65062e-06  2.25284e-14   8.8789e-11  -1.1451e-06 -4.33429e-14  1.15882e-10  8.13467e-14 -4.93167e-10    -0.016942     0.016942 -7.26352e-06 -7.26352e-06 -4.06444e-13  2.39357e-09       1.9863         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
