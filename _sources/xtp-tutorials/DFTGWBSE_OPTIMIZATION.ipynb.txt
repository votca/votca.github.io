{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-25T22:17:50.743509Z",
     "iopub.status.busy": "2022-01-25T22:17:50.740042Z",
     "iopub.status.idle": "2022-01-25T22:18:37.516935Z",
     "shell.execute_reply": "2022-01-25T22:18:37.517330Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2023-dev gitid: c8881d1 (compiled Jan 25 2022, 22:10:37)\r\n",
      "votca_csg, version 2023-dev gitid: c8881d1 (compiled Jan 25 2022, 21:57:49)\r\n",
      "votca_tools, version 2023-dev gitid: c8881d1 (compiled Jan 25 2022, 21:55:33)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 Bohr\r\n",
      "... ... \r\n",
      "... ... =========== OPTIMIZATION SUMMARY ================================= \r\n",
      "... ... At iteration  0\r\n",
      "... ...  ---- POSITIONS (Angstrom)   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    +0.0000  +0.0000  +0.0000\r\n",
      "... ...    1    +1.2000  +0.0000  +0.0000\r\n",
      "... ...    Total energy:     -112.26831841 Hartree \r\n",
      "... ...    Trust radius:       0.01889726 Bohr     \r\n",
      "... ...  ---- FORCES (Hartree/Bohr)   \r\n",
      "... ...       central differences   \r\n",
      "... ...       displacement 0.0010 Angstrom   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    -0.1314  -0.0000  -0.0000\r\n",
      "... ...    1    +0.1314  +0.0000  +0.0000A\r\n",
      "    0.301149 -1.39287e-12   7.7757e-10 -8.98969e-10 -1.20933e-09 -1.05197e-09   -0.0519724   1.0246e-12  -5.9644e-10   -0.0141391    0.0105407 -2.27605e-10    0.0390246 -0.000574411    0.0423984 -8.09223e-13 -1.53549e-10 -3.09803e-10  1.93198e-10 -4.05527e-10    -0.107079  -0.00202449  -6.0816e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.39286e-12     0.301149 -1.58478e-10  3.15846e-10 -2.12495e-10 -9.10957e-11  1.02462e-12   -0.0519724  7.87453e-12   -0.0105407   -0.0141391  3.47804e-12 -0.000574411   -0.0390246 -8.09157e-13    0.0423984 -2.08715e-10  3.61428e-12 -1.62934e-10  6.68044e-12  -0.00202449     0.107079 -6.00494e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  7.7757e-10 -1.58478e-10     0.392881   -0.0726479    -0.110976    -0.110976 -1.75005e-10  9.02639e-11   -0.0543942 -3.36704e-11  1.20741e-10   -0.0245195  1.89975e-09   -6.345e-11   1.1847e-10 -2.97177e-11    0.0361497   -0.0111094    0.0170192   -0.0177148 -8.02922e-09 -4.13628e-10    0.0240881          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-8.98969e-10  3.15846e-10   -0.0726479     0.392881     0.110976     0.110976  2.18932e-10 -1.45039e-10    0.0543942   3.4254e-11 -1.26041e-10    0.0245195 -1.91958e-09  3.80453e-11 -2.13518e-10  1.52006e-10    0.0111094   -0.0361497   -0.0177148    0.0170192  8.11843e-09  5.31575e-10   -0.0240881          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.20933e-09 -2.12495e-10    -0.110976     0.110976      0.45901     0.138777  2.95074e-10  1.11002e-10    0.0729636  1.44658e-10 -3.90895e-11    0.0328901 -2.57456e-09 -2.14093e-12 -2.86996e-10 -1.13883e-10    0.0167938    0.0174894   -0.0208404   -0.0264187  1.08942e-08  1.52096e-10   0.00998299          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.05197e-09 -9.10957e-11    -0.110976     0.110976     0.138777      0.45901  2.40298e-10  6.70756e-11    0.0729636  1.39359e-10 -3.96732e-11    0.0328901 -2.54916e-09 -2.19699e-11 -1.64708e-10 -1.88347e-11    0.0174894    0.0167938    0.0264187    0.0208404  1.07753e-08  2.42095e-10   0.00998299          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0519724  1.02461e-12 -1.75005e-10  2.18932e-10  2.95074e-10  2.40298e-10     0.486835 -2.42228e-13  1.72842e-10    0.0109314  -0.00814935  3.80703e-11   0.00830516 -0.000122245    0.0301449  2.92622e-12 -9.11135e-11    1.012e-10  1.26603e-10  1.34577e-10    0.0549842   0.00103956  3.99309e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  1.0246e-12   -0.0519724  9.02639e-11 -1.45039e-10  1.11002e-10  6.70756e-11 -2.42222e-13     0.486835  6.51215e-13   0.00814935    0.0109314  3.69532e-13 -0.000122245  -0.00830516  2.92619e-12    0.0301449  2.68563e-10  7.38291e-12  2.01913e-10 -9.59875e-12   0.00103956   -0.0549842 -2.31896e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -5.9644e-10  7.87453e-12   -0.0543942    0.0543942    0.0729636    0.0729636  1.72842e-10  6.51215e-13     0.659928  2.68722e-10  -2.0643e-10  -0.00518518  -7.7755e-10  4.25517e-12 -1.32471e-10  3.31027e-13   0.00290763   0.00290763  -0.00378277   0.00378277  5.24983e-09  1.68723e-10  -0.00252607          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0141391   -0.0105407 -3.36704e-11   3.4254e-11  1.44658e-10  1.39359e-10    0.0109314   0.00814935  2.68722e-10     0.668107  7.23627e-13 -7.84576e-11  1.34105e-05  -1.0308e-05  -0.00726376  -0.00541511 -2.59112e-11 -3.26883e-11  1.08791e-09 -4.33751e-11    0.0333149   -0.0238699  -8.0725e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0105407   -0.0141391  1.20741e-10 -1.26041e-10 -3.90895e-11 -3.96732e-11  -0.00814935    0.0109314  -2.0643e-10  7.23865e-13     0.668107  5.95987e-11  -1.0308e-05 -1.34105e-05   0.00541511  -0.00726376   1.0734e-09  2.88639e-11 -2.52659e-11  1.84888e-11   -0.0238699   -0.0333149 -1.12421e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.27605e-10  3.47804e-12   -0.0245195    0.0245195    0.0328901    0.0328901  3.80703e-11  3.69532e-13  -0.00518518 -7.84576e-11  5.95987e-11     0.793012 -5.00994e-10  3.66649e-12  -7.5191e-11  9.06842e-13   0.00932672   0.00932672   -0.0121339    0.0121339  2.00071e-09   6.6164e-11  -0.00103114          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0390246 -0.000574411  1.89975e-09 -1.91958e-09 -2.57456e-09 -2.54916e-09   0.00830516 -0.000122245  -7.7755e-10  1.34105e-05  -1.0308e-05 -5.00994e-10     0.954263 -3.99405e-13   -0.0128737  0.000189491 -1.22861e-09 -1.12088e-09   1.5989e-09 -1.45801e-09    0.0198851  0.000668835  1.18535e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-0.000574411   -0.0390246   -6.345e-11  3.80453e-11 -2.14093e-12 -2.19699e-11 -0.000122245  -0.00830516  4.25517e-12  -1.0308e-05 -1.34105e-05  3.66649e-12 -3.99404e-13     0.954263  0.000189491    0.0128737 -5.52747e-11  8.56192e-11 -5.71048e-11 -5.06251e-11 -0.000668835    0.0198851 -3.53098e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0423984 -8.09157e-13   1.1847e-10 -2.13518e-10 -2.86996e-10 -1.64708e-10    0.0301449  2.92619e-12 -1.32471e-10  -0.00726376   0.00541511  -7.5191e-11   -0.0128737  0.000189491     0.973645  1.58493e-12 -1.19102e-10 -3.33301e-11  1.59416e-10 -4.16089e-11   -0.0229464 -0.000433836 -1.74817e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-8.09223e-13    0.0423984 -2.97177e-11  1.52006e-10 -1.13883e-10 -1.88347e-11  2.92622e-12    0.0301449  3.31027e-13  -0.00541511  -0.00726376  9.06842e-13  0.000189491    0.0128737  1.58493e-12     0.973645  1.25675e-10  7.86806e-12  9.31039e-11 -7.33166e-12 -0.000433836    0.0229464 -5.37981e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.53549e-10 -2.08715e-10    0.0361497    0.0111094    0.0167938    0.0174894 -9.11135e-11  2.68563e-10   0.00290763 -2.59112e-11   1.0734e-09   0.00932672 -1.22861e-09 -5.52747e-11 -1.19102e-10  1.25675e-10      1.03712    0.0179478   -0.0206369    0.0206369  1.53635e-09  -1.5638e-11   0.00299843          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.09803e-10  3.61428e-12   -0.0111094   -0.0361497    0.0174894    0.0167938    1.012e-10  7.38291e-12   0.00290763 -3.26883e-11  2.88639e-11   0.00932672 -1.12088e-09  8.56192e-11 -3.33301e-11  7.86806e-12    0.0179478      1.03712   -0.0206369    0.0206369   1.5866e-09  5.47326e-11   0.00299843          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.93198e-10 -1.62934e-10    0.0170192   -0.0177148   -0.0208404    0.0264187  1.26603e-10  2.01913e-10  -0.00378277  1.08791e-09 -2.52659e-11   -0.0121339   1.5989e-09 -5.71048e-11  1.59416e-10  9.31039e-11   -0.0206369   -0.0206369       1.0481   -0.0289334 -1.99271e-09 -1.11336e-10   0.00431803          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-4.05527e-10  6.68044e-12   -0.0177148    0.0170192   -0.0264187    0.0208404  1.34577e-10 -9.59875e-12   0.00378277 -4.33751e-11  1.84888e-11    0.0121339 -1.45801e-09 -5.06251e-11 -4.16089e-11 -7.33166e-12    0.0206369    0.0206369   -0.0289334       1.0481  2.06307e-09  6.11181e-11  -0.00431803          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0745727   0.00140991  5.48706e-09 -5.50652e-09 -7.38711e-09 -7.36328e-09   -0.0700169  -0.00132377 -4.11237e-09   -0.0247116    0.0177056 -1.74877e-09  -0.00919328  0.000309217    0.0362823  0.000685971 -1.24399e-09 -1.27235e-09  1.61237e-09   -1.653e-09    -0.195058 -8.52225e-12  3.67113e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  0.00140991   -0.0745727  4.31587e-10 -4.55185e-10 -3.00362e-11 -4.95575e-11  -0.00132377    0.0700169 -1.30717e-10    0.0177056    0.0247116 -5.64912e-11 -0.000309217  -0.00919328  0.000685971   -0.0362823  4.20579e-11  1.63373e-12  1.13794e-10 -8.52457e-11 -8.52217e-12    -0.195058  6.16394e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.16216e-11  8.01961e-10   0.00566042  -0.00566042    0.0180399    0.0180399 -5.66051e-11 -7.00167e-10   0.00438095 -1.14681e-09 -1.47415e-09   0.00188206 -1.42575e-10  1.20282e-10  1.81278e-11  3.41328e-11   0.00560718   0.00560718    0.0030795   -0.0030795   8.2078e-10  6.32103e-09      1.05445          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0903883 -6.21256e-13  2.85952e-10 -3.62973e-10 -4.88593e-10 -3.88731e-10   -0.0326152  6.28381e-13  -3.6943e-10   -0.0118767   0.00885406 -1.51548e-10    0.0481023 -0.000708028    0.0477611 -9.28798e-13 -1.01809e-10 -3.12611e-10    1.233e-10 -4.09813e-10   -0.0244241 -0.000461774   -4.259e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.21254e-13    0.0903883 -7.72727e-11  1.77134e-10 -1.23536e-10 -4.65149e-11  6.28393e-13   -0.0326152  4.87706e-12  -0.00885406   -0.0118767  2.35901e-12 -0.000708028   -0.0481023 -9.28735e-13    0.0477611 -2.95726e-10  -9.2126e-12 -2.27839e-10  1.70368e-11 -0.000461774    0.0244241  7.66657e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.85952e-10 -7.72727e-11     0.139691   -0.0348573   -0.0541704   -0.0541704 -8.43901e-11  6.16899e-11   -0.0390782  -2.4234e-11  1.02287e-10   -0.0190747   2.0472e-09 -7.08086e-11  9.98624e-11 -3.05422e-11    0.0543987  -0.00917326    0.0148888   -0.0158245 -4.09384e-10  8.58783e-11    0.0314562         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.62973e-10  1.77134e-10   -0.0348573     0.139691    0.0541704    0.0541704  1.19419e-10 -1.05672e-10    0.0390782  2.48068e-11 -1.08764e-10    0.0190747 -2.07654e-09  3.32739e-11 -2.21747e-10  1.87531e-10   0.00917326   -0.0543987   -0.0158245    0.0148888  4.80689e-10   1.0566e-11   -0.0314562         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-4.88593e-10 -1.23536e-10   -0.0541704    0.0541704     0.171971    0.0671368  1.61153e-10  8.12228e-11    0.0524189  1.22482e-10 -2.83947e-11    0.0255866  -2.7848e-09  2.90793e-12  -2.9804e-10 -1.41458e-10    0.0143483     0.015284   -0.0176816   -0.0458903  6.48696e-10  3.56628e-11    0.0290508         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.88731e-10 -4.65149e-11   -0.0541704    0.0541704    0.0671368     0.171971  1.17171e-10   4.6194e-11    0.0524189  1.16005e-10 -2.89675e-11    0.0255866 -2.74727e-09 -2.64311e-11 -1.41051e-10 -1.95737e-11     0.015284    0.0143483    0.0458903    0.0176816  5.51603e-10  1.07651e-10    0.0290508         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0326152  6.28393e-13 -8.43901e-11  1.19419e-10  1.61153e-10  1.17171e-10     0.236624 -1.35503e-13  1.31185e-10    0.0115303  -0.00859578  2.26183e-11   0.00949836 -0.000139808    0.0424653  4.01631e-12  -1.6343e-10  1.23378e-10  2.24781e-10  1.64872e-10    -0.003595  -6.7969e-05 -5.94264e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.28379e-13   -0.0326152  6.16899e-11 -1.05672e-10  8.12228e-11   4.6194e-11 -1.35495e-13     0.236624  8.07689e-13   0.00859578    0.0115303  4.84939e-13 -0.000139808  -0.00949836  4.01629e-12    0.0424653   4.0275e-10  1.30974e-11  3.02627e-10 -1.58193e-11  -6.7969e-05     0.003595 -8.20326e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " -3.6943e-10  4.87706e-12   -0.0390782    0.0390782    0.0524189    0.0524189  1.31185e-10  8.07689e-13     0.424108  3.28964e-10 -2.52415e-10   -0.0112617 -9.33328e-10  4.62953e-12 -1.79933e-10  4.38351e-13   0.00039566   0.00039566 -0.000514746  0.000514746  1.09702e-09  3.89638e-11   0.00122967         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0118767  -0.00885406  -2.4234e-11  2.48068e-11  1.22482e-10  1.16005e-10    0.0115303   0.00859578  3.28964e-10     0.446812  9.52445e-13 -1.11732e-10 -0.000383858  0.000295053  -0.00865511  -0.00645236 -4.68342e-11 -5.81207e-11  1.82449e-09 -7.90424e-11    0.0144391   -0.0103455 -1.78279e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  0.00885406   -0.0118767  1.02287e-10 -1.08764e-10 -2.83947e-11 -2.89675e-11  -0.00859578    0.0115303 -2.52415e-10  9.52771e-13     0.446812  8.51091e-11  0.000295053  0.000383858   0.00645236  -0.00865511  1.79854e-09  5.30884e-11 -4.59773e-11  3.46908e-11   -0.0103455   -0.0144391 -2.38159e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.51548e-10  2.35901e-12   -0.0190747    0.0190747    0.0255866    0.0255866  2.26183e-11   4.8494e-13   -0.0112617 -1.11732e-10  8.51091e-11     0.627074 -6.51482e-10   4.8131e-12 -1.03755e-10  1.34867e-12    0.0133616    0.0133616   -0.0173832    0.0173832  2.11051e-10  1.00324e-11  0.000508697         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481023 -0.000708028   2.0472e-09 -2.07654e-09  -2.7848e-09 -2.74727e-09   0.00949836 -0.000139808 -9.33328e-10 -0.000383858  0.000295053 -6.51482e-10     0.912954 -7.12446e-13   -0.0215514   0.00031722 -2.20712e-09 -1.98873e-09  2.87235e-09  -2.5867e-09    0.0227033  0.000763627  5.29178e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-0.000708028   -0.0481023 -7.08086e-11  3.32739e-11  2.90793e-12 -2.64311e-11 -0.000139808  -0.00949836  4.62953e-12  0.000295053  0.000383858   4.8131e-12 -7.12441e-13     0.912954   0.00031722    0.0215514 -1.18689e-10  1.66964e-10 -1.16983e-10 -1.01413e-10 -0.000763627    0.0227033    1.067e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0477611 -9.28731e-13  9.98624e-11 -2.21747e-10  -2.9804e-10 -1.41051e-10    0.0424653  4.01629e-12 -1.79933e-10  -0.00865511   0.00645236 -1.03755e-10   -0.0215514   0.00031722     0.952112  3.01124e-12 -1.95886e-10 -5.10327e-11  2.62328e-10 -6.32525e-11   0.00321148  6.07179e-05 -2.68377e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-9.28798e-13    0.0477611 -3.05422e-11  1.87531e-10 -1.41458e-10 -1.95737e-11  4.01631e-12    0.0424653  4.38351e-13  -0.00645236  -0.00865511  1.34867e-12   0.00031722    0.0215514  3.01125e-12     0.952112  2.08225e-10  9.14946e-12  1.54199e-10 -9.34565e-12  6.07179e-05  -0.00321148 -4.76137e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.01809e-10 -2.95726e-10    0.0543987   0.00917326    0.0143483     0.015284  -1.6343e-10   4.0275e-10   0.00039566 -4.68342e-11  1.79854e-09    0.0133616 -2.20712e-09 -1.18689e-10 -1.95886e-10  2.08225e-10       1.0748    0.0338355   -0.0382959    0.0382959  4.72785e-10 -1.00455e-10    0.0122882         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.12611e-10  -9.2126e-12  -0.00917326   -0.0543987     0.015284    0.0143483  1.23378e-10  1.30974e-11   0.00039566 -5.81207e-11  5.30884e-11    0.0133616 -1.98873e-09  1.66964e-10 -5.10327e-11  9.14946e-12    0.0338355       1.0748   -0.0382959    0.0382959  5.96108e-10  7.26043e-11    0.0122882         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   1.233e-10 -2.27839e-10    0.0148888   -0.0158245   -0.0176816    0.0458903  2.24781e-10  3.02627e-10 -0.000514746  1.82449e-09 -4.59773e-11   -0.0173832  2.87235e-09 -1.16983e-10  2.62328e-10  1.54199e-10   -0.0382959   -0.0382959      1.09519   -0.0542215 -6.04347e-10 -1.06122e-10    0.0113662         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-4.09813e-10  1.70368e-11   -0.0158245    0.0148888   -0.0458903    0.0176816  1.64872e-10 -1.58193e-11  0.000514746 -7.90424e-11  3.46908e-11    0.0173832  -2.5867e-09 -1.01413e-10 -6.32525e-11 -9.34565e-12    0.0382959    0.0382959   -0.0542215      1.09519  7.77107e-10 -1.68655e-11   -0.0113662         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0559715  -0.00105822  -3.9366e-09  4.00479e-09  5.37915e-09  5.28676e-09  -0.00259784  -4.9116e-05  1.12601e-09   0.00896742  -0.00642509  2.79863e-10     0.017773 -0.000597795    0.0179749  0.000339842 -5.55068e-11 -7.82559e-11  6.32471e-11 -9.78886e-11     0.583856  -9.3116e-12   2.7807e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " -0.00105822    0.0559715 -8.47998e-11  1.76354e-10  1.30915e-10   1.9998e-10  -4.9116e-05   0.00259784  3.49091e-11  -0.00642509  -0.00896742  8.88757e-12  0.000597795     0.017773  0.000339842   -0.0179749  1.40838e-10  1.06518e-10  1.14893e-10 -9.18055e-11 -9.31149e-12     0.583856  4.58156e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.64921e-11  4.39737e-10    0.0320684   -0.0320684    0.0290237    0.0290237 -3.68746e-12 -8.79743e-10   0.00256713 -1.64344e-09 -2.19291e-09   0.00131212 -9.27761e-11  7.03464e-11 -5.00735e-12 -6.05217e-10    0.0136742    0.0136742    0.0110143   -0.0110143   7.6516e-10  5.08431e-09      2.11719         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.1"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
