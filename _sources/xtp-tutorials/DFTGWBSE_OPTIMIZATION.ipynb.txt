{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-04-29T06:05:07.886567Z",
     "iopub.status.busy": "2022-04-29T06:05:07.886096Z",
     "iopub.status.idle": "2022-04-29T06:05:41.482328Z",
     "shell.execute_reply": "2022-04-29T06:05:41.482726Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2023-dev gitid: 3bb0876 (compiled Apr 29 2022, 05:57:44)\r\n",
      "votca_csg, version 2023-dev gitid: 3bb0876 (compiled Apr 29 2022, 05:44:40)\r\n",
      "votca_tools, version 2023-dev gitid: 3bb0876 (compiled Apr 29 2022, 05:42:07)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 BohrA\r\n",
      "    0.307132 -3.06541e-11  1.79789e-10  5.20028e-10  2.32508e-11   -0.0516061  1.11687e-09 -1.03711e-09  3.87688e-10    0.0181647   0.00104223  1.10477e-10   -0.0104099    0.0375596 -2.00553e-11    0.0421019 -2.08587e-10  9.12276e-11  3.57767e-10  1.58906e-10  0.000479234    -0.108408 -1.82917e-10 -2.53306e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.06541e-11     0.307132  3.89176e-10  3.09418e-10   -0.0516061  2.32508e-11 -2.45183e-09  2.79206e-09 -8.22079e-10   0.00104223   -0.0181647 -3.85162e-10   -0.0375596   -0.0104099    0.0421019 -2.00554e-11  1.92259e-10  6.60175e-12 -5.01632e-10 -6.18992e-10    -0.108408 -0.000479234 -1.68334e-11  5.10254e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.79789e-10  3.89176e-10     0.320606   -0.0092889 -1.39616e-11 -3.03691e-11   -0.0131814    0.0131814  -0.00491537  1.46113e-10 -1.02581e-10   -0.0020941 -1.19078e-11 -2.07324e-10  1.19212e-10 -7.52398e-12   -0.0470491   0.00129348  -0.00255812   -0.0152396 -9.89025e-10  3.14288e-10    -0.025486    0.0215282          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.20028e-10  3.09418e-10   -0.0092889     0.320606 -2.23161e-11 -4.35093e-10   -0.0131814    0.0131814  -0.00491537  1.66388e-10 -1.48488e-10   -0.0020941  8.11906e-12 -1.82418e-10  1.27735e-11  4.05409e-10  -0.00129348    0.0470491   -0.0152396  -0.00255812 -9.65071e-10 -2.05869e-10    -0.025486   -0.0215282          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.32508e-11   -0.0516061 -1.39616e-11 -2.23161e-11     0.490902 -2.83995e-12 -1.49002e-09  1.08529e-09 -6.28855e-10 -0.000771199     0.013441 -1.85913e-10  -0.00770346  -0.00213506    0.0309987  6.62194e-11  4.61902e-11 -3.03355e-10 -2.07822e-10 -6.14899e-11    0.0531267  0.000234855 -2.09521e-10  -4.0787e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0516061  2.32508e-11 -3.03691e-11 -4.35093e-10 -2.83996e-12     0.490902 -9.28592e-11  1.01214e-10 -6.25247e-11    -0.013441 -0.000771199  5.24844e-12  -0.00213506   0.00770346  6.62193e-11    0.0309987  1.53581e-10 -7.24941e-12 -8.26915e-11  1.74474e-10 -0.000234855    0.0531267  -4.4572e-11   1.2315e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.11687e-09 -2.45183e-09   -0.0131814   -0.0131814 -1.49002e-09 -9.28592e-11     0.549584    -0.219689    0.0856686  1.43393e-11  7.24895e-10    0.0364975  8.31285e-10  2.62375e-09  6.31707e-10  2.54392e-10   -0.0113621  -0.00131937   -0.0126968    0.0330588  1.34033e-08 -8.27043e-09   0.00154632  -0.00418358          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.03711e-09  2.79206e-09    0.0131814    0.0131814  1.08529e-09  1.01214e-10    -0.219689     0.549584   -0.0856686 -6.02461e-11 -7.45171e-10   -0.0364975 -8.56191e-10 -2.60372e-09 -2.18775e-10 -1.47954e-10  -0.00131937   -0.0113621   -0.0330588    0.0126968  -1.3917e-08  8.24293e-09  -0.00154632  -0.00418357          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.87688e-10 -8.22079e-10  -0.00491537  -0.00491537 -6.28855e-10 -6.25247e-11    0.0856686   -0.0856686     0.662947  1.80022e-10  5.81849e-10  -0.00632525  2.92476e-10  7.02057e-10  3.36774e-10  9.71472e-11  -0.00131772   0.00131772   0.00387636   0.00387636  4.33966e-09 -3.05367e-09   0.00112656 -1.73456e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0181647   0.00104223  1.46113e-10  1.66388e-10 -0.000771199    -0.013441  1.43393e-11 -6.02461e-11  1.80022e-10     0.680922 -1.60095e-12 -8.83658e-11 -2.70959e-05  7.97082e-05  0.000494743   0.00862274 -3.86241e-10 -2.44798e-13 -8.09518e-11 -8.90866e-10  -0.00216906   -0.0409702  6.68859e-10 -9.55059e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  0.00104223   -0.0181647 -1.02581e-10 -1.48488e-10     0.013441 -0.000771199  7.24895e-10 -7.45171e-10  5.81849e-10 -1.60091e-12     0.680922 -6.20484e-11  7.97082e-05  2.70959e-05  -0.00862274  0.000494743  4.18629e-12 -8.14101e-10 -3.77084e-10   9.4022e-12    0.0409702  -0.00216906 -8.09472e-10 -6.03585e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.10477e-10 -3.85162e-10   -0.0020941   -0.0020941 -1.85913e-10  5.24844e-12    0.0364975   -0.0364975  -0.00632525 -8.83658e-11 -6.20484e-11      0.79826 -1.23136e-11  3.26471e-10 -1.10193e-10  5.77037e-11   -0.0046587    0.0046587    0.0137046    0.0137046  1.73224e-09 -9.75795e-10  0.000446601 -7.03177e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0104099   -0.0375596 -1.19078e-11  8.11906e-12  -0.00770346  -0.00213506  8.31285e-10 -8.56191e-10  2.92476e-10 -2.70959e-05  7.97082e-05 -1.23136e-11     0.956418  -4.2946e-11    0.0126648   0.00351012 -1.23827e-10  2.37463e-10  6.52703e-10  4.30334e-10   -0.0192715  -0.00543306 -6.81741e-12 -1.89864e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0375596   -0.0104099 -2.07324e-10 -1.82418e-10  -0.00213506   0.00770346  2.62375e-09 -2.60372e-09  7.02057e-10  7.97082e-05  2.70959e-05  3.26471e-10 -4.29461e-11     0.956418   0.00351012   -0.0126648 -4.25223e-10  6.47592e-10   1.4916e-09  1.60523e-09  -0.00543306    0.0192715  8.93096e-11  1.17942e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.00553e-11    0.0421019  1.19212e-10  1.27735e-11    0.0309987  6.62193e-11  6.31707e-10 -2.18775e-10  3.36774e-10  0.000494743  -0.00862274 -1.10193e-10    0.0126648   0.00351012     0.988566  3.74479e-11  2.92521e-11 -1.10926e-10  3.59525e-11 -6.16631e-11   -0.0223628 -9.88585e-05 -3.29957e-10 -5.61022e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0421019 -2.00554e-11 -7.52398e-12  4.05409e-10  6.62194e-11    0.0309987  2.54392e-10 -1.47954e-10  9.71472e-11   0.00862274  0.000494743  5.77037e-11   0.00351012   -0.0126648  3.74479e-11     0.988566 -7.18323e-12 -9.04324e-11  6.76072e-11  1.49281e-10  9.88586e-05   -0.0223628 -1.73207e-10  2.09919e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.08587e-10  1.92259e-10   -0.0470491  -0.00129348  4.61902e-11  1.53581e-10   -0.0113621  -0.00131937  -0.00131772 -3.86241e-10  4.18629e-12   -0.0046587 -1.23827e-10 -4.25223e-10  2.92521e-11 -7.18323e-12      1.03321  -0.00657359   -0.0132542   -0.0132542 -8.26757e-10  5.54171e-10   0.00427463 -8.76747e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 9.12276e-11  6.60175e-12   0.00129348    0.0470491 -3.03355e-10 -7.24941e-12  -0.00131937   -0.0113621   0.00131772 -2.44798e-13 -8.14101e-10    0.0046587  2.37463e-10  6.47592e-10 -1.10926e-10 -9.04324e-11  -0.00657359      1.03321    0.0132542    0.0132542  7.79991e-10  -4.5231e-10  -0.00427463 -8.76754e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.57767e-10 -5.01632e-10  -0.00255812   -0.0152396 -2.07822e-10 -8.26915e-11   -0.0126968   -0.0330588   0.00387636 -8.09518e-11 -3.77084e-10    0.0137046  6.52703e-10   1.4916e-09  3.59525e-11  6.76072e-11   -0.0132542    0.0132542       1.0677    0.0410579  2.36658e-09   -1.587e-09   0.00204462  0.000145434          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.58906e-10 -6.18992e-10   -0.0152396  -0.00255812 -6.14899e-11  1.74474e-10    0.0330588    0.0126968   0.00387636 -8.90866e-10   9.4022e-12    0.0137046  4.30334e-10  1.60523e-09 -6.16631e-11  1.49281e-10   -0.0132542    0.0132542    0.0410579       1.0677  2.46754e-09 -1.53968e-09   0.00204462 -0.000145435          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -0.00033264    0.0752465  6.87698e-10  7.32616e-10   -0.0690159  0.000305096 -8.05774e-09  8.33534e-09 -3.16322e-09   0.00163654   -0.0309116 -1.54302e-09   0.00866557   0.00244301    0.0364086  -0.00016095  5.59368e-10 -5.58802e-10 -1.77503e-09 -1.77854e-09    -0.194424  2.21883e-10 -4.21874e-09 -7.85083e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0752465   0.00033264  9.01072e-13  2.85222e-10 -0.000305096   -0.0690159  5.49097e-09 -5.53354e-09   2.3842e-09    0.0309116   0.00163654  8.87168e-10   0.00244301  -0.00866557   0.00016095    0.0364086 -4.82157e-10  4.77913e-10  1.28074e-09  1.27929e-09  2.21883e-10    -0.194424 -5.54342e-09  2.63376e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.99109e-10  5.29825e-10   -0.0141891   -0.0141891 -3.68887e-10 -5.51687e-10  -0.00432759   0.00432759  -0.00131327  1.02977e-09  -1.0896e-09 -0.000526556   8.3621e-11 -8.17552e-11   4.0694e-11   2.5166e-10   0.00597506  -0.00597506   0.00150862   0.00150862 -4.42927e-09 -5.45724e-09      0.95831  1.23931e-08          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.73464e-10  1.57665e-10  -0.00600155   0.00600155  -3.0578e-10 -2.52142e-11  0.000772359  0.000772355  1.00918e-09 -8.45085e-10 -5.92177e-10  5.00163e-10 -2.06115e-11  2.43647e-10 -1.10607e-10  1.80835e-10  -0.00416365  -0.00416365   0.00210382  -0.00210382 -8.24615e-10  2.97281e-09  1.25457e-08     0.091468          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "    0.093811 -1.36243e-11   9.6136e-11  3.20836e-10  1.42988e-11   -0.0328898  4.68343e-10 -4.11375e-10  2.38563e-10    0.0155316  0.000891153  6.35556e-11    -0.012908     0.046573 -2.33008e-11    0.0481429 -2.59321e-10  1.01761e-10  3.59499e-10  8.39273e-11  0.000110993   -0.0251078  4.90461e-10 -5.34196e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.36243e-11     0.093811  2.01296e-10  1.44328e-10   -0.0328898  1.42988e-11 -9.67702e-10   1.1924e-09   -5.073e-10  0.000891153   -0.0155316 -2.54838e-10    -0.046573    -0.012908    0.0481429 -2.33008e-11  1.65048e-10  1.10524e-10  -4.2988e-10 -5.87441e-10   -0.0251078 -0.000110993  5.38573e-10  2.02273e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  9.6136e-11  2.01296e-10     0.105871  -0.00531104 -1.86269e-11 -2.58739e-11  -0.00667767   0.00667767  -0.00361458  1.36139e-10 -8.75889e-11  -0.00164194 -2.39902e-11 -2.30117e-10  1.50957e-10 -1.30756e-11    -0.064047   0.00170976  -0.00245678   -0.0197339   -7.996e-11  1.94542e-10   -0.0418868    0.0157699         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.20836e-10  1.44328e-10  -0.00531104     0.105871 -2.21818e-11 -3.15387e-10  -0.00667767   0.00667767  -0.00361458  1.60333e-10 -1.30163e-10  -0.00164194  2.84933e-12 -1.93242e-10  9.16141e-12  5.05886e-10  -0.00170976     0.064047   -0.0197339  -0.00245678 -5.36922e-12 -4.78807e-11   -0.0418868   -0.0157699         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.42988e-11   -0.0328898 -1.86269e-11 -2.21818e-11     0.240891 -6.67489e-13  -9.4403e-10  6.54517e-10   -5.494e-10 -0.000828764    0.0144443 -1.60931e-10  -0.00881126  -0.00244209    0.0441772  9.20509e-11  4.10564e-11 -4.25168e-10  -2.1489e-10 -1.14881e-11  -0.00438142 -1.93688e-05 -5.21191e-10 -2.96653e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0328898  1.42988e-11 -2.58739e-11 -3.15387e-10 -6.67493e-13     0.240891 -4.37021e-11   4.7257e-11  -4.4667e-11   -0.0144443 -0.000828764  1.06073e-11  -0.00244209   0.00881126  9.20507e-11    0.0441772  2.22794e-10 -1.93921e-11 -1.02545e-10  2.81566e-10  1.93688e-05  -0.00438142 -4.88399e-10   3.2728e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.68343e-10 -9.67702e-10  -0.00667767  -0.00667767  -9.4403e-10 -4.37021e-11     0.221871    -0.110689    0.0629974  1.79217e-11  5.48435e-10     0.028617  9.97752e-10   2.9023e-09  7.94488e-10  2.58566e-10    -0.010092  -0.00718514   -0.0330791    0.0292581  1.48721e-09 -5.30465e-10  -0.00289832  -0.00345867         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-4.11375e-10   1.1924e-09   0.00667767   0.00667767  6.54517e-10   4.7257e-11    -0.110689     0.221871   -0.0629974 -6.04953e-11 -5.72629e-10    -0.028617 -1.03463e-09 -2.87546e-09 -2.75526e-10 -1.16771e-10  -0.00718514    -0.010092   -0.0292581    0.0330791 -1.72927e-09  4.54702e-10   0.00289832  -0.00345867         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.38563e-10   -5.073e-10  -0.00361458  -0.00361458   -5.494e-10  -4.4667e-11    0.0629974   -0.0629974     0.429278  2.30995e-10  6.84381e-10   -0.0121538  4.21011e-10  8.98005e-10   4.7045e-10  1.29886e-10  6.21239e-06 -6.21241e-06 -1.82751e-05 -1.82751e-05  1.01345e-09 -6.37871e-10   5.5723e-05 -4.40275e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0155316  0.000891153  1.36139e-10  1.60333e-10 -0.000828764   -0.0144443  1.79217e-11 -6.04953e-11  2.30995e-10     0.463967   -2.138e-12 -1.17868e-10 -0.000208171  0.000612378  0.000594332    0.0103584 -6.62604e-10  5.03689e-12 -1.34046e-10 -1.50719e-09 -0.000937615   -0.0177101  1.63365e-09 -1.75455e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 0.000891153   -0.0155316 -8.75889e-11 -1.30163e-10    0.0144443 -0.000828764  5.48435e-10 -5.72629e-10  6.84381e-10 -2.13794e-12     0.463967 -1.23373e-10  0.000612378  0.000208171   -0.0103584  0.000594332  2.66586e-11  -1.3998e-09 -6.96529e-10 -3.89624e-11    0.0177101 -0.000937615 -1.78282e-09 -1.09076e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.35556e-11 -2.54838e-10  -0.00164194  -0.00164194 -1.60931e-10  1.06073e-11     0.028617    -0.028617   -0.0121538 -1.17868e-10 -1.23373e-10     0.636067 -4.97811e-11  4.09069e-10 -1.95665e-10  8.28152e-11  -0.00673588   0.00673588     0.019815     0.019815   9.9251e-11  -2.3176e-12  4.39386e-05 -9.06814e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   -0.012908    -0.046573 -2.39902e-11  2.84933e-12  -0.00881126  -0.00244209  9.97752e-10 -1.03463e-09  4.21011e-10 -0.000208171  0.000612378 -4.97811e-11     0.917068 -7.52937e-11    0.0214816   0.00595376 -2.20544e-10  4.53257e-10  1.22499e-09  7.72833e-10    -0.022374  -0.00630772  1.02111e-10 -3.84418e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "    0.046573    -0.012908 -2.30117e-10 -1.93242e-10  -0.00244209   0.00881126   2.9023e-09 -2.87546e-09  8.98005e-10  0.000612378  0.000208171  4.09069e-10 -7.52937e-11     0.917068   0.00595376   -0.0214816 -7.42837e-10  1.19499e-09  2.67335e-09  2.90606e-09  -0.00630772     0.022374  6.28514e-11  4.29595e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.33008e-11    0.0481429  1.50957e-10  9.16141e-12    0.0441772  9.20507e-11  7.94488e-10 -2.75526e-10   4.7045e-10  0.000594332   -0.0103584 -1.95665e-10    0.0214816   0.00595376     0.981535   7.2185e-11  5.43238e-11 -1.86563e-10  5.46709e-11 -1.35501e-10   0.00424838  1.87807e-05 -2.61192e-10 -1.02799e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481429 -2.33008e-11 -1.30756e-11  5.05886e-10  9.20508e-11    0.0441772  2.58566e-10 -1.16771e-10  1.29886e-10    0.0103584  0.000594332  8.28152e-11   0.00595376   -0.0214816   7.2185e-11     0.981535 -2.95923e-11 -1.60579e-10  1.09575e-10  2.41815e-10 -1.87806e-05   0.00424838  1.75263e-10  3.80762e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.59321e-10  1.65048e-10    -0.064047  -0.00170976  4.10564e-11  2.22794e-10    -0.010092  -0.00718514  6.21239e-06 -6.62604e-10  2.66586e-11  -0.00673588 -2.20544e-10 -7.42837e-10  5.43238e-11 -2.95923e-11      1.06909   -0.0128236   -0.0247674   -0.0247674 -3.95187e-10   2.1108e-10    0.0150493  -0.00575228         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.01761e-10  1.10524e-10   0.00170976     0.064047 -4.25168e-10 -1.93921e-11  -0.00718514    -0.010092 -6.21241e-06  5.03689e-12  -1.3998e-09   0.00673588  4.53257e-10  1.19499e-09 -1.86563e-10 -1.60579e-10   -0.0128236      1.06909    0.0247674    0.0247674  2.19625e-10  7.56562e-13   -0.0150493  -0.00575228         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.59499e-10  -4.2988e-10  -0.00245678   -0.0197339  -2.1489e-10 -1.02545e-10   -0.0330791   -0.0292581 -1.82751e-05 -1.34046e-10 -6.96529e-10     0.019815  1.22499e-09  2.67335e-09  5.46709e-11  1.09575e-10   -0.0247674    0.0247674      1.13353    0.0772627   8.7928e-10 -5.99911e-10   0.00545608   0.00308497         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 8.39273e-11 -5.87441e-10   -0.0197339  -0.00245678 -1.14881e-11  2.81566e-10    0.0292581    0.0330791 -1.82751e-05 -1.50719e-09 -3.89624e-11     0.019815  7.72833e-10  2.90606e-09 -1.35501e-10  2.41815e-10   -0.0247674    0.0247674    0.0772627      1.13353  1.09034e-09 -4.24524e-10   0.00545608  -0.00308497         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 0.000253555   -0.0573567 -4.73356e-10 -4.21398e-10  -0.00347861  1.53778e-05  7.51709e-09 -7.82074e-09  1.20411e-09  -0.00053955    0.0101912  2.34295e-10   -0.0179417  -0.00505816    0.0191591 -8.46961e-05 -9.06775e-11  7.11598e-11 -1.66105e-10  5.08473e-12     0.600541  2.22335e-10 -3.19285e-09 -4.37308e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0573567 -0.000253555  3.45341e-10  4.25312e-11 -1.53778e-05  -0.00347861 -4.34614e-09  4.29277e-09 -7.17394e-10   -0.0101912  -0.00053955 -1.52091e-10  -0.00505816    0.0179417  8.46961e-05    0.0191591 -1.00942e-10  2.71837e-10  3.20555e-11  5.07613e-11  2.22335e-10     0.600541  -5.0434e-09  3.61449e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.98168e-10  3.36974e-10   -0.0423676   -0.0423676  -5.9119e-10 -4.72947e-10  -0.00286733   0.00286733 -0.000439236  1.50209e-09 -1.61585e-09 -0.000214875  5.05508e-11  4.23358e-11 -3.64381e-10  1.53279e-10    0.0160893   -0.0160893   0.00534478   0.00534478 -3.64971e-09 -5.04757e-09      1.98482  1.58587e-08         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-5.65039e-10  1.58278e-10    0.0177842   -0.0177842 -2.58056e-10  5.90071e-11  -0.00391319  -0.00391318 -9.08078e-10  -1.6838e-09 -1.08933e-09 -2.82518e-10 -5.43272e-11  4.82607e-10 -1.25993e-10  4.01367e-10  -0.00693908  -0.00693908   0.00362967  -0.00362967 -6.19355e-10  4.07456e-09  1.59994e-08     0.774473         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
