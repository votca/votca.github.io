{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2023-06-03T02:21:40.283879Z",
     "iopub.status.busy": "2023-06-03T02:21:40.283541Z",
     "iopub.status.idle": "2023-06-03T02:22:34.594168Z",
     "shell.execute_reply": "2023-06-03T02:22:34.593366Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/votca/issues\r\n",
      "\r\n",
      "xtp_tools, version 2023-rc.2 gitid: 955b1f7 (compiled Jun  3 2023, 02:18:42)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 Bohr\r\n",
      "... ... \r\n",
      "... ... =========== OPTIMIZATION SUMMARY ================================= \r\n",
      "... ... At iteration  0\r\n",
      "... ...  ---- POSITIONS (Angstrom)   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    +0.0000  +0.0000  +0.0000\r\n",
      "... ...    1    +1.2000  +0.0000  +0.0000\r\n",
      "... ...    Total energy:     -112.26831841 Hartree \r\n",
      "... ...    Trust radius:       0.01889726 Bohr     \r\n",
      "... ...  ---- FORCES (Hartree/Bohr)   \r\n",
      "... ...       central differences   \r\n",
      "... ...       displacement 0.0010 Angstrom   \r\n",
      "... ...  Atom\t x\t  y\t  z \r\n",
      "... ...    0    -0.1314  -0.0000  -0.0000\r\n",
      "... ...    1    +0.1314  +0.0000  +0.0000A\r\n",
      "    0.301149 -1.39205e-12  7.71068e-10 -8.88205e-10 -1.19886e-09 -1.04164e-09   -0.0519724  1.01998e-12  5.92028e-10    0.0141617   -0.0105104  2.25008e-10   -0.0390253  0.000525695    0.0423984   -8.047e-13  1.50874e-10  3.07576e-10  -1.9198e-10  4.04682e-10    -0.107077   0.00212867 -6.00653e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.39205e-12     0.301149 -1.48535e-10  3.05756e-10 -2.20345e-10 -1.03207e-10  1.01989e-12   -0.0519724 -2.96398e-12    0.0105104    0.0141617 -6.48836e-13  0.000525695    0.0390253 -8.04694e-13    0.0423984  2.10765e-10 -1.93704e-12  1.60777e-10 -4.07525e-12  -0.00212867    -0.107077 -5.83738e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 7.71068e-10 -1.48535e-10     0.392406   -0.0721727    -0.110833    -0.110833 -1.83464e-10  9.47904e-11    0.0542378  3.42874e-11   -1.165e-10     0.024449 -1.89894e-09  5.73118e-11  1.23839e-10 -3.05356e-11   -0.0362457    0.0110143   -0.0170119    0.0176485 -7.98027e-09  3.82755e-10    0.0241798          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-8.88205e-10  3.05756e-10   -0.0721727     0.392406     0.110833     0.110833  2.22253e-10 -1.49114e-10   -0.0542378 -3.37775e-11  1.20785e-10    -0.024449  1.91885e-09 -3.18118e-11 -2.13812e-10  1.52367e-10   -0.0110143    0.0362457    0.0176485   -0.0170119  8.06217e-09 -5.00022e-10   -0.0241798          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.19886e-09 -2.20345e-10    -0.110833     0.110833     0.459485     0.139252  3.01554e-10  1.00526e-10     -0.07308 -1.43157e-10  3.35474e-11   -0.0329426  2.58532e-09  1.00566e-11 -2.88591e-10 -1.07655e-10   -0.0168057   -0.0174423    0.0209361    0.0263239  1.08674e-08 -1.19104e-10   0.00983261          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.04164e-09 -1.03207e-10    -0.110833     0.110833     0.139252     0.459485   2.4723e-10  6.17373e-11     -0.07308 -1.38872e-10  3.30375e-11   -0.0329426  2.55982e-09  2.99673e-11 -1.66759e-10 -1.76816e-11   -0.0174423   -0.0168057   -0.0263239   -0.0209361  1.07492e-08 -2.01836e-10   0.00983261          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0519724  1.01989e-12 -1.83464e-10  2.22253e-10  3.01554e-10   2.4723e-10     0.486835 -2.45031e-13 -1.77663e-10   -0.0109489   0.00812591  -3.9654e-11  -0.00830531  0.000111878    0.0301449  2.91497e-12  9.08166e-11 -1.01779e-10 -1.26311e-10 -1.35273e-10    0.0549831  -0.00109306  4.02869e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.01998e-12   -0.0519724  9.47904e-11 -1.49114e-10  1.00526e-10  6.17373e-11 -2.45034e-13     0.486835  4.00979e-12  -0.00812591   -0.0109489  1.15253e-12  0.000111878   0.00830531  2.91502e-12    0.0301449 -2.68856e-10 -7.27122e-12 -2.02181e-10  9.58584e-12   0.00109306    0.0549831 -2.31538e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.92028e-10 -2.96398e-12    0.0542378   -0.0542378     -0.07308     -0.07308 -1.77663e-10  4.00979e-12     0.659928  2.68717e-10 -2.00996e-10  -0.00518518 -7.77966e-10  3.31171e-12  1.34331e-10 -2.17961e-12   0.00289479   0.00289479  -0.00379261   0.00379261 -5.23473e-09  1.55528e-10   0.00257413          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0141617    0.0105104  3.42874e-11 -3.37775e-11 -1.43157e-10 -1.38872e-10   -0.0109489  -0.00812591  2.68717e-10     0.668107  7.22409e-13 -7.86586e-11  1.34454e-05 -1.02625e-05   0.00727534   0.00539954 -2.63123e-11 -2.97429e-11  1.09064e-09 -4.34077e-11   -0.0333891    -0.023766  8.10586e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0105104    0.0141617   -1.165e-10  1.20785e-10  3.35474e-11  3.30375e-11   0.00812591   -0.0109489 -2.00996e-10  7.22327e-13     0.668107  5.95664e-11 -1.02625e-05 -1.34454e-05  -0.00539954   0.00727534  1.07664e-09  2.94101e-11  -2.6275e-11  2.28443e-11     0.023766   -0.0333891  1.12766e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.25008e-10 -6.48836e-13     0.024449    -0.024449   -0.0329426   -0.0329426  -3.9654e-11  1.15253e-12  -0.00518518 -7.86586e-11  5.95664e-11     0.793012 -5.03133e-10  1.21231e-12  7.47808e-11 -4.81199e-13   0.00928553   0.00928553   -0.0121654    0.0121654 -1.99248e-09  5.84414e-11   0.00105162          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0390253  0.000525695 -1.89894e-09  1.91885e-09  2.58532e-09  2.55982e-09  -0.00830531  0.000111878 -7.77966e-10  1.34454e-05 -1.02625e-05 -5.03133e-10     0.954263 -3.99554e-13    0.0128739  -0.00017342 -1.22478e-09 -1.11878e-09  1.60573e-09 -1.46473e-09   -0.0198852  0.000663359 -1.20131e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 0.000525695    0.0390253  5.73118e-11 -3.18118e-11  1.00566e-11  2.99673e-11  0.000111878   0.00830531  3.31171e-12 -1.02625e-05 -1.34454e-05  1.21231e-12 -3.99541e-13     0.954263  -0.00017342   -0.0128739 -5.82196e-11  8.27796e-11 -5.24234e-11  -5.3581e-11  0.000663359    0.0198852  3.45538e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0423984 -8.04693e-13  1.23839e-10 -2.13812e-10 -2.88591e-10 -1.66759e-10    0.0301449  2.91502e-12  1.34331e-10   0.00727534  -0.00539954  7.47808e-11    0.0128739  -0.00017342     0.973645  1.57434e-12  1.20407e-10  3.23021e-11 -1.60359e-10   4.2051e-11    -0.022946  0.000456162 -1.84021e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -8.047e-13    0.0423984 -3.05356e-11  1.52367e-10 -1.07655e-10 -1.76816e-11  2.91497e-12    0.0301449 -2.17961e-12   0.00539954   0.00727534 -4.81199e-13  -0.00017342   -0.0128739  1.57434e-12     0.973645 -1.26404e-10 -8.09539e-12 -9.35339e-11   5.4291e-12 -0.000456162    -0.022946 -5.39202e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.50874e-10  2.10765e-10   -0.0362457   -0.0110143   -0.0168057   -0.0174423  9.08166e-11 -2.68856e-10   0.00289479 -2.63123e-11  1.07664e-09   0.00928553 -1.22478e-09 -5.82196e-11  1.20407e-10 -1.26404e-10      1.03698     0.017808   -0.0205991    0.0205991 -1.52518e-09 -2.03128e-11  -0.00300231          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.07576e-10 -1.93704e-12    0.0110143    0.0362457   -0.0174423   -0.0168057 -1.01779e-10 -7.27122e-12   0.00289479 -2.97429e-11  2.94101e-11   0.00928553 -1.11878e-09  8.27796e-11  3.23021e-11 -8.09539e-12     0.017808      1.03698   -0.0205991    0.0205991 -1.57445e-09  5.00881e-11  -0.00300231          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -1.9198e-10  1.60777e-10   -0.0170119    0.0176485    0.0209361   -0.0263239 -1.26311e-10 -2.02181e-10  -0.00379261  1.09064e-09  -2.6275e-11   -0.0121654  1.60573e-09 -5.24234e-11 -1.60359e-10 -9.35339e-11   -0.0205991   -0.0205991      1.04824   -0.0290732  1.99158e-09 -1.05245e-10  -0.00431975          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.04682e-10 -4.07525e-12    0.0176485   -0.0170119    0.0263239   -0.0209361 -1.35273e-10  9.58584e-12   0.00379261 -4.34077e-11  2.28443e-11    0.0121654 -1.46473e-09  -5.3581e-11   4.2051e-11   5.4291e-12    0.0205991    0.0205991   -0.0290732      1.04824 -2.06198e-09  5.59972e-11   0.00431975          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0745713   0.00148247  5.45905e-09 -5.47359e-09 -7.37501e-09 -7.35179e-09   -0.0700155   -0.0013919  4.10203e-09    0.0247666   -0.0176286  1.74246e-09   0.00919336 -0.000306685    0.0362816  0.000721272  1.23497e-09  1.26386e-09 -1.61283e-09  1.65366e-09    -0.195058  8.53151e-12  3.83159e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -0.00148247    0.0745713 -4.16026e-10  4.39003e-10    1.585e-11  3.05047e-11    0.0013919   -0.0700155 -1.22187e-10    0.0176286    0.0247666 -5.07876e-11 -0.000306685  -0.00919336 -0.000721272    0.0362816  4.46484e-11  4.02319e-12  1.10572e-10 -8.14834e-11  8.53147e-12    -0.195058 -6.14551e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.14756e-11  8.00714e-10   0.00563349  -0.00563349    0.0181066    0.0181066 -5.63476e-11 -7.00639e-10  -0.00442155  1.14833e-09  1.47734e-09  -0.00189912  1.44585e-10 -1.19821e-10  1.51613e-11  3.11376e-11  -0.00562806  -0.00562806  -0.00304521   0.00304521  8.34702e-10 -6.30155e-09       1.0539          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "   0.0903883 -6.20887e-13  2.84178e-10 -3.58519e-10 -4.84114e-10 -3.84348e-10   -0.0326152  6.25549e-13  3.66711e-10    0.0118956  -0.00882859  1.49744e-10   -0.0481031  0.000647979    0.0477611 -9.23615e-13  9.93314e-11  3.10831e-10 -1.22268e-10  4.09295e-10   -0.0244236  0.000485538 -4.24748e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.20886e-13    0.0903883 -7.30728e-11  1.72839e-10 -1.25906e-10 -5.15645e-11   6.2549e-13   -0.0326152 -1.83482e-12   0.00882859    0.0118956 -3.88421e-13  0.000647979    0.0481031 -9.23615e-13    0.0477611  2.97707e-10  1.06799e-11  2.25979e-10 -1.44791e-11 -0.000485538   -0.0244236  7.66583e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.84178e-10 -7.30728e-11     0.139459   -0.0346254   -0.0541007   -0.0541007 -9.00621e-11  6.45428e-11    0.0389658  2.49981e-11 -9.95433e-11    0.0190199 -2.04559e-09  6.49732e-11   1.0661e-10 -3.16521e-11    -0.054483   0.00909009   -0.0148818    0.0157381 -4.03441e-10 -9.23406e-11    0.0315223         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.58519e-10  1.72839e-10   -0.0346254     0.139459    0.0541007    0.0541007  1.21506e-10 -1.08231e-10   -0.0389658  -2.4521e-11  1.05051e-10   -0.0190199  2.07496e-09 -2.73063e-11 -2.22281e-10  1.88094e-10  -0.00909009     0.054483    0.0157381   -0.0148818  4.72309e-10  -4.0463e-12   -0.0315223         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-4.84114e-10 -1.25906e-10   -0.0541007    0.0541007     0.172203    0.0673688  1.65144e-10  7.43031e-11   -0.0525025 -1.21215e-10   2.4831e-11   -0.0256274  2.79538e-09  4.65147e-12 -3.00033e-10 -1.33727e-10   -0.0143871   -0.0152435    0.0177653    0.0458078  6.41432e-10 -2.83426e-11    0.0289639         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.84348e-10 -5.15645e-11   -0.0541007    0.0541007    0.0673688     0.172203  1.21456e-10  4.28592e-11   -0.0525025 -1.15707e-10  2.43539e-11   -0.0256274  2.75771e-09  3.40215e-11 -1.43591e-10 -1.80564e-11   -0.0152435   -0.0143871   -0.0458078   -0.0177653  5.44393e-10 -9.78916e-11    0.0289639         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0326152  6.25491e-13 -9.00621e-11  1.21506e-10  1.65144e-10  1.21456e-10     0.236624 -1.38197e-13 -1.35483e-10   -0.0115486   0.00857106 -2.41283e-11  -0.00949852  0.000127951    0.0424653  4.00006e-12  1.63397e-10 -1.24059e-10 -2.24955e-10 -1.65328e-10  -0.00359494  7.14667e-05 -5.44853e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.25548e-13   -0.0326152  6.45428e-11 -1.08231e-10  7.43031e-11  4.28592e-11   -1.382e-13     0.236624   3.3739e-12  -0.00857106   -0.0115486  9.80325e-13  0.000127951   0.00949852  4.00014e-12    0.0424653 -4.03564e-10 -1.32801e-11 -3.02632e-10  1.51764e-11 -7.14667e-05  -0.00359494 -8.20483e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.66711e-10 -1.83482e-12    0.0389658   -0.0389658   -0.0525025   -0.0525025 -1.35483e-10   3.3739e-12     0.424108  3.29037e-10 -2.46426e-10   -0.0112617 -9.32861e-10  4.45212e-12  1.82485e-10 -2.97087e-12  0.000393913  0.000393913 -0.000516085  0.000516085 -1.09316e-09  3.54147e-11   -0.0012124         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0118956   0.00882859  2.49981e-11  -2.4521e-11 -1.21215e-10 -1.15707e-10   -0.0115486  -0.00857106  3.29037e-10     0.446812   9.5033e-13 -1.11957e-10 -0.000384856  0.000293749   0.00866892   0.00643381 -4.74481e-11 -5.32196e-11   1.8289e-09 -7.90266e-11   -0.0144713   -0.0103005  1.78719e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " -0.00882859    0.0118956 -9.95433e-11  1.05051e-10   2.4831e-11  2.43539e-11   0.00857106   -0.0115486 -2.46426e-10  9.50209e-13     0.446812  8.45357e-11  0.000293749  0.000384856  -0.00643381   0.00866892  1.80338e-09  5.35019e-11 -4.70402e-11  4.12687e-11    0.0103005   -0.0144713  2.38772e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.49744e-10 -3.88421e-13    0.0190199   -0.0190199   -0.0256274   -0.0256274 -2.41283e-11  9.80325e-13   -0.0112617 -1.11957e-10  8.45357e-11     0.627074 -6.54358e-10   1.5305e-12  1.02976e-10 -5.60734e-13    0.0133026    0.0133026   -0.0174284    0.0174284 -2.09133e-10  8.08916e-12  -0.00049946         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0481031  0.000647979 -2.04559e-09  2.07496e-09  2.79538e-09  2.75771e-09  -0.00949852  0.000127951 -9.32861e-10 -0.000384856  0.000293749 -6.54358e-10     0.912954 -7.12451e-13    0.0215518 -0.000290316 -2.19979e-09 -1.98486e-09  2.88425e-09 -2.59838e-09   -0.0227035  0.000757375 -5.32228e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 0.000647979    0.0481031  6.49732e-11 -2.73063e-11  4.65147e-12  3.40215e-11  0.000127951   0.00949852  4.45212e-12  0.000293749  0.000384856   1.5305e-12 -7.12426e-13     0.912954 -0.000290316   -0.0215518  -1.2374e-10  1.62131e-10 -1.08801e-10 -1.06137e-10  0.000757375    0.0227035 -1.07621e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0477611 -9.23613e-13   1.0661e-10 -2.22281e-10 -3.00033e-10 -1.43591e-10    0.0424653  4.00014e-12  1.82485e-10   0.00866892  -0.00643381  1.02976e-10    0.0215518 -0.000290316     0.952112  2.99047e-12  1.98159e-10   4.9168e-11 -2.63936e-10  6.39886e-11   0.00321142 -6.38425e-05 -7.01496e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-9.23615e-13    0.0477611 -3.16521e-11  1.88094e-10 -1.33727e-10 -1.80564e-11  4.00006e-12    0.0424653 -2.97087e-12   0.00643381   0.00866892 -5.60734e-13 -0.000290316   -0.0215518  2.99047e-12     0.952112 -2.09496e-10 -9.54871e-12 -1.55076e-10  6.08416e-12  6.38425e-05   0.00321142 -4.80838e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 9.93314e-11  2.97707e-10    -0.054483  -0.00909009   -0.0143871   -0.0152435  1.63397e-10 -4.03564e-10  0.000393913 -4.74481e-11  1.80338e-09    0.0133026 -2.19979e-09  -1.2374e-10  1.98159e-10 -2.09496e-10      1.07454     0.033576   -0.0382259    0.0382259 -4.69445e-10 -1.03538e-10   -0.0123219         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.10831e-10  1.06799e-11   0.00909009     0.054483   -0.0152435   -0.0143871 -1.24059e-10 -1.32801e-11  0.000393913 -5.32196e-11  5.35019e-11    0.0133026 -1.98486e-09  1.62131e-10   4.9168e-11 -9.54871e-12     0.033576      1.07454   -0.0382259    0.0382259 -5.90957e-10  6.96382e-11   -0.0123219         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.22268e-10  2.25979e-10   -0.0148818    0.0157381    0.0177653   -0.0458078 -2.24955e-10 -3.02632e-10 -0.000516085   1.8289e-09 -4.70402e-11   -0.0174284  2.88425e-09 -1.08801e-10 -2.63936e-10 -1.55076e-10   -0.0382259   -0.0382259      1.09545    -0.054481  6.02411e-10   -1.025e-10    -0.011325         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.09295e-10 -1.44791e-11    0.0157381   -0.0148818    0.0458078   -0.0177653 -1.65328e-10  1.51764e-11  0.000516085 -7.90266e-11  4.12687e-11    0.0174284 -2.59838e-09 -1.06137e-10  6.39886e-11  6.08416e-12    0.0382259    0.0382259    -0.054481      1.09545 -7.75287e-10 -1.86822e-11     0.011325         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0559704  -0.00111268 -3.90957e-09  3.97424e-09  5.36317e-09  5.27102e-09  -0.00259779 -5.16436e-05 -1.12193e-09  -0.00898739   0.00639712 -2.78457e-10   -0.0177731    0.0005929    0.0179745  0.000357331  5.27465e-11  7.88685e-11 -6.30078e-11  9.82822e-11     0.583856   9.3224e-12  2.96099e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  0.00111268   -0.0559704  6.67274e-11 -1.58045e-10 -1.09703e-10 -1.75242e-10  5.16436e-05  -0.00259779  3.08012e-11  -0.00639712  -0.00898739  7.33585e-12    0.0005929    0.0177731 -0.000357331    0.0179745  1.41272e-10  1.06323e-10   1.1548e-10  -8.9019e-11  9.32236e-12     0.583856 -4.55866e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.60037e-11  4.40279e-10    0.0321336   -0.0321336    0.0289365    0.0289365 -2.48512e-12 -8.79368e-10  -0.00256912  1.64908e-09  2.19868e-09  -0.00131403  9.45617e-11   -7.086e-11 -9.54214e-12 -6.09888e-10   -0.0137155   -0.0137155   -0.0109571    0.0109571  7.80129e-10 -5.06154e-09      2.11638         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
