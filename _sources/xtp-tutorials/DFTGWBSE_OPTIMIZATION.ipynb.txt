{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-09-09T06:53:34.751042Z",
     "iopub.status.busy": "2022-09-09T06:53:34.750537Z",
     "iopub.status.idle": "2022-09-09T06:54:06.608075Z",
     "shell.execute_reply": "2022-09-09T06:54:06.607539Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2023-dev gitid: 3134d80 (compiled Sep  9 2022, 06:45:23)\r\n",
      "votca_csg, version 2023-dev gitid: 3134d80 (compiled Sep  9 2022, 06:30:03)\r\n",
      "votca_tools, version 2023-dev gitid: 3134d80 (compiled Sep  9 2022, 06:27:15)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 BohrA\r\n",
      "    0.307132  3.06082e-11  1.79878e-10 -5.20122e-10 -2.32199e-11   -0.0516061  1.11657e-09  1.03683e-09  3.87605e-10   -0.0181647  -0.00104129  1.10437e-10    0.0104045    -0.037561  2.00292e-11    0.0421019 -2.08547e-10  9.11494e-11  3.57728e-10   1.5889e-10 -0.000479661     0.108408 -1.82905e-10  2.37469e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.06082e-11     0.307132 -3.88997e-10  3.09256e-10   -0.0516061 -2.32199e-11  2.45195e-09   2.7922e-09  8.22119e-10   0.00104129   -0.0181647  3.85174e-10    -0.037561   -0.0104045    0.0421019  2.00291e-11 -1.92155e-10 -6.68328e-12  5.01657e-10  6.19055e-10    -0.108408 -0.000479661  1.68206e-11  1.03791e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.79878e-10 -3.88997e-10     0.320604   0.00929027  1.39948e-11 -3.03762e-11   -0.0131695   -0.0131695  -0.00491094 -1.46123e-10  1.02535e-10  -0.00209221  1.19125e-11  2.07187e-10 -1.19203e-10  -7.5095e-12    -0.047052   0.00129456  -0.00255615   -0.0152311  9.88309e-10 -3.13756e-10   -0.0254858   -0.0218988          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-5.20122e-10  3.09256e-10   0.00929027     0.320604 -2.23691e-11    4.351e-10    0.0131695    0.0131695   0.00491094  1.66394e-10 -1.48444e-10   0.00209221  8.11652e-12 -1.82284e-10  1.27855e-11 -4.05429e-10   0.00129456    -0.047052    0.0152311   0.00255615 -9.64377e-10 -2.06402e-10    0.0254858   -0.0218988          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.32199e-11   -0.0516061  1.39948e-11 -2.23691e-11     0.490902  2.83281e-12  1.49001e-09  1.08528e-09  6.28849e-10 -0.000770503     0.013441  1.85914e-10  -0.00770377  -0.00213397    0.0309987 -6.61286e-11 -4.61699e-11  3.03307e-10  2.07885e-10   6.1504e-11    0.0531267  0.000235064  2.09482e-10  -5.9813e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0516061 -2.32199e-11 -3.03762e-11    4.351e-10  2.83284e-12     0.490902 -9.29674e-11 -1.01342e-10 -6.25884e-11     0.013441  0.000770503  5.22923e-12   0.00213397  -0.00770377 -6.61287e-11    0.0309987  1.53632e-10 -7.25135e-12 -8.27065e-11  1.74431e-10  0.000235064   -0.0531267 -4.46051e-11 -1.12338e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.11657e-09  2.45195e-09   -0.0131695    0.0131695  1.49001e-09 -9.29674e-11     0.549585     0.219691    0.0856688 -1.42928e-11 -7.24908e-10    0.0364976 -8.31922e-10 -2.62355e-09 -6.31687e-10  2.54415e-10   -0.0113556  -0.00131935   -0.0126963    0.0330612 -1.34042e-08  8.26898e-09   0.00154482  0.000229074          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.03683e-09   2.7922e-09   -0.0131695    0.0131695  1.08528e-09 -1.01342e-10     0.219691     0.549585    0.0856688 -6.02022e-11 -7.45179e-10    0.0364976 -8.56826e-10 -2.60352e-09 -2.18749e-10  1.47997e-10   0.00131935    0.0113556    0.0330612   -0.0126963 -1.39179e-08   8.2415e-09   0.00154482 -0.000229071          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.87605e-10  8.22119e-10  -0.00491094   0.00491094  6.28849e-10 -6.25884e-11    0.0856688    0.0856688     0.662947 -1.79993e-10 -5.81858e-10  -0.00632525 -2.92646e-10 -7.01986e-10 -3.36765e-10  9.71815e-11  -0.00131697   0.00131697   0.00387662   0.00387662 -4.33997e-09  3.05322e-09   0.00112549  4.56042e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0181647   0.00104129 -1.46123e-10  1.66394e-10 -0.000770503     0.013441 -1.42928e-11 -6.02022e-11 -1.79993e-10     0.680922  -1.5952e-12   8.8363e-11 -2.70805e-05  7.97135e-05  0.000494297  -0.00862277  3.86455e-10  2.29114e-13  8.09528e-11  8.90774e-10  -0.00216678   -0.0409703 -6.68908e-10 -7.92193e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " -0.00104129   -0.0181647  1.02535e-10 -1.48444e-10     0.013441  0.000770503 -7.24908e-10 -7.45179e-10 -5.81858e-10 -1.59534e-12     0.680922  6.20526e-11  7.97134e-05  2.70805e-05  -0.00862277 -0.000494297 -4.18806e-12  8.14009e-10  3.77286e-10 -9.39741e-12    0.0409703  -0.00216678   8.0943e-10 -7.89313e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.10437e-10  3.85174e-10  -0.00209221   0.00209221  1.85914e-10  5.22923e-12    0.0364976    0.0364976  -0.00632525   8.8363e-11  6.20526e-11      0.79826  1.22341e-11 -3.26474e-10  1.10199e-10  5.76927e-11  -0.00465605   0.00465605    0.0137055    0.0137055 -1.73234e-09  9.75612e-10  0.000446182  1.71306e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0104045    -0.037561  1.19125e-11  8.11652e-12  -0.00770377   0.00213397 -8.31922e-10 -8.56826e-10 -2.92646e-10 -2.70805e-05  7.97134e-05  1.22341e-11     0.956418 -4.29189e-11    0.0126653  -0.00350833  1.23859e-10 -2.37483e-10 -6.53117e-10 -4.30743e-10   -0.0192722  -0.00543041   6.8114e-12  9.36671e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   -0.037561   -0.0104045  2.07187e-10 -1.82284e-10  -0.00213397  -0.00770377 -2.62355e-09 -2.60352e-09 -7.01986e-10  7.97135e-05  2.70805e-05 -3.26474e-10 -4.29189e-11     0.956418   0.00350833    0.0126653  4.24877e-10 -6.47251e-10 -1.49157e-09  -1.6052e-09  -0.00543041    0.0192722 -8.92731e-11  1.18273e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.00292e-11    0.0421019 -1.19203e-10  1.27855e-11    0.0309987 -6.61287e-11 -6.31687e-10 -2.18749e-10 -3.36765e-10  0.000494297  -0.00862277  1.10199e-10    0.0126653   0.00350833     0.988566 -3.74013e-11 -2.92361e-11  1.10928e-10 -3.59202e-11  6.16798e-11   -0.0223628 -9.89465e-05  3.29949e-10 -1.00345e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0421019  2.00291e-11  -7.5095e-12 -4.05429e-10 -6.61286e-11    0.0309987  2.54415e-10  1.47997e-10  9.71815e-11  -0.00862277 -0.000494297  5.76927e-11  -0.00350833    0.0126653 -3.74012e-11     0.988566 -7.14726e-12 -9.04528e-11  6.75887e-11  1.49281e-10 -9.89466e-05    0.0223628 -1.73239e-10 -1.89028e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.08547e-10 -1.92155e-10    -0.047052   0.00129456 -4.61699e-11  1.53632e-10   -0.0113556   0.00131935  -0.00131697  3.86455e-10 -4.18806e-12  -0.00465605  1.23859e-10  4.24877e-10 -2.92361e-11 -7.14726e-12      1.03321  -0.00656848   -0.0132475   -0.0132475  8.26332e-10 -5.53789e-10   0.00427516  0.000116406          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 9.11494e-11 -6.68328e-12   0.00129456    -0.047052  3.03307e-10 -7.25135e-12  -0.00131935    0.0113556   0.00131697  2.29114e-13  8.14009e-10   0.00465605 -2.37483e-10 -6.47251e-10  1.10928e-10 -9.04528e-11  -0.00656848      1.03321    0.0132475    0.0132475 -7.79585e-10  4.51918e-10  -0.00427516  0.000116406          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.57728e-10  5.01657e-10  -0.00255615    0.0152311  2.07885e-10 -8.27065e-11   -0.0126963    0.0330612   0.00387662  8.09528e-11  3.77286e-10    0.0137055 -6.53117e-10 -1.49157e-09 -3.59202e-11  6.75887e-11   -0.0132475    0.0132475       1.0677    0.0410631 -2.36689e-09  1.58684e-09   0.00204336 -4.44138e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  1.5889e-10  6.19055e-10   -0.0152311   0.00255615   6.1504e-11  1.74431e-10    0.0330612   -0.0126963   0.00387662  8.90774e-10 -9.39741e-12    0.0137055 -4.30743e-10  -1.6052e-09  6.16798e-11  1.49281e-10   -0.0132475    0.0132475    0.0410631       1.0677 -2.46786e-09  1.53954e-09   0.00204336  4.44143e-05          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 0.000332936    0.0752465 -6.87248e-10  7.32179e-10   -0.0690159 -0.000305368  8.05834e-09  8.33593e-09  3.16346e-09   0.00163481   -0.0309117  1.54311e-09    0.0086659   0.00244182    0.0364086  0.000161093 -5.59074e-10  5.58508e-10  1.77527e-09  1.77878e-09    -0.194424  2.21565e-10  4.21802e-09 -1.35958e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0752465  0.000332936 -1.26435e-12  2.85584e-10 -0.000305368    0.0690159  -5.4901e-09 -5.53268e-09 -2.38386e-09    0.0309117   0.00163481 -8.87006e-10   0.00244182   -0.0086659  0.000161093   -0.0364086   4.8185e-10 -4.77607e-10 -1.28064e-09 -1.27919e-09  2.21565e-10    -0.194424  5.54395e-09  2.35834e-09          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 5.99158e-10 -5.29756e-10   -0.0141894    0.0141894   3.6887e-10 -5.51709e-10  -0.00432395  -0.00432395  -0.00131218 -1.02982e-09  1.08955e-09 -0.000526124 -8.36136e-11  8.17404e-11 -4.06839e-11  2.51658e-10    0.0059752   -0.0059752   0.00150789   0.00150789  4.42847e-09  5.45783e-09     0.958307 -1.25138e-08          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 3.22351e-10  2.36491e-10   0.00611232   0.00611232 -2.94063e-10  9.29381e-11  -1.3634e-05  1.36327e-05 -3.14505e-10 -6.80762e-10  -7.6096e-10 -1.19546e-10   3.2186e-11  2.40005e-10  -1.4664e-10 -1.52707e-10    0.0044691    0.0044691  -0.00129342   0.00129342 -1.47445e-09  2.67626e-09 -1.27162e-08    0.0858401          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "    0.093811  1.36035e-11  9.61749e-11 -3.20878e-10 -1.42798e-11   -0.0328898  4.68218e-10   4.1126e-10  2.38511e-10   -0.0155317 -0.000890349  6.35296e-11    0.0129014   -0.0465748  2.32703e-11    0.0481429 -2.59302e-10  1.01689e-10  3.59468e-10  8.39259e-11 -0.000111092    0.0251078  4.90523e-10   4.7142e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.36035e-11     0.093811 -2.01214e-10  1.44256e-10   -0.0328898 -1.42797e-11  9.67755e-10  1.19246e-09  5.07324e-10  0.000890349   -0.0155317  2.54845e-10   -0.0465748   -0.0129014    0.0481429  2.32702e-11 -1.64953e-10 -1.10589e-10  4.29882e-10  5.87495e-10   -0.0251078 -0.000111092 -5.38511e-10  3.13816e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 9.61749e-11 -2.01214e-10      0.10587   0.00531173   1.8644e-11 -2.58784e-11  -0.00667167  -0.00667167  -0.00361132 -1.36148e-10  8.75515e-11  -0.00164046  2.39906e-11  2.29963e-10 -1.50947e-10 -1.30613e-11   -0.0640504   0.00171075  -0.00245494   -0.0197232  7.98791e-11 -1.94514e-10   -0.0418869   -0.0160335         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-3.20878e-10  1.44256e-10   0.00531173      0.10587  -2.2213e-11  3.15392e-10   0.00667167   0.00667167   0.00361132  1.60338e-10 -1.30128e-10   0.00164046  2.85218e-12 -1.93091e-10  9.17695e-12 -5.05908e-10   0.00171075   -0.0640504    0.0197232   0.00245494 -5.29945e-12 -4.79124e-11    0.0418869   -0.0160335         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.42798e-11   -0.0328898   1.8644e-11  -2.2213e-11     0.240891  6.63493e-13  9.44026e-10  6.54512e-10  5.49396e-10 -0.000828016    0.0144443  1.60933e-10  -0.00881161  -0.00244085    0.0441772  -9.1925e-11 -4.10416e-11  4.25114e-10  2.14981e-10  1.15059e-11  -0.00438142  -1.9386e-05  5.21141e-10 -2.90991e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0328898 -1.42797e-11 -2.58784e-11  3.15392e-10  6.63526e-13     0.240891  -4.3767e-11 -4.73361e-11 -4.47227e-11    0.0144443  0.000828016  1.05904e-11   0.00244085  -0.00881161 -9.19251e-11    0.0441772  2.22872e-10 -1.93963e-11  -1.0256e-10  2.81512e-10  -1.9386e-05   0.00438142  -4.8845e-10  3.21597e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.68218e-10  9.67755e-10  -0.00667167   0.00667167  9.44026e-10  -4.3767e-11     0.221872      0.11069    0.0629976 -1.78844e-11 -5.48446e-10    0.0286171 -9.98456e-10 -2.90206e-09 -7.94469e-10  2.58595e-10   -0.0100862  -0.00718207   -0.0330794    0.0292602 -1.48727e-09  5.30295e-10  -0.00289606  0.000219952         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  4.1126e-10  1.19246e-09  -0.00667167   0.00667167  6.54512e-10 -4.73361e-11      0.11069     0.221872    0.0629976  -6.0461e-11 -5.72636e-10    0.0286171 -1.03533e-09 -2.87522e-09 -2.75499e-10  1.16825e-10   0.00718207    0.0100862    0.0292602   -0.0330794 -1.72933e-09  4.54543e-10  -0.00289606 -0.000219951         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.38511e-10  5.07324e-10  -0.00361132   0.00361132  5.49396e-10 -4.47227e-11    0.0629976    0.0629976     0.429278 -2.30961e-10 -6.84394e-10   -0.0121538 -4.21228e-10 -8.97903e-10 -4.70437e-10  1.29934e-10  6.20886e-06 -6.20888e-06 -1.82763e-05 -1.82763e-05 -1.01351e-09  6.37765e-10  5.55319e-05  1.28832e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0155317  0.000890349 -1.36148e-10  1.60338e-10 -0.000828016    0.0144443 -1.78844e-11  -6.0461e-11 -2.30961e-10     0.463967 -2.13036e-12  1.17863e-10 -0.000208052  0.000612418  0.000593795   -0.0103585  6.62966e-10 -5.06387e-12  1.34044e-10  1.50703e-09 -0.000936628   -0.0177101 -1.63375e-09  -1.4525e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-0.000890349   -0.0155317  8.75515e-11 -1.30128e-10    0.0144443  0.000828016 -5.48446e-10 -5.72636e-10 -6.84394e-10 -2.13055e-12     0.463967  1.23378e-10  0.000612418  0.000208052   -0.0103585 -0.000593795 -2.66508e-11  1.39964e-09  6.96876e-10  3.89743e-11    0.0177101 -0.000936628  1.78273e-09 -1.43812e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 6.35296e-11  2.54845e-10  -0.00164046   0.00164046  1.60933e-10  1.05904e-11    0.0286171    0.0286171   -0.0121538  1.17863e-10  1.23378e-10     0.636067  4.96814e-11 -4.09081e-10  1.95673e-10  8.27956e-11  -0.00673206   0.00673206    0.0198163    0.0198163 -9.92499e-11  2.30726e-12  4.38351e-05   3.8351e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0129014   -0.0465748  2.39906e-11  2.85218e-12  -0.00881161   0.00244085 -9.98456e-10 -1.03533e-09 -4.21228e-10 -0.000208052  0.000612418  4.96814e-11     0.917068 -7.52457e-11    0.0214825  -0.00595072  2.20598e-10 -4.53289e-10 -1.22574e-09 -7.73571e-10   -0.0223749  -0.00630464 -1.02113e-10  5.88982e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0465748   -0.0129014  2.29963e-10 -1.93091e-10  -0.00244085  -0.00881161 -2.90206e-09 -2.87522e-09 -8.97903e-10  0.000612418  0.000208052 -4.09081e-10 -7.52458e-11     0.917068   0.00595072    0.0214825   7.4221e-10 -1.19438e-09  -2.6733e-09   -2.906e-09  -0.00630464    0.0223749 -6.27998e-11  4.23786e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.32703e-11    0.0481429 -1.50947e-10  9.17695e-12    0.0441772  -9.1925e-11 -7.94469e-10 -2.75499e-10 -4.70437e-10  0.000593795   -0.0103585  1.95673e-10    0.0214825   0.00595072     0.981535 -7.20953e-11 -5.42911e-11  1.86567e-10 -5.46173e-11  1.35529e-10   0.00424838  1.87974e-05   2.6121e-10 -1.82941e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481429  2.32702e-11 -1.30613e-11 -5.05908e-10  -9.1925e-11    0.0441772  2.58595e-10  1.16825e-10  1.29934e-10   -0.0103585 -0.000593795  8.27956e-11  -0.00595072    0.0214825 -7.20952e-11     0.981535 -2.95333e-11 -1.60613e-10  1.09541e-10  2.41817e-10  1.87974e-05  -0.00424838  1.75234e-10 -3.45848e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.59302e-10 -1.64953e-10   -0.0640504   0.00171075 -4.10416e-11  2.22872e-10   -0.0100862   0.00718207  6.20886e-06  6.62966e-10 -2.66508e-11  -0.00673206  2.20598e-10   7.4221e-10 -5.42911e-11 -2.95333e-11      1.06908   -0.0128141   -0.0247549   -0.0247549  3.94987e-10 -2.10966e-10    0.0150504   0.00621355         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.01689e-10 -1.10589e-10   0.00171075   -0.0640504  4.25114e-10 -1.93963e-11  -0.00718207    0.0100862 -6.20888e-06 -5.06388e-12  1.39964e-09   0.00673206 -4.53289e-10 -1.19438e-09  1.86567e-10 -1.60613e-10   -0.0128141      1.06908    0.0247549    0.0247549 -2.19465e-10 -9.04171e-13   -0.0150504   0.00621355         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 3.59468e-10  4.29882e-10  -0.00245494    0.0197232  2.14981e-10  -1.0256e-10   -0.0330794    0.0292602 -1.82763e-05  1.34044e-10  6.96876e-10    0.0198163 -1.22574e-09  -2.6733e-09 -5.46173e-11  1.09541e-10   -0.0247549    0.0247549      1.13354    0.0772723 -8.79374e-10  5.99809e-10   0.00545297  -0.00181737         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 8.39259e-11  5.87495e-10   -0.0197232   0.00245494  1.15059e-11  2.81512e-10    0.0292602   -0.0330794 -1.82763e-05  1.50703e-09  3.89743e-11    0.0198163 -7.73571e-10   -2.906e-09  1.35529e-10  2.41817e-10   -0.0247549    0.0247549    0.0772723      1.13354 -1.09047e-09  4.24462e-10   0.00545297   0.00181737         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " -0.00025378   -0.0573567  4.72973e-10 -4.21028e-10  -0.00347861 -1.53914e-05 -7.51757e-09 -7.82122e-09 -1.20419e-09 -0.000538982    0.0101913 -2.34312e-10   -0.0179424  -0.00505569    0.0191591  8.47715e-05  9.06579e-11 -7.11722e-11  1.66095e-10 -5.09883e-12     0.600541  2.21999e-10  3.19227e-09 -1.24236e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0573567  -0.00025378 -3.45071e-10  4.22591e-11 -1.53915e-05   0.00347861  4.34534e-09  4.29198e-09  7.17268e-10   -0.0101913 -0.000538982  1.52066e-10  -0.00505569    0.0179424  8.47715e-05   -0.0191591  1.00941e-10 -2.71839e-10 -3.20979e-11 -5.07717e-11  2.21999e-10     0.600541  5.04377e-09  3.39507e-09         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.98216e-10 -3.36935e-10   -0.0423677    0.0423677  5.91144e-10 -4.73006e-10  -0.00286506  -0.00286506  -0.00043898 -1.50218e-09  1.61576e-09 -0.000214743 -5.05631e-11 -4.23375e-11  3.64387e-10  1.53239e-10    0.0160903   -0.0160903   0.00534183   0.00534183  3.64903e-09  5.04805e-09      1.98482 -1.60829e-08         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 5.12139e-10  2.79257e-10   -0.0180821   -0.0180821 -2.61961e-10 -1.65863e-12  0.000245627 -0.000245625   1.2695e-10 -1.38317e-09 -1.42365e-09  4.20139e-11  5.38221e-11  4.79098e-10 -2.09334e-10 -3.61941e-10   0.00747543   0.00747543  -0.00217644   0.00217644 -1.52321e-09  3.79858e-09 -1.62782e-08     0.765161         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
