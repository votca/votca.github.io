{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## DFT + GWBSE Optimization Using CO"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Introduction\n",
    "This tutorial explains how to perform a molecular geometric optimization using the **GWBSE** method. See [the GW Compendium: A Practical Guide to Theoretical Photoemission Spectroscopy](https://doi.org/10.3389/fchem.2019.00377), for an excellent introduction to the method."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Requirements\n",
    "* You will need to install **VOTCA** using the instructions described [here](https://github.com/votca/votca/blob/master/share/doc/INSTALL.rst)\n",
    "* Once the installation is completed you need to activate the VOTCA enviroment by running the `VOTCARC.bash` script that has been installed at the bin subfolder for the path that you have provided for the installation step above"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Preparing the input\n",
    "To run a DFT-GWBSE calculation we will use the [xtp_tools](https://www.votca.org/xtp/xtp_tools_overview.html) calculator."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "we can now change the calculator mode from single point energy calculation to optimization as follows by adding \n",
    "`-c geometry_optimization.maxiter=1` which enables optimization with one iteration. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Because geometry optimsation is quite expensive numerically we chose a smaller basisset and G0W0 Finally, to run the calculation we just need the following command (This still takes a while)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "execution": {
     "iopub.execute_input": "2022-01-16T05:05:49.690762Z",
     "iopub.status.busy": "2022-01-16T05:05:49.690329Z",
     "iopub.status.idle": "2022-01-16T05:06:12.392765Z",
     "shell.execute_reply": "2022-01-16T05:06:12.393187Z"
    }
   },
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "==================================================\r\n",
      "========   VOTCA (http://www.votca.org)   ========\r\n",
      "==================================================\r\n",
      "\r\n",
      "please submit bugs to https://github.com/votca/xtp/issues\r\n",
      "\r\n",
      "xtp_tools, version 2023-dev gitid: 077cfcc (compiled Jan 16 2022, 04:59:06)\r\n",
      "votca_csg, version 2023-dev gitid: 077cfcc (compiled Jan 16 2022, 04:46:56)\r\n",
      "votca_tools, version 2023-dev gitid: 077cfcc (compiled Jan 16 2022, 04:45:12)\r\n",
      "\r\n",
      "Initializing tool\r\n",
      "... dftgwbse Evaluating tool\r\n",
      "... dftgwbse  Using 4 threads\r\n",
      "... ... Reading structure from CO.xyz\r\n",
      "... ... Requested geometry optimization of excited state s1\r\n",
      "... ... Initial state: s1\r\n",
      "... ... WARNING: No tracker is used \r\n",
      "... ... Convergence of total energy: 0.000001 Hartree \r\n",
      "... ... Convergence of RMS Force:    0.000030 Hartree/Bohr \r\n",
      "... ... Convergence of Max Force:    0.000100 Hartree/Bohr \r\n",
      "... ... Convergence of RMS Step:     0.000600 Bohr \r\n",
      "... ... Convergence of Max Step:     0.001000 Bohr \r\n",
      "... ... Initial trust radius:        0.018897 BohrA\r\n",
      "    0.307557 -1.39254e-16 -3.74997e-14  1.90165e-14    0.0515784 -2.42373e-15   4.7824e-11  2.37465e-11 -6.05566e-12   -0.0182326  1.44777e-05  1.29808e-11     0.038971  0.000154792    0.0420794 -2.22642e-15 -5.62502e-14 -7.96433e-15 -1.51518e-11  4.96692e-12    -0.108498 -8.95743e-06   7.9181e-15  7.09229e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.38819e-16     0.307557  3.93701e-12  2.01404e-11 -2.46468e-15    0.0515784  3.53677e-15 -1.49296e-14  1.93841e-16 -1.44777e-05   -0.0182326  2.28992e-16  0.000154792    -0.038971 -2.16745e-15    0.0420794  8.72433e-12 -1.46052e-12 -3.61066e-14 -1.21511e-14  8.95743e-06    -0.108498 -1.40791e-12 -1.61801e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-3.74997e-14  3.93701e-12     0.320545    0.0100422  1.30807e-13 -4.69825e-12  -0.00018296  -0.00018296 -6.78529e-05  1.73855e-15 -9.17918e-12  2.87757e-05 -8.67569e-16  2.23139e-13 -8.32945e-15 -2.33331e-15   0.00205863    0.0495542  2.13242e-05  0.000167328 -1.66749e-14 -3.08148e-12   -0.0253868   -0.0212962          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.90165e-14  2.01404e-11    0.0100422     0.320545 -1.68649e-13  5.36646e-11   0.00018296   0.00018296  6.78529e-05 -1.95324e-15 -4.45547e-12 -2.87757e-05 -6.88724e-15  2.18051e-12  3.19039e-14 -3.03448e-11   -0.0495542  -0.00205863  0.000167328  2.13242e-05  4.47324e-14 -3.04622e-11    0.0253868   -0.0212962          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0515784 -2.45249e-15  1.30807e-13 -1.68649e-13     0.491199  1.58156e-15 -1.63507e-10 -2.12473e-10 -9.28079e-11     -0.01345  1.06801e-05  4.06113e-11  -0.00797198 -3.16646e-05   -0.0310586 -4.72636e-15  7.61766e-14   1.0031e-13  2.52721e-11 -3.03589e-11   -0.0529951 -4.37518e-06 -7.36339e-14  8.94827e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.42692e-15    0.0515784 -4.69825e-12  5.36646e-11  1.57425e-15     0.491199 -6.05508e-15 -4.38093e-14 -8.34283e-16 -1.06801e-05     -0.01345  6.09466e-16 -3.16646e-05   0.00797198 -4.62159e-15   -0.0310586  7.63558e-12  2.54878e-12 -2.80019e-14  3.91775e-15  4.37518e-06   -0.0529951  5.00591e-12 -3.31177e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  4.7824e-11  3.53675e-15  -0.00018296   0.00018296 -1.63507e-10 -6.05509e-15     0.550957     0.220369    0.0854511 -1.15133e-11  1.99316e-15   -0.0362389 -1.31097e-13 -1.17212e-15  9.80215e-12  4.46542e-16  7.87625e-05 -0.000109889    0.0124022    0.0350933  2.10503e-11 -1.23124e-14  5.38447e-05   0.00532057          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 2.37465e-11 -1.49295e-14  -0.00018296   0.00018296 -2.12473e-10 -4.38093e-14     0.220369     0.550957    0.0854511  2.12137e-12  1.78595e-15   -0.0362389  2.27255e-12  6.54494e-15  4.01493e-11  2.38874e-14 -0.000109889  7.87625e-05   -0.0350933   -0.0124022  5.37951e-11  1.57061e-14  5.38447e-05  -0.00532057          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-6.05566e-12  1.93627e-16 -6.78529e-05  6.78529e-05 -9.28079e-11 -8.34284e-16    0.0854511    0.0854511     0.663153  9.49903e-12 -7.39057e-15   0.00639727  7.94668e-12   3.1195e-14  5.90371e-12  2.48288e-16 -1.28622e-05 -1.28622e-05  -0.00404735   0.00404735   4.3625e-11 -1.11288e-15  2.77772e-05  2.16249e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "  -0.0182326 -1.44777e-05  1.73857e-15  -1.9535e-15     -0.01345 -1.06801e-05 -1.15133e-11  2.12137e-12  9.49903e-12     0.681816   5.8906e-16  9.47396e-12 -9.13983e-05 -2.90457e-07  -0.00860647 -6.83402e-06 -3.69595e-15  2.43818e-15 -7.42207e-13 -8.05788e-13    0.0410285  3.59662e-05  7.02987e-15  3.28262e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.44777e-05   -0.0182326 -9.17918e-12 -4.45547e-12  1.06801e-05     -0.01345  1.99318e-15  1.78579e-15 -7.39056e-15   5.1758e-16     0.681816 -7.39095e-15 -2.90457e-07  9.13983e-05  6.83402e-06  -0.00860647 -2.24133e-13 -1.77215e-12   1.3375e-16 -6.28916e-15 -3.59662e-05    0.0410285  1.08997e-11 -1.36943e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 1.29808e-11  2.28991e-16  2.87757e-05 -2.87757e-05  4.06113e-11  6.09253e-16   -0.0362389   -0.0362389   0.00639727  9.47396e-12 -7.39093e-15      0.79863  6.72086e-12  2.68474e-14 -1.02101e-11 -3.57085e-18  4.58057e-05  4.58057e-05    0.0144137   -0.0144137 -4.27029e-11 -2.59045e-15 -1.11758e-05 -8.53149e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "    0.038971  0.000154792  -8.6757e-16 -6.88724e-15  -0.00797198 -3.16646e-05 -1.31097e-13  2.27255e-12  7.94668e-12 -9.13983e-05 -2.90457e-07  6.72086e-12     0.956559  1.11793e-14   -0.0131604  -5.2273e-05  3.24468e-14  3.40655e-14  7.32967e-12 -9.37708e-12    0.0200323   8.1222e-05   1.1872e-14  6.96265e-13          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 0.000154792    -0.038971  2.23139e-13  2.18051e-12 -3.16646e-05   0.00797198 -1.17212e-15  6.54493e-15  3.11951e-14 -2.90457e-07  9.13983e-05  2.68474e-14   1.1138e-14     0.956559  -5.2273e-05    0.0131604 -2.70717e-12 -6.59783e-13  3.97379e-14 -3.81258e-14   8.1222e-05   -0.0200323 -2.45887e-12  2.74563e-12          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "   0.0420794 -2.16873e-15 -8.32961e-15   3.1904e-14   -0.0310586 -4.63297e-15  9.80216e-12  4.01493e-11  5.90371e-12  -0.00860647  6.83402e-06 -1.02101e-11   -0.0131604  -5.2273e-05     0.989636  5.37192e-15 -5.64797e-14 -3.96748e-14 -1.69078e-11   1.3363e-11   -0.0223203 -1.84272e-06  1.08806e-14 -1.03627e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-2.24281e-15    0.0420794 -2.33324e-15 -3.03448e-11  -4.7571e-15   -0.0310586  4.46646e-16  2.38872e-14  2.48288e-16 -6.83402e-06  -0.00860647 -3.56994e-18  -5.2273e-05    0.0131604  5.38334e-15     0.989636  1.89061e-12 -1.65422e-12 -8.86303e-15 -7.93829e-15  1.84272e-06   -0.0223203 -2.04145e-11  3.69047e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-5.62502e-14  8.72433e-12   0.00205863   -0.0495542  7.61766e-14  7.63558e-12  7.87625e-05 -0.000109889 -1.28622e-05 -3.69593e-15 -2.24133e-13  4.58057e-05  3.24468e-14 -2.70717e-12 -5.64797e-14  1.89061e-12      1.02923   0.00206712  0.000138407 -0.000138407  3.76634e-14 -1.80676e-11  -0.00469352  0.000126022          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-7.96433e-15 -1.46052e-12    0.0495542  -0.00205863   1.0031e-13  2.54878e-12 -0.000109889  7.87625e-05 -1.28622e-05  2.43818e-15 -1.77215e-12  4.58057e-05  3.40655e-14 -6.59783e-13 -3.96748e-14 -1.65422e-12   0.00206712      1.02923  0.000138407 -0.000138407 -6.63252e-14  3.60514e-12  -0.00469352 -0.000126022          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.51518e-11 -3.61066e-14  2.13242e-05  0.000167328  2.52721e-11 -2.80019e-14    0.0124022   -0.0350933  -0.00404735 -7.42207e-13  1.33746e-16    0.0144137  7.32967e-12  3.97379e-14 -1.69078e-11 -8.86302e-15  0.000138407  0.000138407      1.07278   -0.0456192  5.96639e-12  7.70849e-14  1.20641e-05   0.00014324          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 4.96692e-12 -1.21511e-14  0.000167328  2.13242e-05 -3.03589e-11  3.91775e-15    0.0350933   -0.0124022   0.00404735 -8.05788e-13 -6.28917e-15   -0.0144137 -9.37708e-12 -3.81258e-14   1.3363e-11 -7.93829e-15 -0.000138407 -0.000138407   -0.0456192      1.07278  1.55522e-11  2.72348e-14 -1.20641e-05   0.00014324          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "    0.075296 -6.21631e-06  6.19569e-15 -3.23241e-14    0.0689447 -5.69195e-06 -7.71145e-12  -3.7373e-11 -3.99111e-11   -0.0309921  2.71681e-05  2.69248e-11  -0.00898913 -3.64469e-05    0.0364163 -3.00647e-06 -4.63838e-14 -4.46927e-16 -1.20386e-11  2.48918e-12     -0.19441   4.7938e-14 -3.40495e-14  -1.1611e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      " 6.21631e-06     0.075296   3.4437e-12  2.71669e-11  5.69195e-06    0.0689447  1.13748e-14 -1.34351e-14  7.92903e-16 -2.71681e-05   -0.0309921   1.3191e-15 -3.64469e-05   0.00898913  3.00647e-06    0.0364163  7.91912e-12 -1.73903e-12 -3.55546e-14  -1.0935e-14  4.79559e-14     -0.19441 -7.98664e-11  2.35157e-11          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-7.82921e-16  6.01886e-12   -0.0144102    0.0144102  1.89801e-15 -5.60632e-11 -2.30577e-05 -2.30577e-05 -4.77535e-06  -1.8898e-14 -1.65263e-11  1.38152e-06 -1.28613e-14   3.4468e-12 -3.45684e-16  4.11859e-11  -0.00614395  -0.00614395  3.04481e-05 -3.04481e-05 -2.00806e-14 -9.63295e-11     0.957553 -5.58516e-10          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "-1.94069e-13  1.14563e-12   0.00587633   0.00587633 -1.28651e-11  4.36451e-11 -0.000996796  0.000996795 -1.37283e-10 -6.87388e-12   2.3135e-11  6.08145e-11 -1.11681e-12 -3.44119e-12  1.15804e-11 -4.12021e-11   0.00453775  -0.00453775   0.00114453   0.00114453 -1.56482e-11  3.65638e-11 -5.57388e-10    0.0960355          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan         -nan          nan          nan          nan         -nan          nan          nan          nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "B\r\n",
      "    0.094057  1.56579e-16 -1.87443e-14   8.5742e-15    0.0329085  -1.4278e-15  2.39173e-11  1.07034e-11 -5.66315e-12   -0.0156091  1.23945e-05  1.35053e-11    0.0483431  0.000192018    0.0481685 -2.48651e-15 -6.34157e-14 -6.09483e-15 -1.69248e-11  4.83713e-12   -0.0251553 -2.07678e-06  6.35234e-15  5.00314e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.51734e-16     0.094057  2.23075e-12  1.09831e-11 -1.45805e-15    0.0329085  1.91968e-15 -8.24403e-15  1.13011e-16 -1.23945e-05   -0.0156091  2.30295e-16  0.000192018   -0.0483431 -2.41722e-15    0.0481685  1.06186e-11 -1.46897e-12 -4.36749e-14 -1.36136e-14  2.07678e-06   -0.0251553    1.734e-12  -5.2042e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.87442e-14  2.23075e-12     0.105939   0.00570602  7.14006e-14 -2.77352e-12 -9.29293e-05 -9.29293e-05 -4.99782e-05  5.37256e-15 -9.47608e-12  2.25724e-05 -7.86101e-16  1.31557e-13 -6.78154e-15 -2.47902e-14   0.00242562    0.0671913  1.70162e-05  0.000240233    3.525e-15 -4.28848e-13    -0.042045   -0.0156775         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 8.57418e-15  1.09831e-11   0.00570602     0.105939 -1.01234e-13  4.13362e-11  9.29293e-05  9.29293e-05  4.99782e-05 -5.58038e-15 -5.52141e-12 -2.25724e-05 -7.52902e-15  2.44465e-12  3.77712e-14 -3.98858e-11   -0.0671913  -0.00242562  0.000240233  1.70162e-05 -1.06562e-17 -4.23106e-12     0.042045   -0.0156775         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0329085 -1.44387e-15  7.14006e-14 -1.01234e-13     0.241204  1.67069e-15  -8.8981e-11 -1.27544e-10 -7.79347e-11   -0.0144728  1.14922e-05  3.67562e-11   -0.0091184 -3.62182e-05   -0.0442994 -6.76492e-15  7.16469e-14  9.25735e-14  2.36953e-11 -2.81056e-11   0.00443755  3.66357e-07 -7.79516e-14 -8.73106e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.43193e-15    0.0329085 -2.77352e-12  4.13362e-11    1.663e-15     0.241204 -3.59418e-15 -3.33537e-14 -6.93373e-16 -1.14922e-05   -0.0144728  6.07357e-16 -3.62182e-05    0.0091184 -6.63251e-15   -0.0442994  7.97801e-12  3.56775e-12 -2.85857e-14  7.72034e-15 -3.66357e-07   0.00443755 -4.12296e-11  3.53568e-13         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 2.39173e-11  1.91964e-15 -9.29293e-05  9.29293e-05  -8.8981e-11 -3.59418e-15      0.22297     0.111325    0.0629404 -1.63895e-11  5.66766e-15   -0.0284267  2.13343e-13  4.14831e-17  7.63026e-12  4.39154e-16  0.000160224 -9.70247e-05    0.0336288    0.0311369 -4.14012e-12    -1.28e-15  2.68645e-05   0.00438678         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.07034e-11 -8.24404e-15 -9.29293e-05  9.29293e-05 -1.27544e-10 -3.33537e-14     0.111325      0.22297    0.0629404   -1.392e-12  5.46496e-15   -0.0284267  2.78953e-12  8.30753e-15  4.75409e-11  3.12577e-14 -9.70247e-05  0.000160224   -0.0311369   -0.0336288  6.57505e-13  3.40155e-15  2.68645e-05  -0.00438678         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-5.66315e-12  1.12802e-16 -4.99782e-05  4.99782e-05 -7.79347e-11  -6.9339e-16    0.0629404    0.0629404      0.42963  9.32904e-12 -7.21499e-15    0.0122085  1.22467e-11  4.81353e-14  7.86999e-12  3.32699e-16  2.09473e-07  2.09473e-07   6.5915e-05  -6.5915e-05  6.82964e-12 -5.26541e-16  2.77771e-05  5.71218e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0156091 -1.23945e-05  5.37258e-15 -5.58065e-15   -0.0144728 -1.14922e-05 -1.63895e-11   -1.392e-12  9.32904e-12     0.465176   7.7433e-16  1.57164e-11 -0.000658395 -2.09233e-06   -0.0103444 -8.21402e-06 -9.40638e-15  4.01464e-15 -2.18903e-12 -1.20055e-12    0.0177317  1.55438e-05 -1.80783e-14 -5.27363e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.23945e-05   -0.0156091 -9.47608e-12 -5.52141e-12  1.14922e-05   -0.0144728  5.66763e-15  5.46475e-15 -7.21499e-15  6.70806e-16     0.465176 -1.22547e-14 -2.09233e-06  0.000658395  8.21402e-06   -0.0103444  1.49343e-13 -3.24027e-12 -1.33687e-15  -1.2116e-14 -1.55438e-05    0.0177317 -1.06261e-11  1.43499e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 1.35053e-11  2.30282e-16  2.25724e-05 -2.25724e-05  3.67562e-11  6.07085e-16   -0.0284267   -0.0284267    0.0122085  1.57164e-11 -1.22547e-14     0.636701  1.16004e-11  4.62826e-14 -1.83939e-11 -2.92344e-17  6.62711e-05  6.62711e-05    0.0208536   -0.0208536 -2.55625e-11 -2.09213e-15 -1.25646e-05 -1.40008e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0483431  0.000192018 -7.86101e-16 -7.52902e-15   -0.0091184 -3.62182e-05  2.13343e-13  2.78953e-12  1.22467e-11 -0.000658395 -2.09233e-06  1.16004e-11     0.917337  2.06289e-14   -0.0223427 -8.87451e-05  6.25334e-14    6.603e-14  1.37033e-11 -1.81417e-11    0.0232849  9.44097e-05   -1.895e-15 -1.08799e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 0.000192018   -0.0483431  1.31557e-13  2.44465e-12 -3.62182e-05    0.0091184  4.14847e-17  8.30753e-15  4.81353e-14 -2.09233e-06  0.000658395  4.62826e-14  2.05507e-14     0.917337 -8.87451e-05    0.0223427 -5.65305e-12 -1.21463e-12  7.66309e-14 -7.31482e-14  9.44097e-05   -0.0232849  1.49289e-12 -2.42331e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "   0.0481685 -2.41834e-15 -6.78175e-15  3.77714e-14   -0.0442994 -6.64521e-15  7.63026e-12  4.75409e-11  7.86999e-12   -0.0103444  8.21402e-06 -1.83939e-11   -0.0223427 -8.87451e-05     0.983661   1.0546e-14 -1.09015e-13 -6.96648e-14  -3.2267e-11  2.39697e-11   0.00432401  3.56983e-07  1.77859e-14 -2.75752e-12         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-2.50862e-15    0.0481685 -2.47902e-14 -3.98858e-11 -6.81625e-15   -0.0442994  4.39249e-16  3.12574e-14  3.32694e-16 -8.21402e-06   -0.0103444 -2.92366e-17 -8.87451e-05    0.0223427    1.057e-14     0.983661  5.47468e-12 -2.82258e-12 -2.40432e-14 -1.52935e-14 -3.56983e-07   0.00432401  1.26241e-11  1.07644e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.34157e-14  1.06186e-11   0.00242562   -0.0671913  7.16469e-14  7.97801e-12  0.000160224 -9.70247e-05  2.09473e-07 -9.40636e-15  1.49343e-13  6.62711e-05  6.25334e-14 -5.65305e-12 -1.09015e-13  5.47468e-12      1.06175   0.00440521  0.000258759 -0.000258759  4.51715e-14  -2.1392e-11    -0.015997   0.00632416         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-6.09483e-15 -1.46897e-12    0.0671913  -0.00242562  9.25735e-14  3.56775e-12 -9.70247e-05  0.000160224  2.09473e-07  4.01464e-15 -3.24027e-12  6.62711e-05    6.603e-14 -1.21463e-12 -6.96648e-14 -2.82258e-12   0.00440521      1.06175  0.000258759 -0.000258759 -7.34026e-14  3.21488e-12    -0.015997  -0.00632416         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.69248e-11 -4.36749e-14  1.70162e-05  0.000240233  2.36953e-11 -2.85857e-14    0.0336288   -0.0311369   6.5915e-05 -2.18903e-12 -1.33688e-15    0.0208536  1.37033e-11   7.6631e-14  -3.2267e-11 -2.40432e-14  0.000258759  0.000258759      1.14317   -0.0858283  7.42141e-12  8.90101e-14   6.0507e-05   0.00179185         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 4.83713e-12 -1.36136e-14  0.000240233  1.70162e-05 -2.81056e-11  7.72035e-15    0.0311369   -0.0336288  -6.5915e-05 -1.20055e-12  -1.2116e-14   -0.0208536 -1.81417e-11 -7.31482e-14  2.39697e-11 -1.52935e-14 -0.000258759 -0.000258759   -0.0858283      1.14317  1.70526e-11  2.93557e-14  -6.0507e-05   0.00179185         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "  -0.0574548  4.74336e-06 -3.75787e-15  7.04296e-15   0.00354178 -2.92403e-07  4.69054e-12  9.68876e-12 -2.23411e-12    0.0101472 -8.89521e-06 -1.18409e-11    0.0187031  7.58325e-05     0.019244 -1.58875e-06 -1.47609e-14 -7.00629e-14 -7.84424e-12  1.92398e-11     0.601743  8.83736e-15 -5.50852e-14  3.08292e-11         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-4.74336e-06   -0.0574548  3.79711e-13 -5.19074e-12  2.92403e-07   0.00354178   -2.939e-15   1.9309e-15 -4.75522e-16  8.89521e-06    0.0101472 -1.14319e-15  7.58325e-05   -0.0187031  1.58875e-06     0.019244 -9.65459e-12  1.74364e-12  3.86061e-14  1.62426e-14  8.82127e-15     0.601743  5.26069e-11 -1.21988e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      " 5.89146e-15 -5.13913e-12   -0.0425254    0.0425254  -6.6589e-14 -1.05699e-11   2.1174e-05   2.1174e-05  1.94948e-05  6.56078e-15  2.14406e-11 -8.37791e-06  4.87716e-15 -2.74343e-13  9.18208e-15 -1.75334e-12   -0.0169499   -0.0169499   6.9452e-05  -6.9452e-05 -2.99847e-14    4.414e-11       1.9854 -8.23798e-10         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "-1.56329e-12  6.94636e-12   -0.0176701   -0.0176701  9.86332e-12 -3.26658e-11   0.00496397  -0.00496397  9.00693e-11  5.43568e-12 -2.01984e-11 -2.83229e-11  -1.9893e-13  5.49939e-13 -7.39119e-12  2.15561e-11    0.0076065   -0.0076065   0.00205473   0.00205473  2.67257e-11 -1.09303e-10 -8.22853e-10     0.783387         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan\r\n",
      "        -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan         -nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan          nan\r\n",
      "an error occurred:\r\n",
      "Small generalized eigenvalue problem failed.\r\n"
     ]
    }
   ],
   "source": [
    "!xtp_tools -c job_name=CO geometry_optimization.maxiter=1 dftpackage.basisset=3-21G dftpackage.auxbasisset=aux-def2-svp gwbse.gw.mode=G0W0 -e dftgwbse -t 4"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Notice that we are using 4 threads. The results will be stored in a file named `CO_summary.xml` in the current work directory, together with the optimization step in `optimisation.trj` and the orbitals in [hdf5 format](https://www.hdfgroup.org/solutions/hdf5/) saved on `CO.orb`."
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.10.1"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
