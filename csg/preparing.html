<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Preparing coarse-grained runs &mdash; VOTCA 2023-dev documentation</title>
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Methods" href="methods.html" />
    <link rel="prev" title="Input files" href="input_files.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html">
            <img src="../_static/customLogo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div>
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Main">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../INSTALL.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Manuals</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">TOOLS Manual</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">CSG Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="theory.html">Theoretical background</a></li>
<li class="toctree-l2"><a class="reference internal" href="input_files.html">Input files</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Preparing coarse-grained runs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#preliminary-note">Preliminary note</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#generating-a-topology-file-for-a-coarse-grained-run">Generating a topology file for a coarse-grained run</a></li>
<li class="toctree-l4"><a class="reference internal" href="#post-processing-of-the-potential">Post-processing of the potential</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#clipping-of-poorly-sampled-regions">Clipping of poorly sampled regions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resampling">Resampling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#extrapolation">Extrapolation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exporting-the-table">Exporting the table</a></li>
<li class="toctree-l3"><a class="reference internal" href="#an-example-on-non-bonded-interactions">An example on non-bonded interactions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#alternatives">Alternatives</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="methods.html">Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced_topics.html">Advanced topics</a></li>
<li class="toctree-l2"><a class="reference internal" href="reference.html">Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="bibliography.html">Bibliography</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#citations">Citations</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#development">Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#copyright">Copyright</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../xtp/XTP-MANUAL.html">XTP Manual</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../csg-tutorials/README.html">CSG Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xtp-tutorials/XTP-TUTORIAL.html">XTP Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../DEVELOPERS_GUIDE.html">Developer and Contributor Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../VOTCA_LANGUAGE_GUIDE.html">VOTCA Internal Contributor Language Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Architecture.html">The architecture of VOTCA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xtp/Architecture.html">Architecture of votca-xtp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../websiteAndDocumentation.html">Website and Documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/votca">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://twitter.com/votca_software">Twitter</a></li>
<li class="toctree-l1"><a class="reference external" href="https://groups.google.com/g/votca">Forum</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" aria-label="Top" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">VOTCA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          

<div role="navigation" aria-label="Breadcrumbs">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">CSG Manual</a> &raquo;</li>
      <li>Preparing coarse-grained runs</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/csg/preparing.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="preparing-coarse-grained-runs">
<span id="preparing"></span><h1>Preparing coarse-grained runs<a class="headerlink" href="#preparing-coarse-grained-runs" title="Permalink to this heading">¶</a></h1>
<section id="preliminary-note">
<h2>Preliminary note<a class="headerlink" href="#preliminary-note" title="Permalink to this heading">¶</a></h2>
<p>The coarse-grained run requires the molecule topology on the one hand
and suitable potentials on the other. In this chapter, the generation of
coarse-grained runs is described next, followed by a post-processing of
the potential.</p>
<p>If the potential is of such a form that it allows direct fitting of a
functional form, the section on post-processing can be skipped. Instead,
a program of choice should be used to fit a functional form to the
potential. Nevertheless, special attention should be paid to units
(angles, bond lengths). The resulting curve can then be specified in the
MD package used for simulation. However, most potentials don’t allow an
easy processing of this kind and tabulated potentials have to be used.</p>
<section id="generating-a-topology-file-for-a-coarse-grained-run">
<h3>Generating a topology file for a coarse-grained run<a class="headerlink" href="#generating-a-topology-file-for-a-coarse-grained-run" title="Permalink to this heading">¶</a></h3>
<p><strong>WARNING: This section describes experimental features. The exact names and options of the program might change in the near future. The section is specific to GROMACS support though a generalization for other MD packages is planned.</strong></p>
<p>The mapping definition is close to a topology needed for a coarse
grained run. To avoid redundant work, can be used to automatically
generate a gromacs topology based on an atomistic reference system and a
mapping file.</p>
<p>At the current state, can only generate the topology for the first
molecule in the system. If more molecule types are present, a special
tpr file has to be prepared. The program can be executed by</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>csg_gmxtopol --top topol.tpr --cg map.xml --out cgtop
</pre></div>
</div>
<p>which will create a file <code class="docutils literal notranslate"><span class="pre">cgtop.top</span></code>. This file includes the topology
for the first molecule including definitions for atoms, bonds, angles
and dihedrals. It can directly be used as a topology in GROMACS, however
the force field definitions (atom types, bond types, etc.) still have to
be added manually.</p>
</section>
<section id="post-processing-of-the-potential">
<span id="preparing-post-processing-of-the-potential"></span><h3>Post-processing of the potential<a class="headerlink" href="#post-processing-of-the-potential" title="Permalink to this heading">¶</a></h3>
<p>The VOTCA package provides a collection of scripts to handle potentials.
They can be modified, refined, integrated or inter- and extrapolated.
These scripts are the same ones as those used for iterative methods in
<a class="reference internal" href="methods.html#methods-iterative-methods"><span class="std std-ref">Iterative methods</span></a>. Scripts are called by . A complete
list of available scripts can be found in <a class="reference internal" href="reference.html#reference-scripts"><span class="std std-ref">Scripts</span></a>.</p>
<p>The post-processing roughly consists of the following steps (see further
explanations below):</p>
<ul class="simple">
<li><p>(manually) clipping poorly sampled (border) regions</p></li>
<li><p>resampling the potential in order to change the grid to the proper
format ()</p></li>
<li><p>extrapolation of the potential at the borders ( table extrapolate)</p></li>
<li><p>exporting the table to xvg ( convert_potential gromacs)</p></li>
</ul>
</section>
</section>
<section id="clipping-of-poorly-sampled-regions">
<h2>Clipping of poorly sampled regions<a class="headerlink" href="#clipping-of-poorly-sampled-regions" title="Permalink to this heading">¶</a></h2>
<p>Regions with an irregular distribution of samples should be deleted
first. This is simply done by editing the <code class="docutils literal notranslate"><span class="pre">.pot</span></code> file and by deleting
those values.</p>
<p>Alternatively, manually check the range where the potential still looks
good and is not to noisy and set the flags in the potential file of the
bad parts by hand to <code class="docutils literal notranslate"><span class="pre">o</span></code> (for <code class="docutils literal notranslate"><span class="pre">out</span> <span class="pre">of</span> <span class="pre">range</span></code>). Those values will
later be extrapolated and overwritten.</p>
</section>
<section id="resampling">
<h2>Resampling<a class="headerlink" href="#resampling" title="Permalink to this heading">¶</a></h2>
<p>Use the command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>csg_resample --in table.pot --out table_resample.pot <span class="se">\</span>
             --grid min:step:max
</pre></div>
</div>
<p>to resample the potential given in file –<code class="docutils literal notranslate"><span class="pre">table.pot</span></code> from <code class="docutils literal notranslate"><span class="pre">min</span></code> to
<code class="docutils literal notranslate"><span class="pre">max</span></code> with a grid spacing of <code class="docutils literal notranslate"><span class="pre">step</span></code> steps. The result is written to
the file specified by <code class="docutils literal notranslate"><span class="pre">out</span></code>. Additionally, allows the specification of
spline interpolation (<code class="docutils literal notranslate"><span class="pre">spfit</span></code>), the calculation of derivatives
(<code class="docutils literal notranslate"><span class="pre">derivative</span></code>) and comments (<code class="docutils literal notranslate"><span class="pre">comment</span></code>). Check the help (<code class="docutils literal notranslate"><span class="pre">help</span></code>)
for further information.</p>
<p>It is important to note that the values <code class="docutils literal notranslate"><span class="pre">min</span></code> and <code class="docutils literal notranslate"><span class="pre">max</span></code> <em>don’t</em>
correspond to the minimum and maximum value in the input file, but to
the range of values the potential is desired to cover after
extrapolation. Therefore, values in <span class="math notranslate nohighlight">\([ \min,\max ]\)</span> that are not
covered in the file are automatically marked by a flag <code class="docutils literal notranslate"><span class="pre">o</span></code> (for
<code class="docutils literal notranslate"><span class="pre">out</span> <span class="pre">of</span> <span class="pre">range</span></code>) for extrapolation in the next step.</p>
<p>The potential <em>don’t</em> have to start at 0, this is done by the export
script (to xvg) automatically.</p>
</section>
<section id="extrapolation">
<h2>Extrapolation<a class="headerlink" href="#extrapolation" title="Permalink to this heading">¶</a></h2>
<p>The following line</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>csg_call table extrapolate <span class="o">[</span>options<span class="o">]</span> table_resample.pot <span class="se">\</span>
         table_extrapolate.pot
</pre></div>
</div>
<p>calls the extrapolation procedure, which processes the range of values
marked by . The input file is <code class="docutils literal notranslate"><span class="pre">table_resample.pot</span></code> created in the last
step.</p>
<p>After resampling, all values in the potential file that should be used
as a basis for extrapolation are marked with an <code class="docutils literal notranslate"><span class="pre">i</span></code>, while all values
that need extrapolation are marked by <code class="docutils literal notranslate"><span class="pre">o</span></code>. The command above now
extrapolates all <code class="docutils literal notranslate"><span class="pre">o</span></code> values from the <code class="docutils literal notranslate"><span class="pre">i</span></code> values in the file.
Available options include averaging over a certain number of points
(<code class="docutils literal notranslate"><span class="pre">avgpoints</span></code>), changing the functional form (<code class="docutils literal notranslate"><span class="pre">function</span></code>, default is
quadratic), extrapolating just the left or right region of the file
(<code class="docutils literal notranslate"><span class="pre">region</span></code>) and setting the curvature (<code class="docutils literal notranslate"><span class="pre">curvature</span></code>).</p>
<p>The output <code class="docutils literal notranslate"><span class="pre">table_extrapolate.pot</span></code> of the extrapolation step can now
be used for the coarse-grained run. If GROMACS is used as a molecule
dynamics package, the potential has to be converted and exported to a
suitable GROMACS format as described in the final step.</p>
</section>
<section id="exporting-the-table">
<h2>Exporting the table<a class="headerlink" href="#exporting-the-table" title="Permalink to this heading">¶</a></h2>
<p>Finally, the table is exported to <code class="docutils literal notranslate"><span class="pre">xvg</span></code>. The conversion procedure
requires a small xml file <code class="docutils literal notranslate"><span class="pre">table.xml</span></code> as shown below:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;cg&gt;</span>
  <span class="nt">&lt;non-bonded&gt;</span>
    <span class="nt">&lt;name&gt;</span>XXX<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;step&gt;</span>0.01<span class="nt">&lt;/step&gt;</span>
  <span class="nt">&lt;/non-bonded&gt;</span>
  <span class="nt">&lt;inverse&gt;</span>
    <span class="nt">&lt;gromacs&gt;</span>
      <span class="nt">&lt;pot_max&gt;</span>1e8<span class="nt">&lt;/pot_max&gt;</span>
      <span class="nt">&lt;table_end&gt;</span>8.0<span class="nt">&lt;/table_end&gt;</span>
      <span class="nt">&lt;table_bins&gt;</span>0.002<span class="nt">&lt;/table_bins&gt;</span>
    <span class="nt">&lt;/gromacs&gt;</span>
  <span class="nt">&lt;/inverse&gt;</span>
<span class="nt">&lt;/cg&gt;</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;table_end&gt;</span></code> is the GROMACS <code class="docutils literal notranslate"><span class="pre">rvdw+table_extension</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;pot_max&gt;</span></code> is just a number slightly smaller than the upper value of
single/ double precision. The value given in <code class="docutils literal notranslate"><span class="pre">&lt;table_bins&gt;</span></code>
corresponds to the <code class="docutils literal notranslate"><span class="pre">step</span></code> value of
<code class="docutils literal notranslate"><span class="pre">csg_resample</span> <span class="pre">-grid</span> <span class="pre">min:step:max</span></code>.</p>
<p>Using the <code class="docutils literal notranslate"><span class="pre">xml</span></code> file above, call</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>csg_call --options table.xml --ia-type non-bonded --ia-name XXX <span class="se">\</span>
  convert_potential gromacs table_extrapolate.pot table.xvg
</pre></div>
</div>
<p>to convert the extrapolated values in <code class="docutils literal notranslate"><span class="pre">table_extrapolate.pot</span></code> to
<code class="docutils literal notranslate"><span class="pre">table.xvg</span></code> (The file will contain the GROMACS C12 parts only which are
stored in the sixth und seventh column, this can be changed by adding
the <code class="docutils literal notranslate"><span class="pre">–ia-type</span> <span class="pre">C6</span></code> option (for the fourth and fiveth column) or
<code class="docutils literal notranslate"><span class="pre">–ia-type</span> <span class="pre">CB</span></code> option (for the second and third column) after . Ensure
compatibility with the GROMACS topology. See the GROMACS manual for
further information).</p>
<p>To obtain a bond table, run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>csg_call --ia-type bond --ia-name XXX --options table.xml <span class="se">\</span>
convert_potential gromacs table_extrapolate.pot table.xvg
</pre></div>
</div>
<p>It is also possible to use <code class="docutils literal notranslate"><span class="pre">angle</span></code> and <code class="docutils literal notranslate"><span class="pre">dihedral</span></code> as type as well,
but make to sure to have a <code class="docutils literal notranslate"><span class="pre">bonded</span></code> section similar to the
<code class="docutils literal notranslate"><span class="pre">non-bonded</span></code> section above with the corresponding interaction name.</p>
<p>Internally <code class="docutils literal notranslate"><span class="pre">convert_potential</span> <span class="pre">gromacs</span></code> will do the following steps:</p>
<ul class="simple">
<li><p>Resampling of the potential from 0 (or -180 for dihedrals) to
<code class="docutils literal notranslate"><span class="pre">table_end</span></code> (or 180 for angles and dihedrals) with step size
<code class="docutils literal notranslate"><span class="pre">table_bins</span></code>. This is needed for gromacs the table must start with
0 or -180.</p></li>
<li><p>Extrapolate the left side (to 0 or -180) exponentially</p></li>
<li><p>Extrapolate the right side (to <code class="docutils literal notranslate"><span class="pre">table_end</span></code> or 180) exponentially
(or constant for non-bonded interactions)</p></li>
<li><p>Shift it so that the potential is zero at <code class="docutils literal notranslate"><span class="pre">table_end</span></code> for
non-bonded interactions or zero at the minimum for bonded interaction</p></li>
<li><p>Calculate the force (assume periodicity for dihedral potentials)</p></li>
<li><p>Write to the format needed by gromacs</p></li>
</ul>
</section>
<section id="an-example-on-non-bonded-interactions">
<h2>An example on non-bonded interactions<a class="headerlink" href="#an-example-on-non-bonded-interactions" title="Permalink to this heading">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>csg_call pot shift_nonbonded table.pot table.pot.refined
csg_resample --grid <span class="m">0</span>.3:0.05:2 --in table.pot.refined <span class="se">\</span>
         --out table.pot.refined
csg_call table extrapolate --function quadratic --region left <span class="se">\</span>
         table.pot.refined table.pot.refined
csg_call table extrapolate --function constant --region right <span class="se">\</span>
         table.pot.refined table.pot.refined
</pre></div>
</div>
<section id="alternatives">
<h3>Alternatives<a class="headerlink" href="#alternatives" title="Permalink to this heading">¶</a></h3>
<p>Additionally to the two methods described above, namely (a) providing
the MD package directly with a functional form fitted with a program of
choice or (b) using <code class="docutils literal notranslate"><span class="pre">csg_resample</span></code>, <code class="docutils literal notranslate"><span class="pre">csg_call</span> <span class="pre">table</span> <span class="pre">extrapolate</span></code> and
<code class="docutils literal notranslate"><span class="pre">csg_call</span> <span class="pre">convert_potential</span></code>, another method would be suitable. This
is integrating the force table as follows</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Integrate the table</span>
csg_call table integrate force.d minus_pot.d
<span class="c1"># multiply by -1</span>
csg_call table linearop minus_pot.d pot.d -1 <span class="m">0</span>
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="input_files.html" class="btn btn-neutral float-left" title="Input files" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="methods.html" class="btn btn-neutral float-right" title="Methods" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, VOTCA Development Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>