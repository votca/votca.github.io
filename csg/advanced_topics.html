<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Advanced topics &mdash; VOTCA 2025-dev documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/documentation_options.js?v=9cf8aa06"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Reference" href="reference.html" />
    <link rel="prev" title="Methods" href="methods.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/customLogo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../INSTALL.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Manuals</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">TOOLS Manual</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">CSG Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="theory.html">Theoretical background</a></li>
<li class="toctree-l2"><a class="reference internal" href="input_files.html">Input files</a></li>
<li class="toctree-l2"><a class="reference internal" href="preparing.html">Preparing coarse-grained runs</a></li>
<li class="toctree-l2"><a class="reference internal" href="methods.html">Methods</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Advanced topics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#customization">Customization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#used-external-packages">Used external packages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#gromacs">GROMACS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#espresso">ESPResSo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dl-poly">DL_POLY</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gnuplot">Gnuplot</a></li>
<li class="toctree-l4"><a class="reference internal" href="#lammps">LAMMPS</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#dl-poly-interface">DL_POLY interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reference.html">Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="bibliography.html">Bibliography</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#citations">Citations</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#development">Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#copyright">Copyright</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../xtp/XTP-MANUAL.html">XTP Manual</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../csg-tutorials/Tutorial.html">CSG Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xtp-tutorials/XTP-TUTORIAL.html">XTP Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../DEVELOPERS_GUIDE.html">Developer and Contributor Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../VOTCA_LANGUAGE_GUIDE.html">VOTCA Internal Contributor Language Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Architecture.html">The architecture of VOTCA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xtp/Architecture.html">Architecture of votca-xtp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../websiteAndDocumentation.html">Website and Documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/votca">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://twitter.com/votca_software">Twitter</a></li>
<li class="toctree-l1"><a class="reference external" href="https://groups.google.com/g/votca">Forum</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">VOTCA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">CSG Manual</a></li>
      <li class="breadcrumb-item active">Advanced topics</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/csg/advanced_topics.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="advanced-topics">
<h1>Advanced topics<a class="headerlink" href="#advanced-topics" title="Link to this heading">¶</a></h1>
<section id="customization">
<h2>Customization<a class="headerlink" href="#customization" title="Link to this heading">¶</a></h2>
<p>Each sub-step of an iteration and all direct calls can be adjusted to
the user needs. The internal part of the iterative framework is
organized as follows: all scripts are called using two keywords</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>csg_call<span class="w"> </span>key1<span class="w"> </span>key2
</pre></div>
</div>
<p>For example, <code class="docutils literal notranslate"><span class="pre">csg_call</span> <span class="pre">update</span> <span class="pre">imc</span></code> calls the <code class="docutils literal notranslate"><span class="pre">update</span></code> script for the
inverse Monte Carlo procedure. The corresponding keywords are listed in
<a class="reference internal" href="reference.html#reference-scripts"><span class="std std-ref">Scripts</span></a> or can be output directly by calling</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>csg_call<span class="w"> </span>--list
</pre></div>
</div>
<p>It is advised not to change already implemented scripts. To customize a
script or add a new one, copy the script to your own directory (set by <code class="docutils literal notranslate"><span class="pre">inverse.scriptpath</span></code>)
and redirect its call by creating your own <code class="docutils literal notranslate"><span class="pre">csg_table</span></code> file in this
directory which looks like this</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>key1<span class="w"> </span>key2<span class="w"> </span>script1<span class="w"> </span>options
key3<span class="w"> </span>key4<span class="w"> </span>script2
</pre></div>
</div>
<p>If the local keys are already in use, the existing call will be
overloaded.</p>
<p>As an example, we will illustrate how to overload the script which calls
the sampling package. The <code class="docutils literal notranslate"><span class="pre">csg_inverse</span></code> script runs <code class="docutils literal notranslate"><span class="pre">mdrun</span></code> from the GROMACS package only on
one cpu. Our task will be to change the script so that GROMACS uses 8
cpus, which is basically the same as adding mpirun options in <code class="docutils literal notranslate"><span class="pre">inverse.gromacs.mdrun.command</span></code>.</p>
<p>First we find out which script calls <code class="docutils literal notranslate"><span class="pre">mdrun</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>csg_call<span class="w"> </span>--list<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>gromacs
</pre></div>
</div>
<p>The output should look as follows</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>init gromacs initalize_gromacs.sh
prepare gromacs prepare_gromacs.sh
run gromacs run_gromacs.sh
pressure gromacs calc_pressure_gromacs.sh
rdf gromacs calc_rdf_gromacs.sh
imc_stat gromacs imc_stat_generic.sh
convert_potential gromacs potential_to_gromacs.sh
</pre></div>
</div>
<p>the third line indicates the script we need. If the output of <code class="docutils literal notranslate"><span class="pre">csg_call</span></code> is not
clear, one can try to find the right script in <a class="reference internal" href="reference.html#reference-scripts"><span class="std std-ref">Scripts</span></a>.
Alternatively, check the folder</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;csg-installation&gt;/share/scripts/inverse
</pre></div>
</div>
<p>for all available scripts.</p>
<p>Analyzing the output of</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>csg_call<span class="w"> </span>--cat<span class="w"> </span>run<span class="w"> </span>gromacs
</pre></div>
</div>
<p>we can conclude that this is indeed the script we need as the content
(in shorted form is):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>critical<span class="w"> </span>mdrun
</pre></div>
</div>
<p>Now we can create our own <code class="docutils literal notranslate"><span class="pre">SCRIPTDIR</span></code>, add a new script there, make it
executable and overload the call of the script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>-p<span class="w"> </span>SCRIPTDIR
cp<span class="w"> </span><span class="sb">`</span>csg_call<span class="w"> </span>--quiet<span class="w"> </span>--show<span class="w"> </span>run<span class="w"> </span>gromacs<span class="sb">`</span><span class="w"> </span>SCRIPTDIR/my_run_gromacs.sh
chmod<span class="w"> </span><span class="m">755</span><span class="w"> </span>SCRIPTDIR/my_run_gromacs.sh
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;run gromacs my_run_gromacs.sh&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>SCRIPTDIR/csg_table
</pre></div>
</div>
<p>Please note that <code class="docutils literal notranslate"><span class="pre">my_run_gromacs.sh</span></code> is the name of the script and
<code class="docutils literal notranslate"><span class="pre">SCRIPTDIR</span></code> is the custom script directory, which can be a global or a
local path. Now we change the last line of <code class="docutils literal notranslate"><span class="pre">my_run_gromacs.sh</span></code> to:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>critical<span class="w"> </span>mpirun<span class="w"> </span>-np<span class="w"> </span><span class="m">8</span><span class="w"> </span>mdrun
</pre></div>
</div>
<p>This completes the customization. Do not forget to add <code class="docutils literal notranslate"><span class="pre">SCRIPTDIR</span></code> to
<code class="docutils literal notranslate"><span class="pre">inverse.scriptpath</span></code> in the setting XML file (see <a class="reference internal" href="reference.html#reference-settings-file"><span class="std std-ref">Settings file</span></a>).</p>
<p>You can check the new script by running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>csg_call<span class="w"> </span>--scriptdir<span class="w"> </span>SCRIPTDIR<span class="w"> </span>--list
csg_call<span class="w"> </span>--scriptdir<span class="w"> </span>SCRIPTDIR<span class="w"> </span>--run<span class="w"> </span>run<span class="w"> </span>gromacs
</pre></div>
</div>
<p>Finally, do not forget to remove the license infomation and change the
version number of the script.</p>
</section>
<section id="used-external-packages">
<h2>Used external packages<a class="headerlink" href="#used-external-packages" title="Link to this heading">¶</a></h2>
<section id="gromacs">
<h3>GROMACS<a class="headerlink" href="#gromacs" title="Link to this heading">¶</a></h3>
<p><cite>Link to Homepage &lt;https://manual.gromacs.org/documentation/&gt;</cite></p>
</section>
<section id="espresso">
<h3>ESPResSo<a class="headerlink" href="#espresso" title="Link to this heading">¶</a></h3>
<p><cite>Link to Homepage &lt;https://espressomd.org/&gt;</cite></p>
</section>
<section id="dl-poly">
<h3>DL_POLY<a class="headerlink" href="#dl-poly" title="Link to this heading">¶</a></h3>
<p><cite>Link to Homepage &lt;https://www.scd.stfc.ac.uk/Pages/DL_POLY.aspx&gt;</cite></p>
</section>
<section id="gnuplot">
<h3>Gnuplot<a class="headerlink" href="#gnuplot" title="Link to this heading">¶</a></h3>
<p><cite>Link to Homepage &lt;http://www.gnuplot.info/&gt;</cite></p>
</section>
<section id="lammps">
<h3>LAMMPS<a class="headerlink" href="#lammps" title="Link to this heading">¶</a></h3>
<p><cite>Link to Homepage &lt;https://lammps.sandia.gov/&gt;</cite></p>
</section>
</section>
<section id="dl-poly-interface">
<h2>DL_POLY interface<a class="headerlink" href="#dl-poly-interface" title="Link to this heading">¶</a></h2>
<p><strong>WARNING: The DL_POLY interface is still experimental (in development)
but it does support the Iterative Boltzmann Inversion and Inverse Monte
Carlo schemes. The Force Matching might work as well, although it has
not been tested thoroughly.</strong></p>
<p>The DL_POLY interface fully supports coarse-grain mapping of a full-atom
system previuosly simulated with any version of DL_POLY, including
DL_POLY-Classic. However, the full optimization of the effective
potentials with the aid of iterative methods will only become possible
when the new release of DL_POLY-4 (4.06) is made public; the reason
being the incapability of earlier DL_POLY versions of using
user-specified tabulated force-fields for intramolecular, aka “bonded”,
interactions: bonds, angles, dihedral angles (torsions). Below the
coarse-graining and CG force-field optimization with the aid of the
latest DL_POLY-4 version (4.06+) are outlined.</p>
<p>Running VOTCA with DL_POLY-4 as MD simulation engine is very similar to
doing so with GROMACS. The three types of required input files in the
case of DL_POLY are: CONTROL – containing the simulation directives and
parameters (instead of <code class="docutils literal notranslate"><span class="pre">.mdp</span></code> file for GROMACS), FIELD – the topology
and force-field specifications (instead of <code class="docutils literal notranslate"><span class="pre">.top</span></code> and <code class="docutils literal notranslate"><span class="pre">.tpr</span></code> files),
and CONFIG (instead of <code class="docutils literal notranslate"><span class="pre">.gro</span></code> file) – the initial configuration file,
containing the MD cell matrix and particle coordinates (it can also
include initial velocities and/or forces); for details see
DL_POLY-4 manual. Most of the VOTCA tools and scripts described above in
the case of using GROMACS will work in the same manner, with the
following conventional substitutions for the (default) file names used
in options for VOTCA scripts, as necessary:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dlpf = the topology read from FIELD or written to FIELD_CGV
.dlpc = the configuration read from CONFIG or written to CONFIG_CGV
.dlph = the trajectory read from HISTORY or written to HISTORY_CGV
</pre></div>
</div>
<p>It is also possible to specify file names different from the standard
DL_POLY convention, in which case the user has to use the corresponding
dot-preceded extension(s); for example: FA-FIELD.dlpf instead of FIELD
or CG-HISTORY.dlph instead of HISTORY_CGV (see
<a class="reference internal" href="reference.html#reference-programs"><span class="std std-ref">Programs</span></a>, as well as the man pages or output of
VOTCA commands, with option <code class="docutils literal notranslate"><span class="pre">--help</span></code>).</p>
<p>VOTCA follows the DL_POLY conventions for file names and formats. Thus,
<code class="docutils literal notranslate"><span class="pre">csg_dlptopol</span></code> and <code class="docutils literal notranslate"><span class="pre">csg_map</span></code> produce the CG topology (FIELD_CGV by
default), configuration (CONFIG_CGV), and/or trajectory (HISTORY_CGV)
files fully compatible with and usable by DL_POLY. <strong>Note that the
ability of these tools to read and write a plethora of different file
formats provides means to convert input and output files between the
simulation packages supported by VOTCA, e.g. GROMACS – DL_POLY or vice
versa. The user is, however, strongly advised to check the resulting
files for consistency before using them).</strong></p>
<p>Similarly, the distribution analysis and potential/force generation
utilities, such as <code class="docutils literal notranslate"><span class="pre">csg_stat</span></code> and VOTCA scripts, will read and write
DL_POLY-formatted files; in particular, the tabulated force-field files
containing the potential and force/virial data: TABLE – for short-range
(VdW) “non-bonded” interactions, TABBND, TABANG and TABDIH – for
“bonded” interations: bonds, bending angles and dihedrals,
correspondingly (for the format details see DL_POLY-4 manual). Note,
however, that the latter three files can only be used by
DL_POLY-4 (4.06+).</p>
<p>The user is advised to search for “dlpoly” through the
<code class="docutils literal notranslate"><span class="pre">csg_defaults.xml</span></code>, <code class="docutils literal notranslate"><span class="pre">csg_table</span></code> files and in scripts located in
<code class="docutils literal notranslate"><span class="pre">share/votca/scripts/inverse/</span></code> in order to find out about the xml-tags
and options specific for DL_POLY; see also <a class="reference internal" href="reference.html#reference-settings-file"><span class="std std-ref">Settings file</span></a>
and <a class="reference internal" href="reference.html#reference-scripts"><span class="std std-ref">Scripts</span></a>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="methods.html" class="btn btn-neutral float-left" title="Methods" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="reference.html" class="btn btn-neutral float-right" title="Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, VOTCA Development Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>